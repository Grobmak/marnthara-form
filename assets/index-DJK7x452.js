(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const c of n)if(c.type==="childList")for(const a of c.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function o(n){const c={};return n.integrity&&(c.integrity=n.integrity),n.referrerPolicy&&(c.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?c.credentials="include":n.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function r(n){if(n.ep)return;n.ep=!0;const c=o(n);fetch(n.href,c)}})();const Ie="input-ui/5.6.0-final",Ce="https://your-make-webhook-url.com/your-unique-path",ce="marnthara.input.v4",ke=500,I={name:"ม่านธารา ผ้าม่านและของตกแต่ง",address:"65/8 หมู่ 2 ต.ท่าศาลา อ.เมือง จ.ลพบุรี 15000",phone:"092-985-9395, 082-552-5595",taxId:"1234567890123",logoUrl:"https://i.imgur.com/l7y85nI.png",baseVatRate:.07,pdf:{paymentTerms:"ชำระมัดจำ 50%",priceValidity:"30 วัน",notes:["ราคานี้รวมค่าติดตั้งแล้ว","ชำระมัดจำ 50% เพื่อยืนยันการสั่งผลิตสินค้า","ใบเสนอราคานี้มีอายุ 30 วัน นับจากวันที่เสนอราคา"]}},Ee=1.19599,me={ROLL_WIDTH_M:.53,ROLL_LENGTH_M:10,STRIPS_PER_ROLL_UNDER_2_5M:3},ie={fabric:[1e3,1100,1200,1300,1400,1500,1600,1700,1800,1900,2e3,2100,2200],sheer:[1e3,1100,1200,1300,1400,1500],style_surcharge:{ลอน:200,ตาไก่:0,จีบ:0},height:[{threshold:3.2,add_per_m:300},{threshold:2.8,add_per_m:200},{threshold:2.5,add_per_m:100}]},m={orderForm:"#orderForm",roomsContainer:"#rooms",setTpl:"#setTpl",clearAllBtn:"#clearAllBtn",lockBtn:"#lockBtn",grandTotal:"#grandTotal",setCount:"#setCount",modal:"#confirmationModal",modalTitle:"#modalTitle",modalBody:"#modalBody",room:"[data-room]",set:"[data-set]",setsContainer:"[data-sets]",decorationsContainer:"[data-decorations]",decoItem:"[data-deco-item]",wallpapersContainer:"[data-wallpapers]",wallpaperItem:"[data-wallpaper-item]",wallsContainer:"[data-walls-container]",sheerWrap:"[data-sheer-wrap]",roomNameInput:'input[name="room_name"]',toastContainer:"#toast-container",copyTextBtn:"#copyTextBtn",copyOptionsModal:"#copyOptionsModal",menuBtn:"#menuBtn",menuDropdown:"#menuDropdown",importBtn:"#importBtn",exportBtn:"#exportBtn",fileImporter:"#fileImporter",submitBtn:"#submitBtn",clearItemsBtn:"#clearItemsBtn",exportPdfBtn:"#exportPdfBtn",exportOptionsModal:"#exportOptionsModal",printableContent:"#printable-content",quickNavBtn:"#quickNavBtn",quickNavDropdown:"#quickNavDropdown",quickNavRoomList:"#quickNavRoomList",toggleAllRoomsBtn:"#toggleAllRoomsBtn"},v=t=>{typeof t=="string"&&(t=t.replace(/,/g,""));const e=parseFloat(t);return Number.isFinite(e)?e:0},H=t=>{const e=v(t);return e>0?e.toFixed(2):""},A=(t,e=2,o=!1)=>Number.isFinite(t)?t.toLocaleString("en-US",{minimumFractionDigits:o?2:e,maximumFractionDigits:o?2:e}):"0",x=(t,e=0)=>Number.isFinite(t)?t.toLocaleString("th-TH",{minimumFractionDigits:e,maximumFractionDigits:e}):"0",Be=(t,e=150)=>{let o;return(...r)=>{clearTimeout(o),o=setTimeout(()=>t(...r),e)}},Me=(t,e=700)=>{let o=!1;return(...r)=>{if(!o){o=!0;try{return t(...r)}finally{setTimeout(()=>{o=!1},e)}}}};function Ae(t){let e=v(t);if(isNaN(e))return"ข้อมูลตัวเลขไม่ถูกต้อง";if(e===0)return"ศูนย์บาทถ้วน";const o=["","หนึ่ง","สอง","สาม","สี่","ห้า","หก","เจ็ด","แปด","เก้า"],r=["","สิบ","ร้อย","พัน","หมื่น","แสน","ล้าน"];let n=Math.floor(e),c=Math.round((e-n)*100);const a=l=>{if(l===0)return"";let u="";const d=String(l);for(let p=0;p<d.length;p++){const f=d[p];d.length-1;const h=d.length-p-1;f!=="0"&&(h===1&&f==="1"?u+=r[h]:h===1&&f==="2"?u+="ยี่"+r[h]:h===0&&f==="1"&&d.length>1?u+="เอ็ด":u+=o[parseInt(f)]+r[h])}return u};let i="";if(n>0){const l=Math.floor(n/1e6),u=n%1e6;l>0&&(i+=a(l)+"ล้าน"),i+=a(u),i+="บาท"}let s="";return c>0?s=a(c)+"สตางค์":i+="ถ้วน",(i+s).trim()}function j(){var e,o,r,n;const t={app_version:Ie,customer_name:((e=document.querySelector('[name="customer_name"]'))==null?void 0:e.value)||"",customer_phone:((o=document.querySelector('[name="customer_phone"]'))==null?void 0:o.value)||"",customer_address:((r=document.querySelector('[name="customer_address"]'))==null?void 0:r.value)||"",customer_card_open:(n=document.querySelector("#customerDetailsCard"))==null?void 0:n.open,rooms:[]};return document.querySelectorAll(m.room).forEach(c=>{var i;const a={id:c.id,room_name:((i=c.querySelector(m.roomNameInput))==null?void 0:i.value)||"",is_suspended:c.classList.contains("is-suspended"),is_open:c.open,sets:[],decorations:[],wallpapers:[]};c.querySelectorAll(m.set).forEach(s=>{var l,u,d,p,f,h,g,S,q,y,L;a.sets.push({width_m:v((l=s.querySelector('input[name="width_m"]'))==null?void 0:l.value),height_m:v((u=s.querySelector('input[name="height_m"]'))==null?void 0:u.value),style:((d=s.querySelector('select[name="set_style"]'))==null?void 0:d.value)||"",fabric_variant:((p=s.querySelector('select[name="fabric_variant"]'))==null?void 0:p.value)||"",price_per_m_raw:v((f=s.querySelector('select[name="set_price_per_m"]'))==null?void 0:f.value),sheer_price_per_m:v((h=s.querySelector('select[name="sheer_price_per_m"]'))==null?void 0:h.value),fabric_code:((g=s.querySelector('input[name="fabric_code"]'))==null?void 0:g.value)||"",sheer_fabric_code:((S=s.querySelector('input[name="sheer_fabric_code"]'))==null?void 0:S.value)||"",opening_style:((q=s.querySelector('select[name="opening_style"]'))==null?void 0:q.value)||"",track_color:((y=s.querySelector('select[name="track_color"]'))==null?void 0:y.value)||"",notes:((L=s.querySelector('input[name="notes"]'))==null?void 0:L.value)||"",is_suspended:s.classList.contains("is-suspended")})}),c.querySelectorAll(m.decoItem).forEach(s=>{var l,u,d,p,f,h;a.decorations.push({type:((l=s.querySelector('[name="deco_type"]'))==null?void 0:l.value)||"",width_m:v((u=s.querySelector('[name="deco_width_m"]'))==null?void 0:u.value),height_m:v((d=s.querySelector('[name="deco_height_m"]'))==null?void 0:d.value),price_sqyd:v((p=s.querySelector('[name="deco_price_sqyd"]'))==null?void 0:p.value),deco_code:((f=s.querySelector('[name="deco_code"]'))==null?void 0:f.value)||"",notes:((h=s.querySelector('[name="deco_notes"]'))==null?void 0:h.value)||"",is_suspended:s.classList.contains("is-suspended")})}),c.querySelectorAll(m.wallpaperItem).forEach(s=>{var l,u,d,p,f;a.wallpapers.push({height_m:v((l=s.querySelector('[name="wallpaper_height_m"]'))==null?void 0:l.value),wallpaper_code:((u=s.querySelector('[name="wallpaper_code"]'))==null?void 0:u.value)||"",price_per_roll:v((d=s.querySelector('[name="wallpaper_price_roll"]'))==null?void 0:d.value),install_cost_per_roll:v((p=s.querySelector('[name="wallpaper_install_cost"]'))==null?void 0:p.value),notes:((f=s.querySelector('[name="wallpaper_notes"]'))==null?void 0:f.value)||"",widths:Array.from(s.querySelectorAll('[name="wall_width_m"]')).map(h=>v(h.value)),is_suspended:s.classList.contains("is-suspended")})}),t.rooms.push(a)}),t}function P(){localStorage.setItem(ce,JSON.stringify(j()))}const $={stylePlus:t=>ie.style_surcharge[t]??0,heightPlus:t=>{const e=[...ie.height].sort((o,r)=>r.threshold-o.threshold);for(const o of e)if(t>o.threshold)return o.add_per_m;return 0},fabricYardage:(t,e)=>{const o=v(e);return o<=0||!t?0:t==="ตาไก่"||t==="จีบ"?(o*2+.6)/.9:t==="ลอน"?(o*2.6+.6)/.9:0},wallpaperRolls:(t,e)=>{const o=v(t),r=v(e);if(o<=0||r<=0)return 0;const n=r>2.5?Math.floor(me.ROLL_LENGTH_M/r):me.STRIPS_PER_ROLL_UNDER_2_5M;if(n<=0)return 0;const c=Math.ceil(o/me.ROLL_WIDTH_M);return Math.ceil(c/n)},calculateSetPrice:function(t){var a,i;if(!t||t.is_suspended||v(t.width_m)<=0)return{total:0,opaque:0,sheer:0};const e=this.stylePlus(t.style),o=this.heightPlus(v(t.height_m)),r=v(t.width_m),n=(a=t.fabric_variant)!=null&&a.includes("ทึบ")&&v(t.price_per_m_raw)>0?(v(t.price_per_m_raw)+e+o)*r:0,c=(i=t.fabric_variant)!=null&&i.includes("โปร่ง")&&v(t.sheer_price_per_m)>0?(v(t.sheer_price_per_m)+e+o)*r:0;return{total:Math.round(n+c),opaque:Math.round(n),sheer:Math.round(c)}},calculateDecoPrice:function(t){if(!t||t.is_suspended||v(t.width_m)<=0)return{total:0,sqm:0,sqyd:0};const e=v(t.width_m)*v(t.height_m),o=e*Ee,r=o*v(t.price_sqyd);return{total:Math.round(r),sqm:e,sqyd:o}},calculateWallpaperPrice:function(t){var a;if(!t||t.is_suspended)return{total:0,material:0,install:0,rolls:0,sqm:0};const e=((a=t.widths)==null?void 0:a.reduce((i,s)=>i+v(s),0))||0;if(e<=0)return{total:0,material:0,install:0,rolls:0,sqm:0};const o=v(t.height_m),r=this.wallpaperRolls(e,o),n=r*v(t.price_per_roll),c=r*v(t.install_cost_per_roll??300);return{total:Math.round(n+c),material:Math.round(n),install:Math.round(c),rolls:r,sqm:e*o}}};function Pe(t){return t.rooms.reduce((e,o)=>{if(o.is_suspended)return e;const r=o.sets.reduce((a,i)=>a+$.calculateSetPrice(i).total,0),n=o.decorations.reduce((a,i)=>a+$.calculateDecoPrice(i).total,0),c=o.wallpapers.reduce((a,i)=>a+$.calculateWallpaperPrice(i).total,0);return e+r+n+c},0)}function Ne(t,e){const o=Pe(t);let r=`สรุปข้อมูล (${new Date().toLocaleDateString("th-TH",{day:"numeric",month:"numeric",year:"numeric"})})
`;if(r+=`ลูกค้า: ${t.customer_name||"-"}
`,(e==="customer"||e==="owner")&&(r+=`เบอร์โทร: ${t.customer_phone||"-"}
`,r+=`ที่อยู่: ${t.customer_address||"-"}
`),r+=`------------------------------
`,e==="customer")return r+=`
สรุปรายการ
`,t.rooms.forEach(n=>{if(n.is_suspended||[...n.sets,...n.decorations,...n.wallpapers].filter(i=>i.is_suspended?!1:i.widths?i.widths.reduce((s,l)=>s+l,0)>0:i.width_m>0).length===0)return;r+=`
*ห้อง: ${n.room_name||"ไม่ระบุ"}*
`;let a=0;n.sets.forEach(i=>{i.is_suspended||i.width_m<=0||(a++,r+=` ${a}) ผ้าม่าน ${i.style} (${i.fabric_variant})
`)}),n.decorations.forEach(i=>{i.is_suspended||i.width_m<=0||(a++,r+=` ${a}) ${i.type||"ของตกแต่ง"}
`)}),n.wallpapers.forEach(i=>{i.is_suspended||i.widths.reduce((s,l)=>s+l,0)<=0||(a++,r+=` ${a}) วอลเปเปอร์
`)})}),r+=`------------------------------
`,r+=`
สรุปยอดรวม: ${x(o)} บาท
`,r+=`
ขอบคุณที่ใช้บริการ
${I.name}
โทร: ${I.phone}`,r;if(e==="purchase_order"||e==="owner"){const n={opaqueFabrics:[],sheerFabrics:[],decorations:[],wallpapers:[],allSets:[]};if(t.rooms.forEach(c=>{c.is_suspended||(c.sets.forEach(a=>{a.is_suspended||a.width_m<=0||(n.allSets.push(a),a.fabric_variant.includes("ทึบ")&&n.opaqueFabrics.push({code:a.fabric_code||"??",yards:$.fabricYardage(a.style,a.width_m)}),a.fabric_variant.includes("โปร่ง")&&n.sheerFabrics.push({code:a.sheer_fabric_code||"??",yards:$.fabricYardage(a.style,a.width_m)}))}),c.decorations.forEach(a=>{a.is_suspended||!a.type||a.width_m<=0||n.decorations.push({type:a.type,code:a.deco_code||"xxx",width:a.width_m,height:a.height_m})}),c.wallpapers.forEach(a=>{if(a.is_suspended)return;const i=a.widths.reduce((s,l)=>s+l,0);if(i>0){const s=$.wallpaperRolls(i,a.height_m);s>0&&n.wallpapers.push({code:a.wallpaper_code||"xxx",rolls:s})}}))}),r+=`📋 *สรุปวัสดุสำหรับสั่งซื้อผ้า*
`,r+=`------------------------------
`,n.opaqueFabrics.length>0&&n.opaqueFabrics.forEach(c=>{r+=`- ผ้าทึบ (Curtain Fabric)
`,r+=`รหัส: #${c.code||"??"}
`,r+=`จำนวน: ${c.yards.toFixed(2)} หลา

`}),n.sheerFabrics.length>0&&n.sheerFabrics.forEach(c=>{r+=`- ผ้าโปร่ง (Sheer Fabric)
`,r+=`รหัส: #${c.code||"??"}
`,r+=`จำนวน: ${c.yards.toFixed(2)} หลา

`}),r+=`------------------------------
`,r+=`📋 *สำหรับสั่งซื้อ ราง*
`,r+=`------------------------------

`,n.allSets.length>0){let c=1;n.allSets.forEach(a=>{r+=`(${c++}) รางม่าน: ${a.style}, สี: ${a.track_color}
`,a.fabric_variant.includes("ทึบ")&&(r+=`  - รางทึบ: ${a.width_m.toFixed(2)} ม. (1 เส้น)
`),a.fabric_variant.includes("โปร่ง")&&(r+=`  - รางโปร่ง: ${a.width_m.toFixed(2)} ม. (1 เส้น)
`),a.fabric_variant==="ทึบ&โปร่ง"&&(r+=`  (❗️ต้องใช้ขาสองชั้น)
`),r+=`
`})}if(r+=`------------------------------
`,r+=`📋 *สำหรับสั่งซื้อ Blind*
`,r+=`------------------------------

`,n.decorations.length>0){const c={มู่ลี่ไม้:"Wooden Blind",ม่านม้วน:"Roller Blind",ปรับแสง:"Vertical Blind",ฉากกั้นห้อง:"Partition",มุ้งจีบ:"Pleated Insect Screen",มู่ลี่มิเนียม:"Aluminium Blind"};n.decorations.forEach(a=>{const i=c[a.type]?` (${c[a.type]})`:"";r+=`- ${a.type}${i}
`,r+=`รหัส: #${a.code||"xxx"}
`,r+=`ขนาด: ${a.width.toFixed(2)} x ${a.height.toFixed(2)} m.
`,r+=`จำนวน: 1 ชุด

`})}if(r+=`------------------------------
`,r+=`📋 *สำหรับสั่งซื้อ Wallpaper*
`,r+=`------------------------------

`,n.wallpapers.length>0&&n.wallpapers.forEach(c=>{r+=`- วอลเปเปอร์ -
`,r+=`รหัส: #${c.code||"xxx"}
`,r+=`จำนวน: ${c.rolls} ม้วน

`}),r+=`------------------------------
`,e==="purchase_order")return r}return(e==="seamstress"||e==="owner")&&(r+=`
🧵 *รายละเอียดสำหรับช่าง*
`,t.rooms.forEach(n=>{if(n.is_suspended||n.sets.filter(i=>!i.is_suspended&&i.width_m>0).length===0)return;r+=`
*ห้อง: ${n.room_name||"ไม่ระบุ"}*
`;let a=1;n.sets.forEach(i=>{i.is_suspended||i.width_m<=0||(r+=`${a++}) *ผ้าม่าน ${i.style} ${i.fabric_variant}*
`,r+=`  กว้าง ${i.width_m} x สูง ${i.height_m} ม.
`,r+=`  รูปแบบเปิด: ${i.opening_style}
`,i.fabric_variant.includes("ทึบ")&&(r+=`  ผ้าทึบ: รหัส ${i.fabric_code||"-"}
`),i.fabric_variant.includes("โปร่ง")&&(r+=`  ผ้าโปร่ง: รหัส ${i.sheer_fabric_code||"-"}
`))})}),r+=`------------------------------
`,e==="seamstress")||e==="owner"&&(r+=`
💰 *สรุปยอดรวม: ${x(o)} บาท*
`),r}function Fe(t){if(!t.rooms||t.rooms.length===0)return'<p class="empty-summary">ไม่มีข้อมูลสำหรับแสดงผล</p>';const e={};let o=0,r="";if(t.rooms.forEach(a=>{if(a.is_suspended)return;const i={};a.sets.forEach(l=>{if($.calculateSetPrice(l).total>0){const u="ผ้าม่าน";i[u]=(i[u]||0)+1,e[u]=(e[u]||0)+1}}),a.decorations.forEach(l=>{if(l.type&&$.calculateDecoPrice(l).total>0){const u=l.type;i[u]=(i[u]||0)+1,e[u]=(e[u]||0)+1}}),a.wallpapers.forEach(l=>{if($.calculateWallpaperPrice(l).total>0){const u="วอลเปเปอร์";i[u]=(i[u]||0)+1,e[u]=(e[u]||0)+1}});const s=Object.entries(i);s.length>0&&(r+=`<tr class="room-header-row"><td colspan="3">${a.room_name||"ไม่ระบุชื่อห้อง"}</td></tr>`,s.forEach(([l,u])=>{r+=`<tr><td></td><td class="item-type-cell">${l}</td><td class="pdf-text-center">${u}</td></tr>`,o+=u}))}),o===0)return'<p class="empty-summary">ไม่มีรายการที่มีราคาสำหรับแสดงผล</p>';let c=`<div id="detailed-material-summary">
        <h4><i class="ph ph-stack"></i> ยอดรวมทุกประเภท</h4>
        <ul><li class="summary-note">${Object.entries(e).map(([a,i])=>`${a}: ${i}`).join(" , ")}</li></ul>
    </div>`;return c+=`<table>
        <thead><tr><th>ห้อง</th><th>รายการ</th><th class="pdf-text-center">จำนวน</th></tr></thead>
        <tbody>${r}</tbody>
    </table>`,c}function Re(t,e){const{vatRate:o,pageBreakBuffer:r=3}=e,n=[];t.rooms.forEach(T=>{if(T.is_suspended)return;const C=[];T.sets.forEach(b=>{const E=$.calculateSetPrice(b).total;if(E>0){let B=`ผ้าม่าน ${b.style} (${b.fabric_variant}) <br><small>ขนาด ${b.width_m.toFixed(2)} x ${b.height_m.toFixed(2)} ม.${b.notes?` - ${b.notes}`:""}</small>`;C.push({description:B,total:E,units:B.includes("<br>")?1.5:1})}}),T.decorations.forEach(b=>{const E=$.calculateDecoPrice(b).total;if(E>0){let B=`${b.type||"งานตกแต่ง"} <br><small>รหัส: ${b.deco_code||"-"}, ขนาด ${b.width_m.toFixed(2)} x ${b.height_m.toFixed(2)} ม.</small>`;C.push({description:B,total:E,units:B.includes("<br>")?1.5:1})}}),T.wallpapers.forEach(b=>{const E=$.calculateWallpaperPrice(b).total;if(E>0){const B=b.widths.reduce((oe,ne)=>oe+ne,0),U=$.wallpaperRolls(B,b.height_m);let O=`วอลเปเปอร์ <br><small>รหัส: ${b.wallpaper_code||"-"}, สูง ${b.height_m.toFixed(2)} ม. (ใช้ ${U} ม้วน)</small>`;C.push({description:O,total:E,units:O.includes("<br>")?1.5:1})}}),C.length>0&&(n.push({isRoomHeader:!0,roomName:T.room_name||"ไม่ระบุชื่อห้อง",units:1.2}),n.push(...C))});const c=n.reduce((T,C)=>T+(C.total||0),0);if(c===0)return null;const a=c*o,i=c+a,s=17,l=23,u=[];let d=[],p=0;n.forEach((T,C)=>{const b=u.length===0?s:l,E=p+T.units>b;let B=!1;if(!E&&C<n.length-1){const U=b-(p+T.units);U>0&&U<r&&(B=!0)}(E||B)&&d.length>0&&(u.push(d),d=[],p=0),d.push(T),p+=T.units}),d.length>0&&u.push(d);const f=new Date,h=f.toLocaleDateString("th-TH",{year:"numeric",month:"long",day:"numeric"}),g=`QT-${f.getFullYear()}${(f.getMonth()+1).toString().padStart(2,"0")}${f.getDate().toString().padStart(2,"0")}`;let S="",q=0,y=1;u.forEach((T,C)=>{const b=C===0,E=C===u.length-1,B=`
            <div class="pdf-page-header">
                <div class="pdf-header">
                    <div class="pdf-shop-info">
                        ${`<img src="${I.logoUrl}" alt="Logo" class="pdf-logo">`}
                        <div class="pdf-shop-address">
                            <strong>${I.name}</strong><br>
                            ${I.address.replace(/\n/g,"<br>")}<br>
                            โทร: ${I.phone} | เลขประจำตัวผู้เสียภาษี: ${I.taxId}
                        </div>
                    </div>
                    <div class="pdf-quote-details">
                        <div class="pdf-title-box"><h1>ใบเสนอราคา ${u.length>1?b?"":"(ต่อ)":""}</h1></div>
                        <table class="pdf-quote-meta">
                            <tr><td>เลขที่:</td><td>${g}</td></tr>
                            <tr><td>วันที่:</td><td>${h}</td></tr>
                        </table>
                    </div>
                </div>
                ${b?`
                <section class="pdf-customer-details">
                    <div class="pdf-customer-info">
                        <strong>ลูกค้า:</strong> ${t.customer_name||""}<br>
                        <strong>ที่อยู่:</strong> ${t.customer_address.replace(/\n/g,"<br>")||""}<br>
                        <strong>โทร:</strong> ${t.customer_phone||""}
                    </div>
                    <div class="pdf-customer-meta">
                        <strong>เงื่อนไขชำระเงิน:</strong> ${I.pdf.paymentTerms}<br>
                        <strong>ยืนราคา:</strong> ${I.pdf.priceValidity}
                    </div>
                </section>`:""}
            </div>`,U=`
            <div class="pdf-page-footer">
                <div class="pdf-footer-info">
                    <span>${I.name} | โทร: ${I.phone}</span>
                    <span>หน้า ${C+1} / ${u.length}</span>
                </div>
            </div>`;let O="";b||(O+=`<tr class="pdf-subtotal-row"><td colspan="4">ยอดยกมา (Brought Forward)</td><td class="pdf-text-right">${A(q,2,!0)}</td></tr>`),T.forEach(R=>{R.isRoomHeader?O+=`<tr class="pdf-room-header"><td colspan="5">ห้อง: ${R.roomName}</td></tr>`:(O+=`<tr><td class="pdf-text-center">${y++}</td><td>${R.description}</td><td class="pdf-text-center">1</td><td class="pdf-text-right">${A(R.total,2,!0)}</td><td class="pdf-text-right">${A(R.total,2,!0)}</td></tr>`,q+=R.total)});let oe="";E||(oe=`<tfoot><tr class="pdf-subtotal-row"><td colspan="4">ยอดยกไป (Carried Forward)</td><td class="pdf-text-right">${A(q,2,!0)}</td></tr></tfoot>`);let ne="";I.pdf.notes&&I.pdf.notes.length>0&&(ne=`
                <strong>หมายเหตุ:</strong>
                <ul>${I.pdf.notes.map(R=>`<li>${R}</li>`).join("")}</ul>
            `);const xe=E?`
            <div class="pdf-summary-wrapper">
                <section class="pdf-summary-section">
                    <div class="pdf-amount-in-words">
                        ${ne}
                        <div class="pdf-amount-text">( ${Ae(i)} )</div>
                    </div>
                    <div class="pdf-totals-block">
                        <table>
                            <tr><td class="pdf-label">รวมเป็นเงิน</td><td class="pdf-amount">${A(c,2,!0)}</td></tr>
                            ${o>0?`<tr><td class="pdf-label">ภาษีมูลค่าเพิ่ม ${(o*100).toFixed(0)}%</td><td class="pdf-amount">${A(a,2,!0)}</td></tr>`:""}
                            <tr class="pdf-grand-total"><td class="pdf-label">ยอดรวมสุทธิ</td><td class="pdf-amount">${A(i,2,!0)}</td></tr>
                        </table>
                    </div>
                </section>
                <footer class="pdf-footer-section">
                    <div class="pdf-signature-box"><p>.................................................</p><p>ผู้เสนอราคา</p><p>(${I.name})</p><p>วันที่: ${h}</p></div>
                    <div class="pdf-signature-box"><p>.................................................</p><p>ลูกค้า / ผู้มีอำนาจลงนาม</p><p>&nbsp;</p><p>วันที่: ......./......./............</p></div>
                </footer>
            </div>
        `:"";S+=`
            <div class="pdf-page">
                <div class="pdf-page-content">
                    ${B}
                    <div class="pdf-page-body">
                        <table class="pdf-items-table">
                            <thead><tr><th style="width:5%;">ลำดับ</th><th style="width:50%;">รายการ</th><th style="width:10%;">จำนวน</th><th style="width:17.5%;">ราคา/หน่วย</th><th style="width:17.5%;">รวม (บาท)</th></tr></thead>
                            <tbody>${O}</tbody>
                            ${oe}
                        </table>
                        ${xe}
                    </div>
                    ${U}
                </div>
            </div>`});const w=(t.customer_name||"quote").trim().replace(/\s+/g,"-");return{html:`<div id="quotation-template">${S}</div>`,fileName:`${g}_${w}`}}const he="marnthara.favorites.v3";function W(){try{const t=localStorage.getItem(he),e={fabric:[],sheer:[],deco:{},wallpaper:[]};return t?{...e,...JSON.parse(t)}:e}catch(t){return console.error("Failed to parse favorites from localStorage",t),{fabric:[],sheer:[],deco:{},wallpaper:[]}}}function ue(t){try{localStorage.setItem(he,JSON.stringify(t))}catch(e){console.error("Failed to save favorites to localStorage",e)}}function Z(t,e,o){return e==="deco"?o?(t.deco[o]||(t.deco[o]=[]),t.deco[o]):null:(t[e]||(t[e]=[]),t[e])}function De(t,e,o,r=null){const n=W(),c=Z(n,t,r);if(!c)return!1;const a=c.find(i=>i.code===e);return a?a.price=o:c.push({code:e,price:o}),c.sort((i,s)=>i.code.localeCompare(s.code)),ue(n),!0}function Oe(t,e,o,r=null){const n=W(),c=Z(n,t,r);return!c||c.some(a=>a.code===e)?!1:(c.push({code:e,price:o}),c.sort((a,i)=>a.code.localeCompare(i.code)),ue(n),!0)}function He(t,e,o,r,n=null){const c=W(),a=Z(c,t,n);if(!a||e!==o&&a.some(s=>s.code===o))return!1;const i=a.find(s=>s.code===e);return i?(i.code=o,i.price=r,a.sort((s,l)=>s.code.localeCompare(l.code)),ue(c),!0):!1}function Se(t,e,o=null){const r=W(),n=Z(r,t,o);if(!n)return!1;const c=n.findIndex(a=>a.code===e);return c>-1?(n.splice(c,1),ue(r),!0):!1}function ye(t,e,o=null){if(!t||!e)return;const r=W(),n=e.trim(),c=Z(r,t,o);return c==null?void 0:c.find(a=>a.code===n)}function We(t,e,o=null){return!!ye(t,e,o)}function Ue(t,e,o,r=null){const n=ye(t,e,r);return n&&n.price===o?(Se(t,e,r),!1):(De(t,e,o,r),!0)}function je(){localStorage.removeItem(he),console.log("All favorites have been cleared.")}let M=!1,z=null,ae=null,Q=!1,k=null,G=null,pe=null;const we="marnthara.theme";function qe(){const t=localStorage.getItem(we),e=document.querySelector("#themeToggleBtn");if(!e)return;const o=e.querySelector("i"),r=e.querySelector("span");t==="dark"?(document.body.classList.add("dark-theme"),o&&(o.className="ph-fill ph-sun"),r&&(r.textContent=" Light Mode")):(document.body.classList.remove("dark-theme"),o&&(o.className="ph-fill ph-moon"),r&&(r.textContent=" Dark Mode"))}function Ve(){document.body.classList.toggle("dark-theme");const t=document.body.classList.contains("dark-theme");localStorage.setItem(we,t?"dark":"light"),qe()}function _(t,e="default"){const o=document.querySelector(m.toastContainer);if(!o)return;const r={success:"ph-bold ph-check-circle",warning:"ph-bold ph-warning",error:"ph-bold ph-x-circle",default:"ph-bold ph-info"},n=document.createElement("div");n.className=`toast toast-${e}`,n.innerHTML=`<i class="${r[e]||r.default}"></i> ${t}`,o.appendChild(n),setTimeout(()=>n.classList.add("show"),10),setTimeout(()=>{n.classList.remove("show"),n.addEventListener("transitionend",()=>n.remove())},3e3)}function D(t,e){return new Promise(o=>{const r=document.querySelector(t);if(!r){o(null);return}const n=document.querySelector(".modal-wrapper.visible");n&&n.classList.add("is-underlay"),r.classList.add("visible");const c=r.querySelector('[id$="Confirm"]'),a=r.querySelector('[id$="Cancel"], [data-act="close-modal"]'),i=Array.from(r.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])')).filter(p=>!p.disabled&&p.offsetParent!==null),s=i[0],l=i[i.length-1];setTimeout(()=>s==null?void 0:s.focus(),50);const u=p=>{if(p.key==="Escape"&&!r.classList.contains("is-underlay")){d({cancelled:!0});return}if(p.key==="Tab"){if(i.length<=1){p.preventDefault();return}p.shiftKey?document.activeElement===s&&(l.focus(),p.preventDefault()):document.activeElement===l&&(s.focus(),p.preventDefault())}},d=p=>{r.classList.remove("visible"),document.removeEventListener("keydown",u),c&&(c.onclick=null),a&&(a.onclick=null),n&&n.classList.remove("is-underlay"),typeof p=="object"&&p.cancelled&&e&&e(),o(p)};c&&(c.onclick=()=>d(!0)),a&&(a.onclick=()=>{r.classList.contains("is-underlay")||d({cancelled:!0})}),document.addEventListener("keydown",u)})}async function K(t,e){const o=document.querySelector(m.modal);if(!o)return!0;const r=o.querySelector(m.modalTitle),n=o.querySelector(m.modalBody);return r&&(r.textContent=t),n&&(n.textContent=e),await D(m.modal)===!0}async function Ye(){const t=document.querySelector(m.exportOptionsModal);if(!t)return null;const e=await D(m.exportOptionsModal);if(!e||e.cancelled)return null;const o=t.querySelector('input[name="vat_option"]:checked'),r=t.querySelector("#exportMethod"),n=t.querySelector("#pageBreakBuffer");return{vatOption:o?o.value:"include",exportMethod:r?r.value:"direct",pageBreakBuffer:n?parseInt(n.value,10):3}}function J(t,e){t&&(t.classList.add("item-removing"),t.addEventListener("animationend",()=>{t.remove(),e&&_(e),de(),ee(),F(),P(),Y()},{once:!0}))}function ee(){document.querySelectorAll(m.room).forEach(t=>{const e=t.querySelectorAll(".item-card:not(.is-suspended)"),o=e.length;e.forEach((r,n)=>{const c=r.querySelector("[data-item-title]");c&&(c.textContent=`${n+1}/${o}`)})})}function be(){const t=document.querySelector(m.orderForm),e=document.querySelector(m.lockBtn);if(!t||!e)return;const o=t.querySelectorAll("input, select, textarea, button");t.classList.toggle("is-locked",M),e.classList.toggle("is-locked",M);const r=e.querySelector("i");r&&(r.className=M?"ph-bold ph-lock-key":"ph-bold ph-lock-key-open"),o.forEach(n=>{n.closest(".summary-footer")||n.closest(".main-header")||n.closest(".modal-wrapper")||(n.disabled=M)}),_(M?"ฟอร์มถูกล็อค":"ปลดล็อคฟอร์มแล้ว",M?"warning":"success")}function V(){const t=document.querySelectorAll(m.room);if(t.length===0)return;const e=[...t].some(r=>r.open),o=document.querySelector(m.toggleAllRoomsBtn);if(o){const r=o.querySelector("i"),n=o.querySelector("span");r&&(r.className=e?"ph ph-rows-slash":"ph ph-rows"),n&&(n.textContent=e?"ย่อทั้งหมด":"ขยายทั้งหมด")}}function Ge(){const t=document.querySelectorAll(m.room),e=[...t].some(o=>o.open);t.forEach(o=>{o.open=!e}),setTimeout(V,50)}function de(){const t=document.querySelector(m.quickNavRoomList);if(!t)return;t.innerHTML="",document.querySelectorAll(m.room).forEach(o=>{const r=o.querySelector(m.roomNameInput),n=r?r.value:"ห้อง",c=document.createElement("a");c.href=`#${o.id}`,c.dataset.jumpTo=o.id,c.innerHTML=`<i class="ph ph-arrow-bend-left-up"></i> ${n||"ห้อง (ไม่มีชื่อ)"}`,t.appendChild(c)})}function Le(t){const e=document.getElementById("quickNavBtnText");if(e)if(t){const o=t.querySelector('input[name="room_name"]');o&&(e.textContent=o.value||"...")}else e.textContent="ไปยังห้อง"}function Y(){if(ae&&ae.disconnect(),!document.getElementById("quickNavBtnText"))return;const e={root:null,rootMargin:"-60px 0px -150px 0px",threshold:0},o=n=>{const c=n.filter(a=>a.isIntersecting).sort((a,i)=>a.target.getBoundingClientRect().top-i.target.getBoundingClientRect().top);c.length>0&&Le(c[0].target)};ae=new IntersectionObserver(o,e),document.querySelectorAll(m.room).forEach(n=>ae.observe(n))}function Je(){document.querySelectorAll("[data-favorite-type]").forEach(N)}function fe(){const t=document.querySelector('[data-act="edit-selected-fav"]'),e=document.querySelector('[data-act="del-selected-fav"]');if(t&&e){const o=k!==null;t.disabled=!o,e.disabled=!o}}function se(t,e=null){const o=document.getElementById("favManagerBody");if(!o)return;const r=W();let n=[];if(t==="deco"?n=r.deco[e]||[]:n=r[t]||[],o.innerHTML="",n.length===0)o.innerHTML='<p class="empty-state">ไม่มีรายการโปรดที่บันทึกไว้</p>';else{const c=document.getElementById("favManagerItemTpl").innerHTML;n.forEach(a=>{const i=c.replace(/{CODE}/g,a.code).replace(/{PRICE}/g,x(a.price)).replace(/{RAW_PRICE}/g,a.price),s=document.createElement("div");s.innerHTML=i;const l=s.firstElementChild;l.dataset.type=t,e&&(l.dataset.subType=e),o.appendChild(l)})}k=null,fe()}async function Qe(t,e=null){Q=!1,k=null;const o=document.getElementById("favManagerTitle");if(!o)return;let r="รายการโปรด";t==="deco"?r=`รายการโปรด: ${e||"ของตกแต่ง"}`:r=`รายการโปรด: ${{fabric:"ผ้าทึบ",sheer:"ผ้าโปร่ง",wallpaper:"วอลเปเปอร์"}[t]||t}`,o.textContent=r,o.dataset.type=t,o.dataset.subType=e||"",se(t,e),await D("#favManagerModal"),Q&&(Je(),z&&Te(z))}async function Ke(){const t=document.querySelector("#favAddModal");if(!t)return null;const e=t.querySelector("#fav_code_add"),o=t.querySelector("#fav_price_add");e.value="",o.value="";const r=await D("#favAddModal");return r&&!r.cancelled?{newCode:e.value.trim(),newPrice:v(o.value)}:null}async function ze(t){const e=document.querySelector("#favEditModal");if(!e)return null;const o=e.querySelector("#fav_code_edit"),r=e.querySelector("#fav_price_edit");o.value=t.code,r.value=t.price;const n=await D("#favEditModal");return n&&!n.cancelled?{newCode:o.value.trim(),newPrice:v(r.value)}:null}function X(){document.querySelectorAll(".favorite-chips-container.show").forEach(t=>{t.classList.remove("show")}),document.querySelectorAll(".item-card.overflow-visible").forEach(t=>{t.classList.remove("overflow-visible")}),z=null}function N(t){var i;if(!t||!t.matches("[data-favorite-type]"))return;const e=t.nextElementSibling;if(!e||!e.matches(".btn-favorite"))return;const o=e.dataset.type,r=t.value;if(!r){e.classList.remove("is-favorite"),e.querySelector("i").className="ph ph-star";return}const n=t.closest(".item-card");if(!n)return;let c=null;o==="deco"&&(c=(i=n.querySelector('[name="deco_type"]'))==null?void 0:i.value);const a=We(o,r,c);e.classList.toggle("is-favorite",a),e.querySelector("i").className=a?"ph-fill ph-star":"ph ph-star"}function Te(t){var s,l;X();const e=t.dataset.favoriteType;if(!e)return;let o=null,r=[];const n=W();e==="deco"?(o=(l=(s=t.closest(".item-card"))==null?void 0:s.querySelector('[name="deco_type"]'))==null?void 0:l.value,o&&(r=n.deco[o]||[])):r=n[e]||[];const c=t.closest(".form-group-with-favorites").querySelector(".favorite-chips-container");if(!c)return;c.innerHTML="",r.length>0&&r.forEach(u=>{const d=document.createElement("button");d.type="button",d.className="btn-chip",d.textContent=u.code,d.dataset.act="select-favorite",d.dataset.code=u.code,d.dataset.price=u.price,c.appendChild(d)});const a=document.createElement("button");a.type="button",a.className="btn-manage-favorites",a.dataset.act="manage-favorites",a.dataset.type=e,o&&(a.dataset.subType=o),a.innerHTML='<i class="ph ph-pencil-simple"></i> แก้ไข',c.appendChild(a),c.classList.add("show");const i=t.closest(".item-card");i&&i.classList.add("overflow-visible")}async function ve(t,e=null){const o=document.querySelector("#itemTypeModal");if(!o)return null;o.querySelector("#itemTypeModalTitle").textContent=t;const r=o.querySelector(`input[name="item_type_option"][value="${e||"set"}"]`);r&&(r.checked=!0);const n=await D("#itemTypeModal");if(!n||n.cancelled)return null;const c=o.querySelector('input[name="item_type_option"]:checked');return c?c.value:null}function Xe(t,e){const o=t.closest(m.room);if(!o)return;const r=Array.from(o.querySelectorAll(".item-card")),n=r.findIndex(f=>f===t);let c=0;if(n>-1)for(let f=0;f<n;f++){const h=r[f];(e==="set"&&h.matches(m.set)||e==="deco"&&h.matches(m.decoItem)||e==="wallpaper"&&h.matches(m.wallpaperItem))&&c++}const a={set:o.querySelector(m.setsContainer),deco:o.querySelector(m.decorationsContainer),wallpaper:o.querySelector(m.wallpapersContainer)},i={set:"#setTpl",deco:"#decoTpl",wallpaper:"#wallpaperTpl"},s=a[e],l=i[e];if(!s||!l)return;const p=document.querySelector(l).content.cloneNode(!0).firstElementChild;if(e==="wallpaper"){const f=p.querySelector('[data-act="add-wall"]');f&&_e(f)}t.classList.add("item-removing"),t.addEventListener("animationend",()=>{t.remove();const f=s.children[c]||null;s.insertBefore(p,f),p.classList.add("item-created"),p.scrollIntoView({behavior:"smooth",block:"center"});const h=p.querySelector('input:not([type="hidden"]), select, textarea');h&&h.focus(),ee(),F(),P(),_("เปลี่ยนประเภทรายการแล้ว","success")},{once:!0})}function te(t,e,o=!0){X();const r=document.querySelector(t);if(!r||!e)return null;const n=r.content.cloneNode(!0),c=n.firstElementChild;e.appendChild(n),c.querySelectorAll("input[data-favorite-type]").forEach(N),o&&c&&(c.classList.add("item-created"),c.scrollIntoView({behavior:"smooth",block:"center"}));const a=c.querySelector('input:not([type="hidden"]), select, textarea');return a&&a.focus(),ee(),F(),P(),c}function le(){const t=document.querySelector(m.roomsContainer);if(!t)return;const e=document.querySelectorAll(m.roomNameInput);let o=0;e.forEach(c=>{const a=c.value.match(/\d+/g);if(a){const i=parseInt(a[a.length-1],10);i>o&&(o=i)}});const r=o+1,n=te("#roomTpl",t,!0);if(n){n.id=`room-${Date.now()}`;const c=n.querySelector(m.roomNameInput);c&&(c.value=`ห้อง ${r}`),n.open=!0}de(),V(),Y()}function Ze(t){if(!t)return;const e=t.querySelector(m.setsContainer);e&&te("#setTpl",e)}function et(t){if(!t)return;const e=t.querySelector(m.decorationsContainer);e&&te("#decoTpl",e)}function tt(t){if(!t)return;const e=t.querySelector(m.wallpapersContainer);if(e){const o=te("#wallpaperTpl",e);o&&_e(o.querySelector('[data-act="add-wall"]'))}}function _e(t){var o;const e=(o=t==null?void 0:t.closest(".walls-section"))==null?void 0:o.querySelector(m.wallsContainer);e&&(te("#wallTpl",e,!0),re(t))}function $e(t){var n,c;if(!t)return;const e=(n=t.querySelector('select[name="fabric_variant"]'))==null?void 0:n.value,o=e&&e.includes("โปร่ง");(c=t.querySelector(m.sheerWrap))==null||c.classList.toggle("hidden",!o);const r=t.querySelector('input[name="sheer_fabric_code"]');if(r){const a=r.closest(".form-group-with-favorites");a&&a.classList.toggle("hidden",!o)}}function rt(t,e,o,r=null){let n=0;document.querySelectorAll(`
        [name="fabric_code"], 
        [name="sheer_fabric_code"], 
        [name="deco_code"], 
        [name="wallpaper_code"]
    `).forEach(a=>{var i;if(a.value.trim()===t){const s=a.closest(".item-card");if(!s)return;const l=a.dataset.favoriteType;let u=null;if(l===o){if(o==="deco"&&((i=s.querySelector('[name="deco_type"]'))==null?void 0:i.value)!==r)return;o==="fabric"&&(u=s.querySelector('[name="set_price_per_m"]')),o==="sheer"&&(u=s.querySelector('[name="sheer_price_per_m"]')),o==="deco"&&(u=s.querySelector('[name="deco_price_sqyd"]')),o==="wallpaper"&&(u=s.querySelector('[name="wallpaper_price_roll"]')),a.value=e.newCode,u&&(u.tagName==="SELECT"?u.value=e.newPrice:u.value=x(v(e.newPrice)),a.classList.add("input-highlight"),u.classList.add("input-highlight"),setTimeout(()=>{a.classList.remove("input-highlight"),u.classList.remove("input-highlight")},1500),u.dispatchEvent(new Event("change",{bubbles:!0}))),n++}}}),n>0&&_(`อัปเดต ${n} รายการที่ใช้รหัสนี้แล้ว`,"success")}function ot(t,e,o=null){document.querySelectorAll(`input[data-favorite-type="${e}"]`).forEach(r=>{var n;if(r.value.trim()===t)if(e==="deco"){const c=r.closest(".item-card");((n=c==null?void 0:c.querySelector('[name="deco_type"]'))==null?void 0:n.value)===o&&N(r)}else N(r)})}const nt=Be(t=>{re(t),P()});function at(t){if(M){_("ฟอร์มถูกล็อค ไม่สามารถแก้ไขได้","warning"),t.preventDefault();return}t.target.matches("input[data-favorite-type]")&&N(t.target),t.target.matches(m.roomNameInput)&&Y(),nt(t.target)}function ct(t){var c;if(M)return;const e=t.target,o=e.matches('input[name="deco_price_sqyd"]'),r=e.matches('input[name="wallpaper_price_roll"]');if(o||r){const a=e.closest(".item-card");if(a){const i=v(e.value);let s,l,u=null;if(o?(s=a.querySelector('input[name="deco_code"]'),l="deco",u=(c=a.querySelector('select[name="deco_type"]'))==null?void 0:c.value):(s=a.querySelector('input[name="wallpaper_code"]'),l="wallpaper"),s&&s.value&&l){const d=ye(l,s.value,u);d&&d.price!==i&&(s.value="")}}}if(e.matches('select[name="fabric_variant"]')&&$e(e.closest(m.set)),e.matches('select[name="deco_type"]')){const a=e.closest(m.decoItem);if(a){const i=a.querySelector(".item-type-changer .deco-type-display");i&&(i.textContent=e.value||"ตกแต่ง");const s=a.querySelector('input[name="deco_code"]');s&&N(s)}}if(e.matches(m.roomNameInput)&&(de(),Y()),["set_price_per_m","sheer_price_per_m","deco_price_sqyd","wallpaper_price_roll"].includes(e.name)){const a=e.closest(".item-card");if(a){let i;e.name==="set_price_per_m"&&(i=a.querySelector('[name="fabric_code"]')),e.name==="sheer_price_per_m"&&(i=a.querySelector('[name="sheer_fabric_code"]')),e.name==="deco_price_sqyd"&&(i=a.querySelector('[name="deco_code"]')),e.name==="wallpaper_price_roll"&&(i=a.querySelector('[name="wallpaper_code"]')),i&&N(i)}}re(e),P()}function st(t){const e=t.target,o=e.matches('[name="deco_price_sqyd"], [name="wallpaper_price_roll"], [name="wallpaper_install_cost"], [name="fav_price_edit"], [name="fav_price_add"]'),r=e.matches('input[name="width_m"], input[name="height_m"], input[name="deco_width_m"], input[name="deco_height_m"], input[name="wallpaper_height_m"], input[name="wall_width_m"]');if(o){const n=v(e.value);n>0?e.value=x(n):e.value=""}else r&&(e.value=H(e.value))}function lt(t){const e=t.target;e.matches("input[data-favorite-type]")&&(z=e,Te(e))}function re(t){var n,c,a,i,s,l,u,d,p,f,h,g;if(!t)return;const e=t.closest(m.set);if(e){const S=e.querySelector("[data-set-summary]");if(S){const q={width_m:(n=e.querySelector('input[name="width_m"]'))==null?void 0:n.value,height_m:(c=e.querySelector('input[name="height_m"]'))==null?void 0:c.value,style:(a=e.querySelector('select[name="set_style"]'))==null?void 0:a.value,fabric_variant:(i=e.querySelector('select[name="fabric_variant"]'))==null?void 0:i.value,price_per_m_raw:(s=e.querySelector('select[name="set_price_per_m"]'))==null?void 0:s.value,sheer_price_per_m:(l=e.querySelector('select[name="sheer_price_per_m"]'))==null?void 0:l.value},y=$.calculateSetPrice(q);let L=`ราคา: <b>${x(y.total)}</b> บ.`;y.opaque>0&&y.sheer>0&&(L+=` <small>(ทึบ: ${x(y.opaque)}, โปร่ง: ${x(y.sheer)})</small>`),S.innerHTML=L}}const o=t.closest(m.decoItem);if(o){const S=o.querySelector("[data-deco-summary]");if(S){const q={width_m:(u=o.querySelector('input[name="deco_width_m"]'))==null?void 0:u.value,height_m:(d=o.querySelector('input[name="deco_height_m"]'))==null?void 0:d.value,price_sqyd:(p=o.querySelector('input[name="deco_price_sqyd"]'))==null?void 0:p.value},y=$.calculateDecoPrice(q);S.innerHTML=`ราคา: <b>${x(y.total)}</b> บ. &bull; พื้นที่: ${A(y.sqyd,2)} ตร.หลา`}}const r=t.closest(m.wallpaperItem);if(r){const S=r.querySelector("[data-wallpaper-summary]");if(S){const q={height_m:(f=r.querySelector('input[name="wallpaper_height_m"]'))==null?void 0:f.value,price_per_roll:(h=r.querySelector('input[name="wallpaper_price_roll"]'))==null?void 0:h.value,install_cost_per_roll:(g=r.querySelector('input[name="wallpaper_install_cost"]'))==null?void 0:g.value,widths:Array.from(r.querySelectorAll('input[name="wall_width_m"]')).map(w=>w.value)},y=$.calculateWallpaperPrice(q);let L=`รวม: <b>${x(y.total)}</b> บ. `;(y.material>0||y.install>0)&&(L+=`<small>(วอลล์: ${x(y.material)}, ค่าช่าง: ${x(y.install)})</small>`),L+=` &bull; พื้นที่: ${A(y.sqm,2)} ตร.ม. &bull; ใช้: ${y.rolls} ม้วน`,S.innerHTML=L}}F()}function F(){let t=0,e=0;document.querySelectorAll(m.room).forEach(n=>{let c=0,a=0;const i=n.classList.contains("is-suspended");n.querySelectorAll(m.set).forEach(l=>{var d,p,f,h,g,S;const u=$.calculateSetPrice({is_suspended:i||l.classList.contains("is-suspended"),width_m:(d=l.querySelector('input[name="width_m"]'))==null?void 0:d.value,height_m:(p=l.querySelector('input[name="height_m"]'))==null?void 0:p.value,style:(f=l.querySelector('select[name="set_style"]'))==null?void 0:f.value,fabric_variant:(h=l.querySelector('select[name="fabric_variant"]'))==null?void 0:h.value,price_per_m_raw:(g=l.querySelector('select[name="set_price_per_m"]'))==null?void 0:g.value,sheer_price_per_m:(S=l.querySelector('select[name="sheer_price_per_m"]'))==null?void 0:S.value}).total;c+=u,u>0&&(e++,a++)}),n.querySelectorAll(m.decoItem).forEach(l=>{var d,p,f;const u=$.calculateDecoPrice({is_suspended:i||l.classList.contains("is-suspended"),width_m:(d=l.querySelector('input[name="deco_width_m"]'))==null?void 0:d.value,height_m:(p=l.querySelector('input[name="deco_height_m"]'))==null?void 0:p.value,price_sqyd:(f=l.querySelector('input[name="deco_price_sqyd"]'))==null?void 0:f.value}).total;c+=u,u>0&&(e++,a++)}),n.querySelectorAll(m.wallpaperItem).forEach(l=>{var d,p,f;const u=$.calculateWallpaperPrice({is_suspended:i||l.classList.contains("is-suspended"),height_m:(d=l.querySelector('input[name="wallpaper_height_m"]'))==null?void 0:d.value,price_per_roll:(p=l.querySelector('input[name="wallpaper_price_roll"]'))==null?void 0:p.value,install_cost_per_roll:(f=l.querySelector('input[name="wallpaper_install_cost"]'))==null?void 0:f.value,widths:Array.from(l.querySelectorAll('input[name="wall_width_m"]')).map(h=>h.value)}).total;c+=u,u>0&&(e++,a++)});const s=n.querySelector("[data-room-brief]");s&&(i?s.textContent="(ระงับชั่วคราว)":a>0?s.innerHTML=`<span>${a}</span> &bull; ${x(c)} บาท`:s.innerHTML="<span>0</span> รายการ"),t+=i?0:c});const o=document.querySelector(m.grandTotal),r=document.querySelector(m.setCount);o&&(o.textContent=x(t)),r&&(r.textContent=e)}function ge(t){if(!t||!t.rooms)return;const e=document.querySelector(m.roomsContainer);if(!e)return;e.innerHTML="";const o=document.querySelector("#customer_name"),r=document.querySelector("#customer_phone"),n=document.querySelector("#customer_address");o&&(o.value=t.customer_name||""),r&&(r.value=t.customer_phone||""),n&&(n.value=t.customer_address||"");const c=document.querySelector("#customerDetailsCard");c&&(c.open=t.customer_card_open??!0),t.rooms.forEach(a=>{const i=document.querySelector("#roomTpl");if(!i)return;const s=i.content.cloneNode(!0),l=s.querySelector(m.room);if(!l)return;l.id=a.id||`room-${Date.now()}`,a.is_suspended&&l.classList.add("is-suspended"),l.open=!1;const u=l.querySelector(m.roomNameInput);u&&(u.value=a.room_name||"ห้อง (ไม่มีชื่อ)");const d=l.querySelector(m.setsContainer),p=l.querySelector(m.decorationsContainer),f=l.querySelector(m.wallpapersContainer),h=document.querySelector("#setTpl"),g=document.querySelector("#decoTpl"),S=document.querySelector("#wallpaperTpl"),q=document.querySelector("#wallTpl");d&&h&&a.sets&&a.sets.forEach(y=>{const L=h.content.cloneNode(!0),w=L.querySelector(m.set);y.is_suspended&&w.classList.add("is-suspended"),w.querySelector('input[name="width_m"]').value=H(y.width_m),w.querySelector('input[name="height_m"]').value=H(y.height_m),w.querySelector('select[name="set_style"]').value=y.style||"ลอน",w.querySelector('select[name="fabric_variant"]').value=y.fabric_variant||"ทึบ",w.querySelector('select[name="set_price_per_m"]').value=y.price_per_m_raw||"",w.querySelector('select[name="sheer_price_per_m"]').value=y.sheer_price_per_m||"",w.querySelector('select[name="opening_style"]').value=y.opening_style||"แยกกลาง",w.querySelector('select[name="track_color"]').value=y.track_color||"ขาว",w.querySelector('input[name="fabric_code"]').value=y.fabric_code||"",w.querySelector('input[name="sheer_fabric_code"]').value=y.sheer_fabric_code||"",w.querySelector('input[name="notes"]').value=y.notes||"",$e(w),d.appendChild(L)}),p&&g&&a.decorations&&a.decorations.forEach(y=>{const L=g.content.cloneNode(!0),w=L.querySelector(m.decoItem);y.is_suspended&&w.classList.add("is-suspended");const T=w.querySelector('select[name="deco_type"]');T.value=y.type||"",w.querySelector(".deco-type-display").textContent=y.type||"ตกแต่ง",w.querySelector('input[name="deco_width_m"]').value=H(y.width_m),w.querySelector('input[name="deco_height_m"]').value=H(y.height_m),w.querySelector('input[name="deco_price_sqyd"]').value=x(y.price_sqyd)||"",w.querySelector('input[name="deco_code"]').value=y.deco_code||"",w.querySelector('input[name="deco_notes"]').value=y.notes||"",p.appendChild(L)}),f&&S&&a.wallpapers&&a.wallpapers.forEach(y=>{const L=S.content.cloneNode(!0),w=L.querySelector(m.wallpaperItem);y.is_suspended&&w.classList.add("is-suspended"),w.querySelector('input[name="wallpaper_height_m"]').value=H(y.height_m),w.querySelector('input[name="wallpaper_code"]').value=y.wallpaper_code||"",w.querySelector('input[name="wallpaper_price_roll"]').value=x(y.price_per_roll)||"",w.querySelector('input[name="wallpaper_install_cost"]').value=y.hasOwnProperty("install_cost_per_roll")?x(y.install_cost_per_roll):"300",w.querySelector('input[name="wallpaper_notes"]').value=y.notes||"";const T=w.querySelector(m.wallsContainer);T&&q&&y.widths&&y.widths.forEach(C=>{const b=q.content.cloneNode(!0);b.querySelector('input[name="wall_width_m"]').value=H(C),T.appendChild(b)}),f.appendChild(L)}),e.appendChild(s)}),document.querySelectorAll("input[data-favorite-type]").forEach(N),document.querySelectorAll(".item-card").forEach(a=>{re(a)}),ee(),F(),de(),V(),Y(),_("นำเข้าข้อมูลสำเร็จ","success")}function it(t){if(document.getElementById("loading-overlay"))return;const e=document.createElement("div");e.id="loading-overlay",e.innerHTML=`<div class="loading-spinner"></div><p>${t}</p>`,document.body.appendChild(e),document.body.style.overflow="hidden"}function ut(){const t=document.getElementById("loading-overlay");t&&t.remove(),document.body.style.overflow=""}async function dt(t,e){const o=document.querySelector(m.printableContent);if(!o||!t||!t.html){_("ไม่พบข้อมูลสำหรับสร้างเอกสาร","error");return}if(e==="direct"){it("กำลังสร้าง PDF...");const r=document.createElement("div");r.style.position="fixed",r.style.left="-300mm",r.style.top="0",r.style.width="210mm",r.style.background="#fff",r.innerHTML=t.html,document.body.appendChild(r),await new Promise(n=>setTimeout(n,1e3));try{const n=r.querySelectorAll(".pdf-page");if(n.length===0)throw new Error("No pages found to generate.");const c={image:{type:"jpeg",quality:.98},html2canvas:{scale:2,useCORS:!0,logging:!1,width:n[0].scrollWidth,windowWidth:n[0].scrollWidth},jsPDF:{unit:"mm",format:"a4",orientation:"portrait"}},a=await html2pdf().from(n[0]).set(c).toPdf().get("pdf");if(n.length>1)for(let i=1;i<n.length;i++){a.addPage();const l=(await html2canvas(n[i],c.html2canvas)).toDataURL(c.image.type,c.image.quality),u=a.internal.pageSize.getWidth(),d=a.internal.pageSize.getHeight();a.addImage(l,"JPEG",0,0,u,d)}a.save(`${t.fileName}.pdf`),_("ดาวน์โหลด PDF สำเร็จ","success")}catch(n){console.error("PDF Generation Error:",n),_("สร้าง PDF ล้มเหลว, โปรดลองวิธีที่ 2 (พิมพ์)","error")}finally{ut(),document.body.removeChild(r)}}e==="print"&&(o.innerHTML=t.html,setTimeout(()=>{window.print(),setTimeout(()=>{o.innerHTML=""},1e3)},ke))}function mt(t){if(!t||!t.html){_("ไม่พบข้อมูลสำหรับสร้างไฟล์ HTML","error");return}try{const e=`
            <!DOCTYPE html><html lang="th"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
                <title>${t.fileName}</title>
                <link rel="stylesheet" href="https://grobmak.github.io/marnthara-form/src/style.css">
                <style>#printable-content { display: block !important; } .pdf-page { border: 1px solid #eee; box-shadow: 0 0 10px rgba(0,0,0,0.1); margin: 10mm auto; }</style>
            </head>
            <body>${t.html}</body></html>`,o=new Blob([e],{type:"text/html;charset=utf-8"}),r=URL.createObjectURL(o),n=document.createElement("a");n.href=r,n.download=`${t.fileName}.html`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(r),_("ดาวน์โหลดไฟล์ HTML สำเร็จ","success")}catch(e){console.error("HTML Export Error:",e),_("สร้างไฟล์ HTML ล้มเหลว","error")}}const pt=async t=>{var a,i,s;const e=t.target.closest("[data-act]"),o=t.target.closest(".fav-manager-item");if(o&&!e&&o.closest("#favManagerBody")){k===o?(k.classList.remove("is-selected"),k=null):(k&&k.classList.remove("is-selected"),o.classList.add("is-selected"),k=o),fe();return}if(!e||M&&!e.closest(".unlockable")&&!["select-favorite","manage-favorites","close-modal","add-new-fav-form","edit-selected-fav","del-selected-fav"].includes(e.dataset.act))return;const r=e.dataset.act,n=e.closest(m.room),c=(l,u,d)=>{K(l,u).then(p=>{p&&d()})};switch(r){case"add-room":le();break;case"add-item":{if(G=e.closest(m.room),G){const d=await ve("เพิ่มรายการใหม่");d==="set"&&Ze(G),d==="deco"&&et(G),d==="wallpaper"&&tt(G)}break}case"change-type":{pe=e.closest(".item-card");const d=e.dataset.currentType;if(pe){const p=await ve("เปลี่ยนประเภทรายการ",d);p&&p!==d&&await K("ยืนยันการเปลี่ยนแปลง","ข้อมูลทั้งหมดในรายการนี้จะถูกลบและสร้างใหม่ คุณแน่ใจหรือไม่?")&&Xe(pe,p)}break}case"add-wall":_e(e);break;case"toggle-more-details":{const d=e.closest(".item-card"),p=d==null?void 0:d.querySelector(".item-details-more");if(p){const f=p.classList.toggle("show");e.classList.toggle("expanded",f);const h=e.querySelector("i"),g=e.querySelector("span");h&&(h.className=f?"ph ph-caret-up":"ph ph-caret-down"),g&&(g.textContent=f?"ย่อน้อยลง":"เพิ่มเติม")}break}case"del-room":c("ลบห้อง","ยืนยันการลบห้องนี้?",()=>J(n,"ลบห้องแล้ว"));break;case"del-set":c("ลบรายการ","ยืนยันการลบรายการผ้าม่าน?",()=>J(e.closest(m.set),"ลบรายการผ้าม่านแล้ว"));break;case"del-deco":c("ลบรายการ","ยืนยันการลบรายการตกแต่ง?",()=>J(e.closest(m.decoItem),"ลบรายการตกแต่งแล้ว"));break;case"del-wallpaper":c("ลบรายการ","ยืนยันการลบรายการวอลเปเปอร์?",()=>J(e.closest(m.wallpaperItem),"ลบรายการวอลเปเปอร์แล้ว"));break;case"del-wall":c("ลบผนัง","ยืนยันการลบผนังนี้?",()=>J(e.closest(".wall-input-row"),"ลบผนังแล้ว"));break;case"clear-room":c("ล้างข้อมูลในห้อง","ยืนยันลบทุกรายการในห้องนี้?",()=>{n.querySelector(m.setsContainer).innerHTML="",n.querySelector(m.decorationsContainer).innerHTML="",n.querySelector(m.wallpapersContainer).innerHTML="",ee(),F(),P(),_("ล้างข้อมูลในห้องแล้ว","success")});break;case"toggle-room-menu":t.preventDefault();const l=e.nextElementSibling;if(!l||!n)return;const u=!l.classList.contains("show");document.querySelectorAll(".room-options-menu.show").forEach(d=>d.classList.remove("show")),document.querySelectorAll(".card.overflow-visible").forEach(d=>d.classList.remove("overflow-visible")),u&&(l.classList.add("show"),n.classList.add("overflow-visible"));break;case"toggle-suspend-room":t.preventDefault(),n==null||n.classList.toggle("is-suspended"),F(),P(),(a=e.closest(".room-options-menu"))==null||a.classList.remove("show"),n==null||n.classList.remove("overflow-visible");break;case"toggle-suspend":t.preventDefault(),(i=e.closest(".item-card"))==null||i.classList.toggle("is-suspended"),re(e),P();break;case"toggle-favorite":{const d=e.dataset.type,p=e.previousElementSibling,f=p==null?void 0:p.value;if(!f||f.trim()===""){_("กรุณากรอกรหัสก่อนบันทึก","warning");return}const h=e.closest(".item-card");if(!h)return;let g=0,S=null,q=null;if(d==="fabric"&&(S=h.querySelector('[name="set_price_per_m"]')),d==="sheer"&&(S=h.querySelector('[name="sheer_price_per_m"]')),d==="wallpaper"&&(S=h.querySelector('[name="wallpaper_price_roll"]')),d==="deco"&&(S=h.querySelector('[name="deco_price_sqyd"]'),q=(s=h.querySelector('[name="deco_type"]'))==null?void 0:s.value,!q)){_("กรุณาเลือกประเภทของตกแต่งก่อนบันทึก","warning");return}if(S&&S.value&&(g=v(S.value)),g<=0){_("กรุณากรอกราคาก่อนบันทึกเป็นรายการโปรด","warning");return}const y=Ue(d,f,g,q);N(p),_(y?"บันทึกรหัสโปรดแล้ว":"ลบรหัสโปรดแล้ว","success");break}case"select-favorite":{const d=e.dataset.code,p=e.dataset.price,f=e.closest(".form-group-with-favorites"),h=f?f.querySelector("input[data-favorite-type]"):z;if(h){h.value=d;const g=e.closest(".item-card");if(g&&p){const S=h.dataset.favoriteType;let q=null;S==="fabric"&&(q=g.querySelector('[name="set_price_per_m"]')),S==="sheer"&&(q=g.querySelector('[name="sheer_price_per_m"]')),S==="deco"&&(q=g.querySelector('[name="deco_price_sqyd"]')),S==="wallpaper"&&(q=g.querySelector('[name="wallpaper_price_roll"]')),q&&(q.tagName==="SELECT"?q.value=p:q.value=x(v(p)),q.classList.add("input-highlight"),setTimeout(()=>q.classList.remove("input-highlight"),1200),q.dispatchEvent(new Event("change",{bubbles:!0})))}h.dispatchEvent(new Event("input",{bubbles:!0})),X(),_(`เลือกโค้ด ${d} แล้ว`,"success")}break}case"manage-favorites":{X();const d=e.dataset.type,p=e.dataset.subType||null;if(d==="deco"&&!p){_("กรุณาเลือกประเภทของตกแต่งก่อน","warning");return}Qe(d,p);break}case"del-selected-fav":{if(!k)return;const{type:d,subType:p,code:f}=k.dataset;c("ลบรายการโปรด",`ยืนยันการลบ "${f}"?`,()=>{Se(d,f,p)&&(Q=!0,k.remove(),k=null,fe(),_("ลบรายการโปรดแล้ว","success"),ot(f,d,p),document.querySelector(".fav-manager-item")||se(d,p))});break}case"edit-selected-fav":{if(!k)return;const{type:d,subType:p,code:f,price:h}=k.dataset,g=await ze({code:f,price:h});if(g){if(!g.newCode){_("รหัสห้ามว่าง","error");return}He(d,f,g.newCode,g.newPrice,p)?(Q=!0,_("อัปเดตรายการแล้ว","success"),se(d,p),rt(f,g,d,p)):_("อัปเดตล้มเหลว รหัสอาจซ้ำซ้อน","error")}break}case"add-new-fav-form":{const{type:d,subType:p}=document.getElementById("favManagerTitle").dataset,f=await Ke();if(f){if(!f.newCode){_("กรุณากรอกรหัส","error");return}if(f.newPrice<=0){_("กรุณากรอกราคา","error");return}Oe(d,f.newCode,f.newPrice,p)?(Q=!0,_("เพิ่มรายการใหม่สำเร็จ","success"),se(d,p)):_("เพิ่มล้มเหลว รหัสอาจซ้ำ","error")}break}}};function ft(){M=!M,be()}function ht(){const t=document.querySelector(m.setTpl);if(!t)return;const e=t.content.querySelector('select[name="set_price_per_m"]'),o=t.content.querySelector('select[name="sheer_price_per_m"]'),r=n=>{let c='<option value="" hidden>เลือกราคา</option>';return n.forEach(a=>{c+=`<option value="${a}">${a.toLocaleString("th-TH")}</option>`}),c};e&&(e.innerHTML=r(ie.fabric)),o&&(o.innerHTML=r(ie.sheer))}function yt(){ht(),qe();const t=document.querySelector(m.orderForm),e=document.querySelector(m.fileImporter),o=document.querySelector(m.menuDropdown),r=document.querySelector(m.quickNavDropdown),n=document.querySelector("#pageBreakBuffer"),c=document.querySelector("#pageBreakBufferValue");n&&c&&n.addEventListener("input",()=>{c.textContent=n.value}),t.addEventListener("input",at),t.addEventListener("change",ct),document.addEventListener("click",pt),t.addEventListener("blur",st,!0),t.addEventListener("focusin",lt);const a=s=>{const l=s.target.closest(m.room);l&&Le(l)};t.addEventListener("click",a),t.addEventListener("focusin",a),document.body.addEventListener("click",s=>{s.target.closest("summary")&&setTimeout(V,50)}),document.querySelector(m.lockBtn).addEventListener("click",ft),document.querySelector(m.toggleAllRoomsBtn).addEventListener("click",Ge),document.querySelector(m.quickNavBtn).addEventListener("click",s=>{var u;s.stopPropagation(),o.classList.remove("show");const l=!r.classList.contains("show");r.classList.toggle("show"),s.currentTarget.setAttribute("aria-expanded",l),l&&((u=document.querySelector(m.menuBtn))==null||u.setAttribute("aria-expanded","false"))}),document.querySelector(m.quickNavRoomList).addEventListener("click",s=>{var u;const l=s.target.closest("a[data-jump-to]");if(l){s.preventDefault();const d=l.dataset.jumpTo,p=document.getElementById(d);p&&(document.body.classList.add("disable-animations"),p.open=!0,p.scrollIntoView({behavior:"auto",block:"start"}),p.classList.add("scrolling-jump"),setTimeout(()=>{p.classList.remove("scrolling-jump"),document.body.classList.remove("disable-animations"),V()},1e3)),r.classList.remove("show"),(u=document.querySelector(m.quickNavBtn))==null||u.setAttribute("aria-expanded","false")}});const i=document.querySelector("#addRoomQuickNavBtn");if(i){const s=Me(le,700);i.addEventListener("click",l=>{var u;l.stopPropagation(),s(),r.classList.remove("show"),(u=document.querySelector(m.quickNavBtn))==null||u.setAttribute("aria-expanded","false")})}document.querySelector(m.menuBtn).addEventListener("click",s=>{var u;s.stopPropagation(),r.classList.remove("show");const l=!o.classList.contains("show");o.classList.toggle("show"),s.currentTarget.setAttribute("aria-expanded",l),l&&((u=document.querySelector(m.quickNavBtn))==null||u.setAttribute("aria-expanded","false"))}),document.querySelector("#themeToggleBtn").addEventListener("click",s=>{s.preventDefault(),Ve()}),document.querySelector("#overviewBtn").addEventListener("click",async s=>{var p;s.preventDefault(),o.classList.remove("show"),(p=document.querySelector(m.menuBtn))==null||p.setAttribute("aria-expanded","false");const l=j(),u=Fe(l),d=document.querySelector("#overviewModalBody");d&&(d.innerHTML=u,D("#overviewModal",()=>{}))}),document.querySelector(m.exportPdfBtn).addEventListener("click",async s=>{var f;s.preventDefault(),o.classList.remove("show"),(f=document.querySelector(m.menuBtn))==null||f.setAttribute("aria-expanded","false");const l=await Ye();if(!l)return;const u=j(),d=l.vatOption==="include"?I.baseVatRate:0,p=Re(u,{vatRate:d,pageBreakBuffer:l.pageBreakBuffer});if(!p){_("ไม่มีรายการที่มีราคาสำหรับสร้างเอกสาร","warning");return}l.exportMethod==="html"?mt(p):dt(p,l.exportMethod)}),document.querySelector(m.importBtn).addEventListener("click",s=>{var l;s.preventDefault(),o.classList.remove("show"),(l=document.querySelector(m.menuBtn))==null||l.setAttribute("aria-expanded","false"),e.click()}),e.addEventListener("change",s=>{var d;const l=(d=s.target.files)==null?void 0:d[0];if(!l)return;const u=new FileReader;u.onload=p=>{try{const f=JSON.parse(p.target.result);ge(f)}catch{_("ไฟล์ JSON ไม่ถูกต้อง","error")}},u.readAsText(l),s.target.value=null}),document.querySelector(m.exportBtn).addEventListener("click",s=>{var l;s.preventDefault(),o.classList.remove("show"),(l=document.querySelector(m.menuBtn))==null||l.setAttribute("aria-expanded","false");try{const u=j(),d=JSON.stringify(u,null,4),p=new Blob([d],{type:"application/json"}),f=URL.createObjectURL(p),h=document.createElement("a"),g=new Date,S=`${g.getFullYear()}${(g.getMonth()+1).toString().padStart(2,"0")}${g.getDate().toString().padStart(2,"0")}`,q=(u.customer_name||"data").trim().replace(/\s+/g,"-");h.href=f,h.download=`MTR-${q}-${S}.json`,h.click(),URL.revokeObjectURL(f),_("Export ข้อมูลสำเร็จ","success")}catch{_("Export ข้อมูลล้มเหลว","error")}}),document.querySelector(m.submitBtn).addEventListener("click",async s=>{var l;if(s.preventDefault(),o.classList.remove("show"),(l=document.querySelector(m.menuBtn))==null||l.setAttribute("aria-expanded","false"),await K("ส่งข้อมูล","ยืนยันการส่งข้อมูลการประเมินราคา?")){const u=j();if(!u.customer_name&&!u.customer_phone){_("กรุณาระบุชื่อหรือเบอร์โทรลูกค้า","warning");return}_("กำลังส่งข้อมูล...","default");try{const d=await fetch(Ce,{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)});d.ok?_("ส่งข้อมูลสำเร็จ!","success"):_(`ส่งข้อมูลล้มเหลว: ${d.status}`,"error")}catch{_("เกิดข้อผิดพลาดในการเชื่อมต่อ","error")}}}),document.querySelector(m.copyTextBtn).addEventListener("click",async s=>{var u;s.preventDefault(),o.classList.remove("show"),(u=document.querySelector(m.menuBtn))==null||u.setAttribute("aria-expanded","false");const l=document.querySelector(m.copyOptionsModal);if(l.querySelector('input[name="copy_option"][value="customer"]').checked=!0,await D(m.copyOptionsModal)){const d=l.querySelector('input[name="copy_option"]:checked').value,p=Ne(j(),d);try{await navigator.clipboard.writeText(p),_("คัดลอกสรุปสำเร็จ!","success")}catch{_("คัดลอกล้มเหลว","error")}}}),document.querySelector(m.clearItemsBtn).addEventListener("click",async s=>{var l;s.preventDefault(),o.classList.remove("show"),(l=document.querySelector(m.menuBtn))==null||l.setAttribute("aria-expanded","false"),await K("ล้างทุกรายการ","คุณแน่ใจหรือไม่ว่าต้องการลบรายการสินค้าทั้งหมด (ข้อมูลลูกค้าและห้องจะยังคงอยู่)?")&&(document.querySelectorAll(m.room).forEach(u=>{u.querySelector(m.setsContainer).innerHTML="",u.querySelector(m.decorationsContainer).innerHTML="",u.querySelector(m.wallpapersContainer).innerHTML=""}),F(),P(),_("ล้างทุกรายการแล้ว","success"))}),document.querySelector(m.clearAllBtn).addEventListener("click",async s=>{var l;s.preventDefault(),o.classList.remove("show"),(l=document.querySelector(m.menuBtn))==null||l.setAttribute("aria-expanded","false"),await K("ลบข้อมูลทั้งหมด","คุณแน่ใจหรือไม่ว่าต้องการลบข้อมูลทั้งหมดในฟอร์มนี้? การกระทำนี้ไม่สามารถย้อนกลับได้")&&(localStorage.removeItem(ce),localStorage.removeItem("marnthara.theme"),je(),window.location.reload())}),window.addEventListener("click",s=>{var l,u;s.target.closest(".menu-container")||(o.classList.contains("show")&&(o.classList.remove("show"),(l=document.querySelector(m.menuBtn))==null||l.setAttribute("aria-expanded","false")),r.classList.contains("show")&&(r.classList.remove("show"),(u=document.querySelector(m.quickNavBtn))==null||u.setAttribute("aria-expanded","false"))),s.target.closest(".room-options-container")||(document.querySelectorAll(".room-options-menu.show").forEach(d=>d.classList.remove("show")),document.querySelectorAll(".card.overflow-visible").forEach(d=>d.classList.remove("overflow-visible"))),s.target.closest(".form-group-with-favorites")||X()});try{const s=localStorage.getItem(ce);if(s)ge(JSON.parse(s));else{le();const l=document.querySelector("#customerDetailsCard");l&&(l.open=!0)}}catch{localStorage.removeItem(ce),le()}F(),be(),V(),Y()}document.addEventListener("DOMContentLoaded",yt);
