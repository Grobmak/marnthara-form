(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))t(a);new MutationObserver(a=>{for(const n of a)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&t(o)}).observe(document,{childList:!0,subtree:!0});function s(a){const n={};return a.integrity&&(n.integrity=a.integrity),a.referrerPolicy&&(n.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?n.credentials="include":a.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function t(a){if(a.ep)return;a.ep=!0;const n=s(a);fetch(a.href,n)}})();const ne="input-ui/5.5.1-stable-hotfix",ae="https://your-make-webhook-url.com/your-unique-path",Q="marnthara.input.v4",se=500,k={name:"ม่านธารา ผ้าม่านและของตกแต่ง",address:"65/8 หมู่ 2 ต.ท่าศาลา อ.เมือง จ.ลพบุรี 15000",phone:"092-985-9395, 082-552-5595",taxId:"1234567890123",logoUrl:"https://i.imgur.com/l7y85nI.png",baseVatRate:.07,pdf:{paymentTerms:"ชำระมัดจำ 50%",priceValidity:"30 วัน",notes:["ราคานี้รวมค่าติดตั้งแล้ว","ชำระมัดจำ 50% เพื่อยืนยันการสั่งผลิตสินค้า","ใบเสนอราคานี้มีอายุ 30 วัน นับจากวันที่เสนอราคา"]}},le=1.19599,J={fabric:[1e3,1100,1200,1300,1400,1500,1600,1700,1800,1900,2e3,2100,2200],sheer:[1e3,1100,1200,1300,1400,1500],style_surcharge:{ลอน:200,ตาไก่:0,จีบ:0},height:[{threshold:3.2,add_per_m:300},{threshold:2.8,add_per_m:200},{threshold:2.5,add_per_m:100}]},c={orderForm:"#orderForm",roomsContainer:"#rooms",setTpl:"#setTpl",clearAllBtn:"#clearAllBtn",lockBtn:"#lockBtn",grandTotal:"#grandTotal",setCount:"#setCount",modal:"#confirmationModal",modalTitle:"#modalTitle",modalBody:"#modalBody",room:"[data-room]",set:"[data-set]",setsContainer:"[data-sets]",decorationsContainer:"[data-decorations]",decoItem:"[data-deco-item]",wallpapersContainer:"[data-wallpapers]",wallpaperItem:"[data-wallpaper-item]",wallsContainer:"[data-walls-container]",sheerWrap:"[data-sheer-wrap]",sheerCodeWrap:"[data-sheer-code-wrap]",roomNameInput:'input[name="room_name"]',toastContainer:"#toast-container",copyTextBtn:"#copyTextBtn",copyOptionsModal:"#copyOptionsModal",menuBtn:"#menuBtn",menuDropdown:"#menuDropdown",importBtn:"#importBtn",exportBtn:"#exportBtn",fileImporter:"#fileImporter",submitBtn:"#submitBtn",clearItemsBtn:"#clearItemsBtn",exportPdfBtn:"#exportPdfBtn",exportOptionsModal:"#exportOptionsModal",printableContent:"#printable-content",quickNavBtn:"#quickNavBtn",quickNavDropdown:"#quickNavDropdown",quickNavRoomList:"#quickNavRoomList",toggleAllRoomsBtn:"#toggleAllRoomsBtn",allDetailsCards:'.card[id="customerDetailsCard"], .room-card'},y=e=>{typeof e=="string"&&(e=e.replace(/,/g,""));const r=parseFloat(e);return Number.isFinite(r)?r:0},P=(e,r=2,s=!1)=>Number.isFinite(e)?e.toLocaleString("en-US",{minimumFractionDigits:s?2:r,maximumFractionDigits:s?2:r}):"0",T=(e,r=0)=>Number.isFinite(e)?e.toLocaleString("th-TH",{minimumFractionDigits:r,maximumFractionDigits:r}):"0",ce=(e,r=150)=>{let s;return(...t)=>{clearTimeout(s),s=setTimeout(()=>e(...t),r)}},ie=(e,r=700)=>{let s=!1;return(...t)=>{if(!s){s=!0;try{return e(...t)}finally{setTimeout(()=>{s=!1},r)}}}};function ue(e){if(e=Number(e),isNaN(e))return"ข้อมูลตัวเลขไม่ถูกต้อง";if(e===0)return"ศูนย์บาทถ้วน";const[r,s]=e.toFixed(2).split(".");let t="",a=parseInt(r,10);a>0&&(t+=`${a.toLocaleString("th-TH")} บาท`);const n=parseInt(s,10);return n>0&&(t+=` ${n.toLocaleString("th-TH")} สตางค์`),t.trim()||"ศูนย์บาทถ้วน"}function D(){var r,s,t;const e={app_version:ne,customer_name:((r=document.querySelector('[name="customer_name"]'))==null?void 0:r.value)||"",customer_phone:((s=document.querySelector('[name="customer_phone"]'))==null?void 0:s.value)||"",customer_address:((t=document.querySelector('[name="customer_address"]'))==null?void 0:t.value)||"",rooms:[]};return document.querySelectorAll(c.room).forEach(a=>{var o;const n={id:a.id,room_name:((o=a.querySelector(c.roomNameInput))==null?void 0:o.value)||"",is_suspended:a.classList.contains("is-suspended"),sets:[],decorations:[],wallpapers:[]};a.querySelectorAll(c.set).forEach(l=>{var i,u,d,f,h,_,g,C,w,m,v;n.sets.push({width_m:y((i=l.querySelector('input[name="width_m"]'))==null?void 0:i.value),height_m:y((u=l.querySelector('input[name="height_m"]'))==null?void 0:u.value),style:((d=l.querySelector('select[name="set_style"]'))==null?void 0:d.value)||"",fabric_variant:((f=l.querySelector('select[name="fabric_variant"]'))==null?void 0:f.value)||"",price_per_m_raw:y((h=l.querySelector('select[name="set_price_per_m"]'))==null?void 0:h.value),sheer_price_per_m:y((_=l.querySelector('select[name="sheer_price_per_m"]'))==null?void 0:_.value),fabric_code:((g=l.querySelector('input[name="fabric_code"]'))==null?void 0:g.value)||"",sheer_fabric_code:((C=l.querySelector('input[name="sheer_fabric_code"]'))==null?void 0:C.value)||"",opening_style:((w=l.querySelector('select[name="opening_style"]'))==null?void 0:w.value)||"",track_color:((m=l.querySelector('select[name="track_color"]'))==null?void 0:m.value)||"",notes:((v=l.querySelector('input[name="notes"]'))==null?void 0:v.value)||"",is_suspended:l.classList.contains("is-suspended")})}),a.querySelectorAll(c.decoItem).forEach(l=>{var i,u,d,f,h,_;n.decorations.push({type:((i=l.querySelector('[name="deco_type"]'))==null?void 0:i.value)||"",width_m:y((u=l.querySelector('[name="deco_width_m"]'))==null?void 0:u.value),height_m:y((d=l.querySelector('[name="deco_height_m"]'))==null?void 0:d.value),price_sqyd:y((f=l.querySelector('[name="deco_price_sqyd"]'))==null?void 0:f.value),deco_code:((h=l.querySelector('[name="deco_code"]'))==null?void 0:h.value)||"",notes:((_=l.querySelector('[name="deco_notes"]'))==null?void 0:_.value)||"",is_suspended:l.classList.contains("is-suspended")})}),a.querySelectorAll(c.wallpaperItem).forEach(l=>{var i,u,d,f,h;n.wallpapers.push({height_m:y((i=l.querySelector('[name="wallpaper_height_m"]'))==null?void 0:i.value),wallpaper_code:((u=l.querySelector('[name="wallpaper_code"]'))==null?void 0:u.value)||"",price_per_roll:y((d=l.querySelector('[name="wallpaper_price_roll"]'))==null?void 0:d.value),install_cost_per_roll:y((f=l.querySelector('[name="wallpaper_install_cost"]'))==null?void 0:f.value),notes:((h=l.querySelector('[name="wallpaper_notes"]'))==null?void 0:h.value)||"",widths:Array.from(l.querySelectorAll('[name="wall_width_m"]')).map(_=>y(_.value)),is_suspended:l.classList.contains("is-suspended")})}),e.rooms.push(n)}),e}function M(){localStorage.setItem(Q,JSON.stringify(D()))}const q={stylePlus:e=>J.style_surcharge[e]??0,heightPlus:e=>{const r=[...J.height].sort((s,t)=>t.threshold-s.threshold);for(const s of r)if(e>s.threshold)return s.add_per_m;return 0},fabricYardage:(e,r)=>{const s=y(r);return s<=0||!e?0:e==="ตาไก่"||e==="จีบ"?(s*2+.6)/.9:e==="ลอน"?(s*2.6+.6)/.9:0},wallpaperRolls:(e,r)=>{const s=y(e),t=y(r);if(s<=0||t<=0)return 0;const a=t>2.5?Math.floor(10/t):3;if(a<=0)return 0;const n=Math.ceil(s/.53);return Math.ceil(n/a)},calculateSetPrice:function(e){var o,l;if(!e||e.is_suspended||y(e.width_m)<=0)return{total:0,opaque:0,sheer:0};const r=this.stylePlus(e.style),s=this.heightPlus(y(e.height_m)),t=y(e.width_m),a=(o=e.fabric_variant)!=null&&o.includes("ทึบ")&&y(e.price_per_m_raw)>0?(y(e.price_per_m_raw)+r+s)*t:0,n=(l=e.fabric_variant)!=null&&l.includes("โปร่ง")&&y(e.sheer_price_per_m)>0?(y(e.sheer_price_per_m)+r+s)*t:0;return{total:Math.round(a+n),opaque:Math.round(a),sheer:Math.round(n)}},calculateDecoPrice:function(e){if(!e||e.is_suspended||y(e.width_m)<=0)return{total:0,sqm:0,sqyd:0};const r=y(e.width_m)*y(e.height_m),s=r*le,t=s*y(e.price_sqyd);return{total:Math.round(t),sqm:r,sqyd:s}},calculateWallpaperPrice:function(e){var o;if(!e||e.is_suspended)return{total:0,material:0,install:0,rolls:0,sqm:0};const r=((o=e.widths)==null?void 0:o.reduce((l,i)=>l+y(i),0))||0;if(r<=0)return{total:0,material:0,install:0,rolls:0,sqm:0};const s=y(e.height_m),t=this.wallpaperRolls(r,s),a=t*y(e.price_per_roll),n=t*(y(e.install_cost_per_roll)||0);return{total:Math.round(a+n),material:Math.round(a),install:Math.round(n),rolls:t,sqm:r*s}}};function de(e){return e.rooms.reduce((r,s)=>{if(s.is_suspended)return r;const t=s.sets.reduce((o,l)=>o+q.calculateSetPrice(l).total,0),a=s.decorations.reduce((o,l)=>o+q.calculateDecoPrice(l).total,0),n=s.wallpapers.reduce((o,l)=>o+q.calculateWallpaperPrice(l).total,0);return r+t+a+n},0)}function me(e,r){const s=de(e);let t=`สรุปข้อมูล (${new Date().toLocaleDateString("th-TH",{day:"numeric",month:"numeric",year:"numeric"})})
`;if(t+=`ลูกค้า: ${e.customer_name||"-"}
`,(r==="customer"||r==="owner")&&(t+=`เบอร์โทร: ${e.customer_phone||"-"}
`,t+=`ที่อยู่: ${e.customer_address||"-"}
`),t+=`------------------------------
`,r==="customer")return t+=`
สรุปรายการ
`,e.rooms.forEach(a=>{if(a.is_suspended||[...a.sets,...a.decorations,...a.wallpapers].filter(l=>l.is_suspended?!1:l.widths?l.widths.reduce((i,u)=>i+u,0)>0:l.width_m>0).length===0)return;t+=`
*ห้อง: ${a.room_name||"ไม่ระบุ"}*
`;let o=0;a.sets.forEach(l=>{l.is_suspended||l.width_m<=0||(o++,t+=` ${o}) ผ้าม่าน ${l.style} (${l.fabric_variant})
`)}),a.decorations.forEach(l=>{l.is_suspended||l.width_m<=0||(o++,t+=` ${o}) ${l.type||"ของตกแต่ง"}
`)}),a.wallpapers.forEach(l=>{l.is_suspended||l.widths.reduce((i,u)=>i+u,0)<=0||(o++,t+=` ${o}) วอลเปเปอร์
`)})}),t+=`------------------------------
`,t+=`
สรุปยอดรวม: ${T(s)} บาท
`,t+=`
ขอบคุณที่ใช้บริการ
${k.name}
โทร: ${k.phone}`,t;if(r==="purchase_order"||r==="owner"){const a={opaqueFabrics:[],sheerFabrics:[],decorations:[],wallpapers:[],allSets:[]};if(e.rooms.forEach(n=>{n.is_suspended||(n.sets.forEach(o=>{o.is_suspended||o.width_m<=0||(a.allSets.push(o),o.fabric_variant.includes("ทึบ")&&a.opaqueFabrics.push({code:o.fabric_code||"??",yards:q.fabricYardage(o.style,o.width_m)}),o.fabric_variant.includes("โปร่ง")&&a.sheerFabrics.push({code:o.sheer_fabric_code||"??",yards:q.fabricYardage(o.style,o.width_m)}))}),n.decorations.forEach(o=>{o.is_suspended||!o.type||o.width_m<=0||a.decorations.push({type:o.type,code:o.deco_code||"xxx",width:o.width_m,height:o.height_m})}),n.wallpapers.forEach(o=>{if(o.is_suspended)return;const l=o.widths.reduce((i,u)=>i+u,0);if(l>0){const i=q.wallpaperRolls(l,o.height_m);i>0&&a.wallpapers.push({code:o.wallpaper_code||"xxx",rolls:i})}}))}),t+=`📋 *สรุปวัสดุสำหรับสั่งซื้อผ้า*
`,t+=`------------------------------
`,a.opaqueFabrics.length>0&&a.opaqueFabrics.forEach(n=>{t+=`- ผ้าทึบ (Curtain Fabric)
`,t+=`รหัส: #${n.code||"??"}
`,t+=`จำนวน: ${n.yards.toFixed(2)} หลา

`}),a.sheerFabrics.length>0&&a.sheerFabrics.forEach(n=>{t+=`- ผ้าโปร่ง (Sheer Fabric)
`,t+=`รหัส: #${n.code||"??"}
`,t+=`จำนวน: ${n.yards.toFixed(2)} หลา

`}),t+=`------------------------------
`,t+=`📋 *สำหรับสั่งซื้อ ราง*
`,t+=`------------------------------

`,a.allSets.length>0){let n=1;a.allSets.forEach(o=>{t+=`(${n++}) รางม่าน: ${o.style}, สี: ${o.track_color}
`,o.fabric_variant.includes("ทึบ")&&(t+=`  - รางทึบ: ${o.width_m.toFixed(2)} ม. (1 เส้น)
`),o.fabric_variant.includes("โปร่ง")&&(t+=`  - รางโปร่ง: ${o.width_m.toFixed(2)} ม. (1 เส้น)
`),o.fabric_variant==="ทึบ&โปร่ง"&&(t+=`  (❗️ต้องใช้ขาสองชั้น)
`),t+=`
`})}if(t+=`------------------------------
`,t+=`📋 *สำหรับสั่งซื้อ Blind*
`,t+=`------------------------------

`,a.decorations.length>0){const n={มู่ลี่ไม้:"Wooden Blind",ม่านม้วน:"Roller Blind",ปรับแสง:"Vertical Blind",ฉากกั้นห้อง:"Partition",มุ้งจีบ:"Pleated Insect Screen",มู่ลี่มิเนียม:"Aluminium Blind"};a.decorations.forEach(o=>{const l=n[o.type]?` (${n[o.type]})`:"";t+=`- ${o.type}${l}
`,t+=`รหัส: #${o.code||"xxx"}
`,t+=`ขนาด: ${o.width.toFixed(2)} x ${o.height.toFixed(2)} m.
`,t+=`จำนวน: 1 ชุด

`})}if(t+=`------------------------------
`,t+=`📋 *สำหรับสั่งซื้อ Wallpaper*
`,t+=`------------------------------

`,a.wallpapers.length>0&&a.wallpapers.forEach(n=>{t+=`- วอลเปเปอร์ -
`,t+=`รหัส: #${n.code||"xxx"}
`,t+=`จำนวน: ${n.rolls} ม้วน

`}),t+=`------------------------------
`,r==="purchase_order")return t}return(r==="seamstress"||r==="owner")&&(t+=`
🧵 *รายละเอียดสำหรับช่าง*
`,e.rooms.forEach(a=>{if(a.is_suspended||a.sets.filter(l=>!l.is_suspended&&l.width_m>0).length===0)return;t+=`
*ห้อง: ${a.room_name||"ไม่ระบุ"}*
`;let o=1;a.sets.forEach(l=>{l.is_suspended||l.width_m<=0||(t+=`${o++}) *ผ้าม่าน ${l.style} ${l.fabric_variant}*
`,t+=`  กว้าง ${l.width_m} x สูง ${l.height_m} ม.
`,t+=`  รูปแบบเปิด: ${l.opening_style}
`,l.fabric_variant.includes("ทึบ")&&(t+=`  ผ้าทึบ: รหัส ${l.fabric_code||"-"}
`),l.fabric_variant.includes("โปร่ง")&&(t+=`  ผ้าโปร่ง: รหัส ${l.sheer_fabric_code||"-"}
`))})}),t+=`------------------------------
`,r==="seamstress")||r==="owner"&&(t+=`
💰 *สรุปยอดรวม: ${T(s)} บาท*
`),t}function pe(e){if(!e.rooms||e.rooms.length===0)return'<p class="empty-summary">ไม่มีข้อมูลสำหรับแสดงผล</p>';const r={};let s=0,t="";if(e.rooms.forEach(o=>{if(o.is_suspended)return;const l={};o.sets.forEach(u=>{if(q.calculateSetPrice(u).total>0){const d="ผ้าม่าน";l[d]=(l[d]||0)+1,r[d]=(r[d]||0)+1}}),o.decorations.forEach(u=>{if(u.type&&q.calculateDecoPrice(u).total>0){const d=u.type;l[d]=(l[d]||0)+1,r[d]=(r[d]||0)+1}}),o.wallpapers.forEach(u=>{if(q.calculateWallpaperPrice(u).total>0){const d="วอลเปเปอร์";l[d]=(l[d]||0)+1,r[d]=(r[d]||0)+1}});const i=Object.entries(l);i.length>0&&(t+=`<tr class="room-header-row"><td colspan="3">${o.room_name||"ไม่ระบุชื่อห้อง"}</td></tr>`,i.forEach(([u,d])=>{t+=`<tr><td></td><td class="item-type-cell">${u}</td><td class="pdf-text-center">${d}</td></tr>`,s+=d}))}),s===0)return'<p class="empty-summary">ไม่มีรายการที่มีราคาสำหรับแสดงผล</p>';let n=`<div id="detailed-material-summary">
        <h4><i class="ph ph-stack"></i> ยอดรวมทุกประเภท</h4>
        <ul><li class="summary-note">${Object.entries(r).map(([o,l])=>`${o}: ${l}`).join(" , ")}</li></ul>
    </div>`;return n+=`<table>
        <thead><tr><th>ห้อง</th><th>รายการ</th><th class="pdf-text-center">จำนวน</th></tr></thead>
        <tbody>${t}</tbody>
    </table>`,n}function fe(e,r){const{vatRate:s,pageBreakBuffer:t=3}=r,a=[];e.rooms.forEach($=>{if($.is_suspended)return;const L=[];$.sets.forEach(S=>{const x=q.calculateSetPrice(S).total;if(x>0){let E=`ผ้าม่าน ${S.style} (${S.fabric_variant}) <br><small>ขนาด ${S.width_m.toFixed(2)} x ${S.height_m.toFixed(2)} ม.${S.notes?` - ${S.notes}`:""}</small>`;L.push({description:E,total:x,units:E.includes("<br>")?1.5:1})}}),$.decorations.forEach(S=>{const x=q.calculateDecoPrice(S).total;if(x>0){let E=`${S.type||"งานตกแต่ง"} <br><small>รหัส: ${S.deco_code||"-"}, ขนาด ${S.width_m.toFixed(2)} x ${S.height_m.toFixed(2)} ม.</small>`;L.push({description:E,total:x,units:E.includes("<br>")?1.5:1})}}),$.wallpapers.forEach(S=>{const x=q.calculateWallpaperPrice(S).total;if(x>0){const E=S.widths.reduce((V,Z)=>V+Z,0),A=q.wallpaperRolls(E,S.height_m);let F=`วอลเปเปอร์ <br><small>รหัส: ${S.wallpaper_code||"-"}, สูง ${S.height_m.toFixed(2)} ม. (ใช้ ${A} ม้วน)</small>`;L.push({description:F,total:x,units:F.includes("<br>")?1.5:1})}}),L.length>0&&(a.push({isRoomHeader:!0,roomName:$.room_name||"ไม่ระบุชื่อห้อง",units:1.2}),a.push(...L))});const n=a.reduce(($,L)=>$+(L.total||0),0);if(n===0)return null;const o=n*s,l=n+o,i=17,u=23,d=[];let f=[],h=0;a.forEach(($,L)=>{const S=d.length===0?i:u,x=h+$.units>S;let E=!1;if(!x&&L<a.length-1){const A=S-(h+$.units);A>0&&A<t&&(E=!0)}(x||E)&&f.length>0&&(d.push(f),f=[],h=0),f.push($),h+=$.units}),f.length>0&&d.push(f);const _=new Date,g=_.toLocaleDateString("th-TH",{year:"numeric",month:"long",day:"numeric"}),C=`QT-${_.getFullYear()}${(_.getMonth()+1).toString().padStart(2,"0")}${_.getDate().toString().padStart(2,"0")}`;let w="",m=0,v=1;d.forEach(($,L)=>{const S=L===0,x=L===d.length-1,E=`
            <div class="pdf-page-header">
                <div class="pdf-header">
                    <div class="pdf-shop-info">
                        ${`<img src="${k.logoUrl}" alt="Logo" class="pdf-logo">`}
                        <div class="pdf-shop-address">
                            <strong>${k.name}</strong><br>
                            ${k.address.replace(/\n/g,"<br>")}<br>
                            โทร: ${k.phone} | เลขประจำตัวผู้เสียภาษี: ${k.taxId}
                        </div>
                    </div>
                    <div class="pdf-quote-details">
                        <div class="pdf-title-box"><h1>ใบเสนอราคา ${d.length>1?S?"":"(ต่อ)":""}</h1></div>
                        <table class="pdf-quote-meta">
                            <tr><td>เลขที่:</td><td>${C}</td></tr>
                            <tr><td>วันที่:</td><td>${g}</td></tr>
                        </table>
                    </div>
                </div>
                ${S?`
                <section class="pdf-customer-details">
                    <div class="pdf-customer-info">
                        <strong>ลูกค้า:</strong> ${e.customer_name||""}<br>
                        <strong>ที่อยู่:</strong> ${e.customer_address.replace(/\n/g,"<br>")||""}<br>
                        <strong>โทร:</strong> ${e.customer_phone||""}
                    </div>
                    <div class="pdf-customer-meta">
                        <strong>เงื่อนไขชำระเงิน:</strong> ${k.pdf.paymentTerms}<br>
                        <strong>ยืนราคา:</strong> ${k.pdf.priceValidity}
                    </div>
                </section>`:""}
            </div>`,A=`
            <div class="pdf-page-footer">
                <div class="pdf-footer-info">
                    <span>${k.name} | โทร: ${k.phone}</span>
                    <span>หน้า ${L+1} / ${d.length}</span>
                </div>
            </div>`;let F="";S||(F+=`<tr class="pdf-subtotal-row"><td colspan="4">ยอดยกมา (Brought Forward)</td><td class="pdf-text-right">${P(m,2,!0)}</td></tr>`),$.forEach(N=>{N.isRoomHeader?F+=`<tr class="pdf-room-header"><td colspan="5">ห้อง: ${N.roomName}</td></tr>`:(F+=`<tr><td class="pdf-text-center">${v++}</td><td>${N.description}</td><td class="pdf-text-center">1</td><td class="pdf-text-right">${P(N.total,2,!0)}</td><td class="pdf-text-right">${P(N.total,2,!0)}</td></tr>`,m+=N.total)});let V="";x||(V=`<tfoot><tr class="pdf-subtotal-row"><td colspan="4">ยอดยกไป (Carried Forward)</td><td class="pdf-text-right">${P(m,2,!0)}</td></tr></tfoot>`);const Z=x?`
            <div class="pdf-summary-wrapper">
                <section class="pdf-summary-section">
                    <div class="pdf-amount-in-words">
                        <strong>หมายเหตุ:</strong>
                        <ul>${k.pdf.notes.map(N=>`<li>${N}</li>`).join("")}</ul>
                        <div class="pdf-amount-text">( ${ue(l)} )</div>
                    </div>
                    <div class="pdf-totals-block">
                        <table>
                            <tr><td colspan="2" class="pdf-label">รวมเป็นเงิน</td><td class="pdf-amount">${P(n,2,!0)}</td></tr>
                            ${s>0?`<tr><td colspan="2" class="pdf-label">ภาษีมูลค่าเพิ่ม ${(s*100).toFixed(0)}%</td><td class="pdf-amount">${P(o,2,!0)}</td></tr>`:""}
                            <tr class="pdf-grand-total"><td colspan="2" class="pdf-label">ยอดรวมสุทธิ</td><td class="pdf-amount">${P(l,2,!0)}</td></tr>
                        </table>
                    </div>
                </section>
                <footer class="pdf-footer-section">
                    <div class="pdf-signature-box"><p>.................................................</p><p>ผู้เสนอราคา</p><p>(${k.name})</p><p>วันที่: ${g}</p></div>
                    <div class="pdf-signature-box"><p>.................................................</p><p>ลูกค้า / ผู้มีอำนาจลงนาม</p><p>&nbsp;</p><p>วันที่: ......./......./............</p></div>
                </footer>
            </div>
        `:"";w+=`
            <div class="pdf-page">
                <div class="pdf-page-content">
                    ${E}
                    <div class="pdf-page-body">
                        <table class="pdf-items-table">
                            <thead><tr><th style="width:5%;">ลำดับ</th><th style="width:50%;">รายการ</th><th style="width:10%;">จำนวน</th><th style="width:17.5%;">ราคา/หน่วย</th><th style="width:17.5%;">รวม (บาท)</th></tr></thead>
                            <tbody>${F}</tbody>
                            ${V}
                        </table>
                        ${Z}
                    </div>
                    ${A}
                </div>
            </div>`});const I=(e.customer_name||"quote").trim().replace(/\s+/g,"-");return{html:`<div id="quotation-template">${w}</div>`,fileName:`${C}_${I}`}}let U=0,B=!1;function b(e,r="default"){const s=document.querySelector(c.toastContainer);if(!s)return;const t={success:"ph-bold ph-check-circle",warning:"ph-bold ph-warning",error:"ph-bold ph-x-circle",default:"ph-bold ph-info"},a=document.createElement("div");a.className=`toast toast-${r}`,a.innerHTML=`<i class="${t[r]||t.default}"></i> ${e}`,s.appendChild(a),setTimeout(()=>a.classList.add("show"),10),setTimeout(()=>{a.classList.remove("show"),a.addEventListener("transitionend",()=>a.remove())},3e3)}function K(e,r){return new Promise(s=>{const t=document.querySelector(e);if(!t){s(null);return}t.classList.add("visible");const a=t.querySelector('[id$="Confirm"]'),n=t.querySelector('[id$="Cancel"]'),o=i=>{t.classList.remove("visible"),a&&(a.onclick=null),n&&(n.onclick=null),document.removeEventListener("keydown",l),!i&&r&&r(),s(i)},l=i=>{i.key==="Escape"&&o(!1)};a&&(a.onclick=()=>o(!0)),n&&(n.onclick=()=>o(!1)),document.addEventListener("keydown",l)})}async function Y(e,r){const s=document.querySelector(c.modal);if(!s)return!0;const t=s.querySelector(c.modalTitle),a=s.querySelector(c.modalBody);return t&&(t.textContent=e),a&&(a.textContent=r),await K(c.modal)}async function he(){const e=document.querySelector(c.exportOptionsModal);if(!e||!await K(c.exportOptionsModal))return null;const s=e.querySelector('input[name="vat_option"]:checked'),t=e.querySelector("#exportMethod"),a=e.querySelector("#pageBreakBuffer");return{vatOption:s?s.value:"include",exportMethod:t?t.value:"direct",pageBreakBuffer:a?parseInt(a.value,10):3}}function W(e,r){e&&(e.classList.add("item-removing"),e.addEventListener("animationend",()=>{e.remove(),r&&b(r),z(),X(),R(),M()},{once:!0}))}function X(){document.querySelectorAll(c.room).forEach(e=>{const r=e.querySelectorAll(".item-card"),s=r.length;r.forEach((t,a)=>{const n=t.querySelector("[data-item-title]");n&&(n.textContent=`${a+1}/${s}`)})})}function te(){const e=document.querySelector(c.orderForm),r=document.querySelector(c.lockBtn);if(!e||!r)return;const s=e.querySelectorAll("input, select, textarea, button");e.classList.toggle("is-locked",B),r.classList.toggle("is-locked",B);const t=r.querySelector("i");t&&(t.className=B?"ph-bold ph-lock-key":"ph-bold ph-lock-key-open"),s.forEach(a=>{a.closest(".summary-footer")||a.closest(".main-header")||a.closest(".modal-wrapper")||(a.disabled=B)}),b(B?"ฟอร์มถูกล็อค":"ปลดล็อคฟอร์มแล้ว",B?"warning":"success")}function O(){const e=document.querySelectorAll(c.allDetailsCards);if(e.length===0)return;const r=[...e].every(t=>t.open),s=document.querySelector(c.toggleAllRoomsBtn);if(s){const t=s.querySelector("i"),a=s.querySelector("span");t&&(t.className=r?"ph ph-rows-slash":"ph ph-rows"),a&&(a.textContent=r?"ย่อทั้งหมด":"ขยายทั้งหมด")}}function _e(){const e=document.querySelectorAll(c.allDetailsCards),r=[...e].every(s=>s.open);e.forEach(s=>{s.open=!r}),setTimeout(O,50)}function z(){const e=document.querySelector(c.quickNavRoomList);if(!e)return;e.innerHTML="",document.querySelectorAll(c.room).forEach(s=>{const t=s.querySelector(c.roomNameInput),a=t?t.value:"ห้อง",n=document.createElement("a");n.href=`#${s.id}`,n.dataset.jumpTo=s.id,n.innerHTML=`<i class="ph ph-arrow-bend-left-up"></i> ${a||"ห้อง (ไม่มีชื่อ)"}`,e.appendChild(n)})}function j(e,r,s=!0){const t=document.querySelector(e);if(!t||!r)return null;const a=t.content.cloneNode(!0),n=a.firstElementChild;return r.appendChild(a),s&&n&&(n.classList.add("item-created"),n.scrollIntoView({behavior:"smooth",block:"center"})),X(),R(),M(),n}function G(){const e=document.querySelector(c.roomsContainer);if(!e)return;U++;const r=j("#roomTpl",e,!0);if(r){r.id=`room-${Date.now()}`;const s=r.querySelector(c.roomNameInput);s&&(s.value=`ห้อง ${U}`),r.open=!0}z(),O()}function ye(e){if(!e)return;const r=e.querySelector(c.setsContainer);r&&j("#setTpl",r)}function ve(e){if(!e)return;const r=e.querySelector(c.decorationsContainer);r&&j("#decoTpl",r)}function Se(e){if(!e)return;const r=e.querySelector(c.wallpapersContainer);if(r){const s=j("#wallpaperTpl",r);s&&re(s.querySelector('[data-act="add-wall"]'))}}function re(e){var s;const r=(s=e==null?void 0:e.closest(".walls-section"))==null?void 0:s.querySelector(c.wallsContainer);r&&(j("#wallTpl",r,!1),H(e))}function oe(e){var t,a,n;if(!e)return;const r=(t=e.querySelector('select[name="fabric_variant"]'))==null?void 0:t.value,s=r&&r.includes("โปร่ง");(a=e.querySelector(c.sheerWrap))==null||a.classList.toggle("hidden",!s),(n=e.querySelector(c.sheerCodeWrap))==null||n.classList.toggle("hidden",!s)}const ge=ce(e=>{H(e),M()});function we(e){if(B){b("ฟอร์มถูกล็อค ไม่สามารถแก้ไขได้","warning"),e.preventDefault();return}ge(e.target)}function qe(e){if(B)return;const r=e.target;if(r.matches('select[name="fabric_variant"]')&&oe(r.closest(c.set)),r.matches('select[name="deco_type"]')){const s=r.closest(c.decoItem),t=s==null?void 0:s.querySelector(".deco-type-display");t&&(t.textContent=r.value||"ตกแต่ง")}r.matches(c.roomNameInput)&&z(),H(r),M()}function be(e){const r=e.target,s=r.matches('[name="deco_price_sqyd"], [name="wallpaper_price_roll"], [name="wallpaper_install_cost"]'),t=r.matches('input[name="width_m"], input[name="height_m"], input[name="deco_width_m"], input[name="deco_height_m"], input[name="wallpaper_height_m"], input[name="wall_width_m"]');if(s){const a=y(r.value);a>0?r.value=T(a):r.value=""}else if(t){const a=y(r.value);a>0?r.value=a.toFixed(2):r.value=""}}function H(e){var a,n,o,l,i,u,d,f,h,_,g,C;if(!e)return;const r=e.closest(c.set);if(r){const w=r.querySelector("[data-set-summary]");if(w){const m={width_m:(a=r.querySelector('input[name="width_m"]'))==null?void 0:a.value,height_m:(n=r.querySelector('input[name="height_m"]'))==null?void 0:n.value,style:(o=r.querySelector('select[name="set_style"]'))==null?void 0:o.value,fabric_variant:(l=r.querySelector('select[name="fabric_variant"]'))==null?void 0:l.value,price_per_m_raw:(i=r.querySelector('select[name="set_price_per_m"]'))==null?void 0:i.value,sheer_price_per_m:(u=r.querySelector('select[name="sheer_price_per_m"]'))==null?void 0:u.value},v=q.calculateSetPrice(m);let p=`ราคา: <b>${T(v.total)}</b> บ.`;v.opaque>0&&v.sheer>0&&(p+=` <small>(ทึบ: ${T(v.opaque)}, โปร่ง: ${T(v.sheer)})</small>`),w.innerHTML=p}}const s=e.closest(c.decoItem);if(s){const w=s.querySelector("[data-deco-summary]");if(w){const m={width_m:(d=s.querySelector('input[name="deco_width_m"]'))==null?void 0:d.value,height_m:(f=s.querySelector('input[name="deco_height_m"]'))==null?void 0:f.value,price_sqyd:(h=s.querySelector('input[name="deco_price_sqyd"]'))==null?void 0:h.value},v=q.calculateDecoPrice(m);w.innerHTML=`ราคา: <b>${T(v.total)}</b> บ. &bull; พื้นที่: ${P(v.sqyd,2)} ตร.หลา`}}const t=e.closest(c.wallpaperItem);if(t){const w=t.querySelector("[data-wallpaper-summary]");if(w){const m={height_m:(_=t.querySelector('input[name="wallpaper_height_m"]'))==null?void 0:_.value,price_per_roll:(g=t.querySelector('input[name="wallpaper_price_roll"]'))==null?void 0:g.value,install_cost_per_roll:(C=t.querySelector('input[name="wallpaper_install_cost"]'))==null?void 0:C.value,widths:Array.from(t.querySelectorAll('input[name="wall_width_m"]')).map(I=>I.value)},v=q.calculateWallpaperPrice(m);let p=`รวม: <b>${T(v.total)}</b> บ. `;(v.material>0||v.install>0)&&(p+=`<small>(วอลล์: ${T(v.material)}, ค่าช่าง: ${T(v.install)})</small>`),p+=` &bull; พื้นที่: ${P(v.sqm,2)} ตร.ม. &bull; ใช้: ${v.rolls} ม้วน`,w.innerHTML=p}}R()}function R(){let e=0,r=0;document.querySelectorAll(c.room).forEach(a=>{let n=0,o=0;const l=a.classList.contains("is-suspended");a.querySelectorAll(c.set).forEach(u=>{var f,h,_,g,C,w;const d=q.calculateSetPrice({is_suspended:l||u.classList.contains("is-suspended"),width_m:(f=u.querySelector('input[name="width_m"]'))==null?void 0:f.value,height_m:(h=u.querySelector('input[name="height_m"]'))==null?void 0:h.value,style:(_=u.querySelector('select[name="set_style"]'))==null?void 0:_.value,fabric_variant:(g=u.querySelector('select[name="fabric_variant"]'))==null?void 0:g.value,price_per_m_raw:(C=u.querySelector('select[name="set_price_per_m"]'))==null?void 0:C.value,sheer_price_per_m:(w=u.querySelector('select[name="sheer_price_per_m"]'))==null?void 0:w.value}).total;n+=d,d>0&&(r++,o++)}),a.querySelectorAll(c.decoItem).forEach(u=>{var f,h,_;const d=q.calculateDecoPrice({is_suspended:l||u.classList.contains("is-suspended"),width_m:(f=u.querySelector('input[name="deco_width_m"]'))==null?void 0:f.value,height_m:(h=u.querySelector('input[name="deco_height_m"]'))==null?void 0:h.value,price_sqyd:(_=u.querySelector('input[name="deco_price_sqyd"]'))==null?void 0:_.value}).total;n+=d,d>0&&(r++,o++)}),a.querySelectorAll(c.wallpaperItem).forEach(u=>{var f,h,_;const d=q.calculateWallpaperPrice({is_suspended:l||u.classList.contains("is-suspended"),height_m:(f=u.querySelector('input[name="wallpaper_height_m"]'))==null?void 0:f.value,price_per_roll:(h=u.querySelector('input[name="wallpaper_price_roll"]'))==null?void 0:h.value,install_cost_per_roll:(_=u.querySelector('input[name="wallpaper_install_cost"]'))==null?void 0:_.value,widths:Array.from(u.querySelectorAll('input[name="wall_width_m"]')).map(g=>g.value)}).total;n+=d,d>0&&(r++,o++)});const i=a.querySelector("[data-room-brief]");i&&(l?i.textContent="(ระงับชั่วคราว)":o>0?i.innerHTML=`<span>${o}</span> &bull; ${T(n)} บาท`:i.textContent=""),e+=l?0:n});const s=document.querySelector(c.grandTotal),t=document.querySelector(c.setCount);s&&(s.textContent=T(e)),t&&(t.textContent=r)}function ee(e){if(!e||!e.rooms)return;const r=document.querySelector(c.roomsContainer);if(!r)return;r.innerHTML="",U=0;const s=document.querySelector("#customer_name"),t=document.querySelector("#customer_phone"),a=document.querySelector("#customer_address");s&&(s.value=e.customer_name||""),t&&(t.value=e.customer_phone||""),a&&(a.value=e.customer_address||""),e.rooms.forEach(n=>{U++;const o=document.querySelector("#roomTpl");if(!o)return;const l=o.content.cloneNode(!0),i=l.querySelector(c.room);if(!i)return;i.id=n.id||`room-${Date.now()}`,n.is_suspended&&i.classList.add("is-suspended");const u=i.querySelector(c.roomNameInput);u&&(u.value=n.room_name||`ห้อง ${U}`);const d=i.querySelector(c.setsContainer),f=i.querySelector(c.decorationsContainer),h=i.querySelector(c.wallpapersContainer),_=document.querySelector("#setTpl"),g=document.querySelector("#decoTpl"),C=document.querySelector("#wallpaperTpl"),w=document.querySelector("#wallTpl");d&&_&&n.sets&&n.sets.forEach(m=>{const v=_.content.cloneNode(!0),p=v.querySelector(c.set);m.is_suspended&&p.classList.add("is-suspended"),p.querySelector('input[name="width_m"]').value=m.width_m||"",p.querySelector('input[name="height_m"]').value=m.height_m||"",p.querySelector('select[name="set_style"]').value=m.style||"ลอน",p.querySelector('select[name="fabric_variant"]').value=m.fabric_variant||"ทึบ",p.querySelector('select[name="set_price_per_m"]').value=m.price_per_m_raw||"",p.querySelector('select[name="sheer_price_per_m"]').value=m.sheer_price_per_m||"",p.querySelector('select[name="opening_style"]').value=m.opening_style||"แยกกลาง",p.querySelector('select[name="track_color"]').value=m.track_color||"ขาว",p.querySelector('input[name="fabric_code"]').value=m.fabric_code||"",p.querySelector('input[name="sheer_fabric_code"]').value=m.sheer_fabric_code||"",p.querySelector('input[name="notes"]').value=m.notes||"",oe(p),d.appendChild(v)}),f&&g&&n.decorations&&n.decorations.forEach(m=>{const v=g.content.cloneNode(!0),p=v.querySelector(c.decoItem);m.is_suspended&&p.classList.add("is-suspended");const I=p.querySelector('select[name="deco_type"]');I.value=m.type||"",p.querySelector(".deco-type-display").textContent=m.type||"ตกแต่ง",p.querySelector('input[name="deco_width_m"]').value=m.width_m||"",p.querySelector('input[name="deco_height_m"]').value=m.height_m||"",p.querySelector('input[name="deco_price_sqyd"]').value=T(m.price_sqyd)||"",p.querySelector('input[name="deco_code"]').value=m.deco_code||"",p.querySelector('input[name="deco_notes"]').value=m.notes||"",f.appendChild(v)}),h&&C&&n.wallpapers&&n.wallpapers.forEach(m=>{const v=C.content.cloneNode(!0),p=v.querySelector(c.wallpaperItem);m.is_suspended&&p.classList.add("is-suspended"),p.querySelector('input[name="wallpaper_height_m"]').value=m.height_m||"",p.querySelector('input[name="wallpaper_code"]').value=m.wallpaper_code||"",p.querySelector('input[name="wallpaper_price_roll"]').value=T(m.price_per_roll)||"",p.querySelector('input[name="wallpaper_install_cost"]').value=T(m.install_cost_per_roll)||"300",p.querySelector('input[name="wallpaper_notes"]').value=m.notes||"";const I=p.querySelector(c.wallsContainer);I&&w&&m.widths&&m.widths.forEach($=>{const L=w.content.cloneNode(!0);L.querySelector('input[name="wall_width_m"]').value=$||"",I.appendChild(L)}),h.appendChild(v)}),r.appendChild(l)}),document.querySelectorAll(".item-card").forEach(n=>{H(n)}),X(),R(),z(),O(),b("นำเข้าข้อมูลสำเร็จ","success")}function $e(e,r){const s=document.querySelector(c.printableContent);!s||!e||!e.html||(s.innerHTML=e.html,setTimeout(()=>{if(r==="direct"){const t=document.getElementById("quotation-template");t&&html2pdf().from(t).set({margin:[15,12,10,12],filename:`${e.fileName}.pdf`,pagebreak:{mode:["css","legacy"]},html2canvas:{scale:2,useCORS:!0},jsPDF:{unit:"mm",format:"a4",orientation:"portrait"}}).save().then(()=>{s.innerHTML=""})}else r==="print"&&(window.print(),s.innerHTML="")},se))}function Le(e){if(!e||!e.html)return;const r=new Blob([e.html],{type:"text/html;charset=utf-8"}),s=URL.createObjectURL(r),t=document.createElement("a");t.href=s,t.download=`${e.fileName}.html`,t.click(),URL.revokeObjectURL(s),b("Export ไฟล์ HTML สำเร็จ","success")}const Te=e=>{const r=e.target.closest("[data-act]");if(!r||B&&!r.closest(".unlockable"))return;const s=r.dataset.act,t=r.closest(c.room),a=(o,{confirm:l=!1,isRemoval:i=!1,title:u="",body:d="",actionFn:f,toastMsg:h=""})=>{if(!o)return;const _=()=>{var g;f(o,h),i||(h&&b(h),H(o),M()),(g=r.closest(".room-options-menu"))==null||g.classList.remove("show"),o.classList.remove("overflow-visible")};l?Y(u,d).then(g=>g&&_()):_()},n={"add-room":G,"add-set":()=>ye(t),"add-deco":()=>ve(t),"add-wallpaper":()=>Se(t),"add-wall":()=>re(r),"toggle-room-menu":()=>{e.preventDefault();const o=r.nextElementSibling;if(!o||!t)return;const l=!o.classList.contains("show");document.querySelectorAll(".room-options-menu.show").forEach(i=>i.classList.remove("show")),document.querySelectorAll(".card.overflow-visible").forEach(i=>i.classList.remove("overflow-visible")),l&&(o.classList.add("show"),t.classList.add("overflow-visible"))},"toggle-suspend-room":()=>{var o;e.preventDefault(),t==null||t.classList.toggle("is-suspended"),R(),M(),(o=r.closest(".room-options-menu"))==null||o.classList.remove("show"),t==null||t.classList.remove("overflow-visible")},"toggle-suspend":()=>{var o;e.preventDefault(),(o=r.closest(".item-card"))==null||o.classList.toggle("is-suspended"),H(r),M()},"clear-room":()=>a(t,{confirm:!0,title:"ล้างข้อมูลในห้อง",body:"ยืนยันลบทุกรายการในห้องนี้?",actionFn:o=>{o.querySelector(c.setsContainer).innerHTML="",o.querySelector(c.decorationsContainer).innerHTML="",o.querySelector(c.wallpapersContainer).innerHTML=""},toastMsg:"ล้างข้อมูลในห้องแล้ว"}),"del-room":()=>a(t,{confirm:!0,isRemoval:!0,title:"ลบห้อง",body:"ยืนยันการลบห้องนี้?",actionFn:W,toastMsg:"ลบห้องแล้ว"}),"del-set":()=>a(r.closest(c.set),{confirm:!0,isRemoval:!0,title:"ลบรายการ",body:"ยืนยันการลบรายการผ้าม่าน?",actionFn:W,toastMsg:"ลบรายการผ้าม่านแล้ว"}),"del-deco":()=>a(r.closest(c.decoItem),{confirm:!0,isRemoval:!0,title:"ลบรายการ",body:"ยืนยันการลบรายการตกแต่ง?",actionFn:W,toastMsg:"ลบรายการตกแต่งแล้ว"}),"del-wallpaper":()=>a(r.closest(c.wallpaperItem),{confirm:!0,isRemoval:!0,title:"ลบรายการ",body:"ยืนยันการลบรายการวอลเปเปอร์?",actionFn:W,toastMsg:"ลบรายการวอลเปเปอร์แล้ว"}),"del-wall":()=>a(r.closest(".wall-input-row"),{confirm:!0,isRemoval:!0,title:"ลบผนัง",body:"ยืนยันการลบผนังนี้?",actionFn:W,toastMsg:"ลบผนังแล้ว"})};n[s]&&(n[s](),X())};function Ce(){B=!B,te()}function xe(){const e=document.querySelector(c.setTpl);if(!e)return;const r=e.content.querySelector('select[name="set_price_per_m"]'),s=e.content.querySelector('select[name="sheer_price_per_m"]'),t=a=>{let n='<option value="" hidden>เลือกราคา</option>';return a.forEach(o=>{n+=`<option value="${o}">${o.toLocaleString("th-TH")}</option>`}),n};r&&(r.innerHTML=t(J.fabric)),s&&(s.innerHTML=t(J.sheer))}function ke(){xe();const e=document.querySelector(c.orderForm),r=document.querySelector(c.fileImporter),s=document.querySelector(c.menuDropdown),t=document.querySelector(c.quickNavDropdown);e.addEventListener("input",we),e.addEventListener("change",qe),e.addEventListener("click",Te),e.addEventListener("blur",be,!0),document.body.addEventListener("click",n=>{n.target.closest("summary")&&setTimeout(O,50)}),document.querySelector(c.lockBtn).addEventListener("click",Ce),document.querySelector(c.toggleAllRoomsBtn).addEventListener("click",_e),document.querySelector(c.quickNavBtn).addEventListener("click",n=>{n.stopPropagation(),s.classList.remove("show"),t.classList.toggle("show")}),document.querySelector(c.quickNavRoomList).addEventListener("click",n=>{const o=n.target.closest("a[data-jump-to]");if(o){n.preventDefault();const l=o.dataset.jumpTo,i=document.getElementById(l);i&&(document.body.classList.add("disable-animations"),i.open=!0,i.scrollIntoView({behavior:"auto",block:"start"}),i.classList.add("scrolling-jump"),setTimeout(()=>{i.classList.remove("scrolling-jump"),document.body.classList.remove("disable-animations"),O()},1e3)),t.classList.remove("show")}});const a=document.querySelector("#addRoomQuickNavBtn");if(a){const n=ie(G,700);a.addEventListener("click",o=>{o.stopPropagation(),n(),t.classList.remove("show")})}document.querySelector(c.menuBtn).addEventListener("click",n=>{n.stopPropagation(),t.classList.remove("show"),s.classList.toggle("show")}),document.querySelector("#overviewBtn").addEventListener("click",async n=>{n.preventDefault(),s.classList.remove("show");const o=D(),l=pe(o),i=document.querySelector("#overviewModalBody");i&&(i.innerHTML=l,K("#overviewModal",()=>{}))}),document.querySelector(c.exportPdfBtn).addEventListener("click",async n=>{n.preventDefault(),s.classList.remove("show");const o=await he();if(!o)return;const l=D(),i=o.vatOption==="include"?k.baseVatRate:0,u=fe(l,{vatRate:i,pageBreakBuffer:o.pageBreakBuffer});if(!u){b("ไม่มีรายการที่มีราคาสำหรับสร้างเอกสาร","warning");return}o.exportMethod==="html"?Le(u):$e(u,o.exportMethod)}),document.querySelector(c.importBtn).addEventListener("click",n=>{n.preventDefault(),s.classList.remove("show"),r.click()}),r.addEventListener("change",n=>{var i;const o=(i=n.target.files)==null?void 0:i[0];if(!o)return;const l=new FileReader;l.onload=u=>{try{const d=JSON.parse(u.target.result);ee(d)}catch{b("ไฟล์ JSON ไม่ถูกต้อง","error")}},l.readAsText(o),n.target.value=null}),document.querySelector(c.exportBtn).addEventListener("click",n=>{n.preventDefault(),s.classList.remove("show");try{const o=D(),l=JSON.stringify(o,null,4),i=new Blob([l],{type:"application/json"}),u=URL.createObjectURL(i),d=document.createElement("a"),f=new Date,h=`${f.getFullYear()}${(f.getMonth()+1).toString().padStart(2,"0")}${f.getDate().toString().padStart(2,"0")}`,_=(o.customer_name||"data").trim().replace(/\s+/g,"-");d.href=u,d.download=`MTR-${_}-${h}.json`,d.click(),URL.revokeObjectURL(u),b("Export ข้อมูลสำเร็จ","success")}catch{b("Export ข้อมูลล้มเหลว","error")}}),document.querySelector(c.submitBtn).addEventListener("click",async n=>{if(n.preventDefault(),s.classList.remove("show"),await Y("ส่งข้อมูล","ยืนยันการส่งข้อมูลการประเมินราคา?")){const o=D();if(!o.customer_name&&!o.customer_phone){b("กรุณาระบุชื่อหรือเบอร์โทรลูกค้า","warning");return}b("กำลังส่งข้อมูล...","default");try{const l=await fetch(ae,{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});l.ok?b("ส่งข้อมูลสำเร็จ!","success"):b(`ส่งข้อมูลล้มเหลว: ${l.status}`,"error")}catch{b("เกิดข้อผิดพลาดในการเชื่อมต่อ","error")}}}),document.querySelector(c.copyTextBtn).addEventListener("click",async n=>{n.preventDefault(),s.classList.remove("show");const o=document.querySelector(c.copyOptionsModal);if(o.querySelector('input[name="copy_option"][value="customer"]').checked=!0,await K(c.copyOptionsModal)){const l=o.querySelector('input[name="copy_option"]:checked').value,i=me(D(),l);try{await navigator.clipboard.writeText(i),b("คัดลอกสรุปสำเร็จ!","success")}catch{b("คัดลอกล้มเหลว","error")}}}),document.querySelector(c.clearItemsBtn).addEventListener("click",async n=>{n.preventDefault(),s.classList.remove("show"),await Y("ล้างทุกรายการ","คุณแน่ใจหรือไม่ว่าต้องการลบรายการสินค้าทั้งหมด (ข้อมูลลูกค้าและห้องจะยังคงอยู่)?")&&(document.querySelectorAll(c.room).forEach(o=>{o.querySelector(c.setsContainer).innerHTML="",o.querySelector(c.decorationsContainer).innerHTML="",o.querySelector(c.wallpapersContainer).innerHTML=""}),R(),M(),b("ล้างทุกรายการแล้ว","success"))}),document.querySelector(c.clearAllBtn).addEventListener("click",async n=>{n.preventDefault(),s.classList.remove("show"),await Y("ลบข้อมูลทั้งหมด","คุณแน่ใจหรือไม่ว่าต้องการลบข้อมูลทั้งหมดในฟอร์มนี้? การกระทำนี้ไม่สามารถย้อนกลับได้")&&(localStorage.removeItem(Q),window.location.reload())}),window.addEventListener("click",n=>{n.target.closest(".menu-container")||(s.classList.remove("show"),t.classList.remove("show")),n.target.closest(".room-options-container")||(document.querySelectorAll(".room-options-menu.show").forEach(o=>o.classList.remove("show")),document.querySelectorAll(".card.overflow-visible").forEach(o=>o.classList.remove("overflow-visible")))});try{const n=localStorage.getItem(Q);if(n)ee(JSON.parse(n));else{G();const o=document.querySelector("#customerDetailsCard");o&&(o.open=!0)}}catch{localStorage.removeItem(Q),G()}R(),te(),O()}document.addEventListener("DOMContentLoaded",ke);
