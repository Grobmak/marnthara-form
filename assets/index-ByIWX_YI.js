(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))t(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&t(a)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function t(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();const ct="vite-refactor/6.1.0",ut="https://your-make-webhook-url.com/your-unique-path",he="marnthara.input.v6.1",dt=500,O={name:"‡∏°‡πà‡∏≤‡∏ô‡∏ò‡∏≤‡∏£‡∏≤ ‡∏ú‡πâ‡∏≤‡∏°‡πà‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏Ç‡∏≠‡∏á‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á",address:"65/8 ‡∏´‡∏°‡∏π‡πà 2 ‡∏ï.‡∏ó‡πà‡∏≤‡∏®‡∏≤‡∏•‡∏≤ ‡∏≠.‡πÄ‡∏°‡∏∑‡∏≠‡∏á ‡∏à.‡∏•‡∏û‡∏ö‡∏∏‡∏£‡∏µ 15000",phone:"092-985-9395, 082-552-5595",taxId:"1600668000020",logoUrl:"./assets/logo.png",baseVatRate:.07,pdf:{paymentTerms:"‡∏ä‡∏≥‡∏£‡∏∞‡∏°‡∏±‡∏î‡∏à‡∏≥ 50%",priceValidity:"30 ‡∏ß‡∏±‡∏ô",notes:["‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ô‡∏µ‡πâ‡∏£‡∏ß‡∏°‡∏Ñ‡πà‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏•‡πâ‡∏ß","‡∏ä‡∏≥‡∏£‡∏∞‡∏°‡∏±‡∏î‡∏à‡∏≥ 50% ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ú‡∏•‡∏¥‡∏ï‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤","‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏≤‡∏¢‡∏∏ 30 ‡∏ß‡∏±‡∏ô ‡∏ô‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤"]}},pt=1.19599,Ae={ROLL_WIDTH_M:.53,ROLL_LENGTH_M:10,STRIPS_PER_ROLL_UNDER_2_5M:3},ve={fabric:[1e3,1100,1200,1300,1400,1500,1600,1700,1800,1900,2e3,2100,2200,2300,2400,2500,2600,2700,2800,2900,3e3],sheer:[1e3,1100,1200,1300,1400,1500],louis:[2200,2300,2400,2500,2600,2700,2800,2900,3e3,3100,3200,3300,3400,3500],style_surcharge:{‡∏•‡∏≠‡∏ô:200,‡∏ï‡∏≤‡πÑ‡∏Å‡πà:0,‡∏à‡∏µ‡∏ö:0,‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö:0,‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå:0},height:[{threshold:3.2,add_per_m:300},{threshold:2.8,add_per_m:200},{threshold:2.5,add_per_m:100}]},H={set:{templateId:"#setTpl",name:"‡∏ú‡πâ‡∏≤‡∏°‡πà‡∏≤‡∏ô"},wallpaper:{templateId:"#wallpaperTpl",name:"‡∏ß‡∏≠‡∏•‡∏•‡πå‡πÄ‡∏õ‡πÄ‡∏õ‡∏≠‡∏£‡πå"},wooden_blind:{templateId:"#areaBasedTpl",name:"‡∏°‡∏π‡πà‡∏•‡∏µ‡πà‡πÑ‡∏°‡πâ"},roller_blind:{templateId:"#areaBasedTpl",name:"‡∏°‡πà‡∏≤‡∏ô‡∏°‡πâ‡∏ß‡∏ô"},vertical_blind:{templateId:"#areaBasedTpl",name:"‡∏°‡πà‡∏≤‡∏ô‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏á"},partition:{templateId:"#areaBasedTpl",name:"‡∏â‡∏≤‡∏Å‡∏Å‡∏±‡πâ‡∏ô‡∏´‡πâ‡∏≠‡∏á"},pleated_screen:{templateId:"#areaBasedTpl",name:"‡∏°‡∏∏‡πâ‡∏á‡∏à‡∏µ‡∏ö"},aluminum_blind:{templateId:"#areaBasedTpl",name:"‡∏°‡∏π‡πà‡∏•‡∏µ‡πà‡∏≠‡∏•‡∏π‡∏°‡∏¥‡πÄ‡∏ô‡∏µ‡∏¢‡∏°"}},f={orderForm:"#orderForm",roomsContainer:"#rooms",toastContainer:"#toast-container",printableContent:"#printable-content",filterStatusBar:"#filterStatusBar",menuBtn:"#menuBtn",menuDropdown:"#menuDropdown",undoBtn:"#undoBtn",themeToggleBtn:"#themeToggleBtn",overviewBtn:"#overviewBtn",copyTextBtn:"#copyTextBtn",visualReportsBtn:"#visualReportsBtn",exportPdfBtn:"#exportPdfBtn",submitBtn:"#submitBtn",importBtn:"#importBtn",exportBtn:"#exportBtn",importFavsBtn:"#importFavsBtn",exportFavsBtn:"#exportFavsBtn",clearItemsBtn:"#clearItemsBtn",clearAllBtn:"#clearAllBtn",lockBtn:"#lockBtn",quickNavBtn:"#quickNavBtn",quickNavDropdown:"#quickNavDropdown",quickNavRoomList:"#quickNavRoomList",quickNavBtnText:"#quickNavBtnText",toggleAllRoomsBtn:"#toggleAllRoomsBtn",suspendedItemsBtn:"#suspendedItemsBtn",suspendedCountBadge:"#suspendedCountBadge",originalTotal:"#originalTotal",grandTotal:"#grandTotal",fileImporter:"#fileImporter",favImporter:"#favImporter",customerCard:"#customerDetailsCard",customerNameInput:"#customer_name",customerPhoneInput:"#customer_phone",customerAddressInput:"#customer_address",room:".room-card",roomTpl:"#roomTpl",roomNameInput:'input[name="room_name"]',roomNameDisplay:"[data-room-name-display]",roomBrief:"[data-room-brief]",allItemsContainer:"[data-all-items]",itemCard:".item-card",itemDetailsMore:".item-details-more",itemGrid:".item-grid",itemTitle:"[data-item-title]",toggleDetailsBtn:'[data-act="toggle-more-details"]',setTpl:"#setTpl",setWidthInput:'input[name="width_m"]',setHeightInput:'input[name="height_m"]',setStyleSelect:'select[name="set_style"]',setFabricVariantSelect:'select[name="fabric_variant"]',setPricePerMSelect:'select[name="set_price_per_m"]',setSheerPricePerMSelect:'select[name="sheer_price_per_m"]',setLouisPricePerMSelect:'select[name="louis_price_per_m"]',setFabricCodeInput:'input[name="fabric_code"]',setSheerCodeInput:'input[name="sheer_fabric_code"]',setOpeningStyleSelect:'select[name="opening_style"]',setAdjustmentSideSelect:'select[name="adjustment_side"]',setTrackColorInput:'input[name="track_color"]',setBracketColorInput:'input[name="bracket_color"]',setFinialColorInput:'input[name="finial_color"]',setGrommetColorInput:'input[name="grommet_color"]',setLouisValanceInput:'input[name="louis_valance"]',setLouisTasselsInput:'input[name="louis_tassels"]',setNotesInput:'input[name="notes"]',wallpaperTpl:"#wallpaperTpl",wallTpl:"#wallTpl",wallHeightInput:'[name="wallpaper_height_m"]',wallCodeInput:'[name="wallpaper_code"]',wallPriceRollInput:'[name="wallpaper_price_roll"]',wallInstallCostInput:'[name="wallpaper_install_cost"]',wallNotesInput:'[name="wallpaper_notes"]',wallWidthInput:'[name="wall_width_m"]',areaBasedTpl:"#areaBasedTpl",areaBasedItem:".area-based-item",areaWidthInput:'[name="area_width_m"]',areaHeightInput:'[name="area_height_m"]',areaPriceSqydInput:'[name="area_price_sqyd"]',areaCodeInput:'[name="area_code"]',areaNotesInput:'[name="area_notes"]',modal:"#confirmationModal",modalTitle:"#modalTitle",modalBody:"#modalBody",discountModal:"#discountModal",discountSubtotal:"#discountSubtotal",discountPercent:"#discountPercent",discountAmount:"#discountAmount",discountFinalTotal:"#discountFinalTotal",discountTypeInput:"#discount_type",discountValueInput:"#discount_value",copyOptionsModal:"#copyOptionsModal",visualReportsModal:"#visualReportsModal",lookbookModal:"#lookbookModal",lookbookModalBody:"#lookbookModalBody",exportOptionsModal:"#exportOptionsModal",pdfOptionsModal:"#pdfOptionsModal",exportPdfWithDetailsBtn:"#exportPdfWithDetailsBtn",exportPdfWithoutDetailsBtn:"#exportPdfWithoutDetailsBtn",itemTypeModal:"#itemTypeModal",itemTypeModalTitle:"#itemTypeModalTitle",hardwareModal:"#hardwareModal",modalTrackColor:'[name="modal_track_color"]',modalBracketColor:'[name="modal_bracket_color"]',modalFinialColor:'[name="modal_finial_color"]',modalGrommetColor:'[name="modal_grommet_color"]',modalLouisValance:'[name="modal_louis_valance"]',modalLouisTassels:'[name="modal_louis_tassels"]',trackColorGroup:"#trackColorGroup",bracketColorGroup:"#bracketColorGroup",finialColorGroup:"#finialColorGroup",grommetColorGroup:"#grommetColorGroup",louisValanceGroup:"#louisValanceGroup",louisTasselGroup:"#louisTasselGroup",hardwareApplyToRoomBtn:"#hardwareApplyToRoom",favoritesConflictModal:"#favoritesConflictModal",favoritesModal:"#favoritesModal",favoritesModalTitle:"#favoritesModalTitle",favoritesModalBody:"#favoritesModalBody",favSearchInput:"#favSearchInput",favoritesModalManageBtn:"#favoritesModalManageBtn",favSelectorItemTpl:"#favSelectorItemTpl",favInput:"input[data-favorite-type]",favManagerModal:"#favManagerModal",favManagerTitle:"#favManagerTitle",favManagerBody:"#favManagerBody",favManagerItemTpl:"#favManagerItemTpl",favManagerEditBtn:'#favManagerModal [data-act="edit-selected-fav"]',favManagerDelBtn:'#favManagerModal [data-act="del-selected-fav"]',favAddModal:"#favAddModal",favAddCodeInput:'[name="fav_code_add"]',favAddPriceInput:'[name="fav_price_add"]',favEditModal:"#favEditModal",favEditCodeInput:'[name="fav_code_edit"]',favEditPriceInput:'[name="fav_price_edit"]',overviewModal:"#overviewModal",overviewModalHeader:"#overviewModalHeader",overviewModalBody:"#overviewModalBody"},h=e=>{typeof e=="string"&&(e=e.replace(/,/g,""));const r=parseFloat(e);return Number.isFinite(r)?r:0},le=e=>{const r=h(e);return r>0?r.toFixed(2):""},z=(e,r=2,n=!1)=>Number.isFinite(e)?e.toLocaleString("en-US",{minimumFractionDigits:n?2:r,maximumFractionDigits:n?2:r}):"0",P=(e,r=0)=>Number.isFinite(e)?e.toLocaleString("th-TH",{minimumFractionDigits:r,maximumFractionDigits:r}):"0",_e=(e,r=150)=>{let n;return(...t)=>{clearTimeout(n),n=setTimeout(()=>e(...t),r)}},mt=(e,r=700)=>{let n=!1;return(...t)=>{if(!n){n=!0;try{return e(...t)}finally{setTimeout(()=>{n=!1},r)}}}},T=e=>typeof e!="string"?"":e.replace(/[&<>"']/g,function(r){switch(r){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";default:return"&#039;"}}),Ke=e=>typeof e!="string"?"":e.replace(/[\\/?%*:|"<>\x00-\x1f]/g,"").trim()||"file";function ft(e){let r=h(e);if(isNaN(r))return"‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á";if(r===0)return"‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ö‡∏≤‡∏ó‡∏ñ‡πâ‡∏ß‡∏ô";const n=["","‡∏´‡∏ô‡∏∂‡πà‡∏á","‡∏™‡∏≠‡∏á","‡∏™‡∏≤‡∏°","‡∏™‡∏µ‡πà","‡∏´‡πâ‡∏≤","‡∏´‡∏Å","‡πÄ‡∏à‡πá‡∏î","‡πÅ‡∏õ‡∏î","‡πÄ‡∏Å‡πâ‡∏≤"],t=["","‡∏™‡∏¥‡∏ö","‡∏£‡πâ‡∏≠‡∏¢","‡∏û‡∏±‡∏ô","‡∏´‡∏°‡∏∑‡πà‡∏ô","‡πÅ‡∏™‡∏ô","‡∏•‡πâ‡∏≤‡∏ô"];let o=Math.floor(r),s=Math.round((r-o)*100);const a=u=>{if(u===0)return"";let c="";const m=String(u);for(let d=0;d<m.length;d++){const p=m[d],_=m.length-d-1;p!=="0"&&(_===1&&p==="1"?c+=t[_]:_===1&&p==="2"?c+="‡∏¢‡∏µ‡πà"+t[_]:_===0&&p==="1"&&m.length>1?c+="‡πÄ‡∏≠‡πá‡∏î":c+=n[parseInt(p)]+t[_])}return c};let l="";if(o>0){const u=Math.floor(o/1e6),c=o%1e6;u>0&&(l+=a(u)+"‡∏•‡πâ‡∏≤‡∏ô"),l+=a(c),l+="‡∏ö‡∏≤‡∏ó"}let i="";return s>0?i=a(s)+"‡∏™‡∏ï‡∏≤‡∏á‡∏Ñ‡πå":o>0&&(l+="‡∏ñ‡πâ‡∏ß‡∏ô"),(l+i).trim()}const We="marnthara.favorites.v4",ye={fabric:[],sheer:[],wallpaper:[],wooden_blind:[],roller_blind:[],vertical_blind:[],partition:[],pleated_screen:[],aluminum_blind:[]};function ne(){try{const e=localStorage.getItem(We);return e?{...ye,...JSON.parse(e)}:ye}catch(e){return console.error("Failed to parse favorites from localStorage",e),ye}}function Te(e){try{localStorage.setItem(We,JSON.stringify(e))}catch(r){console.error("Failed to save favorites to localStorage",r)}}function Ve(e){if(!e||typeof e!="object")return console.error("Invalid favorites data for import."),!1;const r={...ye,...e};return Te(r),!0}function He(e){if(!e||typeof e!="object")return console.error("Invalid favorites data for merge."),0;const r=ne();let n=0;for(const t in e)Object.hasOwnProperty.call(e,t)&&Array.isArray(e[t])&&(r[t]||(r[t]=[]),e[t].forEach(o=>{!r[t].some(a=>a.code===o.code)&&o.code&&(r[t].push(o),n++)}),r[t].sort((o,s)=>o.code.localeCompare(s.code)));return n>0&&Te(r),n}function ht(e,r,n){const t=ne();if(!t[e]){if(!Object.hasOwnProperty.call(ye,e))return console.error(`Attempted to add favorite to an invalid type: ${e}`),!1;t[e]=[]}const o=t[e],s=o.find(a=>a.code===r);return s?s.price=n:o.push({code:r,price:n}),o.sort((a,l)=>a.code.localeCompare(l.code)),Te(t),!0}function Oe(e,r){const n=ne();if(!n[e])return!1;const t=n[e].findIndex(o=>o.code===r);return t>-1?(n[e].splice(t,1),Te(n),!0):!1}function Xe(e,r){if(!e||!r)return;const n=ne(),t=r.trim();return(n[e]||[]).find(s=>s.code===t)}function ze(e,r){return!!Xe(e,r)}function qe(e,r,n){return ze(e,r)?(Oe(e,r),!1):(ht(e,r,n),!0)}function vt(){localStorage.removeItem(We),console.log("All favorites have been cleared.")}function J(){const e=ne(),r={app_version:ct,customer_name:document.querySelector(f.customerNameInput)?.value||"",customer_phone:document.querySelector(f.customerPhoneInput)?.value||"",customer_address:document.querySelector(f.customerAddressInput)?.value||"",customer_card_open:document.querySelector(f.customerCard)?.open,discount:{type:document.querySelector(f.discountTypeInput)?.value||"amount",value:h(document.querySelector(f.discountValueInput)?.value)},rooms:[],favorites:e};return document.querySelectorAll(f.room).forEach(n=>{const t={id:n.id,room_name:n.querySelector(f.roomNameInput)?.value||"",is_suspended:n.classList.contains("is-suspended"),is_open:n.open,items:[]};n.querySelector(f.allItemsContainer)?.childNodes.forEach(o=>{if(o.nodeType!==1||!o.matches(f.itemCard))return;const s=o.dataset.type;if(!s)return;let a={type:s,is_suspended:o.classList.contains("is-suspended")};s==="set"?Object.assign(a,{width_m:h(o.querySelector(f.setWidthInput)?.value),height_m:h(o.querySelector(f.setHeightInput)?.value),style:o.querySelector(f.setStyleSelect)?.value||"",fabric_variant:o.querySelector(f.setFabricVariantSelect)?.value||"",price_per_m_raw:h(o.querySelector(f.setPricePerMSelect)?.value),sheer_price_per_m:h(o.querySelector(f.setSheerPricePerMSelect)?.value),louis_price_per_m:h(o.querySelector('select[name="louis_price_per_m"]')?.value),fabric_code:o.querySelector(f.setFabricCodeInput)?.value||"",sheer_fabric_code:o.querySelector(f.setSheerCodeInput)?.value||"",opening_style:o.querySelector(f.setOpeningStyleSelect)?.value||"",adjustment_side:o.querySelector(f.setAdjustmentSideSelect)?.value||"‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ß‡∏≤",track_color:o.querySelector(f.setTrackColorInput)?.value||"‡∏Ç‡∏≤‡∏ß",bracket_color:o.querySelector(f.setBracketColorInput)?.value||"‡∏Ç‡∏≤‡∏ß",finial_color:o.querySelector(f.setFinialColorInput)?.value||"‡∏Ç‡∏≤‡∏ß",grommet_color:o.querySelector(f.setGrommetColorInput)?.value||"‡πÄ‡∏á‡∏¥‡∏ô",louis_valance:o.querySelector('input[name="louis_valance"]')?.value||"‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå",louis_tassels:o.querySelector('input[name="louis_tassels"]')?.value||"‡∏™‡∏µ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏ú‡πâ‡∏≤",notes:o.querySelector(f.setNotesInput)?.value||""}):s==="wallpaper"?Object.assign(a,{height_m:h(o.querySelector(f.wallHeightInput)?.value),wallpaper_code:o.querySelector(f.wallCodeInput)?.value||"",price_per_roll:h(o.querySelector(f.wallPriceRollInput)?.value),install_cost_per_roll:h(o.querySelector(f.wallInstallCostInput)?.value),notes:o.querySelector(f.wallNotesInput)?.value||"",widths:Array.from(o.querySelectorAll(f.wallWidthInput)).map(l=>h(l.value))}):o.matches(f.areaBasedItem)&&(Object.assign(a,{width_m:h(o.querySelector(f.areaWidthInput)?.value),height_m:h(o.querySelector(f.areaHeightInput)?.value),price_sqyd:h(o.querySelector(f.areaPriceSqydInput)?.value),code:o.querySelector(f.areaCodeInput)?.value||"",notes:o.querySelector(f.areaNotesInput)?.value||""}),(s==="partition"||s==="pleated_screen")&&(a.opening_style=o.querySelector('select[name="opening_style"]')?.value||"‡πÅ‡∏¢‡∏Å‡∏Å‡∏•‡∏≤‡∏á"),["wooden_blind","roller_blind","vertical_blind","aluminum_blind"].includes(s)&&(a.adjustment_side=o.querySelector('select[name="adjustment_side"]')?.value||"‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ß‡∏≤")),t.items.push(a)}),r.rooms.push(t)}),r}function K(){try{const e=J();localStorage.setItem(he,JSON.stringify(e))}catch(e){console.error("Failed to save data to localStorage:",e)}}const de=[],yt=10;function ie(e){if(!e){console.warn("Attempted to push invalid state to undo stack.");return}try{const r=JSON.parse(JSON.stringify(e));de.push(r),de.length>yt&&de.shift()}catch(r){console.error("Failed to clone state for undo history:",r)}}function gt(){if(de.length!==0)return de.pop()}function _t(){return de.length>0}const F={stylePlus:e=>ve.style_surcharge[e]??0,heightPlus:e=>{const r=[...ve.height].sort((n,t)=>t.threshold-n.threshold);for(const n of r)if(e>n.threshold)return n.add_per_m;return 0},fabricYardage:(e,r)=>{const n=h(r);if(n<=0||!e)return 0;if(e==="‡∏ï‡∏≤‡πÑ‡∏Å‡πà"||e==="‡∏à‡∏µ‡∏ö")return(n*2+.6)/.9;if(e==="‡∏•‡∏≠‡∏ô")return(n*2.6+.6)/.9;if(e==="‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö")return(n+.3)/.9;if(e==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"){const o=Math.max(3,Math.ceil(n/.8))*1.5,s=2.5*2;return(n*2+.6+o+s)/.9}return 0},calculateGrommets:function(e){if(!e||e.style!=="‡∏ï‡∏≤‡πÑ‡∏Å‡πà"||h(e.width_m)<=0)return 0;const r=h(e.width_m),n=2,t=.05,o=.16;let s;e.opening_style==="‡πÅ‡∏¢‡∏Å‡∏Å‡∏•‡∏≤‡∏á"?s=r/2:s=r;const a=s*n+2*t;let l=Math.round(a/o);return l%2!==0&&(l+=1),l<4&&(l=4),e.opening_style==="‡πÅ‡∏¢‡∏Å‡∏Å‡∏•‡∏≤‡∏á"?l*2:l},wallpaperRolls:(e,r)=>{const n=h(e),t=h(r);if(n<=0||t<=0)return 0;const o=t>2.5?Math.floor(Ae.ROLL_LENGTH_M/t):Ae.STRIPS_PER_ROLL_UNDER_2_5M;if(o<=0)return 0;const s=Math.ceil(n/Ae.ROLL_WIDTH_M);return Math.ceil(s/o)},calculateSetPrice:function(e){if(!e||e.is_suspended||h(e.width_m)<=0)return{total:0,opaque:0,sheer:0,louis:0};const r=this.stylePlus(e.style),n=this.heightPlus(h(e.height_m)),t=h(e.width_m),o=h(e.price_per_m_raw),s=h(e.sheer_price_per_m),a=h(e.louis_price_per_m);let l=0,i=0,u=0;return e.style==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"?(e.fabric_variant?.includes("‡∏ó‡∏∂‡∏ö")&&o>0&&(l=(o+r+n)*t),e.fabric_variant?.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")&&s>0&&(i=(s+r+n)*t),a>0&&(u=(a+n)*t)):(e.fabric_variant?.includes("‡∏ó‡∏∂‡∏ö")&&o>0&&(l=(o+r+n)*t),e.fabric_variant?.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")&&s>0&&(i=(s+r+n)*t)),{total:Math.round(l+i+u),opaque:Math.round(l),sheer:Math.round(i),louis:Math.round(u)}},calculateAreaBasedPrice:function(e){if(!e||e.is_suspended||h(e.width_m)<=0||h(e.height_m)<=0)return{total:0,sqm:0,sqyd:0};const r=h(e.width_m)*h(e.height_m),n=r*pt,t=n*h(e.price_sqyd);return{total:Math.round(t),sqm:r,sqyd:n}},calculateWallpaperPrice:function(e){if(!e||e.is_suspended)return{total:0,material:0,install:0,rolls:0,sqm:0};const r=e.widths?.reduce((l,i)=>l+h(i),0)||0;if(r<=0)return{total:0,material:0,install:0,rolls:0,sqm:0};const n=h(e.height_m),t=this.wallpaperRolls(r,n),o=t*h(e.price_per_roll),s=e.install_cost_per_roll===""||e.install_cost_per_roll===null||e.install_cost_per_roll===void 0?300:h(e.install_cost_per_roll),a=t*s;return{total:Math.round(o+a),material:Math.round(o),install:Math.round(a),rolls:t,sqm:r*n}}},G=Object.entries(H).reduce((e,[r,n])=>(e[r]=n.name,e),{});G.set_louis="‡∏°‡πà‡∏≤‡∏ô‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå";function se(e){const{width:r=0,height:n=0}=e,t=15,o=100-t*2,s=100-t*2,a=r>0&&n>0?Math.min(o/r,s/n):1,l=r*a,i=n*a,u=(100-l)/2,c=(100-i)/2,m=`
        <line x1="${u}" y1="${c+i+5}" x2="${u+l}" y2="${c+i+5}" class="dimension-line" />
        <line x1="${u}" y1="${c+i+3}" x2="${u}" y2="${c+i+7}" class="dimension-tick" />
        <line x1="${u+l}" y1="${c+i+3}" x2="${u+l}" y2="${c+i+7}" class="dimension-tick" />
        <text x="50" y="${c+i+14}" class="dimension-text">${r.toFixed(2)} ‡∏°.</text>

        <line x1="${u-5}" y1="${c}" x2="${u-5}" y2="${c+i}" class="dimension-line" />
        <line x1="${u-7}" y1="${c}" x2="${u-3}" y2="${c}" class="dimension-tick" />
        <line x1="${u-7}" y1="${c+i}" x2="${u-3}" y2="${c+i}" class="dimension-tick" />
        <text x="${u-9}" y="50" class="dimension-text" transform="rotate(-90, ${u-9}, 50)">${n.toFixed(2)} ‡∏°.</text>
    `;return{x:u,y:c,svgWidth:l,svgHeight:i,lines:m}}function Ze(e,{y:r,svgHeight:n}){if(!e.opening_style||e.opening_style==="‡∏™‡πÑ‡∏•‡∏î‡πå‡πÄ‡∏î‡∏µ‡πà‡∏¢‡∏ß")return"";const t=e.opening_style==="‡πÅ‡∏¢‡∏Å‡∏Å‡∏•‡∏≤‡∏á"?"< >":"‚Üí";return`
        <rect x="40" y="${r+n/2-8}" width="20" height="16" rx="3" class="opening-text-bg" />
        <text x="50" y="${r+n/2+1}" class="opening-text">${t}</text>
    `}function Le(e,{x:r,y:n,svgWidth:t}){if(!e.adjustment_side)return"";const s=e.adjustment_side==="‡∏õ‡∏£‡∏±‡∏ö‡∏ã‡πâ‡∏≤‡∏¢"?r+8:r+t-8;return`
        <g class="adjustment-cord">
            <circle cx="${s}" cy="${n+3}" r="2"/>
            <line x1="${s}" y1="${n+5}" x2="${s}" y2="${n+15}"/>
        </g>
    `}function bt(e){const r=h(e.width_m),n=h(e.height_m);if(r<=0||n<=0)return'<svg viewBox="0 0 100 100"><text x="50" y="50" class="fallback-text">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î</text></svg>';const{x:t,y:o,svgWidth:s,svgHeight:a,lines:l}=se({width:r,height:n});let i="";const u=e.fabric_variant.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á"),c=e.fabric_variant.includes("‡∏ó‡∏∂‡∏ö"),m=(_,x)=>(e.opening_style||"‡πÅ‡∏¢‡∏Å‡∏Å‡∏•‡∏≤‡∏á")==="‡πÅ‡∏¢‡∏Å‡∏Å‡∏•‡∏≤‡∏á"?`
                <rect x="${t}" y="${o+x}" width="${s/2-1}" height="${a}" class="${_}" />
                <rect x="${t+s/2+1}" y="${o+x}" width="${s/2-1}" height="${a}" class="${_}" />
            `:`<rect x="${t}" y="${o+x}" width="${s}" height="${a}" class="${_}" />`;u&&(i+=m("curtain-panel-sheer",0)),c&&(i+=m("curtain-panel-opaque",u?-2:0));let d="";if(e.style==="‡∏ï‡∏≤‡πÑ‡∏Å‡πà"){const _=F.calculateGrommets(e)/((e.opening_style||"‡πÅ‡∏¢‡∏Å‡∏Å‡∏•‡∏≤‡∏á")==="‡πÅ‡∏¢‡∏Å‡∏Å‡∏•‡∏≤‡∏á"?2:1),x=Math.min(Math.floor(_),Math.max(8,Math.floor(s/8)));for(let v=0;v<x;v++){const b=t+s/(x>1?x-1:1)*v;d+=`<circle cx="${b}" cy="${o+2}" r="2" class="style-grommet" />`}}else if(e.style==="‡∏•‡∏≠‡∏ô"){const _=Math.max(4,Math.floor(s/10));let x=`M ${t},${o}`;for(let v=0;v<_;v++)x+=" q 5,-4 10,0";d=`<path d="${x}" class="style-ripplefold-path" />`}else e.style==="‡∏à‡∏µ‡∏ö"&&(d=`<text x="${t+2}" y="${o+5}" class="style-pleat-text">||| ||| ||| ||| |||</text>`);const p=Ze(e,{y:o,svgHeight:a});return`<svg viewBox="0 0 100 100">${i}${d}${p}${l}</svg>`}function St(e){const r=h(e.width_m),n=h(e.height_m);if(r<=0||n<=0)return'<svg viewBox="0 0 100 100"><text x="50" y="50" class="fallback-text">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î</text></svg>';const{x:t,y:o,svgWidth:s,svgHeight:a,lines:l}=se({width:r,height:n});let i="";const u=e.fabric_variant.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á"),c=e.fabric_variant.includes("‡∏ó‡∏∂‡∏ö"),m=(v,b)=>`
        <rect x="${t}" y="${o+b}" width="${s/2-1}" height="${a}" class="${v}" />
        <rect x="${t+s/2+1}" y="${o+b}" width="${s/2-1}" height="${a}" class="${v}" />
    `;u&&(i+=m("curtain-panel-sheer",0)),c&&(i+=m("curtain-panel-opaque",u?-2:0));const d=Math.max(3,Math.floor(s/15)),p=s/d;let _="";for(let v=0;v<d;v++){const b=t+v*p;_+=`<path d="M ${b},${o} Q ${b+p/2},${o+10} ${b+p},${o}" class="louis-swag" />`}_+=`
        <polygon points="${t},${o} ${t+8},${o} ${t},${o+15}" class="louis-tail" />
        <polygon points="${t+s},${o} ${t+s-8},${o} ${t+s},${o+15}" class="louis-tail" />
    `;let x="";if(e.louis_tassels&&e.louis_tassels!=="‡πÑ‡∏°‡πà‡∏°‡∏µ"){x+=`<circle cx="${t+5}" cy="${o+18}" r="2" class="louis-tassel" />`,x+=`<circle cx="${t+s-5}" cy="${o+18}" r="2" class="louis-tassel" />`;for(let v=1;v<d;v++)x+=`<circle cx="${t+v*p}" cy="${o+8}" r="2" class="louis-tassel" />`}return`<svg viewBox="0 0 100 100">${i}${_}${x}${l}</svg>`}function wt(e){const r=h(e.width_m),n=h(e.height_m);if(r<=0||n<=0)return'<svg viewBox="0 0 100 100"><text x="50" y="50" class="fallback-text">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î</text></svg>';const{x:t,y:o,svgWidth:s,svgHeight:a,lines:l}=se({width:r,height:n});let i=`<rect x="${t}" y="${o}" width="${s}" height="${a}" class="blind-frame" />`;const u=5,c=a/u;for(let d=0;d<u;d++)i+=`<rect x="${t+1}" y="${o+d*c}" width="${s-2}" height="${c-1.5}" class="blind-slat" />`;const m=Le(e,{x:t,y:o,svgWidth:s});return`<svg viewBox="0 0 100 100">${i}${l}${m}</svg>`}function Ue(e,r=!1){const n=h(e.width_m),t=h(e.height_m);if(n<=0||t<=0)return'<svg viewBox="0 0 100 100"><text x="50" y="50" class="fallback-text">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î</text></svg>';const{x:o,y:s,svgWidth:a,svgHeight:l,lines:i}=se({width:n,height:t});let u=`<rect x="${o}" y="${s}" width="${a}" height="${l}" class="blind-frame" />`;if(r){const m=Math.max(4,Math.floor(a/8)),d=a/m;for(let p=0;p<m;p++)u+=`<rect x="${o+p*d+1}" y="${s}" width="${d-2}" height="${l}" class="blind-slat" />`}else{const m=Math.max(3,Math.floor(l/6)),d=l/m;for(let p=0;p<m;p++)u+=`<rect x="${o+1}" y="${s+p*d+.5}" width="${a-2}" height="${d-1}" class="blind-slat" />`}const c=Le(e,{x:o,y:s,svgWidth:a});return`<svg viewBox="0 0 100 100">${u}${i}${c}</svg>`}function $t(e){const r=h(e.width_m),n=h(e.height_m);if(r<=0||n<=0)return'<svg viewBox="0 0 100 100"><text x="50" y="50" class="fallback-text">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î</text></svg>';const{x:t,y:o,svgWidth:s,svgHeight:a,lines:l}=se({width:r,height:n});let i=`<rect x="${t}" y="${o}" width="${s}" height="${a}" class="blind-frame" />`;const u=Math.max(3,Math.floor(a/8)),c=a/u;for(let v=0;v<u;v++)i+=`<rect x="${t+1}" y="${o+v*c}" width="${s-2}" height="${c-1.5}" rx="0.5" class="wooden-blind-slat" />`;const m=Math.max(2,s*.05),d=t+s*.25-m/2,p=t+s*.75-m/2,_=`
        <rect x="${d}" y="${o}" width="${m}" height="${a}" class="wooden-blind-strip" />
        <rect x="${p}" y="${o}" width="${m}" height="${a}" class="wooden-blind-strip" />
    `,x=Le(e,{x:t,y:o,svgWidth:s});return`<svg viewBox="0 0 100 100">${i}${_}${l}${x}</svg>`}function qt(e){const r=h(e.width_m),n=h(e.height_m);if(r<=0||n<=0)return'<svg viewBox="0 0 100 100"><text x="50" y="50" class="fallback-text">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î</text></svg>';const{x:t,y:o,svgWidth:s,svgHeight:a,lines:l}=se({width:r,height:n}),i=`
        <rect x="${t}" y="${o}" width="${s}" height="${a}" class="roller-fabric" />
        <rect x="${t-1}" y="${o-4}" width="${s+2}" height="5" rx="2" class="roller-roll" />
        <line x1="${t}" y1="${o+a}" x2="${t+s}" y2="${o+a}" class="roller-bar" />
    `,u=Le(e,{x:t,y:o-2,svgWidth:s});return`<svg viewBox="0 0 100 100">${i}${l}${u}</svg>`}function Ye(e,r=!1){const n=h(e.width_m),t=h(e.height_m);if(n<=0||t<=0)return'<svg viewBox="0 0 100 100"><text x="50" y="50" class="fallback-text">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î</text></svg>';const{x:o,y:s,svgWidth:a,svgHeight:l,lines:i}=se({width:n,height:t});let u="";if(r)u=`
            <defs>
                <pattern id="pleated-mesh" width="6" height="6" patternUnits="userSpaceOnUse">
                    <path d="M -1 1 L 1 -1 M 0 6 L 6 0" class="pleated-screen-mesh" />
                </pattern>
            </defs>
            <rect x="${o}" y="${s}" width="${a}" height="${l}" class="blind-frame" />
            <rect x="${o}" y="${s}" width="${a}" height="${l}" fill="url(#pleated-mesh)" />
        `;else{const m=Math.max(4,Math.floor(a/10)),d=a/m;for(let p=0;p<m;p++)u+=`<rect x="${o+p*d}" y="${s}" width="${d}" height="${l}" class="partition-panel" />`,p>0&&(u+=`<line x1="${o+p*d}" y1="${s}" x2="${o+p*d}" y2="${s+l}" class="partition-hinge" />`)}const c=Ze(e,{y:s,svgHeight:l});return`<svg viewBox="0 0 100 100">${u}${c}${i}</svg>`}function kt(e){const r=(e.widths||[]).reduce((d,p)=>d+h(p),0),n=h(e.height_m);if(r<=0||n<=0)return'<svg viewBox="0 0 100 100"><text x="50" y="50" class="fallback-text">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î</text></svg>';const{x:t,y:o,svgWidth:s,svgHeight:a,lines:l}=se({width:r,height:n});let i="";const u=Math.floor(s/10),c=Math.floor(a/10);for(let d=0;d<c;d++)for(let p=0;p<u;p++)i+=`<circle cx="${t+p*10+5}" cy="${o+d*10+5}" r="1.5" class="wallpaper-pattern" />`;return`<svg viewBox="0 0 100 100">${`<rect x="${t}" y="${o}" width="${s}" height="${a}" class="blind-frame" /> ${i}`}${l}</svg>`}function xt(e,r,n){let t="",o=G[e.type]||"‡∏Ç‡∏≠‡∏á‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á";switch(e.type){case"set":e.style==="‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö"?t=wt(e):e.style==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"?(t=St(e),o=G.set_louis||"‡∏°‡πà‡∏≤‡∏ô‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"):t=bt(e);break;case"wooden_blind":t=$t(e);break;case"aluminum_blind":t=Ue(e,!1);break;case"vertical_blind":t=Ue(e,!0);break;case"roller_blind":t=qt(e);break;case"partition":t=Ye(e,!1);break;case"pleated_screen":t=Ye(e,!0);break;case"wallpaper":t=kt(e);break;default:t=`<svg viewBox="0 0 100 100"><text x="50" y="50" class="fallback-text">${T(o)}</text></svg>`;break}return`<div class="visual-placeholder is-clickable"
                 data-act="jump-to-item"
                 data-room-id="${r}"
                 data-item-index="${n}"
                 title="‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ">${t}</div>`}function Je(e){let r=`
üìÉ *‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤*
`,n=!1;return e.rooms.forEach(t=>{if(t.is_suspended||!t.items)return;const o=t.items.filter(a=>a.is_suspended?!1:a.type==="wallpaper"?(a.widths||[]).reduce((l,i)=>l+h(i),0)>0:a.type==="set"||H[a.type]?.templateId==="#areaBasedTpl"?h(a.width_m)>0:!0);if(o.length===0)return;n=!0,r+=`
*üö™ ‡∏´‡πâ‡∏≠‡∏á: ${t.room_name||"‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏"}*
`;let s=0;o.forEach(a=>{s++;let l=G[a.type]||"‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á";a.type==="set"?a.style==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"?(l=G.set_louis||"‡∏°‡πà‡∏≤‡∏ô‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå",r+=` ${s}) ${l} (${a.fabric_variant||""})
`):r+=` ${s}) ${l} ${a.style||""} (${a.fabric_variant||""})
`:r+=` ${s}) ${l}
`})}),n?r+`------------------------------
`:""}function et(e){return e.rooms.reduce((r,n)=>{if(n.is_suspended)return r;const t=n.items?.reduce((o,s)=>{if(s.is_suspended)return o;switch(s.type){case"set":return o+F.calculateSetPrice(s).total;case"wallpaper":return o+F.calculateWallpaperPrice(s).total;default:return H[s.type]?.templateId==="#areaBasedTpl"?o+F.calculateAreaBasedPrice(s).total:o}},0)||0;return r+t},0)}function It(e,r){const n=et(e);let t=0,o="";e.discount&&e.discount.value>0&&(e.discount.type==="percent"?(t=n*(e.discount.value/100),o=`üè∑Ô∏è ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î (${e.discount.value}%): -${P(t)} ‡∏ö‡∏≤‡∏ó
`):(t=e.discount.value,o=`üè∑Ô∏è ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î: -${P(t)} ‡∏ö‡∏≤‡∏ó
`));const s=n-t;let a=`üóìÔ∏è ‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (${new Date().toLocaleDateString("th-TH",{day:"numeric",month:"short",year:"2-digit"})})
`;if(a+=`üë§ ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤: ${e.customer_name||"-"}
`,(r==="customer"||r==="owner")&&(a+=`üìû ‡πÇ‡∏ó‡∏£: ${e.customer_phone||"-"}
`,a+=`üè† ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà: ${e.customer_address||"-"}
`),a+=`------------------------------
`,r==="customer")return a+=Je(e),t>0&&(a+=`
‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: ${P(n)} ‡∏ö‡∏≤‡∏ó
`,a+=o),a+=`
üí∞ *‡∏¢‡∏≠‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥: ${P(s)} ‡∏ö‡∏≤‡∏ó*
`,a+=`
‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏Ñ‡πà‡∏∞
${O.name}
‡πÇ‡∏ó‡∏£: ${O.phone}`,a;if(r==="purchase_order"||r==="owner"){r==="owner"&&(a+=Je(e));const l={opaqueFabrics:[],sheerFabrics:[],wallpapers:[],allSets:[]};e.rooms.forEach(y=>{y.is_suspended||!y.items||y.items.forEach(g=>{let k=!g.is_suspended;if(g.type==="set"||H[g.type]?.templateId==="#areaBasedTpl")k=k&&h(g.width_m)>0&&h(g.height_m)>0;else if(g.type==="wallpaper"){const $=(g.widths||[]).reduce((S,L)=>S+h(L),0);k=k&&$>0&&h(g.height_m)>0}if(k)switch(g.type){case"set":l.allSets.push(g),g.fabric_variant.includes("‡∏ó‡∏∂‡∏ö")&&l.opaqueFabrics.push({code:g.fabric_code||"??",yards:F.fabricYardage(g.style,g.width_m)}),g.fabric_variant.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")&&l.sheerFabrics.push({code:g.sheer_fabric_code||"??",yards:F.fabricYardage(g.style,g.width_m)});break;case"wallpaper":const $=(g.widths||[]).reduce((L,w)=>L+h(w),0),S=F.wallpaperRolls($,g.height_m);S>0&&l.wallpapers.push({code:g.wallpaper_code||"xxx",rolls:S});break;default:if(H[g.type]?.templateId==="#areaBasedTpl"){const L=g.type;l[L]||(l[L]=[]),l[L].push({code:g.code||"xxx",width:h(g.width_m),height:h(g.height_m),opening_style:g.opening_style,adjustment_side:g.adjustment_side})}break}})});const i={};if([...l.opaqueFabrics,...l.sheerFabrics].forEach(y=>{y.yards>0&&(i[y.code]=(i[y.code]||0)+y.yards)}),Object.keys(i).length>0){a+=`‚úÇÔ∏è *‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ (‡∏ú‡πâ‡∏≤)*
`,a+=`------------------------------
`,l.opaqueFabrics.filter(y=>y.yards>0).forEach(y=>{a+=`- ‡∏ú‡πâ‡∏≤‡∏ó‡∏∂‡∏ö (Curtain)
`,a+=`  ‡∏£‡∏´‡∏±‡∏™: #${y.code||"??"}
`,a+=`  ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${y.yards.toFixed(2)} ‡∏´‡∏•‡∏≤

`}),l.sheerFabrics.filter(y=>y.yards>0).forEach(y=>{a+=`- ‡∏ú‡πâ‡∏≤‡πÇ‡∏õ‡∏£‡πà‡∏á (Sheer)
`,a+=`  ‡∏£‡∏´‡∏±‡∏™: #${y.code||"??"}
`,a+=`  ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${y.yards.toFixed(2)} ‡∏´‡∏•‡∏≤

`}),a+=`------------------------------
`,a+=`üìä *‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ú‡πâ‡∏≤ (‡∏ï‡∏≤‡∏°‡∏£‡∏´‡∏±‡∏™)*
`,a+=`------------------------------
`;for(const[y,g]of Object.entries(i))a+=`  - ‡∏£‡∏´‡∏±‡∏™ #${y}: ${g.toFixed(2)} ‡∏´‡∏•‡∏≤
`;a+=`
`}const u=l.allSets.filter(y=>y.style==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"),c=l.allSets.filter(y=>y.style==="‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö"),m=l.allSets.filter(y=>y.style==="‡∏ï‡∏≤‡πÑ‡∏Å‡πà"),d=l.allSets.filter(y=>!["‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö","‡∏ï‡∏≤‡πÑ‡∏Å‡πà","‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"].includes(y.style));if(u.length>0){a+=`------------------------------
`,a+=`üëë *‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ ‡∏£‡∏≤‡∏á (‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå)*
`,a+=`------------------------------

`;let y=1;u.forEach(S=>{a+=`(${y++}) ‡∏£‡∏≤‡∏á ${S.style}, ‡∏™‡∏µ: ${S.track_color||"‡∏Ç‡∏≤‡∏ß"}
`,a+=`  - ‡∏£‡∏≤‡∏á‡∏´‡∏•‡∏±‡∏Å (‡∏ó‡∏∂‡∏ö/‡πÇ‡∏õ‡∏£‡πà‡∏á): ${Number(S.width_m).toFixed(2)} ‡∏°.
`,a+=`  - ‡∏´‡∏±‡∏ß‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå: ${S.louis_valance||"‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"}
`,a+=`  - ‡∏û‡∏π‡πà: ${S.louis_tassels||"‡∏™‡∏µ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏ú‡πâ‡∏≤"}
`,S.notes&&r==="owner"&&(a+=`  üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ${S.notes}
`),a+=`
`});const g=[];u.forEach(S=>{g.push(Number(S.width_m)),S.fabric_variant==="‡∏ó‡∏∂‡∏ö&‡πÇ‡∏õ‡∏£‡πà‡∏á"&&g.push(Number(S.width_m))});const k=g.reduce((S,L)=>{const w=L.toFixed(2);return S[w]=(S[w]||0)+1,S},{}),$=Object.entries(k).sort((S,L)=>parseFloat(L[0])-parseFloat(S[0]));if($.length>0){a+=`--- ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏á‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå ---
`,a+=`*‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡∏î (‡πÇ‡∏î‡∏¢‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì):*
`;for(const[S,L]of $)a+=`  - ‡∏Ç‡∏ô‡∏≤‡∏î ${S} ‡∏°. = ${L} ‡πÄ‡∏™‡πâ‡∏ô
`;a+=`
`}}if(c.length>0){a+=`------------------------------
`,a+=`üìè *‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ ‡∏£‡∏≤‡∏á‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö*
`,a+=`------------------------------

`;let y=1;c.forEach($=>{a+=`(${y++}) ‡∏£‡∏≤‡∏á‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö
`,a+=`  - ‡∏Ç‡∏ô‡∏≤‡∏î: ${Number($.width_m).toFixed(2)} ‡∏°.
`,a+=`  - ‡∏™‡∏µ‡∏£‡∏≤‡∏á: ${$.track_color||"‡∏Ç‡∏≤‡∏ß"}
`,a+=`  - ‡πÄ‡∏ä‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏±‡∏ö: ${$.adjustment_side||"‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ß‡∏≤"}
`,$.notes&&r==="owner"&&(a+=`  üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ${$.notes}
`),a+=`
`});const g=c.reduce(($,S)=>{const L=Number(S.width_m).toFixed(2);return $[L]=($[L]||0)+1,$},{}),k=Object.entries(g).sort(($,S)=>parseFloat(S[0])-parseFloat($[0]));if(k.length>0){a+=`--- ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏á‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö ---
`,a+=`*‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡∏î:*
`;for(const[$,S]of k)a+=`  - ‡∏Ç‡∏ô‡∏≤‡∏î ${$} ‡∏°. = ${S} ‡πÄ‡∏™‡πâ‡∏ô
`;a+=`
`}}if(d.length>0){a+=`------------------------------
`,a+=`üìè *‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ ‡∏£‡∏≤‡∏á (‡∏•‡∏≠‡∏ô/‡∏à‡∏µ‡∏ö)*
`,a+=`------------------------------

`;let y=1;d.forEach(S=>{a+=`(${y++}) ‡∏£‡∏≤‡∏á ${S.style}, ‡∏™‡∏µ: ${S.track_color||"‡∏Ç‡∏≤‡∏ß"}
`,S.fabric_variant.includes("‡∏ó‡∏∂‡∏ö")&&(a+=`  - ‡∏£‡∏≤‡∏á‡∏ó‡∏∂‡∏ö: ${Number(S.width_m).toFixed(2)} ‡∏°.
`),S.fabric_variant.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")&&(a+=`  - ‡∏£‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πà‡∏á: ${Number(S.width_m).toFixed(2)} ‡∏°.
`),S.notes&&r==="owner"&&(a+=`  üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ${S.notes}
`),a+=`
`});const g=[];d.forEach(S=>{S.fabric_variant.includes("‡∏ó‡∏∂‡∏ö")&&g.push(Number(S.width_m)),S.fabric_variant.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")&&g.push(Number(S.width_m))});const k=g.reduce((S,L)=>{const w=L.toFixed(2);return S[w]=(S[w]||0)+1,S},{}),$=Object.entries(k).sort((S,L)=>parseFloat(L[0])-parseFloat(S[0]));if($.length>0){a+=`--- ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏á‡∏•‡∏≠‡∏ô/‡∏à‡∏µ‡∏ö ---
`,a+=`*‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡∏î:*
`;for(const[S,L]of $)a+=`  - ‡∏Ç‡∏ô‡∏≤‡∏î ${S} ‡∏°. = ${L} ‡πÄ‡∏™‡πâ‡∏ô
`;a+=`
`}}if(m.length>0){a+=`------------------------------
`,a+=`üìè *‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ ‡∏£‡∏≤‡∏á (‡∏ï‡∏≤‡πÑ‡∏Å‡πà)*
`,a+=`------------------------------

`;let y=1;m.forEach(w=>{a+=`(${y++}) ‡∏£‡∏≤‡∏á ${w.style}, ‡∏™‡∏µ: ${w.track_color||"‡∏Ç‡∏≤‡∏ß"}
`,w.fabric_variant.includes("‡∏ó‡∏∂‡∏ö")&&(a+=`  - ‡∏£‡∏≤‡∏á‡∏ó‡∏∂‡∏ö: ${Number(w.width_m).toFixed(2)} ‡∏°.
`),w.fabric_variant.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")&&(a+=`  - ‡∏£‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πà‡∏á: ${Number(w.width_m).toFixed(2)} ‡∏°.
`),w.notes&&r==="owner"&&(a+=`  üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ${w.notes}
`),a+=`
`}),a+=`--- ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏á‡∏ï‡∏≤‡πÑ‡∏Å‡πà ---
`;const g=[];m.forEach(w=>{w.fabric_variant.includes("‡∏ó‡∏∂‡∏ö")&&g.push(Number(w.width_m)),w.fabric_variant.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")&&g.push(Number(w.width_m))});const k=6;g.sort((w,B)=>B-w);const $=[];for(const w of g){let B=!1;for(let I=0;I<$.length;I++)if($[I]>=w-.001){$[I]-=w,B=!0;break}B||$.push(k-w)}a+=`‡πÉ‡∏ä‡πâ‡∏£‡∏≤‡∏á‡πÄ‡∏ï‡πá‡∏° (6 ‡∏°.) ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: *${$.length} ‡πÄ‡∏™‡πâ‡∏ô*

`;const S=g.reduce((w,B)=>{const I=B.toFixed(2);return w[I]=(w[I]||0)+1,w},{}),L=Object.entries(S).sort((w,B)=>parseFloat(B[0])-parseFloat(w[0]));if(L.length>0){a+=`*‡∏™‡∏£‡∏∏‡∏õ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡∏î:*
`;for(const[w,B]of L)a+=`  - ‡∏Ç‡∏ô‡∏≤‡∏î ${w} ‡∏°. = ${B} ‡πÄ‡∏™‡πâ‡∏ô
`;a+=`
`}}const p={};let _={};l.allSets.forEach(y=>{const g=y.track_color||"‡∏Ç‡∏≤‡∏ß",k=y.style,$=y.fabric_variant==="‡∏ó‡∏∂‡∏ö&‡πÇ‡∏õ‡∏£‡πà‡∏á",S=h(y.width_m)>=1.6?3:2;if(p[g]||(p[g]={brackets:{},finials:0,grommets:{}}),p[g].brackets[k]||(p[g].brackets[k]={single:0,double:0}),k!=="‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö"&&k!=="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"&&($?p[g].brackets[k].double+=S:p[g].brackets[k].single+=S),k==="‡∏ï‡∏≤‡πÑ‡∏Å‡πà"){const L=$?4:2;p[g].finials+=L}if(k==="‡∏ï‡∏≤‡πÑ‡∏Å‡πà"){const L=y.grommet_color||"‡πÄ‡∏á‡∏¥‡∏ô",w=F.calculateGrommets(y);p[g].grommets[L]||(p[g].grommets[L]=0),p[g].grommets[L]+=w}if(k==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"){const L=y.louis_tassels||"‡∏™‡∏µ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏ú‡πâ‡∏≤";L!=="‡πÑ‡∏°‡πà‡∏°‡∏µ"&&(_[L]=(_[L]||0)+2)}});const x=l.allSets.filter(y=>y.style!=="‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö"&&y.style!=="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå").length*2,v=Object.values(p).some(y=>Object.values(y.brackets).some(g=>g.single>0||g.double>0)||y.finials>0||Object.values(y.grommets).some(g=>g>0))||x>0,b=Object.keys(_).length>0;if(v||b){a+=`------------------------------
`,a+=`üî© *‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå (Hardware)*
`,a+=`------------------------------

`;for(const[g,k]of Object.entries(p)){let $=!1,S=`**‡∏™‡∏µ${g}**
`;const L=Object.keys(k.brackets);if(L.length>0){let B="";L.forEach(I=>{!["‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö","‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"].includes(I)&&(k.brackets[I].single>0||k.brackets[I].double>0)&&(B+=`    - ${I} (‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß): ${k.brackets[I].single} ‡∏ï‡∏±‡∏ß
`,B+=`    - ${I} (2‡∏ä‡∏±‡πâ‡∏ô): ${k.brackets[I].double} ‡∏ï‡∏±‡∏ß
`)}),B&&($=!0,S+=`  - ‡∏Ç‡∏≤‡∏à‡∏±‡∏ö:
${B}`)}k.finials>0&&($=!0,S+=`  - ‡∏´‡∏±‡∏ß‡∏£‡∏≤‡∏á (‡∏ï‡∏≤‡πÑ‡∏Å‡πà): ${k.finials} ‡∏ï‡∏±‡∏ß
`);const w=Object.keys(k.grommets);if(w.length>0){let B="";w.forEach(I=>{const D=k.grommets[I];D>0&&(B+=`    - ‡∏™‡∏µ${I}: ${D} ‡∏ï‡∏±‡∏ß
`)}),B&&($=!0,S+=`  - ‡∏ï‡∏≤‡πÑ‡∏Å‡πà:
${B}`)}$&&(a+=S+`
`)}let y="";if(x>0&&(y+=`  - ‡∏ï‡∏∞‡∏Ç‡∏≠‡∏£‡∏ß‡∏ö‡∏°‡πà‡∏≤‡∏ô (‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô): ${x} ‡∏ï‡∏±‡∏ß
`),b){y+=`  - ‡∏û‡∏π‡πà/‡∏™‡∏≤‡∏¢‡∏£‡∏ß‡∏ö (‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå):
`;for(const[g,k]of Object.entries(_))y+=`    - ${g}: ${k} ‡∏ä‡∏∏‡∏î
`}y&&(a+=`**‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏£‡∏ß‡∏°**
`+y+`
`)}const M=Object.keys(l).filter(y=>!["opaqueFabrics","sheerFabrics","wallpapers","allSets"].includes(y));M.length>0&&M.sort().forEach(y=>{const g=l[y],k=G[y]||y;a+=`------------------------------
`,a+=`üì¶ *‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ ${k}*
`,a+=`------------------------------

`,g.forEach($=>{a+=`- ‡∏£‡∏´‡∏±‡∏™: #${$.code||"xxx"}
  ‡∏Ç‡∏ô‡∏≤‡∏î: ${$.width.toFixed(2)} x ${$.height.toFixed(2)} ‡∏°.
`,$.opening_style&&(a+=`  ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏õ‡∏¥‡∏î: ${$.opening_style}
`),$.adjustment_side&&(a+=`  ‡πÄ‡∏ä‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏±‡∏ö: ${$.adjustment_side}
`),a+=`
`})});const A={};if(l.wallpapers.forEach(y=>{A[y.code]=(A[y.code]||0)+y.rolls}),Object.keys(A).length>0){a+=`------------------------------
`,a+=`üé® *‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ (Wallpaper)*
`,a+=`------------------------------

`;for(const[y,g]of Object.entries(A))a+=`  - ‡∏£‡∏´‡∏±‡∏™ #${y}: ${g} ‡∏°‡πâ‡∏ß‡∏ô
`;a+=`
`}if(r==="purchase_order")return a+=`------------------------------
`,a}if(r==="seamstress"||r==="owner"){a+=`
üßµ *‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡πà‡∏≤‡∏á‡πÄ‡∏¢‡πá‡∏ö‡∏ú‡πâ‡∏≤*
`;let l=0;if(e.rooms.forEach(i=>{if(i.is_suspended||!i.items)return;const u=i.items.filter(c=>c.type==="set"&&!c.is_suspended&&h(c.width_m)>0&&h(c.height_m)>0);u.length!==0&&(l>0&&(a+=`==============================
`),a+=`
*üö™ ‡∏´‡πâ‡∏≠‡∏á: ${i.room_name||"‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏"}*

`,u.forEach((c,m)=>{m>0&&(a+=`--------------------
`);const d=c.style==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"?G.set_louis||"‡∏°‡πà‡∏≤‡∏ô‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå":c.style;a+=`*‡∏ä‡∏∏‡∏î‡∏ó‡∏µ‡πà ${m+1}/${u.length}: ${d} ${c.fabric_variant}*
`,c.style==="‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö"?a+=`  - ‡πÄ‡∏ä‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏±‡∏ö: ${c.adjustment_side||"‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ß‡∏≤"}
`:c.style==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"?(a+=`  - ‡∏´‡∏±‡∏ß‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå: ${c.louis_valance||"‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"}
`,a+=`  - ‡∏û‡∏π‡πà: ${c.louis_tassels||"‡∏™‡∏µ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏ú‡πâ‡∏≤"}
`):a+=`  - ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏õ‡∏¥‡∏î: ${c.opening_style||"‡πÅ‡∏¢‡∏Å‡∏Å‡∏•‡∏≤‡∏á"}
`,c.style==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"?(c.fabric_variant.includes("‡∏ó‡∏∂‡∏ö")&&(a+=`  - ‡∏ú‡πâ‡∏≤‡∏ê‡∏≤‡∏ô (‡∏ó‡∏∂‡∏ö): #${c.fabric_code||"-"}
`),c.fabric_variant.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")&&(a+=`  - ‡∏ú‡πâ‡∏≤‡∏ê‡∏≤‡∏ô (‡πÇ‡∏õ‡∏£‡πà‡∏á): #${c.sheer_fabric_code||"-"}
`)):(c.fabric_variant.includes("‡∏ó‡∏∂‡∏ö")&&(a+=`  - ‡∏ú‡πâ‡∏≤‡∏ó‡∏∂‡∏ö: #${c.fabric_code||"-"}
`),c.fabric_variant.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")&&(a+=`  - ‡∏ú‡πâ‡∏≤‡πÇ‡∏õ‡∏£‡πà‡∏á: #${c.sheer_fabric_code||"-"}
`)),a+=`  - ‡∏Ç‡∏ô‡∏≤‡∏î: ‡∏Å‡∏ß‡πâ‡∏≤‡∏á ${Number(c.width_m).toFixed(2)} x ‡∏™‡∏π‡∏á ${Number(c.height_m).toFixed(2)} ‡∏°.
`,c.notes&&r==="owner"&&(a+=`  üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ${c.notes}
`)}),a+=`
`,l++)}),l>0?a+=`==============================
`:a+=`‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡πà‡∏≤‡∏á
------------------------------
`,r==="seamstress")return a}return r==="owner"&&(a+=`
üí∞ *‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: ${P(s)} ‡∏ö‡∏≤‡∏ó*
`,t>0&&(a+=`   (‡∏¢‡∏≠‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏•‡∏î: ${P(n)} ‡∏ö‡∏≤‡∏ó ${o.trim()})
`)),a}function Tt(e){if(!e.rooms||e.rooms.length===0)return'<p class="empty-summary">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•</p>';let r="";const n={};let t=0;if(e.rooms.forEach(a=>{a.is_suspended||!a.items||a.items.forEach(l=>{if(l.is_suspended)return;let i=null,u=0;switch(l.type){case"set":u=F.calculateSetPrice(l).total,u>0&&(i=l.style==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"?"set_louis":"set");break;case"wallpaper":u=F.calculateWallpaperPrice(l).total,u>0&&(i=l.type);break;default:H[l.type]?.templateId==="#areaBasedTpl"&&(u=F.calculateAreaBasedPrice(l).total,u>0&&(i=l.type));break}i&&(n[i]=(n[i]||0)+1,t++)})}),t>0){const a=Object.entries(n).map(([l,i])=>{const u=G[l]||G[l.split("_")[0]]||"‡∏Ç‡∏≠‡∏á‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á";return`
                <span class="summary-tag" data-filter-type="${T(l)}" title="‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ">
                    ${T(u)} <strong>${i}</strong>
                </span>`}).join("");a&&(r+=`
                <div class="overview-summary-group">
                    <h4><i class="ph ph-stack"></i> ‡∏™‡∏£‡∏∏‡∏õ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</h4>
                    <div class="summary-tags-container">
                        ${a}
                    </div>
                </div>`)}let o="",s=0;return e.rooms.forEach(a=>{if(a.is_suspended||!a.items)return;const l={};let i=0;if(a.items.forEach(u=>{if(u.is_suspended)return;let c=null,m=0;switch(u.type){case"set":m=F.calculateSetPrice(u).total,m>0&&(c=u.style==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"?"set_louis":"set");break;case"wallpaper":m=F.calculateWallpaperPrice(u).total,m>0&&(c=u.type);break;default:H[u.type]?.templateId==="#areaBasedTpl"&&(m=F.calculateAreaBasedPrice(u).total,m>0&&(c=u.type));break}c&&(l[c]=(l[c]||0)+1,i++)}),i>0){s+=i;const u=Object.entries(l).map(([c,m])=>{const d=G[c]||G[c.split("_")[0]]||"‡∏Ç‡∏≠‡∏á‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á";return`
                    <div class="overview-item">
                        <span>${T(d)}</span>
                        <span>${m}</span>
                    </div>`}).join("");o+=`
                <details class="overview-room-card">
                    <summary class="overview-room-summary">
                        <span class="room-name">${T(a.room_name)||"‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á"}</span>
                        <div class="summary-tags">
                            <span class="room-item-count">${i} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
                            <i class="ph ph-caret-down expand-icon"></i>
                        </div>
                    </summary>
                    <div class="overview-room-items">${u}</div>
                </details>`}}),o&&(r+=`
            <div class="overview-breakdown-group">
                <h4><i class="ph ph-map-pin-line"></i> ‡πÅ‡∏à‡∏Å‡πÅ‡∏à‡∏á‡∏ï‡∏≤‡∏°‡∏´‡πâ‡∏≠‡∏á</h4>
                ${o}
            </div>`),t===0&&s===0?'<p class="empty-summary">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•</p>':r}function Lt(e,r){const{vatRate:n=O.baseVatRate,pageBreakBuffer:t=3,showDetails:o=!0}=r,s=[];e.rooms.forEach(w=>{if(w.is_suspended||!w.items)return;const B=[];w.items.forEach(I=>{if(I.is_suspended)return;let D="",j=0,R=0,C=0,E=1,X=I.type==="set"&&I.style==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"?G.set_louis||"‡∏°‡πà‡∏≤‡∏ô‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå":G[I.type]||"‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á",U="";switch(I.type){case"set":if(j=F.calculateSetPrice(I).total,j>0){R=h(I.width_m),C=h(I.height_m);const Y=I.style==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"?"":` ${T(I.style||"")}`;D=`${X}${Y} (${T(I.fabric_variant||"")})`,o&&(U=`<br><small>‡∏Ç‡∏ô‡∏≤‡∏î ${R.toFixed(2)} x ${C.toFixed(2)} ‡∏°.${I.notes?` - ${T(I.notes)}`:""}</small>`),E=o?1.5:1}break;case"wallpaper":if(j=F.calculateWallpaperPrice(I).total,j>0){const Y=(I.widths||[]).reduce((ue,it)=>ue+h(it),0),ce=F.wallpaperRolls(Y,I.height_m);C=h(I.height_m),D=`${X}`,o&&(U=`<br><small>‡∏£‡∏´‡∏±‡∏™: ${T(I.wallpaper_code)||"-"}, ‡∏™‡∏π‡∏á ${C.toFixed(2)} ‡∏°. (‡πÉ‡∏ä‡πâ ${ce} ‡∏°‡πâ‡∏ß‡∏ô)</small>`),E=o?1.5:1}break;default:H[I.type]?.templateId==="#areaBasedTpl"&&(j=F.calculateAreaBasedPrice(I).total,j>0&&(R=h(I.width_m),C=h(I.height_m),D=`${X}`,o&&(U=`<br><small>‡∏£‡∏´‡∏±‡∏™: ${T(I.code)||"-"}, ‡∏Ç‡∏ô‡∏≤‡∏î ${R.toFixed(2)} x ${C.toFixed(2)} ‡∏°.</small>`),E=o?1.5:1));break}j>0&&D&&B.push({description:D+U,total:j,units:E})}),B.length>0&&(s.push({isRoomHeader:!0,roomName:T(w.room_name)||"‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á",units:1.2}),s.push(...B))});const a=s.reduce((w,B)=>w+(B.total||0),0);if(a===0)return null;let l=0,i="",u=a;e.discount&&e.discount.value>0&&(e.discount.type==="percent"?(l=a*(e.discount.value/100),i=`<tr><td class="pdf-label">‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î (${e.discount.value}%)</td><td class="pdf-amount">-${z(l,2,!0)}</td></tr>`):(l=e.discount.value,i=`<tr><td class="pdf-label">‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î</td><td class="pdf-amount">-${z(l,2,!0)}</td></tr>`),u=a-l);const c=u*n,m=u+c,d=o?17:20,p=o?23:28,_=[];let x=[],v=0;s.forEach((w,B)=>{const I=_.length===0?d:p,D=v+w.units>I;let j=!1;if(w.isRoomHeader&&B<s.length-1){const C=s[B+1].units||(o?1.5:1);v+w.units+C>I&&v+w.units<=I&&(j=!0)}let R=!1;if(!D&&!j&&B<s.length-1){const C=I-(v+w.units),E=s[B+1].units||(o?1.5:1);C>0&&C<t&&C<E&&!w.isRoomHeader&&(R=!0)}(D||j||R)&&x.length>0&&(_.push(x),x=[],v=0),x.push(w),v+=w.units}),x.length>0&&_.push(x);const b=new Date,M=b.toLocaleDateString("th-TH",{year:"numeric",month:"long",day:"numeric"}),A=`QT-${b.getFullYear()}${(b.getMonth()+1).toString().padStart(2,"0")}${b.getDate().toString().padStart(2,"0")}`;let y="";try{y=new URL(O.logoUrl,document.baseURI).href}catch(w){console.warn("Could not create absolute logo URL:",w),y=O.logoUrl}let g="",k=0,$=1;_.forEach((w,B)=>{const I=B===0,D=B===_.length-1,j=`
            <div class="pdf-page-header">
                <div class="pdf-header">
                    <div class="pdf-shop-info">
                        ${y?`<img src="${y}" alt="Logo" class="pdf-logo">`:""}
                        <div class="pdf-shop-address">
                            <strong><i class="ph ph-github-logo"></i> ${T(O.name)}</strong><br>
                            ${T(O.address).replace(/\n/g,"<br>")}<br>
                            ‡πÇ‡∏ó‡∏£: ${T(O.phone)} | ‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏ú‡∏π‡πâ‡πÄ‡∏™‡∏µ‡∏¢‡∏†‡∏≤‡∏©‡∏µ: ${T(O.taxId)}
                        </div>
                    </div>
                    <div class="pdf-quote-details">
                        <div class="pdf-title-box"><h1>‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤ ${_.length>1?I?"":"(‡∏ï‡πà‡∏≠)":""}</h1></div>
                        <table class="pdf-quote-meta">
                            <tr><td>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà:</td><td>${A}</td></tr>
                            <tr><td>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</td><td>${M}</td></tr>
                        </table>
                    </div>
                </div>
                ${I?`
                <section class="pdf-customer-details">
                    <div class="pdf-customer-info">
                        <strong>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤:</strong> ${T(e.customer_name)||"-"}<br>
                        <strong>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:</strong> ${T(e.customer_address||"-").replace(/\n/g,"<br>")}<br>
                        <strong>‡πÇ‡∏ó‡∏£:</strong> ${T(e.customer_phone)||"-"}
                    </div>
                    <div class="pdf-customer-meta">
                        <strong>‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô:</strong> ${T(O.pdf.paymentTerms)}<br>
                        <strong>‡∏¢‡∏∑‡∏ô‡∏£‡∏≤‡∏Ñ‡∏≤:</strong> ${T(O.pdf.priceValidity)}
                    </div>
                </section>`:""}
            </div>`,R=`
            <div class="pdf-page-footer">
                <div class="pdf-footer-info">
                    <span><i class="ph ph-github-logo"></i> ${T(O.name)} | ‡πÇ‡∏ó‡∏£: ${T(O.phone)}</span>
                    <span>‡∏´‡∏ô‡πâ‡∏≤ ${B+1} / ${_.length}</span>
                </div>
            </div>`;let C="";I||(C+=`<tr class="pdf-subtotal-row"><td colspan="4">‡∏¢‡∏≠‡∏î‡∏¢‡∏Å‡∏°‡∏≤ (Brought Forward)</td><td class="pdf-text-right">${z(k,2,!0)}</td></tr>`),w.forEach(Y=>{Y.isRoomHeader?C+=`<tr class="pdf-room-header"><td colspan="5">‡∏´‡πâ‡∏≠‡∏á: ${Y.roomName}</td></tr>`:(C+=`<tr><td class="pdf-text-center">${$++}</td><td>${Y.description}</td><td class="pdf-text-center">1</td><td class="pdf-text-right">${z(Y.total,2,!0)}</td><td class="pdf-text-right">${z(Y.total,2,!0)}</td></tr>`,k+=Y.total)});let E="";D||(E=`<tfoot><tr class="pdf-subtotal-row"><td colspan="4">‡∏¢‡∏≠‡∏î‡∏¢‡∏Å‡πÑ‡∏õ (Carried Forward)</td><td class="pdf-text-right">${z(k,2,!0)}</td></tr></tfoot>`);let X="";o&&O.pdf.notes&&O.pdf.notes.length>0&&(X=`
                <strong>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</strong>
                <ul>${O.pdf.notes.map(Y=>`<li>${T(Y)}</li>`).join("")}</ul>
            `);const U=D?`
            <div class="pdf-summary-wrapper">
                <section class="pdf-summary-section">
                    <div class="pdf-amount-in-words">
                        ${X}
                        <div class="pdf-amount-text">( ${ft(m)} )</div>
                    </div>
                    <div class="pdf-totals-block">
                        <table>
                            <tr><td class="pdf-label">‡∏£‡∏ß‡∏°‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</td><td class="pdf-amount">${z(a,2,!0)}</td></tr>
                            ${i}
                            ${n>0?`<tr><td class="pdf-label">‡∏†‡∏≤‡∏©‡∏µ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏° ${(n*100).toFixed(0)}%</td><td class="pdf-amount">${z(c,2,!0)}</td></tr>`:""}
                            <tr class="pdf-grand-total"><td class="pdf-label">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</td><td class="pdf-amount">${z(m,2,!0)}</td></tr>
                        </table>
                    </div>
                </section>
                <footer class="pdf-footer-section">
                    <div class="pdf-signature-box"><p>.................................................</p><p>‡∏ú‡∏π‡πâ‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤</p><p>(<i class="ph ph-github-logo"></i> ${T(O.name)})</p><p>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${M}</p></div>
                    <div class="pdf-signature-box"><p>.................................................</p><p>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ / ‡∏ú‡∏π‡πâ‡∏°‡∏µ‡∏≠‡∏≥‡∏ô‡∏≤‡∏à‡∏•‡∏á‡∏ô‡∏≤‡∏°</p><p>&nbsp;</p><p>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ......./......./............</p></div>
                </footer>
            </div>
        `:"";g+=`
            <div class="pdf-page">
                <div class="pdf-page-content">
                    ${j}
                    <div class="pdf-page-body">
                        <table class="pdf-items-table">
                            <thead><tr><th style="width:5%;">‡∏•‡∏≥‡∏î‡∏±‡∏ö</th><th style="width:50%;">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th><th style="width:10%;">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th><th style="width:17.5%;">‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏´‡∏ô‡πà‡∏ß‡∏¢</th><th style="width:17.5%;">‡∏£‡∏ß‡∏° (‡∏ö‡∏≤‡∏ó)</th></tr></thead>
                            <tbody>${C}</tbody>
                            ${E}
                        </table>
                        ${U}
                    </div>
                    ${R}
                </div>
            </div>`});const S=e.customer_name||"quote",L=Ke(S);return{html:`<div id="quotation-template">${g}</div>`,fileName:`${A}_${L}`}}function Mt(e){const r=et(e);let n=0;e.discount?.value>0&&(n=e.discount.type==="percent"?r*(e.discount.value/100):e.discount.value);const t=r-n;let o=!1,s=e.rooms.map(l=>{if(l.is_suspended)return"";const i=l.items.filter(c=>c.is_suspended?!1:c.type==="set"||H[c.type]?.templateId==="#areaBasedTpl"?h(c.width_m)>0&&h(c.height_m)>0:c.type==="wallpaper"?(c.widths||[]).reduce((d,p)=>d+h(p),0)>0&&h(c.height_m)>0:!1);if(i.length===0)return"";const u=i.map((c,m)=>{let d="",p="",_="",x="";switch(c.type==="set"?c.style==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"?(x=G.set_louis||"‡∏°‡πà‡∏≤‡∏ô‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå",p=`<h5 class="lookbook-item-title">${T(x)}</h5>`):x=G.set||"‡∏ú‡πâ‡∏≤‡∏°‡πà‡∏≤‡∏ô":(x=G[c.type]||"‡∏Ç‡∏≠‡∏á‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á",p=`<h5 class="lookbook-item-title">${T(x)}</h5>`),c.type){case"set":_=`<tr><td>‡∏Ç‡∏ô‡∏≤‡∏î</td><td>${h(c.width_m).toFixed(2)} x ${h(c.height_m).toFixed(2)} ‡∏°.</td></tr>`,c.style==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"?d=`
                            <tr><td>‡πÅ‡∏ö‡∏ö</td><td>${x} (${T(c.fabric_variant||"")})</td></tr>
                            ${c.fabric_variant.includes("‡∏ó‡∏∂‡∏ö")?`<tr><td>‡∏ú‡πâ‡∏≤‡∏ê‡∏≤‡∏ô</td><td>#${T(c.fabric_code)||"-"}</td></tr>`:""}
                            ${c.fabric_variant.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")?`<tr><td>‡∏ú‡πâ‡∏≤‡πÇ‡∏õ‡∏£‡πà‡∏á</td><td>#${T(c.sheer_fabric_code)||"-"}</td></tr>`:""}
                            <tr><td>‡∏´‡∏±‡∏ß‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå</td><td>${T(c.louis_valance||"‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå")}</td></tr>
                            <tr><td>‡∏û‡∏π‡πà</td><td>${T(c.louis_tassels||"‡∏™‡∏µ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏ú‡πâ‡∏≤")}</td></tr>
                         `:(d=`
                            <tr><td>‡πÅ‡∏ö‡∏ö</td><td>${T(c.style||"")} (${T(c.fabric_variant||"")})</td></tr>
                            ${c.fabric_variant.includes("‡∏ó‡∏∂‡∏ö")?`<tr><td>‡∏ó‡∏∂‡∏ö</td><td>#${T(c.fabric_code)||"-"}</td></tr>`:""}
                            ${c.fabric_variant.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")?`<tr><td>‡πÇ‡∏õ‡∏£‡πà‡∏á</td><td>#${T(c.sheer_fabric_code)||"-"}</td></tr>`:""}
                        `,c.style==="‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö"?d+=`<tr><td>‡πÄ‡∏ä‡∏∑‡∏≠‡∏Å</td><td>${T(c.adjustment_side||"‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ß‡∏≤")}</td></tr>`:d+=`<tr><td>‡πÄ‡∏õ‡∏¥‡∏î</td><td>${T(c.opening_style||"‡πÅ‡∏¢‡∏Å‡∏Å‡∏•‡∏≤‡∏á")}</td></tr>`);break;case"wallpaper":const v=(c.widths||[]).reduce((M,A)=>M+h(A),0),b=F.wallpaperRolls(v,c.height_m);_=`<tr><td>‡∏Ç‡∏ô‡∏≤‡∏î</td><td>‡∏£‡∏ß‡∏° ${v.toFixed(2)} ‡∏°., ‡∏™‡∏π‡∏á ${h(c.height_m).toFixed(2)} ‡∏°.</td></tr>`,d=`
                        <tr><td>‡∏£‡∏´‡∏±‡∏™</td><td>#${T(c.wallpaper_code)||"-"}</td></tr>
                        <tr><td>‡πÉ‡∏ä‡πâ</td><td>${b} ‡∏°‡πâ‡∏ß‡∏ô</td></tr>
                    `;break;default:H[c.type]?.templateId==="#areaBasedTpl"&&(_=`<tr><td>‡∏Ç‡∏ô‡∏≤‡∏î</td><td>${h(c.width_m).toFixed(2)} x ${h(c.height_m).toFixed(2)} ‡∏°.</td></tr>`,d=`<tr><td>‡∏£‡∏´‡∏±‡∏™</td><td>#${T(c.code)||"-"}</td></tr>`,c.opening_style&&(d+=`<tr><td>‡πÄ‡∏õ‡∏¥‡∏î</td><td>${T(c.opening_style)}</td></tr>`),c.adjustment_side&&(d+=`<tr><td>‡πÄ‡∏ä‡∏∑‡∏≠‡∏Å</td><td>${T(c.adjustment_side)}</td></tr>`));break}return d&&(o=!0),`
                 <div class="lookbook-details">
                    ${xt(c,l.id,m)}
                    <div class="spec-table-wrapper">
                        ${p}
                        <table class="spec-table">
                            ${d}
                            ${_}
                            ${c.notes?`<tr><td>‡πÇ‡∏ô‡πâ‡∏ï</td><td>${T(c.notes)}</td></tr>`:""}
                        </table>
                    </div>
                </div>
            `}).join('<hr class="lookbook-hr">');return u.trim()?`
            <div class="lookbook-room">
                <h4><i class="ph ph-map-pin"></i> ${T(l.room_name)||"‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á"}</h4>
                ${u}
            </div>
        `:""}).join("");return o?`
        <div class="lookbook-summary">
            <div class="lookbook-customer-info">
                <strong>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤:</strong> ${T(e.customer_name)||"-"}<br/>
                <strong>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:</strong> ${T(e.customer_address||"-").replace(/\n/g,"<br/>")}
            </div>
            <div class="lookbook-totals">
                <span>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏° (‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î): ${P(r)} ‡∏ö‡∏≤‡∏ó</span>
                ${n>0?`<span>‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î: -${P(n)} ‡∏ö‡∏≤‡∏ó</span>`:""}
                <span class="grand-total">‡∏¢‡∏≠‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥: ${P(t)} ‡∏ö‡∏≤‡∏ó</span>
            </div>
        </div>
    `+s:'<p class="empty-summary">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</p>'}function tt(e={}){const r=document.querySelector(f.roomTpl);if(!r)return console.error("Room template not found"),null;const t=r.content.cloneNode(!0).firstElementChild;t.id=e.id||`room-${Date.now()}`,t.open=e.is_open!==!1;const o=t.querySelector(f.roomNameInput),s=t.querySelector("[data-room-name-display]"),a=t.querySelector("[data-room-brief]"),l=t.querySelector(f.allItemsContainer),i=()=>{const m=o.value||"‡∏´‡πâ‡∏≠‡∏á (‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠)";s&&(s.textContent=m)};o&&o.addEventListener("input",i);const u=t.querySelector("summary");u&&u.addEventListener("click",()=>{});const c=e.room_name||`‡∏´‡πâ‡∏≠‡∏á ${document.querySelectorAll(f.room).length+1}`;if(o){o.value=c;const m=`room_name_${t.id}`;o.id=m;const d=o.closest(".form-group")?.querySelector("label");d&&d.setAttribute("for",m)}return s&&(s.textContent=c),e.is_suspended&&t.classList.add("is-suspended"),t.getItemsContainer=()=>l,t.updateBrief=m=>{a&&(a.innerHTML=m)},t}function Me(e={}){const r=document.querySelector(f.setTpl);if(!r)return console.error("Set template not found"),null;const t=r.content.cloneNode(!0).firstElementChild;t.dataset.type="set";const o=t.querySelector('input[name="width_m"]'),s=t.querySelector('input[name="height_m"]'),a=t.querySelector('select[name="set_style"]'),l=t.querySelector('select[name="fabric_variant"]'),i=t.querySelector('select[name="set_price_per_m"]'),u=t.querySelector('select[name="sheer_price_per_m"]'),c=t.querySelector('select[name="louis_price_per_m"]'),m=t.querySelector('input[name="fabric_code"]'),d=t.querySelector('input[name="sheer_fabric_code"]'),p=t.querySelector('select[name="opening_style"]'),_=t.querySelector('select[name="adjustment_side"]'),x=t.querySelector('input[name="notes"]'),v=t.querySelector('[data-set-control="opening_style_wrap"]'),b=t.querySelector('[data-set-control="adjustment_side_wrap"]'),M=t.querySelector('[data-set-control="louis_price_wrap"]'),A=t.querySelector('[data-set-control="fabric_price_wrap"]'),y=t.querySelector('[data-set-control="fabric_code_wrap"]'),g=t.querySelector("[data-sheer-wrap]"),k=t.querySelector("[data-sheer-code-wrap]"),$=t.querySelector("[data-set-summary]"),S=t.querySelector(".item-details-more"),L=t.querySelector('[data-act="toggle-more-details"]')?.parentElement,w=()=>({width_m:o.value,height_m:s.value,style:a.value,fabric_variant:l.value,price_per_m_raw:i.value,sheer_price_per_m:u.value,louis_price_per_m:c.value,is_suspended:t.classList.contains("is-suspended")}),B=()=>{const R=w(),C=F.calculateSetPrice(R);t.dataset.totalPrice=C.total;let E=`‡∏£‡∏≤‡∏Ñ‡∏≤: <b>${P(C.total)}</b> ‡∏ö.`;if(R.style==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"){const U=[];C.opaque>0&&U.push(`‡∏ó‡∏∂‡∏ö: ${P(C.opaque)}`),C.sheer>0&&U.push(`‡πÇ‡∏õ‡∏£‡πà‡∏á: ${P(C.sheer)}`),C.louis>0&&U.push(`‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå: ${P(C.louis)}`),U.length>0&&(E+=` <small>(${U.join(", ")})</small>`)}else C.opaque>0&&C.sheer>0&&(E+=` <small>(‡∏ó‡∏∂‡∏ö: ${P(C.opaque)}, ‡πÇ‡∏õ‡∏£‡πà‡∏á: ${P(C.sheer)})</small>`);const X=F.fabricYardage(R.style,R.width_m);X>0&&(E+=` &bull; ‡πÉ‡∏ä‡πâ‡∏ú‡πâ‡∏≤: ${X.toFixed(2)} ‡∏´‡∏•‡∏≤`),$?$.innerHTML=E:console.warn("Summary element not found for set item.")},I=_e(()=>{B(),t.dispatchEvent(new CustomEvent("item-update",{bubbles:!0}))},200),D=()=>{const R=a.value,C=l.value,E=R==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå",X=C.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á"),U=C==="‡πÇ‡∏õ‡∏£‡πà‡∏á"&&!E,Y=C==="‡∏ó‡∏∂‡∏ö"&&!E;g?.classList.toggle("hidden",!X||E),k?.classList.toggle("hidden",!X||E);const ce=U||E;i&&(i.disabled=ce,ce&&(i.value="")),m&&(m.disabled=ce,ce&&(m.value=""));const ue=Y||E;u&&(u.disabled=ue,ue&&(u.value="")),d&&(d.disabled=ue,ue&&(d.value=""))},j=()=>{const R=a.value,C=R==="‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö",E=R==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå";v&&v.classList.toggle("hidden",C||E),b&&b.classList.toggle("hidden",!C),M&&M.classList.toggle("hidden",!E),A&&A.classList.toggle("hidden",E),y&&y.classList.toggle("hidden",E),D()};if(t.addEventListener("input",R=>{R.target===l&&D(),R.target===a&&j(),I()}),S&&L){const R=t.querySelector(".item-grid");R&&R.appendChild(L)}return o.value=le(e.width_m),s.value=le(e.height_m),a.value=e.style||"‡∏•‡∏≠‡∏ô",l.value=e.fabric_variant||"‡∏ó‡∏∂‡∏ö",i.value=e.price_per_m_raw||"",u.value=e.sheer_price_per_m||"",c.value=e.louis_price_per_m||"",m.value=e.fabric_code||"",d.value=e.sheer_fabric_code||"",p.value=e.opening_style||"‡πÅ‡∏¢‡∏Å‡∏Å‡∏•‡∏≤‡∏á",_.value=e.adjustment_side||"‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ß‡∏≤",x.value=e.notes||"",t.querySelector('input[name="track_color"]').value=e.track_color||"‡∏Ç‡∏≤‡∏ß",t.querySelector('input[name="bracket_color"]').value=e.bracket_color||"‡∏Ç‡∏≤‡∏ß",t.querySelector('input[name="finial_color"]').value=e.finial_color||"‡∏Ç‡∏≤‡∏ß",t.querySelector('input[name="grommet_color"]').value=e.grommet_color||"‡πÄ‡∏á‡∏¥‡∏ô",t.querySelector('input[name="louis_valance"]').value=e.louis_valance||"‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå",t.querySelector('input[name="louis_tassels"]').value=e.louis_tassels||"‡∏™‡∏µ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏ú‡πâ‡∏≤",e.is_suspended&&t.classList.add("is-suspended"),j(),B(),t}function De(e={}){const r=document.querySelector(f.wallTpl);if(!r)return null;const t=r.content.cloneNode(!0).firstElementChild,o=t.querySelector('input[name="wall_width_m"]');o.value=le(e.width);const s=`wall_width_${Date.now()}_${Math.random().toString(36).substring(2,7)}`;o.id=s;const a=t.querySelector("label");return a&&a.setAttribute("for",s),t}function Be(e={}){const r=document.querySelector(f.wallpaperTpl);if(!r)return console.error("Wallpaper template not found"),null;const t=r.content.cloneNode(!0).firstElementChild;t.dataset.type="wallpaper";const o=t.querySelector('[name="wallpaper_height_m"]'),s=t.querySelector('[name="wallpaper_price_roll"]'),a=t.querySelector('[name="wallpaper_install_cost"]'),l=t.querySelector('[name="wallpaper_code"]'),i=t.querySelector('[name="wallpaper_notes"]'),u=t.querySelector("[data-walls-container]"),c=t.querySelector("[data-wallpaper-summary]"),m=t.querySelector(".item-details-more"),d=t.querySelector('[data-act="toggle-more-details"]')?.parentElement,p=()=>({height_m:o.value,price_per_roll:s.value,install_cost_per_roll:a.value,widths:Array.from(u.querySelectorAll('input[name="wall_width_m"]')).map(v=>v.value),is_suspended:t.classList.contains("is-suspended")}),_=()=>{const v=p(),b=F.calculateWallpaperPrice(v);t.dataset.totalPrice=b.total;let M=`‡∏£‡∏ß‡∏°: <b>${P(b.total)}</b> ‡∏ö. `;(b.material>0||b.install>0)&&(M+=`<small>(‡∏ß‡∏≠‡∏•‡∏•‡πå: ${P(b.material)}, ‡∏Ñ‡πà‡∏≤‡∏ä‡πà‡∏≤‡∏á: ${P(b.install)})</small>`),b.rolls>0&&(M+=` &bull; ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà: ${z(b.sqm,2)} ‡∏ï‡∏£.‡∏°. &bull; ‡πÉ‡∏ä‡πâ: ${b.rolls} ‡∏°‡πâ‡∏ß‡∏ô`),c&&(c.innerHTML=M)},x=_e(()=>{_(),t.dispatchEvent(new CustomEvent("item-update",{bubbles:!0}))},200);if(t.addEventListener("input",x),m&&d){const v=t.querySelector(".item-grid");v&&v.appendChild(d)}if(e.widths&&e.widths.length>0)e.widths.forEach(v=>{const b=De({width:v});b&&u.appendChild(b)});else{const v=De();v&&u.appendChild(v)}return o.value=le(e.height_m),s.value=e.price_per_roll>0?P(e.price_per_roll):"",e.hasOwnProperty("install_cost_per_roll")?a.value=e.install_cost_per_roll===0?"0":e.install_cost_per_roll>0?P(e.install_cost_per_roll):"":a.value=a.value,l.value=e.wallpaper_code||"",i.value=e.notes||"",e.is_suspended&&t.classList.add("is-suspended"),_(),t}function Ce(e,r={}){const n=document.querySelector(f.areaBasedTpl);if(!n)return console.error("AreaBased template not found"),null;const o=n.content.cloneNode(!0).firstElementChild;o.dataset.type=e;const s=H[e]||{name:"‡∏Ç‡∏≠‡∏á‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á"};o.classList.add(`${e.replace(/_/g,"-")}-item`);const a=o.querySelector(".item-type-display"),l=o.querySelector('[name="area_width_m"]'),i=o.querySelector('[name="area_height_m"]'),u=o.querySelector('[name="area_price_sqyd"]'),c=o.querySelector('[name="area_code"]'),m=o.querySelector('[name="area_notes"]'),d=o.querySelector(".btn-favorite"),p=o.querySelector(".btn-show-favs"),_=o.querySelector("[data-area-summary]"),x=o.querySelector(".item-details-more"),v=o.querySelector('[data-act="toggle-more-details"]')?.parentElement,b=x?.querySelector(".item-grid"),M=b?.querySelector('[name="area_price_sqyd"]')?.closest(".form-group");let A,y;if(b&&M){if(e==="partition"||e==="pleated_screen"){const S=document.createElement("div");S.className="form-group",S.innerHTML=`
                <label>‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏õ‡∏¥‡∏î
                    <select name="opening_style">
                        <option value="‡πÅ‡∏¢‡∏Å‡∏Å‡∏•‡∏≤‡∏á">‡πÅ‡∏¢‡∏Å‡∏Å‡∏•‡∏≤‡∏á</option>
                        <option value="‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß">‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß</option>
                    </select>
                </label>
            `,b.insertBefore(S,M),A=S.querySelector("select")}else if(["wooden_blind","roller_blind","vertical_blind","aluminum_blind"].includes(e)){const S=document.createElement("div");S.className="form-group",S.innerHTML=`
                <label>‡πÄ‡∏ä‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏±‡∏ö
                    <select name="adjustment_side">
                        <option value="‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ß‡∏≤">‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ß‡∏≤</option>
                        <option value="‡∏õ‡∏£‡∏±‡∏ö‡∏ã‡πâ‡∏≤‡∏¢">‡∏õ‡∏£‡∏±‡∏ö‡∏ã‡πâ‡∏≤‡∏¢</option>
                    </select>
                </label>
            `,b.insertBefore(S,M),y=S.querySelector("select")}(A||y)&&M&&M.classList.remove("full-width-item")}const g=()=>({width_m:l.value,height_m:i.value,price_sqyd:u.value,is_suspended:o.classList.contains("is-suspended")}),k=()=>{const S=g(),L=F.calculateAreaBasedPrice(S);o.dataset.totalPrice=L.total;const w=L.sqyd>0?` &bull; ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà: ${z(L.sqyd,2)} ‡∏ï‡∏£.‡∏´‡∏•‡∏≤`:"";_&&(_.innerHTML=`‡∏£‡∏≤‡∏Ñ‡∏≤: <b>${P(L.total)}</b> ‡∏ö.${w}`)},$=_e(()=>{k(),o.dispatchEvent(new CustomEvent("item-update",{bubbles:!0}))},200);if(o.addEventListener("input",$),x&&v){const S=o.querySelector(".item-grid");S&&S.appendChild(v)}return a&&(a.textContent=s.name),c&&(c.dataset.favoriteType=e),d&&(d.dataset.type=e),p&&(p.dataset.type=e),l.value=le(r.width_m),i.value=le(r.height_m),u.value=r.price_sqyd>0?P(r.price_sqyd):"",c.value=r.code||"",m.value=r.notes||"",A&&(A.value=r.opening_style||"‡πÅ‡∏¢‡∏Å‡∏Å‡∏•‡∏≤‡∏á"),y&&(y.value=r.adjustment_side||"‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ß‡∏≤"),r.is_suspended&&o.classList.add("is-suspended"),k(),o}let Z=!1,we=null,N=null,me=null,ge=!1,W=null,Ee=!1,re=null;const Qe=document.querySelector("#undoBtn"),je="marnthara.theme",$e={};function Bt(e){if($e[e])return $e[e];const r=new Promise((n,t)=>{const o=document.createElement("script");o.src=e,o.onload=()=>n(),o.onerror=()=>{console.error(`Script load error for ${e}`),delete $e[e],t(new Error(`Script load error for ${e}`))},document.head.appendChild(o)});return $e[e]=r,r}function ot(){const e=localStorage.getItem(je),r=document.querySelector("#themeToggleBtn");if(!r)return;const n=r.querySelector("i"),t=r.querySelector("span");switch(document.body.classList.remove("dark-theme","neutral-theme"),e){case"dark":document.body.classList.add("dark-theme"),n&&(n.className="ph-fill ph-sun"),t&&(t.textContent=" ‡∏™‡∏ß‡πà‡∏≤‡∏á");break;case"neutral":document.body.classList.add("neutral-theme"),n&&(n.className="ph-fill ph-moon"),t&&(t.textContent=" ‡∏°‡∏∑‡∏î");break;default:n&&(n.className="ph-fill ph-palette"),t&&(t.textContent=" ‡∏Å‡∏•‡∏≤‡∏á");break}}function Ct(){const e=localStorage.getItem(je);let r="neutral";!e||e==="light"?r="neutral":e==="neutral"?r="dark":r="light",localStorage.setItem(je,r),ot()}function te(){Qe&&(Qe.disabled=!_t())}function Pt(){const e=gt();e&&(Ge(e,!1),q("‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß","success")),te()}function fe(){const e=document.getElementById("suspendedItemsBtn");if(!e)return;if(me){e.classList.remove("is-visible");return}const r=document.getElementById("suspendedCountBadge"),n=document.querySelectorAll(".item-card.is-suspended").length,t=document.querySelectorAll(".room-card.is-suspended");let o=0;t.forEach(a=>{o+=a.querySelectorAll(".item-card:not(.is-suspended)").length});const s=n+o;r&&(r.textContent=s),e.classList.toggle("is-visible",s>0)}function Fe(){me="suspended";const e=document.getElementById("filterStatusBar");let r=0;if(document.querySelectorAll(".room-card").forEach(n=>{let t=!1;const o=n.classList.contains("is-suspended");n.querySelectorAll(".item-card").forEach(a=>{const i=a.classList.contains("is-suspended")||o;a.classList.toggle("item-hidden",!i),i&&(t=!0,r++)});const s=o||t;n.classList.toggle("item-hidden",!s)}),r===0){rt(),q("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏£‡∏∞‡∏á‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß","success");return}e&&(e.innerHTML=`
            <span><i class="ph ph-warning"></i> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏£‡∏∞‡∏á‡∏±‡∏ö (${r} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)</span>
            <button type="button" class="btn-chip" data-act="clear-filter" title="‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏á">
                <i class="ph ph-x"></i>&nbsp;‡∏õ‡∏¥‡∏î
            </button>
        `,e.classList.add("is-visible"),e.dataset.filterType="suspended"),oe(),ee(),fe()}function At(e,r){if(!e)return;me=e;const n=document.getElementById("filterStatusBar");let t=0;document.querySelectorAll(f.room).forEach(o=>{let s=0;o.querySelectorAll(".item-card").forEach(a=>{const l=a.dataset.type===e;a.classList.toggle("item-hidden",!l),l&&s++}),o.classList.toggle("item-hidden",s===0),s>0&&(t+=s)}),n&&(n.innerHTML=`
            <span>‡πÄ‡∏â‡∏û‡∏≤‡∏∞: <strong>${T(r)}</strong> (${t} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)</span>
            <button type="button" class="btn-chip" data-act="clear-filter" title="‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏á">
                <i class="ph ph-x"></i>&nbsp;‡∏õ‡∏¥‡∏î
            </button>
        `,n.classList.add("is-visible"),n.dataset.filterType=e),oe(),ee(),fe()}function rt(){me=null;const e=document.getElementById("filterStatusBar");e&&(e.classList.remove("is-visible"),e.innerHTML="",e.removeAttribute("data-filter-type")),document.querySelectorAll(".item-hidden").forEach(r=>r.classList.remove("item-hidden")),oe(),ee(),fe()}function q(e,r="default"){const n=document.querySelector(f.toastContainer);if(!n)return;const t={success:"ph-bold ph-check-circle",warning:"ph-bold ph-warning",error:"ph-bold ph-x-circle",default:"ph-bold ph-info"},o=document.createElement("div");o.className=`toast toast-${r}`,o.innerHTML=`<i class="${t[r]||t.default}"></i> ${T(e)}`,n.appendChild(o),setTimeout(()=>o.classList.add("show"),10),setTimeout(()=>{o.classList.remove("show"),o.addEventListener("transitionend",()=>o.remove())},3e3)}function Q(e,r){return new Promise(n=>{const t=document.querySelector(e);if(!t){n(null);return}const o=document.querySelector(".modal-wrapper.visible:not(.is-underlay)");o&&o!==t&&o.classList.add("is-underlay"),t.classList.add("visible");const s=t.querySelector('[id$="Confirm"]'),a=t.querySelector('[id$="Cancel"], [data-act="close-modal"]'),l=Array.from(t.querySelectorAll('button, [href], input:not([type="hidden"]), select, textarea, [tabindex]:not([tabindex="-1"])')).filter(p=>!p.disabled&&p.offsetParent!==null),i=l[0],u=l[l.length-1];setTimeout(()=>i?.focus(),50);const c=p=>{t.classList.remove("visible"),document.removeEventListener("keydown",m),t.removeEventListener("click",d),s&&(s.onclick=null),a&&(a.onclick=null);const _=document.querySelector(".modal-wrapper.visible:not(.is-underlay)");_?_.classList.remove("is-underlay"):o&&o!==t&&o.classList.remove("is-underlay"),p?.cancelled&&typeof r=="function"&&r(),n(p)},m=p=>{p.key==="Escape"&&!t.classList.contains("is-underlay")&&c({cancelled:!0}),p.key==="Tab"&&l.length>1&&(p.shiftKey?document.activeElement===i&&(u.focus(),p.preventDefault()):document.activeElement===u&&(i.focus(),p.preventDefault()))},d=p=>{p.target===t&&!t.classList.contains("is-underlay")&&(p.stopPropagation(),c({cancelled:!0}))};s&&(s.onclick=()=>c(!0)),a&&(a.onclick=()=>{t.classList.contains("is-underlay")||c({cancelled:!0})}),document.addEventListener("keydown",m),t.addEventListener("click",d)})}async function ae(e,r){const n=document.querySelector(f.modal);return n?(n.querySelector(f.modalTitle).textContent=e,n.querySelector(f.modalBody).textContent=r,await Q(f.modal)===!0):!0}async function Et(){const e=document.querySelector(f.exportOptionsModal);if(!e)return null;const r=e.querySelector("#pageBreakBuffer"),n=e.querySelector("#pageBreakBufferValue");r&&n&&(n.textContent=r.value,r.oninput=()=>{n.textContent=r.value});const t=await Q(f.exportOptionsModal);return r&&(r.oninput=null),!t||t.cancelled?null:{vatOption:e.querySelector('input[name="vat_option"]:checked')?.value||"include",showDetails:(e.querySelector('input[name="item_details_option"]:checked')?.value||"show_details")==="show_details",exportMethod:e.querySelector("#exportMethod")?.value||"direct",pageBreakBuffer:parseInt(r?.value,10)||3}}async function Ft(){const e=document.querySelector("#discountModal");if(!e)return;const r=e.querySelector("#discountSubtotal"),n=e.querySelector("#discountPercent"),t=e.querySelector("#discountAmount"),o=e.querySelector("#discountFinalTotal"),s=document.querySelector("#discount_type"),a=document.querySelector("#discount_value"),l=h(document.querySelector("#originalTotal").dataset.rawTotal||document.querySelector("#grandTotal").textContent);r&&(r.textContent=P(l));const i=v=>{if(Ee)return;Ee=!0;let b=0;if(v==="percent"){const M=h(n.value);b=l*(Math.max(0,M)/100),t.value=b>0?P(Math.round(b)):""}else b=h(t.value);if(b=Math.max(0,Math.min(b,l)),v!=="percent"){const M=l>0?b/l*100:0;n.value=M>0&&isFinite(M)?z(M,2):""}o&&(o.textContent=P(l-b)),setTimeout(()=>{Ee=!1},50)},u=()=>i("percent"),c=()=>i("amount"),m=v=>{h(v.target.value)>0&&(v.target.value=h(v.target.value))},d=v=>{const b=h(v.target.value);v.target.value=b>0?P(b):"",i("amount")};n.addEventListener("input",u),t.addEventListener("input",c),t.addEventListener("focus",m),t.addEventListener("blur",d);const p=s.value,_=h(a.value);n.value="",t.value="",_>0?p==="percent"?(n.value=_,i("percent")):(t.value=_,t.value=P(_),i("amount")):i();const x=await Q("#discountModal");if(n.removeEventListener("input",u),t.removeEventListener("input",c),t.removeEventListener("focus",m),t.removeEventListener("blur",d),x&&!x.cancelled){const v=h(n.value),b=h(t.value),M=document.activeElement;v>0&&M===n?(s.value="percent",a.value=v):b>0?(s.value="amount",a.value=b):v>0?(s.value="percent",a.value=v):(s.value="amount",a.value=0),V()}}async function Rt(){if(!N)return;const e=document.querySelector("#hardwareModal");if(!e)return;const r=N.querySelector('[name="set_style"]'),n=r?r.value:null,t=n==="‡∏ï‡∏≤‡πÑ‡∏Å‡πà",o=n==="‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö",s=n==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå",a=e.querySelector("#trackColorGroup"),l=e.querySelector("#bracketColorGroup"),i=e.querySelector("#finialColorGroup"),u=e.querySelector("#grommetColorGroup"),c=e.querySelector("#louisValanceGroup"),m=e.querySelector("#louisTasselGroup"),d=e.querySelector("#hardwareApplyToRoom");e.querySelector('[name="modal_track_color"]').value=N.querySelector('[name="track_color"]')?.value||"‡∏Ç‡∏≤‡∏ß",e.querySelector('[name="modal_bracket_color"]').value=N.querySelector('[name="bracket_color"]')?.value||"‡∏Ç‡∏≤‡∏ß",e.querySelector('[name="modal_finial_color"]').value=N.querySelector('[name="finial_color"]')?.value||"‡∏Ç‡∏≤‡∏ß",e.querySelector('[name="modal_grommet_color"]').value=N.querySelector('[name="grommet_color"]')?.value||"‡πÄ‡∏á‡∏¥‡∏ô",e.querySelector('[name="modal_louis_valance"]').value=N.querySelector('[name="louis_valance"]')?.value||"‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå",e.querySelector('[name="modal_louis_tassels"]').value=N.querySelector('[name="louis_tassels"]')?.value||"‡∏™‡∏µ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏ú‡πâ‡∏≤",a&&(a.style.display=""),l&&(l.style.display=""),i&&(i.style.display=t?"":"none"),u&&(u.style.display=t?"":"none"),c&&(c.style.display=s?"":"none"),m&&(m.style.display=s?"":"none"),d&&(d.disabled=o||s);const p=await Q("#hardwareModal");p&&!p.cancelled&&(N.querySelector('[name="track_color"]').value=e.querySelector('[name="modal_track_color"]').value,N.querySelector('[name="bracket_color"]').value=e.querySelector('[name="modal_bracket_color"]').value,t?(N.querySelector('[name="finial_color"]').value=e.querySelector('[name="modal_finial_color"]').value,N.querySelector('[name="grommet_color"]').value=e.querySelector('[name="modal_grommet_color"]').value):s&&(N.querySelector('[name="louis_valance"]').value=e.querySelector('[name="modal_louis_valance"]').value,N.querySelector('[name="louis_tassels"]').value=e.querySelector('[name="modal_louis_tassels"]').value),K(),q("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÅ‡∏•‡πâ‡∏ß","success")),N=null}function Re(e,r){e&&(ie(J()),te(),e.classList.add("item-removing"),e.addEventListener("animationend",()=>{e.remove(),q(r),Pe(),oe(),V(),Se()},{once:!0}))}function Nt(e){if(!e)return;const r=document.querySelector(".main-header");if(!r){e.scrollIntoView({behavior:"smooth",block:"center"});return}const n=r.offsetHeight,t=16,s=(e.querySelector(".item-header")||e).getBoundingClientRect(),a=n+t,l=s.top-a;Math.abs(l)>5&&window.scrollBy({top:l,behavior:"smooth"})}function be(e){if(!e)return;const r=document.querySelector(".main-header"),n=document.querySelector(".summary-footer"),t=r?r.offsetHeight+16:80,o=n?n.offsetHeight+16:100;requestAnimationFrame(()=>{const s=e.getBoundingClientRect(),a=window.innerHeight;if(!(s.top>=t&&s.bottom<=a-o)){const i=a-t-o,u=s.height>i?"start":"center";e.scrollIntoView({behavior:"smooth",block:u})}})}function oe(){document.querySelectorAll(f.room).forEach(e=>{const r=e.querySelectorAll(".item-card:not(.item-hidden)");let n=0;const t=Array.from(r).filter(o=>!o.classList.contains("is-suspended")).length;r.forEach(o=>{const s=o.querySelector("[data-item-title]");s&&(o.classList.contains("is-suspended")?s.textContent="-":(n++,s.textContent=`${n}/${t}`))}),e.querySelectorAll(".item-card.item-hidden").forEach(o=>{const s=o.querySelector("[data-item-title]");s&&(s.textContent="-")})})}function at(){const e=document.querySelector(f.orderForm),r=document.querySelector(f.lockBtn);!e||!r||(e.classList.toggle("is-locked",Z),r.classList.toggle("is-locked",Z),r.querySelector("i").className=Z?"ph-bold ph-lock-key":"ph ph-paw-print",e.querySelectorAll('input:not([type="hidden"]), select, textarea, button:not(.unlockable):not([data-act="toggle-more-details"]):not([data-act="collapse-room"])').forEach(n=>{!n.closest(".main-header")&&!n.closest(".summary-footer")&&!n.closest(".modal-wrapper")&&(n.disabled=Z)}),document.querySelectorAll(".unlockable").forEach(n=>n.disabled=!1))}function Ht(){Z=!Z,at(),q(Z?"‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ñ‡∏π‡∏Å‡∏•‡πá‡∏≠‡∏Ñ":"‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Ñ‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏•‡πâ‡∏ß",Z?"warning":"success")}function ee(){const e=document.querySelectorAll(f.room+":not(.item-hidden)");if(e.length===0){const t=document.querySelector(f.toggleAllRoomsBtn);t&&(t.querySelector("i").className="ph ph-caret-down",t.querySelector("span").textContent="‡∏Ç‡∏¢‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î");return}const r=[...e].some(t=>t.open),n=document.querySelector(f.toggleAllRoomsBtn);n&&(n.querySelector("i").className=r?"ph ph-caret-up":"ph ph-caret-down",n.querySelector("span").textContent=r?"‡∏¢‡πà‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î":"‡∏Ç‡∏¢‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î")}function Ot(){const e=document.querySelectorAll(f.room+":not(.item-hidden)");if(e.length===0)return;const r=[...e].some(t=>t.open);e.forEach(t=>{t.open=!r});const n=document.querySelector(f.quickNavDropdown);n&&n.classList.contains("show")&&(n.classList.remove("show"),document.querySelector(f.quickNavBtn)?.setAttribute("aria-expanded","false")),setTimeout(()=>{ee(),K()},50)}function Pe(){const e=document.querySelector(f.quickNavRoomList);e&&(e.innerHTML="",document.querySelectorAll(f.room).forEach(r=>{const n=r.querySelector(f.roomNameInput)?.value||"‡∏´‡πâ‡∏≠‡∏á",t=document.createElement("a");t.href=`#${r.id}`,t.dataset.jumpTo=r.id,t.innerHTML=`<i class="ph ph-share-fat"></i> ${T(n)||"‡∏´‡πâ‡∏≠‡∏á (‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠)"}`,e.appendChild(t)}))}function Ne(e){const r=document.getElementById("quickNavBtnText");r&&(e?r.textContent=e.querySelector('input[name="room_name"]')?.value||"...":r.textContent="‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏´‡πâ‡∏≠‡∏á")}function Se(){if(we&&we.disconnect(),!document.getElementById("quickNavBtnText"))return;const r={root:null,rootMargin:"-60px 0px -150px 0px",threshold:0},n=o=>{const s=o.filter(a=>a.isIntersecting).sort((a,l)=>a.target.getBoundingClientRect().top-l.target.getBoundingClientRect().top);s.length>0&&Ne(s[0].target)};we=new IntersectionObserver(n,r),document.querySelectorAll(f.room).forEach(o=>we.observe(o));const t=Array.from(document.querySelectorAll(f.room));if(t.length>0){t.sort((s,a)=>s.getBoundingClientRect().top-a.getBoundingClientRect().top);const o=t.find(s=>s.getBoundingClientRect().bottom>60);Ne(o||t[0])}else Ne(null)}function Ie(e){if(!e)return;const r=e.closest(".form-group-with-favorites")?.querySelector(".btn-favorite");if(!r)return;const n=e.dataset.favoriteType,t=e.value;r.classList.toggle("is-favorite",ze(n,t))}function ke(e,r=null){if(!e)return;const n=e.querySelector(".item-details-more"),t=e.querySelector('[data-act="toggle-more-details"]'),o=t?.parentElement;if(!n||!t||!o)return;const s=n.classList.contains("show"),a=r!==null?r:!s;if(s===a)return;n.classList.toggle("show",a),t.classList.toggle("expanded",a);const l=t.querySelector("i");l&&(l.className=a?"ph ph-caret-up":"ph ph-caret-down");const i=t.querySelector("span");if(i&&(i.textContent=a?"‡∏¢‡πà‡∏≠‡∏ô‡πâ‡∏≠‡∏¢‡∏•‡∏á":"‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°"),a)n.appendChild(o),setTimeout(()=>Nt(e),100);else{const u=e.querySelector(".item-grid");u&&u.appendChild(o)}}function pe(e={}){const r=document.querySelector(f.roomsContainer);if(!r)return null;Object.keys(e).length===0&&(ie(J()),te());const n=tt(e);return n?(r.appendChild(n),Object.keys(e).length===0&&(n.classList.add("item-created"),be(n),n.querySelector('input[name="room_name"]')?.focus()),Pe(),ee(),Se(),Object.keys(e).length===0&&K(),n):null}async function nt(e,r=null){const n=document.querySelector("#itemTypeModal");if(!n)return null;n.querySelector("#itemTypeModalTitle").textContent=e;let t=r||"set";r&&!H[r]&&(t="set");const o=n.querySelector(`input[name="item_type_option"][value="${t}"]`);if(o)o.checked=!0;else{const l=n.querySelector('input[name="item_type_option"][value="set"]');l&&(l.checked=!0)}const s=await Q("#itemTypeModal");if(!s||s.cancelled)return null;const a=n.querySelector('input[name="item_type_option"]:checked');return a?a.value:null}async function Dt(e,r){if(!r||!e||!H[e])return;const n=r.getItemsContainer();if(!n)return;ie(J()),te();let t;if(e==="set")t=Me();else if(e==="wallpaper")t=Be();else if(H[e].templateId==="#areaBasedTpl")t=Ce(e);else return;t&&(n.appendChild(t),t.classList.add("item-created"),be(t),t.querySelector('input:not([type="hidden"]), select, textarea')?.focus(),oe(),V())}async function jt(e){if(!e)return;const r=e.dataset.type,n=await nt("‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£",r);if(!n||n===r||!await ae("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á","‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà ‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?"))return;ie(J()),te();let t;if(n==="set")t=Me();else if(n==="wallpaper")t=Be();else if(H[n]?.templateId==="#areaBasedTpl")t=Ce(n);else return;t&&(e.replaceWith(t),t.classList.add("item-created"),be(t),t.querySelector('input:not([type="hidden"]), select, textarea')?.focus(),oe(),V(),q("‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß","success"))}const V=_e(()=>{let e=0;document.querySelectorAll(f.room).forEach(u=>{let c=0,m=0;const d=u.classList.contains("is-suspended");d||(u.querySelectorAll(".item-card:not(.is-suspended)").forEach(p=>{const _=h(p.dataset.totalPrice);_>0&&(c+=_,m++)}),e+=c),typeof u.updateBrief=="function"&&(d?u.updateBrief("(‡∏£‡∏∞‡∏á‡∏±‡∏ö‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß)"):m>0?u.updateBrief(`<span>${m}</span> &bull; ${P(c)} ‡∏ö‡∏≤‡∏ó`):u.updateBrief("<span>0</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£"))});const r=document.querySelector("#discount_type"),n=document.querySelector("#discount_value"),t=r?r.value:"amount",o=n?h(n.value):0;let s=0;o>0&&(s=t==="percent"?e*(o/100):o,s=Math.min(e,s));const a=e-s,l=document.querySelector("#grandTotal"),i=document.querySelector("#originalTotal");l&&(l.textContent=P(a)),i&&(s>0?(i.textContent=P(e),i.dataset.rawTotal=e,i.style.display="block"):(i.style.display="none",i.dataset.rawTotal="")),fe(),K()},200);async function Ge(e,r=!1){if(!e){q("‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á","error");return}if(e.favorites)if(r){const u=document.querySelector("#favoritesConflictModal");if(u){const c=u.querySelector('input[name="fav_conflict_option"][value="merge"]');c&&(c.checked=!0);const m=await Q("#favoritesConflictModal");if(!m||m.cancelled){q("‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤","warning");return}const d=u.querySelector('input[name="fav_conflict_option"]:checked').value;let p=0;switch(d){case"overwrite":Ve(e.favorites)&&q("‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à","success");break;case"merge":p=He(e.favorites),q(`‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡πÄ‡∏û‡∏¥‡πà‡∏° ${p} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà)`,"success");break;case"skip":q("‡∏Ç‡πâ‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î","default");break}}else He(e.favorites)}else Ve(e.favorites);const n=document.querySelector(f.roomsContainer);if(!n)return;n.innerHTML="";const t=document.querySelector("#customer_name"),o=document.querySelector("#customer_phone"),s=document.querySelector("#customer_address"),a=document.querySelector("#customerDetailsCard");t&&(t.value=e.customer_name||""),o&&(o.value=e.customer_phone||""),s&&(s.value=e.customer_address||""),a&&(a.open=e.customer_card_open??!0);const l=document.querySelector("#discount_type"),i=document.querySelector("#discount_value");if(e.discount&&l&&i?(l.value=e.discount.type||"amount",i.value=e.discount.value||0):l&&i&&(l.value="amount",i.value=0),!Array.isArray(e.rooms)){q("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡πâ‡∏≠‡∏á‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå","warning"),n.children.length===0&&pe();return}for(const u of e.rooms){const c=tt(u);if(!c)continue;n.appendChild(c);const m=c.getItemsContainer();if(m&&Array.isArray(u.items))for(const d of u.items){d.type==="deco"&&d.deco_type&&(d.code=d.deco_code,d.width_m=d.deco_width_m,d.height_m=d.deco_height_m,d.price_sqyd=d.deco_price_sqyd,d.notes=d.deco_notes,delete d.deco_type,delete d.deco_code,delete d.deco_width_m,delete d.deco_height_m,delete d.deco_price_sqyd,delete d.deco_notes);let p;if(d.type==="set")p=Me(d);else if(d.type==="wallpaper")p=Be(d);else if(H[d.type]?.templateId==="#areaBasedTpl")p=Ce(d.type,d);else continue;p&&m.appendChild(p)}}document.querySelectorAll("input[data-favorite-type]").forEach(Ie),oe(),Pe(),ee(),Se(),te(),V(),r&&q("‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à","success")}async function Wt(e,r){const n=document.querySelector(f.printableContent);if(!n||!e){q("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£","error");return}const t=document.title;if(r==="direct"){q("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á PDF...","default");let o;try{typeof window.html2pdf>"u"&&(q("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏•‡∏ö‡∏£‡∏≤‡∏£‡∏µ PDF...","default"),await Bt("https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js")),o=document.createElement("div"),o.style.position="fixed",o.style.left="-300mm",o.style.top="0",o.style.width="210mm",o.style.background="#fff",o.innerHTML=e,document.body.appendChild(o),await new Promise(a=>setTimeout(a,300));const s={margin:0,filename:`${t}.pdf`,image:{type:"jpeg",quality:.98},html2canvas:{scale:2,useCORS:!0,logging:!1,width:o.querySelector(".pdf-page")?.scrollWidth||794,windowWidth:o.querySelector(".pdf-page")?.scrollWidth||794},jsPDF:{unit:"mm",format:"a4",orientation:"portrait"}};await window.html2pdf().from(o).set(s).save(),q("‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î PDF ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à","success")}catch(s){console.error("PDF Generation Error:",s),q("‡∏™‡∏£‡πâ‡∏≤‡∏á PDF ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß, ‡πÇ‡∏õ‡∏£‡∏î‡∏•‡∏≠‡∏á‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 2 (‡∏û‡∏¥‡∏°‡∏û‡πå)","error")}finally{o&&document.body.contains(o)&&document.body.removeChild(o)}}else r==="print"&&(n.innerHTML=e,setTimeout(()=>{window.print(),setTimeout(()=>{n.innerHTML=""},1e3)},dt))}function Gt(e){if(!e||!e.html){q("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå HTML","error");return}try{const r=`<!DOCTYPE html><html lang="th"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>${e.fileName}</title><link rel="stylesheet" href="./src/styles/main.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.1/src/bold/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.1/src/fill/style.css"><style>body { background-color: #eee; } #printable-content { display: block !important; max-width: 210mm; margin: 10mm auto; } .pdf-page { border: 1px solid #ccc; box-shadow: 0 0 10px rgba(0,0,0,0.1); margin-bottom: 10mm; background: #fff; page-break-inside: avoid; } .pdf-page-content { padding: 12mm; } @media print { body { background-color: #fff; } #printable-content { max-width: 100%; margin: 0; } .pdf-page { border: none; box-shadow: none; margin-bottom: 0; page-break-after: always; } .pdf-page:last-child { page-break-after: avoid; } } i.ph { vertical-align: middle; }</style></head><body><div id="printable-content">${e.html}</div></body></html>`,n=new Blob([r],{type:"text/html;charset=utf-8"}),t=URL.createObjectURL(n),o=document.createElement("a");o.href=t,o.download=`${e.fileName}.html`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(t),q("‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå HTML ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à","success")}catch(r){console.error("HTML Export Error:",r),q("‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå HTML ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß","error")}}function Vt(e){const r=e.closest(".item-card");if(!r)return;const n=h(e.value);let t;const o=e.getAttribute("name");if(o==="set_price_per_m")t=r.querySelector('input[name="fabric_code"]');else if(o==="sheer_price_per_m")t=r.querySelector('input[name="sheer_fabric_code"]');else if(o==="wallpaper_price_roll")t=r.querySelector('input[name="wallpaper_code"]');else if(o==="area_price_sqyd")t=r.querySelector('input[name="area_code"]');else return;if(t&&t.value.trim()){const s=t.dataset.favoriteType,a=t.value.trim(),l=Xe(s,a);if(l&&l.price!==n){const i=t.closest(".form-group-with-favorites")?.querySelector(".btn-favorite");i?.classList.contains("is-favorite")&&(qe(s,a,l.price),i.classList.remove("is-favorite"),q(`‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å Favorite '${a}' ‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏Ñ‡∏≤‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô`,"warning"),K())}}}function Ut(e){const{roomId:r,itemIndex:n}=e.dataset;if(!r||n===void 0)return;const t=document.getElementById("lookbookModal");t&&t.classList.remove("visible");const o=document.getElementById(r);if(!o){q("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£","error");return}const a=Array.from(o.querySelectorAll(".item-card:not(.item-hidden)"))[parseInt(n,10)];if(!a){q("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£","error");return}o.open=!0,ee(),setTimeout(()=>{a.scrollIntoView({behavior:"smooth",block:"center"}),a.classList.add("scrolling-jump"),setTimeout(()=>a.classList.remove("scrolling-jump"),2500)},150)}function st(e){if(!re)return;const r=re.closest(".item-card");if(!r)return;const n=e.dataset.code,t=h(e.dataset.price);re.value=n,re.classList.add("input-highlight"),setTimeout(()=>re.classList.remove("input-highlight"),1200);const o=re.dataset.favoriteType;let s;o==="fabric"?s="set_price_per_m":o==="sheer"?s="sheer_price_per_m":o==="wallpaper"?s="wallpaper_price_roll":s="area_price_sqyd";const a=r.querySelector(`[name="${s}"]`);a&&t>0&&(a.tagName==="SELECT"?a.value=t:a.value=P(t),a.classList.add("input-highlight"),setTimeout(()=>a.classList.remove("input-highlight"),1200)),Ie(re),(a||re).dispatchEvent(new Event("input",{bubbles:!0,cancelable:!0})),document.querySelector("#favoritesModal").classList.remove("visible")}async function lt(e){re=e;const r=e.dataset.favoriteType;if(!r)return;const n=document.querySelector("#favoritesModal"),t=n.querySelector("#favoritesModalTitle"),o=n.querySelector("#favoritesModalBody"),s=n.querySelector("#favSearchInput"),a=n.querySelector("#favoritesModalManageBtn"),l=document.querySelector("#favSelectorItemTpl"),i=H[r]?.name||r;t.textContent=`‡πÄ‡∏•‡∏∑‡∏≠‡∏Å '${T(i)}'`;const c=ne()[r]||[];c.length>0?o.innerHTML=c.map(p=>l.innerHTML.replace(/{CODE}/g,T(p.code)).replace(/{PRICE}/g,p.price>0?P(p.price):"-").replace(/{RAW_PRICE}/g,p.price)).join(""):o.innerHTML='<p class="empty-state">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ</p>',s.value="";const m=()=>{const p=s.value.toLowerCase();o.querySelectorAll(".fav-selector-item").forEach(_=>{const x=_.dataset.code.toLowerCase();_.classList.toggle("is-hidden",!x.includes(p))})};s.addEventListener("input",m);const d=p=>{const _=p.target.closest(".fav-selector-item");_&&(st(_),o.removeEventListener("click",d),s.removeEventListener("input",m))};o.addEventListener("click",d),a.onclick=async()=>{n.classList.remove("visible"),await Yt(r),ge&&await lt(e)},await Q("#favoritesModal",()=>{s.removeEventListener("input",m),o.removeEventListener("click",d)})}function xe(e){const r=document.querySelector("#favManagerBody"),n=document.querySelector("#favManagerItemTpl"),o=ne()[e]||[];if(!r||!n)return;o.length===0?r.innerHTML='<p class="empty-state">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ</p>':r.innerHTML=o.map(l=>n.innerHTML.replace(/{CODE}/g,T(l.code)).replace(/{PRICE}/g,P(l.price)).replace(/{RAW_PRICE}/g,l.price)).join(""),W=null;const s=document.querySelector('#favManagerModal [data-act="edit-selected-fav"]'),a=document.querySelector('#favManagerModal [data-act="del-selected-fav"]');s&&(s.disabled=!0),a&&(a.disabled=!0)}async function Yt(e){const r=document.querySelector("#favManagerModal");if(!r||!e)return;const n=H[e]?.name||e;r.dataset.currentType=e,ge=!1,W=null,document.querySelector("#favManagerTitle").textContent=`‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ '${T(n)}'`,xe(e),await Q("#favManagerModal")}function Jt(e){if(!e||!e.matches(f.itemCard))return null;const r=e.dataset.type;if(!r)return null;let n={type:r,is_suspended:e.classList.contains("is-suspended")};try{return r==="set"?Object.assign(n,{width_m:h(e.querySelector(f.setWidthInput)?.value),height_m:h(e.querySelector(f.setHeightInput)?.value),style:e.querySelector(f.setStyleSelect)?.value||"",fabric_variant:e.querySelector(f.setFabricVariantSelect)?.value||"",price_per_m_raw:h(e.querySelector(f.setPricePerMSelect)?.value),sheer_price_per_m:h(e.querySelector(f.setSheerPricePerMSelect)?.value),louis_price_per_m:h(e.querySelector('select[name="louis_price_per_m"]')?.value),fabric_code:e.querySelector(f.setFabricCodeInput)?.value||"",sheer_fabric_code:e.querySelector(f.setSheerCodeInput)?.value||"",opening_style:e.querySelector(f.setOpeningStyleSelect)?.value||"",adjustment_side:e.querySelector(f.setAdjustmentSideSelect)?.value||"‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ß‡∏≤",track_color:e.querySelector(f.setTrackColorInput)?.value||"‡∏Ç‡∏≤‡∏ß",bracket_color:e.querySelector(f.setBracketColorInput)?.value||"‡∏Ç‡∏≤‡∏ß",finial_color:e.querySelector(f.setFinialColorInput)?.value||"‡∏Ç‡∏≤‡∏ß",grommet_color:e.querySelector(f.setGrommetColorInput)?.value||"‡πÄ‡∏á‡∏¥‡∏ô",louis_valance:e.querySelector('input[name="louis_valance"]')?.value||"‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå",louis_tassels:e.querySelector('input[name="louis_tassels"]')?.value||"‡∏™‡∏µ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏ú‡πâ‡∏≤",notes:e.querySelector(f.setNotesInput)?.value||""}):r==="wallpaper"?Object.assign(n,{height_m:h(e.querySelector(f.wallHeightInput)?.value),wallpaper_code:e.querySelector(f.wallCodeInput)?.value||"",price_per_roll:h(e.querySelector(f.wallPriceRollInput)?.value),install_cost_per_roll:h(e.querySelector(f.wallInstallCostInput)?.value),notes:e.querySelector(f.wallNotesInput)?.value||"",widths:Array.from(e.querySelectorAll(f.wallWidthInput)).map(t=>h(t.value))}):e.matches(f.areaBasedItem)&&(Object.assign(n,{width_m:h(e.querySelector(f.areaWidthInput)?.value),height_m:h(e.querySelector(f.areaHeightInput)?.value),price_sqyd:h(e.querySelector(f.areaPriceSqydInput)?.value),code:e.querySelector(f.areaCodeInput)?.value||"",notes:e.querySelector(f.areaNotesInput)?.value||""}),(r==="partition"||r==="pleated_screen")&&(n.opening_style=e.querySelector('select[name="opening_style"]')?.value||"‡πÅ‡∏¢‡∏Å‡∏Å‡∏•‡∏≤‡∏á"),["wooden_blind","roller_blind","vertical_blind","aluminum_blind"].includes(r)&&(n.adjustment_side=e.querySelector('select[name="adjustment_side"]')?.value||"‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ß‡∏≤")),n}catch(t){return console.error("Failed to extract item data:",t,e),null}}function Qt(e){if(!e)return;const r=Jt(e);if(!r){q("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÑ‡∏î‡πâ","error");return}const n=e.closest(f.room);if(!n||!n.getItemsContainer())return;ie(J()),te();let o;if(r.type==="set")o=Me(r);else if(r.type==="wallpaper")o=Be(r);else if(H[r.type]?.templateId==="#areaBasedTpl")o=Ce(r.type,r);else{q("‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£","error");return}if(o){e.after(o),o.classList.add("item-created");const s=e.querySelector(f.itemDetailsMore);s&&s.classList.contains("show")&&ke(o,!0),be(o),oe(),V(),q("‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß","success")}}function Kt(){const e=document.querySelector(f.orderForm),r=document.querySelector(f.fileImporter),n=document.querySelector("#favImporter"),t=document.querySelector(f.menuDropdown),o=document.querySelector(f.quickNavDropdown),s=document.querySelector(f.menuBtn),a=document.querySelector(f.quickNavBtn);if(e.addEventListener("item-update",V),e.addEventListener("input",l=>{if(Z){l.preventDefault();return}l.target.closest("#customerInfo")&&K();const i=l.target.closest("input[data-favorite-type]");if(i&&Ie(i),l.target.matches(f.roomNameInput)){const c=l.target.closest(".room-card")?.querySelector("[data-room-name-display]");c&&(c.textContent=l.target.value||"‡∏´‡πâ‡∏≠‡∏á"),Pe(),Se(),_e(K,300)()}l.target.matches('input[name$="_m"], input[name$="price_sqyd"], input[name$="price_roll"], input[name$="install_cost"]')&&V()}),e.addEventListener("change",l=>{if(Z){l.preventDefault();return}l.target.matches("select")&&V()}),e.addEventListener("blur",l=>{const i=l.target;i.matches('[name$="_price_sqyd"], [name$="_price_roll"], [name$="_install_cost"]')?(Vt(i),i.value=h(i.value)>0?P(h(i.value)):""):i.matches('input[name$="_m"], input[name^="wall_width_m"]')&&(i.value=le(i.value)),i.matches('input:not([type="hidden"]), select, textarea')&&K()},!0),e.addEventListener("focusin",l=>{const i=l.target;if(i.matches('[name$="_price_sqyd"], [name$="_price_roll"], [name$="_install_cost"]')&&h(i.value)>0&&(i.value=h(i.value)),i.matches('input:not([type="hidden"]), select, textarea')){const u=document.querySelector(".main-header"),c=document.querySelector(".summary-footer"),m=u?u.offsetHeight+16:80,d=c?c.offsetHeight+16:100,p=window.innerHeight,_=i.getBoundingClientRect();if(_.top<m||_.bottom>p-d){const v=i.closest(".item-card, .room-card");v&&be(v)}}},!0),e.addEventListener("keydown",l=>{if(Z){l.preventDefault();return}const i=l.target;l.key==="Enter"&&i.matches("input, select")&&!i.closest(".modal-wrapper")&&l.preventDefault()}),document.addEventListener("click",async l=>{l.target.closest(".menu-container")||(t?.classList.remove("show"),s?.setAttribute("aria-expanded","false"),o?.classList.remove("show"),a?.setAttribute("aria-expanded","false")),l.target.closest(".room-options-container")||document.querySelectorAll(".room-options-menu.show").forEach(d=>d.classList.remove("show"));const i=l.target.closest(".summary-tag[data-filter-type]");if(i&&i.closest("#overviewModal")){const d=i.dataset.filterType,p=i.textContent.trim().replace(/\s*\d+\s*$/,""),_=document.querySelector("#overviewModal");_&&_.classList.remove("visible"),At(d,p);return}const u=l.target.closest(".fav-manager-item");if(u){const d=u.closest("#favManagerModal"),p=d?.querySelector(".fav-manager-item.is-selected");p&&p.classList.remove("is-selected"),p!==u?(u.classList.add("is-selected"),W={code:u.dataset.code,price:h(u.dataset.price)}):W=null,d&&(d.querySelector('[data-act="edit-selected-fav"]').disabled=!W,d.querySelector('[data-act="del-selected-fav"]').disabled=!W);return}const c=l.target.closest(".fav-selector-item");if(c){st(c);return}const m=l.target.closest("[data-act]");if(m){const d=m.dataset.act,p=m.closest(".item-card"),_=m.closest(".room-card"),x=["toggle-more-details","collapse-room","show-discount-modal","show-suspended-items","clear-filter","close-modal","jump-to-item"];if(Z&&!m.closest(".unlockable")&&!x.includes(d)){q("‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ñ‡∏π‡∏Å‡∏•‡πá‡∏≠‡∏Ñ‡∏≠‡∏¢‡∏π‡πà","warning");return}switch(["toggle-more-details","close-modal","collapse-room"].includes(d)||l.preventDefault(),l.stopPropagation(),d){case"show-discount-modal":Ft();break;case"show-suspended-items":Fe();break;case"clear-filter":rt();break;case"add-room":pe();break;case"add-item":if(_){const v=await nt("‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà");v&&Dt(v,_)}break;case"collapse-room":_&&(_.open=!1,setTimeout(()=>{ee(),K()},50));break;case"toggle-room-menu":m.nextElementSibling?.classList.toggle("show");break;case"toggle-suspend-room":_&&(_.classList.toggle("is-suspended"),m.closest(".room-options-menu")?.classList.remove("show"),V(),me==="suspended"?Fe():fe());break;case"clear-room":_&&await ae("‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á","?")&&(ie(J()),te(),_.getItemsContainer().innerHTML="",oe(),V(),q("‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß","success"));break;case"del-room":_&&await ae("‡∏•‡∏ö‡∏´‡πâ‡∏≠‡∏á","?")&&Re(_,"‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß");break;case"del-item":p&&await ae("‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£","?")&&Re(p,"‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß");break;case"duplicate-item":p&&Qt(p);break;case"toggle-suspend":p&&(p.classList.toggle("is-suspended"),V(),me==="suspended"?Fe():fe());break;case"change-type":p&&jt(p);break;case"toggle-more-details":p&&!p.querySelector(".item-details-more")?.classList.contains("show")&&document.querySelectorAll(".item-details-more.show").forEach(v=>{v.closest(".item-card")!==p&&ke(v.closest(".item-card"),!1)}),ke(p);break;case"open-hardware-modal":N=p,N&&Rt();break;case"apply-hardware-to-room":{const v=m.closest("#hardwareModal"),b=N?.closest(f.room);if(!v||!b||!N)break;const M=N.querySelector('[name="set_style"]');if(M?.value==="‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö"||M?.value==="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"){q("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡∏°‡πà‡∏≤‡∏ô‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå‡πÑ‡∏î‡πâ","warning");break}const A=v.querySelector('[name="modal_track_color"]').value,y=v.querySelector('[name="modal_bracket_color"]').value,g=v.querySelector('[name="modal_finial_color"]').value,k=v.querySelector('[name="modal_grommet_color"]').value;b.querySelectorAll('.set-item:not(:has(select[name="set_style"][value="‡∏°‡πà‡∏≤‡∏ô‡∏û‡∏±‡∏ö"])):not(:has(select[name="set_style"][value="‡∏´‡∏•‡∏∏‡∏¢‡∏™‡πå"]))').forEach($=>{$.querySelector('[name="track_color"]').value=A,$.querySelector('[name="bracket_color"]').value=y,$.querySelector('select[name="set_style"]')?.value==="‡∏ï‡∏≤‡πÑ‡∏Å‡πà"&&($.querySelector('[name="finial_color"]').value=g,$.querySelector('[name="grommet_color"]').value=k)}),K(),q("‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ô‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß","success");break}case"add-wall":{const v=m.closest(".walls-section")?.querySelector("[data-walls-container]");if(v){const b=De();b&&(v.appendChild(b),b.querySelector("input")?.focus(),V())}break}case"del-wall":{const v=m.closest(".wall-input-row");v&&await ae("‡∏•‡∏ö‡∏ú‡∏ô‡∏±‡∏á","?")&&Re(v,"‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß");break}case"show-favorites":{const v=m.closest(".form-group-with-favorites")?.querySelector("input[data-favorite-type]");v&&lt(v);break}case"toggle-favorite":{const b=m.closest(".form-group-with-favorites")?.querySelector("input[data-favorite-type]");if(!b||!p)break;const M=b.dataset.favoriteType,A=b.value;let y=0,g;if(b.name==="fabric_code"?g=p.querySelector('[name="set_price_per_m"]'):b.name==="sheer_fabric_code"?g=p.querySelector('[name="sheer_price_per_m"]'):b.name==="wallpaper_code"?g=p.querySelector('[name="wallpaper_price_roll"]'):b.name==="area_code"&&(g=p.querySelector('[name="area_price_sqyd"]')),y=h(g?.value),!A.trim()){q("‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏´‡∏±‡∏™","warning");break}if(!["fabric","sheer"].includes(M)&&y<=0){q("‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏Ñ‡∏≤","warning");break}const k=qe(M,A,y);k!==null&&(m.classList.toggle("is-favorite",k),q(k?"‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß":"‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß","success"),K());break}case"add-new-fav-form":{const b=m.closest("#favManagerModal")?.dataset.currentType;if(!b)break;const M=document.querySelector("#favAddModal");if(!M)break;M.querySelector("h3").textContent=`‡πÄ‡∏û‡∏¥‡πà‡∏° '${H[b]?.name||b}'`;const A=M.querySelector('[name="fav_code_add"]'),y=M.querySelector('[name="fav_price_add"]');A.value="",y.value="";const g=await Q("#favAddModal");if(g&&!g.cancelled){const k=A.value.trim(),$=h(y.value);k?qe(b,k,$)!==null?(ge=!0,xe(b),q("‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß","success")):q("‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß","error"):q("‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏´‡∏±‡∏™","warning")}break}case"edit-selected-fav":{if(!W)break;const b=m.closest("#favManagerModal")?.dataset.currentType;if(!b)break;const M=document.querySelector("#favEditModal");if(!M)break;M.querySelector("h3").textContent=`‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç '${W.code}'`;const A=M.querySelector('[name="fav_code_edit"]'),y=M.querySelector('[name="fav_price_edit"]');A.value=W.code,y.value=W.price>0?W.price:"";const g=await Q("#favEditModal");if(g&&!g.cancelled){const k=A.value.trim(),$=h(y.value);k?(k!==W.code&&Oe(b,W.code),qe(b,k,$),ge=!0,xe(b),q("‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î‡πÅ‡∏•‡πâ‡∏ß","success")):q("‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏´‡∏±‡∏™","warning")}break}case"del-selected-fav":{if(!W)break;const b=m.closest("#favManagerModal")?.dataset.currentType;if(!b)break;await ae("‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î",`"${W.code}"?`)&&(Oe(b,W.code)?(ge=!0,xe(b),q("‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß","success")):q("‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß","error"));break}case"jump-to-item":Ut(m);break}}else{const d=l.target.closest("summary");d&&d.closest("details.card")&&setTimeout(()=>{ee(),K()},50)}}),document.querySelector("#undoBtn")?.addEventListener("click",l=>{l.preventDefault(),Pt()}),document.querySelector(f.lockBtn)?.addEventListener("click",l=>{l.preventDefault(),Ht()}),document.querySelector(f.toggleAllRoomsBtn)?.addEventListener("click",l=>{l.preventDefault(),Ot()}),a&&o){a.addEventListener("click",i=>{i.stopPropagation(),t?.classList.remove("show");const u=!o.classList.contains("show");o.classList.toggle("show",u),a.setAttribute("aria-expanded",u),u&&s?.setAttribute("aria-expanded","false")}),document.querySelector(f.quickNavRoomList)?.addEventListener("click",i=>{const u=i.target.closest("a[data-jump-to]");if(u){i.preventDefault();const c=u.dataset.jumpTo,m=document.getElementById(c);m&&(m.open=!0,m.scrollIntoView({behavior:"smooth",block:"center"}),m.classList.add("scrolling-jump"),setTimeout(()=>m.classList.remove("scrolling-jump"),2500),setTimeout(ee,100)),o.classList.remove("show"),a.setAttribute("aria-expanded","false")}});const l=document.querySelector("#addRoomQuickNavBtn");if(l){const i=mt(pe,700);l.addEventListener("click",u=>{u.stopPropagation(),i(),o.classList.remove("show"),a.setAttribute("aria-expanded","false")})}}s&&t&&s.addEventListener("click",l=>{l.stopPropagation(),o?.classList.remove("show");const i=!t.classList.contains("show");t.classList.toggle("show",i),s.setAttribute("aria-expanded",i),i&&a?.setAttribute("aria-expanded","false")}),document.querySelector("#themeToggleBtn")?.addEventListener("click",l=>{l.preventDefault(),Ct(),t?.classList.remove("show"),s?.setAttribute("aria-expanded","false")}),document.querySelector("#overviewBtn")?.addEventListener("click",async l=>{l.preventDefault(),t?.classList.remove("show"),s?.setAttribute("aria-expanded","false");const i=J(),u=document.querySelector("#overviewModalHeader"),c=document.querySelector("#overviewModalBody");if(u&&c){const m=i.rooms.reduce((_,x)=>_+(x.is_suspended?0:(x.items||[]).filter(v=>!v.is_suspended&&(F.calculateSetPrice(v)?.total>0||F.calculateWallpaperPrice(v)?.total>0||F.calculateAreaBasedPrice(v)?.total>0)).length),0),d=document.querySelector(f.grandTotal)?.textContent||"0",p=i.rooms.filter(_=>!_.is_suspended&&_.items?.some(x=>!x.is_suspended)).length;u.innerHTML=`<div class="overview-stats-grid"><div class="overview-stat-card"><i class="ph-bold ph-map-pin-line"></i><div class="stat-value">${p}</div><div class="stat-label">‡∏´‡πâ‡∏≠‡∏á</div></div><div class="overview-stat-card"><i class="ph-bold ph-stack"></i><div class="stat-value">${m}</div><div class="stat-label">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div></div><div class="overview-stat-card"><i class="ph-bold ph-coins"></i><div class="stat-value">${d}</div><div class="stat-label">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°</div></div></div>`,c.innerHTML=Tt(i),Q("#overviewModal")}}),document.querySelector("#copyTextBtn")?.addEventListener("click",async l=>{l.preventDefault(),t?.classList.remove("show"),s?.setAttribute("aria-expanded","false");const i=document.querySelector(f.copyOptionsModal);if(!i)return;i.querySelector('input[name="copy_option"][value="customer"]').checked=!0;const u=await Q(f.copyOptionsModal);if(u&&!u.cancelled){const c=i.querySelector('input[name="copy_option"]:checked').value,m=It(J(),c);try{await navigator.clipboard.writeText(m),q("‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!","success")}catch{q("‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß","error")}}}),document.querySelector("#visualReportsBtn")?.addEventListener("click",async l=>{l.preventDefault(),t?.classList.remove("show"),s?.setAttribute("aria-expanded","false");const i=document.querySelector("#visualReportsModal");if(!i)return;i.querySelector('input[name="report_type_option"][value="lookbook"]').checked=!0;const u=await Q("#visualReportsModal");if(u&&!u.cancelled){const c=i.querySelector('input[name="report_type_option"]:checked').value;if(c==="lookbook"){const m=J(),d=Mt(m),p=document.querySelector("#lookbookModalBody");d&&p?(p.innerHTML=d,Q("#lookbookModal")):q("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•","warning")}else q(`'${c}' ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°`,"default")}}),document.querySelector(f.exportPdfBtn)?.addEventListener("click",async l=>{l.preventDefault(),t?.classList.remove("show"),s?.setAttribute("aria-expanded","false");const i=await Et();if(!i)return;const u=J(),c=Lt(u,{vatRate:i.vatOption==="include"?O.baseVatRate:0,pageBreakBuffer:i.pageBreakBuffer,showDetails:i.showDetails});if(!c){q("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£","warning");return}i.exportMethod==="html"?Gt(c):Wt(c.html,i.exportMethod)}),document.querySelector(f.submitBtn)?.addEventListener("click",async l=>{if(l.preventDefault(),t?.classList.remove("show"),s?.setAttribute("aria-expanded","false"),await ae("‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•","?")){const i=J();if(!i.customer_name&&!i.customer_phone){q("‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠/‡πÄ‡∏ö‡∏≠‡∏£‡πå","warning");return}q("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á...","default");try{const u=await fetch(ut,{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});u.ok?q("‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß!","success"):q(`‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ${u.status}`,"error")}catch{q("‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î","error")}}}),document.querySelector(f.importBtn)?.addEventListener("click",l=>{l.preventDefault(),t?.classList.remove("show"),s?.setAttribute("aria-expanded","false"),r?.click()}),r?.addEventListener("change",l=>{const i=l.target.files?.[0];if(!i)return;const u=new FileReader;u.onload=async c=>{try{const m=JSON.parse(c.target.result);if(m&&typeof m=="object")await Ge(m,!0);else throw new Error("Invalid JSON")}catch(m){q("‡πÑ‡∏ü‡∏•‡πå JSON ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å","error"),console.error(m)}},u.readAsText(i),l.target.value=null}),document.querySelector(f.exportBtn)?.addEventListener("click",l=>{l.preventDefault(),t?.classList.remove("show"),s?.setAttribute("aria-expanded","false");try{const i=J(),u=JSON.stringify(i,null,4),c=new Blob([u],{type:"application/json"}),m=URL.createObjectURL(c),d=document.createElement("a"),p=new Date,_=`${p.getFullYear()}${(p.getMonth()+1).toString().padStart(2,"0")}${p.getDate().toString().padStart(2,"0")}`,x=`${p.getHours().toString().padStart(2,"0")}${p.getMinutes().toString().padStart(2,"0")}`,v=Ke(i.customer_name||"data");d.href=m,d.download=`MTR-${_}${x}-${v}.json`,d.click(),URL.revokeObjectURL(m),q("Export ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à","success")}catch{q("Export ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß","error")}}),document.querySelector("#importFavsBtn")?.addEventListener("click",l=>{l.preventDefault(),t?.classList.remove("show"),s?.setAttribute("aria-expanded","false"),n?.click()}),n?.addEventListener("change",l=>{const i=l.target.files?.[0];if(!i)return;const u=new FileReader;u.onload=c=>{try{const m=JSON.parse(c.target.result),d=He(m);d>0?q(`‡πÄ‡∏û‡∏¥‡πà‡∏° ${d} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`,"success"):q("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà","default"),document.querySelectorAll("input[data-favorite-type]").forEach(Ie)}catch{q("‡πÑ‡∏ü‡∏•‡πå JSON ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å","error")}},u.readAsText(i),l.target.value=null}),document.querySelector("#exportFavsBtn")?.addEventListener("click",l=>{l.preventDefault(),t?.classList.remove("show"),s?.setAttribute("aria-expanded","false");try{const i=ne();if(Object.values(i).every(_=>_.length===0)){q("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£","warning");return}const u=JSON.stringify(i,null,4),c=new Blob([u],{type:"application/json"}),m=URL.createObjectURL(c),d=document.createElement("a"),p=new Date().toISOString().slice(0,10).replace(/-/g,"");d.href=m,d.download=`MTR-Favorites-${p}.json`,d.click(),URL.revokeObjectURL(m),q("Export ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à","success")}catch{q("Export ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß","error")}}),document.querySelector(f.clearItemsBtn)?.addEventListener("click",async l=>{if(l.preventDefault(),t?.classList.remove("show"),s?.setAttribute("aria-expanded","false"),await ae("‡∏•‡πâ‡∏≤‡∏á‡∏ó‡∏∏‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£","?")){ie(J()),te(),document.querySelectorAll(f.room).forEach(c=>{c.getItemsContainer().innerHTML=""});const i=document.querySelector("#discount_type"),u=document.querySelector("#discount_value");i&&(i.value="amount"),u&&(u.value="0"),oe(),V(),q("‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß","success")}}),document.querySelector(f.clearAllBtn)?.addEventListener("click",async l=>{if(l.preventDefault(),t?.classList.remove("show"),s?.setAttribute("aria-expanded","false"),await ae("‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î","‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô! ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏£‡∏ß‡∏°‡∏ñ‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡∏ñ‡∏≤‡∏ß‡∏£ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")){const i=document.querySelector(f.roomsContainer);i&&(i.innerHTML=""),localStorage.removeItem(he),vt(),q("‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î...","success"),setTimeout(()=>window.location.reload(),500)}}),window.addEventListener("click",l=>{l.target.closest(".menu-container")||(t?.classList.remove("show"),o?.classList.remove("show"),s?.setAttribute("aria-expanded","false"),a?.setAttribute("aria-expanded","false")),l.target.closest(".room-options-container")||document.querySelectorAll(".room-options-menu.show").forEach(u=>u.classList.remove("show"));const i=l.target.closest(".item-card");document.querySelectorAll(".item-details-more.show").forEach(u=>{const c=u.closest(".item-card");c!==i&&ke(c,!1)})}),window.addEventListener("beforeunload",K)}function Xt(){const e=document.querySelector(f.setTpl);if(!e)return;const r=e.content.querySelector(f.setPricePerMSelect),n=e.content.querySelector(f.setSheerPricePerMSelect),t=e.content.querySelector(f.setLouisPricePerMSelect),o=s=>{let a='<option value="" hidden>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏Ñ‡∏≤</option>';return Array.isArray(s)?(s.forEach(l=>{a+=`<option value="${l}">${l.toLocaleString("th-TH")}</option>`}),a):(console.error("Price data for dropdown is not available or not an array.",s),a)};r&&(r.innerHTML=o(ve.fabric)),n&&(n.innerHTML=o(ve.sheer)),t&&(t.innerHTML=o(ve.louis))}function zt(){Xt(),ot(),Kt();try{const e=localStorage.getItem(he);if(e&&e!=="null"&&e!=="{}"){const r=JSON.parse(e);if(r&&Array.isArray(r.rooms))Ge(r,!1);else{console.warn("Stored data structure seems invalid, starting fresh."),localStorage.removeItem(he),pe();const n=document.querySelector(f.customerCard);n&&(n.open=!0)}}else{pe();const r=document.querySelector(f.customerCard);r&&(r.open=!0)}}catch(e){console.error("Failed to load or parse data from localStorage:",e),localStorage.removeItem(he),pe();const r=document.querySelector(f.customerCard);r&&(r.open=!0)}V(),at(),ee(),Se(),te(),console.log("Marnthara App Initialized (Vite Refactor)")}document.addEventListener("DOMContentLoaded",zt);
