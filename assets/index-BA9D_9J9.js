(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();const ye="input-ui/5.6.0-final",ve="https://your-make-webhook-url.com/your-unique-path",X="marnthara.input.v4",ge=500,C={name:"ม่านธารา ผ้าม่านและของตกแต่ง",address:"65/8 หมู่ 2 ต.ท่าศาลา อ.เมือง จ.ลพบุรี 15000",phone:"092-985-9395, 082-552-5595",taxId:"1234567890123",logoUrl:"https://i.imgur.com/l7y85nI.png",baseVatRate:.07,pdf:{paymentTerms:"ชำระมัดจำ 50%",priceValidity:"30 วัน",notes:["ราคานี้รวมค่าติดตั้งแล้ว","ชำระมัดจำ 50% เพื่อยืนยันการสั่งผลิตสินค้า","ใบเสนอราคานี้มีอายุ 30 วัน นับจากวันที่เสนอราคา"]}},Se=1.19599,ae={ROLL_WIDTH_M:.53,ROLL_LENGTH_M:10,STRIPS_PER_ROLL_UNDER_2_5M:3},ee={fabric:[1e3,1100,1200,1300,1400,1500,1600,1700,1800,1900,2e3,2100,2200],sheer:[1e3,1100,1200,1300,1400,1500],style_surcharge:{ลอน:200,ตาไก่:0,จีบ:0},height:[{threshold:3.2,add_per_m:300},{threshold:2.8,add_per_m:200},{threshold:2.5,add_per_m:100}]},u={orderForm:"#orderForm",roomsContainer:"#rooms",setTpl:"#setTpl",clearAllBtn:"#clearAllBtn",lockBtn:"#lockBtn",grandTotal:"#grandTotal",setCount:"#setCount",modal:"#confirmationModal",modalTitle:"#modalTitle",modalBody:"#modalBody",room:"[data-room]",set:"[data-set]",setsContainer:"[data-sets]",decorationsContainer:"[data-decorations]",decoItem:"[data-deco-item]",wallpapersContainer:"[data-wallpapers]",wallpaperItem:"[data-wallpaper-item]",wallsContainer:"[data-walls-container]",sheerWrap:"[data-sheer-wrap]",roomNameInput:'input[name="room_name"]',toastContainer:"#toast-container",copyTextBtn:"#copyTextBtn",copyOptionsModal:"#copyOptionsModal",menuBtn:"#menuBtn",menuDropdown:"#menuDropdown",importBtn:"#importBtn",exportBtn:"#exportBtn",fileImporter:"#fileImporter",submitBtn:"#submitBtn",clearItemsBtn:"#clearItemsBtn",exportPdfBtn:"#exportPdfBtn",exportOptionsModal:"#exportOptionsModal",printableContent:"#printable-content",manageFavoritesModal:"#manageFavoritesModal",manageFavoritesModalBody:"#manageFavoritesModalBody",manageFavoritesModalTitle:"#manageFavoritesModalTitle",quickNavBtn:"#quickNavBtn",quickNavDropdown:"#quickNavDropdown",quickNavRoomList:"#quickNavRoomList",toggleAllRoomsBtn:"#toggleAllRoomsBtn",allDetailsCards:'.card[id="customerDetailsCard"], .room-card'},v=e=>{typeof e=="string"&&(e=e.replace(/,/g,""));const t=parseFloat(e);return Number.isFinite(t)?t:0},A=e=>{const t=v(e);return t>0?t.toFixed(2):""},I=(e,t=2,n=!1)=>Number.isFinite(e)?e.toLocaleString("en-US",{minimumFractionDigits:n?2:t,maximumFractionDigits:n?2:t}):"0",$=(e,t=0)=>Number.isFinite(e)?e.toLocaleString("th-TH",{minimumFractionDigits:t,maximumFractionDigits:t}):"0",qe=(e,t=150)=>{let n;return(...r)=>{clearTimeout(n),n=setTimeout(()=>e(...r),t)}},we=(e,t=700)=>{let n=!1;return(...r)=>{if(!n){n=!0;try{return e(...r)}finally{setTimeout(()=>{n=!1},t)}}}};function be(e){let t=v(e);if(isNaN(t))return"ข้อมูลตัวเลขไม่ถูกต้อง";if(t===0)return"ศูนย์บาทถ้วน";const n=["","หนึ่ง","สอง","สาม","สี่","ห้า","หก","เจ็ด","แปด","เก้า"],r=["","สิบ","ร้อย","พัน","หมื่น","แสน","ล้าน"];let o=Math.floor(t),s=Math.round((t-o)*100);const a=l=>{if(l===0)return"";let d="";const m=String(l);for(let p=0;p<m.length;p++){const f=m[p];m.length-1;const h=m.length-p-1;f!=="0"&&(h===1&&f==="1"?d+=r[h]:h===1&&f==="2"?d+="ยี่"+r[h]:h===0&&f==="1"&&m.length>1?d+="เอ็ด":d+=n[parseInt(f)]+r[h])}return d};let i="";if(o>0){const l=Math.floor(o/1e6),d=o%1e6;l>0&&(i+=a(l)+"ล้าน"),i+=a(d),i+="บาท"}let c="";return s>0?c=a(s)+"สตางค์":i+="ถ้วน",(i+c).trim()}function O(){var t,n,r,o;const e={app_version:ye,customer_name:((t=document.querySelector('[name="customer_name"]'))==null?void 0:t.value)||"",customer_phone:((n=document.querySelector('[name="customer_phone"]'))==null?void 0:n.value)||"",customer_address:((r=document.querySelector('[name="customer_address"]'))==null?void 0:r.value)||"",customer_card_open:(o=document.querySelector("#customerDetailsCard"))==null?void 0:o.open,rooms:[]};return document.querySelectorAll(u.room).forEach(s=>{var i;const a={id:s.id,room_name:((i=s.querySelector(u.roomNameInput))==null?void 0:i.value)||"",is_suspended:s.classList.contains("is-suspended"),sets:[],decorations:[],wallpapers:[]};s.querySelectorAll(u.set).forEach(c=>{var l,d,m,p,f,h,S,b,_,g,y;a.sets.push({width_m:v((l=c.querySelector('input[name="width_m"]'))==null?void 0:l.value),height_m:v((d=c.querySelector('input[name="height_m"]'))==null?void 0:d.value),style:((m=c.querySelector('select[name="set_style"]'))==null?void 0:m.value)||"",fabric_variant:((p=c.querySelector('select[name="fabric_variant"]'))==null?void 0:p.value)||"",price_per_m_raw:v((f=c.querySelector('select[name="set_price_per_m"]'))==null?void 0:f.value),sheer_price_per_m:v((h=c.querySelector('select[name="sheer_price_per_m"]'))==null?void 0:h.value),fabric_code:((S=c.querySelector('input[name="fabric_code"]'))==null?void 0:S.value)||"",sheer_fabric_code:((b=c.querySelector('input[name="sheer_fabric_code"]'))==null?void 0:b.value)||"",opening_style:((_=c.querySelector('select[name="opening_style"]'))==null?void 0:_.value)||"",track_color:((g=c.querySelector('select[name="track_color"]'))==null?void 0:g.value)||"",notes:((y=c.querySelector('input[name="notes"]'))==null?void 0:y.value)||"",is_suspended:c.classList.contains("is-suspended")})}),s.querySelectorAll(u.decoItem).forEach(c=>{var l,d,m,p,f,h;a.decorations.push({type:((l=c.querySelector('[name="deco_type"]'))==null?void 0:l.value)||"",width_m:v((d=c.querySelector('[name="deco_width_m"]'))==null?void 0:d.value),height_m:v((m=c.querySelector('[name="deco_height_m"]'))==null?void 0:m.value),price_sqyd:v((p=c.querySelector('[name="deco_price_sqyd"]'))==null?void 0:p.value),deco_code:((f=c.querySelector('[name="deco_code"]'))==null?void 0:f.value)||"",notes:((h=c.querySelector('[name="deco_notes"]'))==null?void 0:h.value)||"",is_suspended:c.classList.contains("is-suspended")})}),s.querySelectorAll(u.wallpaperItem).forEach(c=>{var l,d,m,p,f;a.wallpapers.push({height_m:v((l=c.querySelector('[name="wallpaper_height_m"]'))==null?void 0:l.value),wallpaper_code:((d=c.querySelector('[name="wallpaper_code"]'))==null?void 0:d.value)||"",price_per_roll:v((m=c.querySelector('[name="wallpaper_price_roll"]'))==null?void 0:m.value),install_cost_per_roll:v((p=c.querySelector('[name="wallpaper_install_cost"]'))==null?void 0:p.value),notes:((f=c.querySelector('[name="wallpaper_notes"]'))==null?void 0:f.value)||"",widths:Array.from(c.querySelectorAll('[name="wall_width_m"]')).map(h=>v(h.value)),is_suspended:c.classList.contains("is-suspended")})}),e.rooms.push(a)}),e}function F(){localStorage.setItem(X,JSON.stringify(O()))}const L={stylePlus:e=>ee.style_surcharge[e]??0,heightPlus:e=>{const t=[...ee.height].sort((n,r)=>r.threshold-n.threshold);for(const n of t)if(e>n.threshold)return n.add_per_m;return 0},fabricYardage:(e,t)=>{const n=v(t);return n<=0||!e?0:e==="ตาไก่"||e==="จีบ"?(n*2+.6)/.9:e==="ลอน"?(n*2.6+.6)/.9:0},wallpaperRolls:(e,t)=>{const n=v(e),r=v(t);if(n<=0||r<=0)return 0;const o=r>2.5?Math.floor(ae.ROLL_LENGTH_M/r):ae.STRIPS_PER_ROLL_UNDER_2_5M;if(o<=0)return 0;const s=Math.ceil(n/ae.ROLL_WIDTH_M);return Math.ceil(s/o)},calculateSetPrice:function(e){var a,i;if(!e||e.is_suspended||v(e.width_m)<=0)return{total:0,opaque:0,sheer:0};const t=this.stylePlus(e.style),n=this.heightPlus(v(e.height_m)),r=v(e.width_m),o=(a=e.fabric_variant)!=null&&a.includes("ทึบ")&&v(e.price_per_m_raw)>0?(v(e.price_per_m_raw)+t+n)*r:0,s=(i=e.fabric_variant)!=null&&i.includes("โปร่ง")&&v(e.sheer_price_per_m)>0?(v(e.sheer_price_per_m)+t+n)*r:0;return{total:Math.round(o+s),opaque:Math.round(o),sheer:Math.round(s)}},calculateDecoPrice:function(e){if(!e||e.is_suspended||v(e.width_m)<=0)return{total:0,sqm:0,sqyd:0};const t=v(e.width_m)*v(e.height_m),n=t*Se,r=n*v(e.price_sqyd);return{total:Math.round(r),sqm:t,sqyd:n}},calculateWallpaperPrice:function(e){var a;if(!e||e.is_suspended)return{total:0,material:0,install:0,rolls:0,sqm:0};const t=((a=e.widths)==null?void 0:a.reduce((i,c)=>i+v(c),0))||0;if(t<=0)return{total:0,material:0,install:0,rolls:0,sqm:0};const n=v(e.height_m),r=this.wallpaperRolls(t,n),o=r*v(e.price_per_roll),s=r*(v(e.install_cost_per_roll)||0);return{total:Math.round(o+s),material:Math.round(o),install:Math.round(s),rolls:r,sqm:t*n}}};function Le(e){return e.rooms.reduce((t,n)=>{if(n.is_suspended)return t;const r=n.sets.reduce((a,i)=>a+L.calculateSetPrice(i).total,0),o=n.decorations.reduce((a,i)=>a+L.calculateDecoPrice(i).total,0),s=n.wallpapers.reduce((a,i)=>a+L.calculateWallpaperPrice(i).total,0);return t+r+o+s},0)}function $e(e,t){const n=Le(e);let r=`สรุปข้อมูล (${new Date().toLocaleDateString("th-TH",{day:"numeric",month:"numeric",year:"numeric"})})
`;if(r+=`ลูกค้า: ${e.customer_name||"-"}
`,(t==="customer"||t==="owner")&&(r+=`เบอร์โทร: ${e.customer_phone||"-"}
`,r+=`ที่อยู่: ${e.customer_address||"-"}
`),r+=`------------------------------
`,t==="customer")return r+=`
สรุปรายการ
`,e.rooms.forEach(o=>{if(o.is_suspended||[...o.sets,...o.decorations,...o.wallpapers].filter(i=>i.is_suspended?!1:i.widths?i.widths.reduce((c,l)=>c+l,0)>0:i.width_m>0).length===0)return;r+=`
*ห้อง: ${o.room_name||"ไม่ระบุ"}*
`;let a=0;o.sets.forEach(i=>{i.is_suspended||i.width_m<=0||(a++,r+=` ${a}) ผ้าม่าน ${i.style} (${i.fabric_variant})
`)}),o.decorations.forEach(i=>{i.is_suspended||i.width_m<=0||(a++,r+=` ${a}) ${i.type||"ของตกแต่ง"}
`)}),o.wallpapers.forEach(i=>{i.is_suspended||i.widths.reduce((c,l)=>c+l,0)<=0||(a++,r+=` ${a}) วอลเปเปอร์
`)})}),r+=`------------------------------
`,r+=`
สรุปยอดรวม: ${$(n)} บาท
`,r+=`
ขอบคุณที่ใช้บริการ
${C.name}
โทร: ${C.phone}`,r;if(t==="purchase_order"||t==="owner"){const o={opaqueFabrics:[],sheerFabrics:[],decorations:[],wallpapers:[],allSets:[]};if(e.rooms.forEach(s=>{s.is_suspended||(s.sets.forEach(a=>{a.is_suspended||a.width_m<=0||(o.allSets.push(a),a.fabric_variant.includes("ทึบ")&&o.opaqueFabrics.push({code:a.fabric_code||"??",yards:L.fabricYardage(a.style,a.width_m)}),a.fabric_variant.includes("โปร่ง")&&o.sheerFabrics.push({code:a.sheer_fabric_code||"??",yards:L.fabricYardage(a.style,a.width_m)}))}),s.decorations.forEach(a=>{a.is_suspended||!a.type||a.width_m<=0||o.decorations.push({type:a.type,code:a.deco_code||"xxx",width:a.width_m,height:a.height_m})}),s.wallpapers.forEach(a=>{if(a.is_suspended)return;const i=a.widths.reduce((c,l)=>c+l,0);if(i>0){const c=L.wallpaperRolls(i,a.height_m);c>0&&o.wallpapers.push({code:a.wallpaper_code||"xxx",rolls:c})}}))}),r+=`📋 *สรุปวัสดุสำหรับสั่งซื้อผ้า*
`,r+=`------------------------------
`,o.opaqueFabrics.length>0&&o.opaqueFabrics.forEach(s=>{r+=`- ผ้าทึบ (Curtain Fabric)
`,r+=`รหัส: #${s.code||"??"}
`,r+=`จำนวน: ${s.yards.toFixed(2)} หลา

`}),o.sheerFabrics.length>0&&o.sheerFabrics.forEach(s=>{r+=`- ผ้าโปร่ง (Sheer Fabric)
`,r+=`รหัส: #${s.code||"??"}
`,r+=`จำนวน: ${s.yards.toFixed(2)} หลา

`}),r+=`------------------------------
`,r+=`📋 *สำหรับสั่งซื้อ ราง*
`,r+=`------------------------------

`,o.allSets.length>0){let s=1;o.allSets.forEach(a=>{r+=`(${s++}) รางม่าน: ${a.style}, สี: ${a.track_color}
`,a.fabric_variant.includes("ทึบ")&&(r+=`  - รางทึบ: ${a.width_m.toFixed(2)} ม. (1 เส้น)
`),a.fabric_variant.includes("โปร่ง")&&(r+=`  - รางโปร่ง: ${a.width_m.toFixed(2)} ม. (1 เส้น)
`),a.fabric_variant==="ทึบ&โปร่ง"&&(r+=`  (❗️ต้องใช้ขาสองชั้น)
`),r+=`
`})}if(r+=`------------------------------
`,r+=`📋 *สำหรับสั่งซื้อ Blind*
`,r+=`------------------------------

`,o.decorations.length>0){const s={มู่ลี่ไม้:"Wooden Blind",ม่านม้วน:"Roller Blind",ปรับแสง:"Vertical Blind",ฉากกั้นห้อง:"Partition",มุ้งจีบ:"Pleated Insect Screen",มู่ลี่มิเนียม:"Aluminium Blind"};o.decorations.forEach(a=>{const i=s[a.type]?` (${s[a.type]})`:"";r+=`- ${a.type}${i}
`,r+=`รหัส: #${a.code||"xxx"}
`,r+=`ขนาด: ${a.width.toFixed(2)} x ${a.height.toFixed(2)} m.
`,r+=`จำนวน: 1 ชุด

`})}if(r+=`------------------------------
`,r+=`📋 *สำหรับสั่งซื้อ Wallpaper*
`,r+=`------------------------------

`,o.wallpapers.length>0&&o.wallpapers.forEach(s=>{r+=`- วอลเปเปอร์ -
`,r+=`รหัส: #${s.code||"xxx"}
`,r+=`จำนวน: ${s.rolls} ม้วน

`}),r+=`------------------------------
`,t==="purchase_order")return r}return(t==="seamstress"||t==="owner")&&(r+=`
🧵 *รายละเอียดสำหรับช่าง*
`,e.rooms.forEach(o=>{if(o.is_suspended||o.sets.filter(i=>!i.is_suspended&&i.width_m>0).length===0)return;r+=`
*ห้อง: ${o.room_name||"ไม่ระบุ"}*
`;let a=1;o.sets.forEach(i=>{i.is_suspended||i.width_m<=0||(r+=`${a++}) *ผ้าม่าน ${i.style} ${i.fabric_variant}*
`,r+=`  กว้าง ${i.width_m} x สูง ${i.height_m} ม.
`,r+=`  รูปแบบเปิด: ${i.opening_style}
`,i.fabric_variant.includes("ทึบ")&&(r+=`  ผ้าทึบ: รหัส ${i.fabric_code||"-"}
`),i.fabric_variant.includes("โปร่ง")&&(r+=`  ผ้าโปร่ง: รหัส ${i.sheer_fabric_code||"-"}
`))})}),r+=`------------------------------
`,t==="seamstress")||t==="owner"&&(r+=`
💰 *สรุปยอดรวม: ${$(n)} บาท*
`),r}function Te(e){if(!e.rooms||e.rooms.length===0)return'<p class="empty-summary">ไม่มีข้อมูลสำหรับแสดงผล</p>';const t={};let n=0,r="";if(e.rooms.forEach(a=>{if(a.is_suspended)return;const i={};a.sets.forEach(l=>{if(L.calculateSetPrice(l).total>0){const d="ผ้าม่าน";i[d]=(i[d]||0)+1,t[d]=(t[d]||0)+1}}),a.decorations.forEach(l=>{if(l.type&&L.calculateDecoPrice(l).total>0){const d=l.type;i[d]=(i[d]||0)+1,t[d]=(t[d]||0)+1}}),a.wallpapers.forEach(l=>{if(L.calculateWallpaperPrice(l).total>0){const d="วอลเปเปอร์";i[d]=(i[d]||0)+1,t[d]=(t[d]||0)+1}});const c=Object.entries(i);c.length>0&&(r+=`<tr class="room-header-row"><td colspan="3">${a.room_name||"ไม่ระบุชื่อห้อง"}</td></tr>`,c.forEach(([l,d])=>{r+=`<tr><td></td><td class="item-type-cell">${l}</td><td class="pdf-text-center">${d}</td></tr>`,n+=d}))}),n===0)return'<p class="empty-summary">ไม่มีรายการที่มีราคาสำหรับแสดงผล</p>';let s=`<div id="detailed-material-summary">
        <h4><i class="ph ph-stack"></i> ยอดรวมทุกประเภท</h4>
        <ul><li class="summary-note">${Object.entries(t).map(([a,i])=>`${a}: ${i}`).join(" , ")}</li></ul>
    </div>`;return s+=`<table>
        <thead><tr><th>ห้อง</th><th>รายการ</th><th class="pdf-text-center">จำนวน</th></tr></thead>
        <tbody>${r}</tbody>
    </table>`,s}function ke(e,t){const{vatRate:n,pageBreakBuffer:r=3}=t,o=[];e.rooms.forEach(T=>{if(T.is_suspended)return;const k=[];T.sets.forEach(q=>{const E=L.calculateSetPrice(q).total;if(E>0){let x=`ผ้าม่าน ${q.style} (${q.fabric_variant}) <br><small>ขนาด ${q.width_m.toFixed(2)} x ${q.height_m.toFixed(2)} ม.${q.notes?` - ${q.notes}`:""}</small>`;k.push({description:x,total:E,units:x.includes("<br>")?1.5:1})}}),T.decorations.forEach(q=>{const E=L.calculateDecoPrice(q).total;if(E>0){let x=`${q.type||"งานตกแต่ง"} <br><small>รหัส: ${q.deco_code||"-"}, ขนาด ${q.width_m.toFixed(2)} x ${q.height_m.toFixed(2)} ม.</small>`;k.push({description:x,total:E,units:x.includes("<br>")?1.5:1})}}),T.wallpapers.forEach(q=>{const E=L.calculateWallpaperPrice(q).total;if(E>0){const x=q.widths.reduce((Q,ne)=>Q+ne,0),D=L.wallpaperRolls(x,q.height_m);let R=`วอลเปเปอร์ <br><small>รหัส: ${q.wallpaper_code||"-"}, สูง ${q.height_m.toFixed(2)} ม. (ใช้ ${D} ม้วน)</small>`;k.push({description:R,total:E,units:R.includes("<br>")?1.5:1})}}),k.length>0&&(o.push({isRoomHeader:!0,roomName:T.room_name||"ไม่ระบุชื่อห้อง",units:1.2}),o.push(...k))});const s=o.reduce((T,k)=>T+(k.total||0),0);if(s===0)return null;const a=s*n,i=s+a,c=17,l=23,d=[];let m=[],p=0;o.forEach((T,k)=>{const q=d.length===0?c:l,E=p+T.units>q;let x=!1;if(!E&&k<o.length-1){const D=q-(p+T.units);D>0&&D<r&&(x=!0)}(E||x)&&m.length>0&&(d.push(m),m=[],p=0),m.push(T),p+=T.units}),m.length>0&&d.push(m);const f=new Date,h=f.toLocaleDateString("th-TH",{year:"numeric",month:"long",day:"numeric"}),S=`QT-${f.getFullYear()}${(f.getMonth()+1).toString().padStart(2,"0")}${f.getDate().toString().padStart(2,"0")}`;let b="",_=0,g=1;d.forEach((T,k)=>{const q=k===0,E=k===d.length-1,x=`
            <div class="pdf-page-header">
                <div class="pdf-header">
                    <div class="pdf-shop-info">
                        ${`<img src="${C.logoUrl}" alt="Logo" class="pdf-logo">`}
                        <div class="pdf-shop-address">
                            <strong>${C.name}</strong><br>
                            ${C.address.replace(/\n/g,"<br>")}<br>
                            โทร: ${C.phone} | เลขประจำตัวผู้เสียภาษี: ${C.taxId}
                        </div>
                    </div>
                    <div class="pdf-quote-details">
                        <div class="pdf-title-box"><h1>ใบเสนอราคา ${d.length>1?q?"":"(ต่อ)":""}</h1></div>
                        <table class="pdf-quote-meta">
                            <tr><td>เลขที่:</td><td>${S}</td></tr>
                            <tr><td>วันที่:</td><td>${h}</td></tr>
                        </table>
                    </div>
                </div>
                ${q?`
                <section class="pdf-customer-details">
                    <div class="pdf-customer-info">
                        <strong>ลูกค้า:</strong> ${e.customer_name||""}<br>
                        <strong>ที่อยู่:</strong> ${e.customer_address.replace(/\n/g,"<br>")||""}<br>
                        <strong>โทร:</strong> ${e.customer_phone||""}
                    </div>
                    <div class="pdf-customer-meta">
                        <strong>เงื่อนไขชำระเงิน:</strong> ${C.pdf.paymentTerms}<br>
                        <strong>ยืนราคา:</strong> ${C.pdf.priceValidity}
                    </div>
                </section>`:""}
            </div>`,D=`
            <div class="pdf-page-footer">
                <div class="pdf-footer-info">
                    <span>${C.name} | โทร: ${C.phone}</span>
                    <span>หน้า ${k+1} / ${d.length}</span>
                </div>
            </div>`;let R="";q||(R+=`<tr class="pdf-subtotal-row"><td colspan="4">ยอดยกมา (Brought Forward)</td><td class="pdf-text-right">${I(_,2,!0)}</td></tr>`),T.forEach(M=>{M.isRoomHeader?R+=`<tr class="pdf-room-header"><td colspan="5">ห้อง: ${M.roomName}</td></tr>`:(R+=`<tr><td class="pdf-text-center">${g++}</td><td>${M.description}</td><td class="pdf-text-center">1</td><td class="pdf-text-right">${I(M.total,2,!0)}</td><td class="pdf-text-right">${I(M.total,2,!0)}</td></tr>`,_+=M.total)});let Q="";E||(Q=`<tfoot><tr class="pdf-subtotal-row"><td colspan="4">ยอดยกไป (Carried Forward)</td><td class="pdf-text-right">${I(_,2,!0)}</td></tr></tfoot>`);const ne=E?`
            <div class="pdf-summary-wrapper">
                <section class="pdf-summary-section">
                    <div class="pdf-amount-in-words">
                        <strong>หมายเหตุ:</strong>
                        <ul>${C.pdf.notes.map(M=>`<li>${M}</li>`).join("")}</ul>
                        <div class="pdf-amount-text">( ${be(i)} )</div>
                    </div>
                    <div class="pdf-totals-block">
                        <table>
                            <tr><td colspan="2" class="pdf-label">รวมเป็นเงิน</td><td class="pdf-amount">${I(s,2,!0)}</td></tr>
                            ${n>0?`<tr><td colspan="2" class="pdf-label">ภาษีมูลค่าเพิ่ม ${(n*100).toFixed(0)}%</td><td class="pdf-amount">${I(a,2,!0)}</td></tr>`:""}
                            <tr class="pdf-grand-total"><td colspan="2" class="pdf-label">ยอดรวมสุทธิ</td><td class="pdf-amount">${I(i,2,!0)}</td></tr>
                        </table>
                    </div>
                </section>
                <footer class="pdf-footer-section">
                    <div class="pdf-signature-box"><p>.................................................</p><p>ผู้เสนอราคา</p><p>(${C.name})</p><p>วันที่: ${h}</p></div>
                    <div class="pdf-signature-box"><p>.................................................</p><p>ลูกค้า / ผู้มีอำนาจลงนาม</p><p>&nbsp;</p><p>วันที่: ......./......./............</p></div>
                </footer>
            </div>
        `:"";b+=`
            <div class="pdf-page">
                <div class="pdf-page-content">
                    ${x}
                    <div class="pdf-page-body">
                        <table class="pdf-items-table">
                            <thead><tr><th style="width:5%;">ลำดับ</th><th style="width:50%;">รายการ</th><th style="width:10%;">จำนวน</th><th style="width:17.5%;">ราคา/หน่วย</th><th style="width:17.5%;">รวม (บาท)</th></tr></thead>
                            <tbody>${R}</tbody>
                            ${Q}
                        </table>
                        ${ne}
                    </div>
                    ${D}
                </div>
            </div>`});const N=(e.customer_name||"quote").trim().replace(/\s+/g,"-");return{html:`<div id="quotation-template">${b}</div>`,fileName:`${S}_${N}`}}const se="marnthara.favorites.v2";function V(){try{const e=localStorage.getItem(se),t={fabric:[],sheer:[],deco:[],wallpaper:[]};return e?{...t,...JSON.parse(e)}:t}catch(e){return console.error("Failed to parse favorites from localStorage",e),{fabric:[],sheer:[],deco:[],wallpaper:[]}}}function Ee(e,t){var r;return!e||!t||(r=V()[e])==null?void 0:r.find(o=>o.code===t.trim())}function Ce(e){try{localStorage.setItem(se,JSON.stringify(e))}catch(t){console.error("Failed to save favorites to localStorage",t)}}function ie(e,t,n=0){if(!e||!t||typeof t!="string"||t.trim()==="")return!1;const r=t.trim(),o=V();o[e]||(o[e]=[]);const s=o[e].findIndex(i=>i.code===r);let a=!1;return s>-1?(o[e].splice(s,1),a=!1):(o[e].push({code:r,price:n}),o[e].sort((i,c)=>i.code.localeCompare(c.code)),a=!0),Ce(o),a}function xe(e,t){var r;return!e||!t?!1:((r=V()[e])==null?void 0:r.some(o=>o.code===t.trim()))??!1}function Be(){localStorage.removeItem(se),console.log("All favorites have been cleared.")}let B=!1,ce=null,K=null;const ue="marnthara.theme";function de(){const e=localStorage.getItem(ue),t=document.querySelector("#themeToggleBtn");if(!t)return;const n=t.querySelector("i"),r=t.querySelector("span");e==="dark"?(document.body.classList.add("dark-theme"),n&&(n.className="ph-fill ph-sun"),r&&(r.textContent=" Light Mode")):(document.body.classList.remove("dark-theme"),n&&(n.className="ph-fill ph-moon"),r&&(r.textContent=" Dark Mode"))}function Ie(){document.body.classList.toggle("dark-theme");const e=document.body.classList.contains("dark-theme");localStorage.setItem(ue,e?"dark":"light"),de()}function w(e,t="default"){const n=document.querySelector(u.toastContainer);if(!n)return;const r={success:"ph-bold ph-check-circle",warning:"ph-bold ph-warning",error:"ph-bold ph-x-circle",default:"ph-bold ph-info"},o=document.createElement("div");o.className=`toast toast-${t}`,o.innerHTML=`<i class="${r[t]||r.default}"></i> ${e}`,n.appendChild(o),setTimeout(()=>o.classList.add("show"),10),setTimeout(()=>{o.classList.remove("show"),o.addEventListener("transitionend",()=>o.remove())},3e3)}function j(e,t){return new Promise(n=>{const r=document.querySelector(e);if(!r){n(null);return}r.classList.add("visible");const o=r.querySelector('[id$="Confirm"]'),s=r.querySelector('[id$="Cancel"]'),a=c=>{r.classList.remove("visible"),o&&(o.onclick=null),s&&(s.onclick=null),document.removeEventListener("keydown",i),!c&&t&&t(),n(c)},i=c=>{c.key==="Escape"&&a(!1)};o&&(o.onclick=()=>a(!0)),s&&(s.onclick=()=>a(!1)),document.addEventListener("keydown",i)})}async function z(e,t){const n=document.querySelector(u.modal);if(!n)return!0;const r=n.querySelector(u.modalTitle),o=n.querySelector(u.modalBody);return r&&(r.textContent=e),o&&(o.textContent=t),await j(u.modal)}async function Ne(){const e=document.querySelector(u.exportOptionsModal);if(!e||!await j(u.exportOptionsModal))return null;const n=e.querySelector('input[name="vat_option"]:checked'),r=e.querySelector("#exportMethod"),o=e.querySelector("#pageBreakBuffer");return{vatOption:n?n.value:"include",exportMethod:r?r.value:"direct",pageBreakBuffer:o?parseInt(o.value,10):3}}function U(e,t){e&&(e.classList.add("item-removing"),e.addEventListener("animationend",()=>{e.remove(),t&&w(t),oe(),re(),P(),F(),W()},{once:!0}))}function re(){document.querySelectorAll(u.room).forEach(e=>{const t=e.querySelectorAll(".item-card"),n=t.length;t.forEach((r,o)=>{const s=r.querySelector("[data-item-title]");s&&(s.textContent=`${o+1}/${n}`)})})}function me(){const e=document.querySelector(u.orderForm),t=document.querySelector(u.lockBtn);if(!e||!t)return;const n=e.querySelectorAll("input, select, textarea, button");e.classList.toggle("is-locked",B),t.classList.toggle("is-locked",B);const r=t.querySelector("i");r&&(r.className=B?"ph-bold ph-lock-key":"ph-bold ph-lock-key-open"),n.forEach(o=>{o.closest(".summary-footer")||o.closest(".main-header")||o.closest(".modal-wrapper")||(o.disabled=B)}),w(B?"ฟอร์มถูกล็อค":"ปลดล็อคฟอร์มแล้ว",B?"warning":"success")}function H(){const e=document.querySelectorAll(u.allDetailsCards);if(e.length===0)return;const t=[...e].some(r=>r.open),n=document.querySelector(u.toggleAllRoomsBtn);if(n){const r=n.querySelector("i"),o=n.querySelector("span");r&&(r.className=t?"ph ph-rows-slash":"ph ph-rows"),o&&(o.textContent=t?"ย่อทั้งหมด":"ขยายทั้งหมด")}}function Me(){const e=document.querySelectorAll(u.allDetailsCards),t=[...e].some(n=>n.open);e.forEach(n=>{n.open=!t}),setTimeout(H,50)}function oe(){const e=document.querySelector(u.quickNavRoomList);if(!e)return;e.innerHTML="",document.querySelectorAll(u.room).forEach(n=>{const r=n.querySelector(u.roomNameInput),o=r?r.value:"ห้อง",s=document.createElement("a");s.href=`#${n.id}`,s.dataset.jumpTo=n.id,s.innerHTML=`<i class="ph ph-arrow-bend-left-up"></i> ${o||"ห้อง (ไม่มีชื่อ)"}`,e.appendChild(s)})}function pe(e){const t=document.getElementById("quickNavBtnText");if(t)if(e){const n=e.querySelector('input[name="room_name"]');n&&(t.textContent=n.value||"...")}else t.textContent="ไปยังห้อง"}function W(){if(K&&K.disconnect(),!document.getElementById("quickNavBtnText"))return;const t={root:null,rootMargin:"-60px 0px -150px 0px",threshold:0},n=o=>{const s=o.filter(a=>a.isIntersecting).sort((a,i)=>a.target.getBoundingClientRect().top-i.target.getBoundingClientRect().top);s.length>0&&pe(s[0].target)};K=new IntersectionObserver(n,t),document.querySelectorAll(u.room).forEach(o=>K.observe(o))}function Fe(e,t){ie(e,t),w(`ลบรหัส "${t}" แล้ว`,"success"),fe(e)}function fe(e){const t=document.querySelector(u.manageFavoritesModalBody),n=document.querySelector(u.manageFavoritesModalTitle);if(!t||!n)return;const r=V()[e]||[],o={fabric:"ผ้าทึบ",sheer:"ผ้าโปร่ง",deco:"ของตกแต่ง",wallpaper:"วอลเปเปอร์"};n.textContent=`จัดการรหัสโปรด: ${o[e]||e}`,t.innerHTML="",r.length===0?t.innerHTML='<p class="empty-summary" style="margin-bottom: 1rem;">ไม่มีรหัสโปรดสำหรับประเภทนี้</p>':r.forEach(s=>{const a=document.createElement("div");a.className="favorite-management-item",a.innerHTML=`
                <div>
                    <span class="fav-code">${s.code}</span>
                    <span class="fav-price">(${$(s.price)} บาท)</span>
                </div>
                <button type="button" class="btn-icon btn-icon-small danger btn-delete-favorite" title="ลบ">
                    <i class="ph-bold ph-trash"></i>
                </button>
            `,a.querySelector(".btn-delete-favorite").onclick=()=>Fe(e,s.code),t.appendChild(a)})}function Pe(e){fe(e),j(u.manageFavoritesModal)}function te(){document.querySelectorAll(".favorite-chips-container.show").forEach(e=>{e.classList.remove("show")}),ce=null}function Y(e){if(!e)return;const t=e.nextElementSibling;if(!t||!t.matches(".btn-favorite"))return;const n=t.dataset.type,r=xe(n,e.value);t.classList.toggle("is-favorite",r),t.querySelector("i").className=r?"ph-fill ph-star":"ph ph-star"}function Re(e){te();const t=e.dataset.favoriteType;if(!t)return;const n=V()[t]||[],r=e.closest(".form-group-with-favorites").querySelector(".favorite-chips-container");if(!r)return;if(r.innerHTML="",n.length===0){r.classList.remove("show");return}const o=document.createElement("div");o.className="favorite-chips-wrapper",n.forEach(a=>{const i=document.createElement("button");i.type="button",i.className="btn-chip",i.textContent=a.code,i.dataset.act="select-favorite",i.dataset.code=a.code,i.dataset.price=a.price,o.appendChild(i)}),r.appendChild(o);const s=document.createElement("a");s.className="manage-favorites-link",s.textContent="Edit",s.dataset.act="manage-favorites",s.dataset.type=t,r.appendChild(s),r.classList.add("show")}function G(e,t,n=!0){const r=document.querySelector(e);if(!r||!t)return null;const o=r.content.cloneNode(!0),s=o.firstElementChild;t.appendChild(o),s.querySelectorAll("input[data-favorite-type]").forEach(Y),n&&s&&(s.classList.add("item-created"),s.scrollIntoView({behavior:"smooth",block:"center"}));const a=s.querySelector('input:not([type="hidden"]), select, textarea');return a&&a.focus(),re(),P(),F(),s}function Z(){const e=document.querySelector(u.roomsContainer);if(!e)return;const t=document.querySelectorAll(u.roomNameInput);let n=0;t.forEach(s=>{const a=s.value.match(/\d+/g);if(a){const i=parseInt(a[a.length-1],10);i>n&&(n=i)}});const r=n+1,o=G("#roomTpl",e,!0);if(o){o.id=`room-${Date.now()}`;const s=o.querySelector(u.roomNameInput);s&&(s.value=`ห้อง ${r}`),o.open=!0}oe(),H(),W()}function Ae(e){if(!e)return;const t=e.querySelector(u.setsContainer);t&&G("#setTpl",t)}function De(e){if(!e)return;const t=e.querySelector(u.decorationsContainer);t&&G("#decoTpl",t)}function Oe(e){if(!e)return;const t=e.querySelector(u.wallpapersContainer);if(t){const n=G("#wallpaperTpl",t);n&&he(n.querySelector('[data-act="add-wall"]'))}}function he(e){var n;const t=(n=e==null?void 0:e.closest(".walls-section"))==null?void 0:n.querySelector(u.wallsContainer);t&&(G("#wallTpl",t,!0),J(e))}function _e(e){var o,s;if(!e)return;const t=(o=e.querySelector('select[name="fabric_variant"]'))==null?void 0:o.value,n=t&&t.includes("โปร่ง");(s=e.querySelector(u.sheerWrap))==null||s.classList.toggle("hidden",!n);const r=e.querySelector('input[name="sheer_fabric_code"]');if(r){const a=r.closest(".form-group-with-favorites");a&&a.classList.toggle("hidden",!n)}}const He=qe(e=>{J(e),F()});function We(e){if(B){w("ฟอร์มถูกล็อค ไม่สามารถแก้ไขได้","warning"),e.preventDefault();return}e.target.matches("input[data-favorite-type]")&&Y(e.target),e.target.matches(u.roomNameInput)&&W(),He(e.target)}function Ue(e){if(B)return;const t=e.target;if(t.matches('select[name="fabric_variant"]')&&_e(t.closest(u.set)),t.matches('select[name="deco_type"]')){const r=t.closest(u.decoItem),o=r==null?void 0:r.querySelector(".deco-type-display");o&&(o.textContent=t.value||"ตกแต่ง")}if(t.matches(u.roomNameInput)&&(oe(),W()),["set_price_per_m","sheer_price_per_m","deco_price_sqyd","wallpaper_price_roll"].includes(t.name)){const r=t.closest(".item-card");if(r){let o;if(t.name==="set_price_per_m"&&(o=r.querySelector('[name="fabric_code"]')),t.name==="sheer_price_per_m"&&(o=r.querySelector('[name="sheer_fabric_code"]')),t.name==="deco_price_sqyd"&&(o=r.querySelector('[name="deco_code"]')),t.name==="wallpaper_price_roll"&&(o=r.querySelector('[name="wallpaper_code"]')),o&&o.value){const s=o.dataset.favoriteType,a=Ee(s,o.value);a&&v(t.value)!==a.price&&(o.value="",Y(o),w("ล้างรหัสเนื่องจากราคาไม่ตรงกับ Favorite","warning"))}}}J(t),F()}function je(e){const t=e.target,n=t.matches('[name="deco_price_sqyd"], [name="wallpaper_price_roll"], [name="wallpaper_install_cost"]'),r=t.matches('input[name="width_m"], input[name="height_m"], input[name="deco_width_m"], input[name="deco_height_m"], input[name="wallpaper_height_m"], input[name="wall_width_m"]');if(n){const o=v(t.value);o>0?t.value=$(o):t.value=""}else r&&(t.value=A(t.value))}function Ve(e){const t=e.target;t.matches("input[data-favorite-type]")&&(ce=t,Re(t))}function J(e){var o,s,a,i,c,l,d,m,p,f,h,S;if(!e)return;const t=e.closest(u.set);if(t){const b=t.querySelector("[data-set-summary]");if(b){const _={width_m:(o=t.querySelector('input[name="width_m"]'))==null?void 0:o.value,height_m:(s=t.querySelector('input[name="height_m"]'))==null?void 0:s.value,style:(a=t.querySelector('select[name="set_style"]'))==null?void 0:a.value,fabric_variant:(i=t.querySelector('select[name="fabric_variant"]'))==null?void 0:i.value,price_per_m_raw:(c=t.querySelector('select[name="set_price_per_m"]'))==null?void 0:c.value,sheer_price_per_m:(l=t.querySelector('select[name="sheer_price_per_m"]'))==null?void 0:l.value},g=L.calculateSetPrice(_);let y=`ราคา: <b>${$(g.total)}</b> บ.`;g.opaque>0&&g.sheer>0&&(y+=` <small>(ทึบ: ${$(g.opaque)}, โปร่ง: ${$(g.sheer)})</small>`),b.innerHTML=y}}const n=e.closest(u.decoItem);if(n){const b=n.querySelector("[data-deco-summary]");if(b){const _={width_m:(d=n.querySelector('input[name="deco_width_m"]'))==null?void 0:d.value,height_m:(m=n.querySelector('input[name="deco_height_m"]'))==null?void 0:m.value,price_sqyd:(p=n.querySelector('input[name="deco_price_sqyd"]'))==null?void 0:p.value},g=L.calculateDecoPrice(_);b.innerHTML=`ราคา: <b>${$(g.total)}</b> บ. &bull; พื้นที่: ${I(g.sqyd,2)} ตร.หลา`}}const r=e.closest(u.wallpaperItem);if(r){const b=r.querySelector("[data-wallpaper-summary]");if(b){const _={height_m:(f=r.querySelector('input[name="wallpaper_height_m"]'))==null?void 0:f.value,price_per_roll:(h=r.querySelector('input[name="wallpaper_price_roll"]'))==null?void 0:h.value,install_cost_per_roll:(S=r.querySelector('input[name="wallpaper_install_cost"]'))==null?void 0:S.value,widths:Array.from(r.querySelectorAll('input[name="wall_width_m"]')).map(N=>N.value)},g=L.calculateWallpaperPrice(_);let y=`รวม: <b>${$(g.total)}</b> บ. `;(g.material>0||g.install>0)&&(y+=`<small>(วอลล์: ${$(g.material)}, ค่าช่าง: ${$(g.install)})</small>`),y+=` &bull; พื้นที่: ${I(g.sqm,2)} ตร.ม. &bull; ใช้: ${g.rolls} ม้วน`,b.innerHTML=y}}P()}function P(){let e=0,t=0;document.querySelectorAll(u.room).forEach(o=>{let s=0,a=0;const i=o.classList.contains("is-suspended");o.querySelectorAll(u.set).forEach(l=>{var m,p,f,h,S,b;const d=L.calculateSetPrice({is_suspended:i||l.classList.contains("is-suspended"),width_m:(m=l.querySelector('input[name="width_m"]'))==null?void 0:m.value,height_m:(p=l.querySelector('input[name="height_m"]'))==null?void 0:p.value,style:(f=l.querySelector('select[name="set_style"]'))==null?void 0:f.value,fabric_variant:(h=l.querySelector('select[name="fabric_variant"]'))==null?void 0:h.value,price_per_m_raw:(S=l.querySelector('select[name="set_price_per_m"]'))==null?void 0:S.value,sheer_price_per_m:(b=l.querySelector('select[name="sheer_price_per_m"]'))==null?void 0:b.value}).total;s+=d,d>0&&(t++,a++)}),o.querySelectorAll(u.decoItem).forEach(l=>{var m,p,f;const d=L.calculateDecoPrice({is_suspended:i||l.classList.contains("is-suspended"),width_m:(m=l.querySelector('input[name="deco_width_m"]'))==null?void 0:m.value,height_m:(p=l.querySelector('input[name="deco_height_m"]'))==null?void 0:p.value,price_sqyd:(f=l.querySelector('input[name="deco_price_sqyd"]'))==null?void 0:f.value}).total;s+=d,d>0&&(t++,a++)}),o.querySelectorAll(u.wallpaperItem).forEach(l=>{var m,p,f;const d=L.calculateWallpaperPrice({is_suspended:i||l.classList.contains("is-suspended"),height_m:(m=l.querySelector('input[name="wallpaper_height_m"]'))==null?void 0:m.value,price_per_roll:(p=l.querySelector('input[name="wallpaper_price_roll"]'))==null?void 0:p.value,install_cost_per_roll:(f=l.querySelector('input[name="wallpaper_install_cost"]'))==null?void 0:f.value,widths:Array.from(l.querySelectorAll('input[name="wall_width_m"]')).map(h=>h.value)}).total;s+=d,d>0&&(t++,a++)});const c=o.querySelector("[data-room-brief]");c&&(i?c.textContent="(ระงับชั่วคราว)":a>0?c.innerHTML=`<span>${a}</span> &bull; ${$(s)} บาท`:c.textContent=""),e+=i?0:s});const n=document.querySelector(u.grandTotal),r=document.querySelector(u.setCount);n&&(n.textContent=$(e)),r&&(r.textContent=t)}function le(e){if(!e||!e.rooms)return;const t=document.querySelector(u.roomsContainer);if(!t)return;t.innerHTML="";const n=document.querySelector("#customer_name"),r=document.querySelector("#customer_phone"),o=document.querySelector("#customer_address");n&&(n.value=e.customer_name||""),r&&(r.value=e.customer_phone||""),o&&(o.value=e.customer_address||""),e.rooms.forEach(s=>{const a=document.querySelector("#roomTpl");if(!a)return;const i=a.content.cloneNode(!0),c=i.querySelector(u.room);if(!c)return;c.id=s.id||`room-${Date.now()}`,s.is_suspended&&c.classList.add("is-suspended");const l=c.querySelector(u.roomNameInput);l&&(l.value=s.room_name||"ห้อง (ไม่มีชื่อ)");const d=c.querySelector(u.setsContainer),m=c.querySelector(u.decorationsContainer),p=c.querySelector(u.wallpapersContainer),f=document.querySelector("#setTpl"),h=document.querySelector("#decoTpl"),S=document.querySelector("#wallpaperTpl"),b=document.querySelector("#wallTpl");d&&f&&s.sets&&s.sets.forEach(_=>{const g=f.content.cloneNode(!0),y=g.querySelector(u.set);_.is_suspended&&y.classList.add("is-suspended"),y.querySelector('input[name="width_m"]').value=A(_.width_m),y.querySelector('input[name="height_m"]').value=A(_.height_m),y.querySelector('select[name="set_style"]').value=_.style||"ลอน",y.querySelector('select[name="fabric_variant"]').value=_.fabric_variant||"ทึบ",y.querySelector('select[name="set_price_per_m"]').value=_.price_per_m_raw||"",y.querySelector('select[name="sheer_price_per_m"]').value=_.sheer_price_per_m||"",y.querySelector('select[name="opening_style"]').value=_.opening_style||"แยกกลาง",y.querySelector('select[name="track_color"]').value=_.track_color||"ขาว",y.querySelector('input[name="fabric_code"]').value=_.fabric_code||"",y.querySelector('input[name="sheer_fabric_code"]').value=_.sheer_fabric_code||"",y.querySelector('input[name="notes"]').value=_.notes||"",_e(y),d.appendChild(g)}),m&&h&&s.decorations&&s.decorations.forEach(_=>{const g=h.content.cloneNode(!0),y=g.querySelector(u.decoItem);_.is_suspended&&y.classList.add("is-suspended");const N=y.querySelector('select[name="deco_type"]');N.value=_.type||"",y.querySelector(".deco-type-display").textContent=_.type||"ตกแต่ง",y.querySelector('input[name="deco_width_m"]').value=A(_.width_m),y.querySelector('input[name="deco_height_m"]').value=A(_.height_m),y.querySelector('input[name="deco_price_sqyd"]').value=$(_.price_sqyd)||"",y.querySelector('input[name="deco_code"]').value=_.deco_code||"",y.querySelector('input[name="deco_notes"]').value=_.notes||"",m.appendChild(g)}),p&&S&&s.wallpapers&&s.wallpapers.forEach(_=>{const g=S.content.cloneNode(!0),y=g.querySelector(u.wallpaperItem);_.is_suspended&&y.classList.add("is-suspended"),y.querySelector('input[name="wallpaper_height_m"]').value=A(_.height_m),y.querySelector('input[name="wallpaper_code"]').value=_.wallpaper_code||"",y.querySelector('input[name="wallpaper_price_roll"]').value=$(_.price_per_roll)||"",y.querySelector('input[name="wallpaper_install_cost"]').value=_.hasOwnProperty("install_cost_per_roll")?$(_.install_cost_per_roll):"300",y.querySelector('input[name="wallpaper_notes"]').value=_.notes||"";const N=y.querySelector(u.wallsContainer);N&&b&&_.widths&&_.widths.forEach(T=>{const k=b.content.cloneNode(!0);k.querySelector('input[name="wall_width_m"]').value=A(T),N.appendChild(k)}),p.appendChild(g)}),t.appendChild(i)}),document.querySelectorAll("input[data-favorite-type]").forEach(Y),document.querySelectorAll(".item-card").forEach(s=>{J(s)}),re(),P(),oe(),H(),W(),w("นำเข้าข้อมูลสำเร็จ","success")}function Ye(e,t){const n=document.querySelector(u.printableContent);!n||!e||!e.html||(n.innerHTML=e.html,setTimeout(()=>{if(t==="direct"){const r=document.getElementById("quotation-template");r&&html2pdf().from(r).set({margin:[15,12,10,12],filename:`${e.fileName}.pdf`,pagebreak:{mode:["css","legacy"]},html2canvas:{scale:2,useCORS:!0},jsPDF:{unit:"mm",format:"a4",orientation:"portrait"}}).save().then(()=>{n.innerHTML=""})}else t==="print"&&(window.print(),n.innerHTML="")},ge))}function Ge(e){if(!e||!e.html)return;const t=new Blob([e.html],{type:"text/html;charset=utf-8"}),n=URL.createObjectURL(t),r=document.createElement("a");r.href=n,r.download=`${e.fileName}.html`,r.click(),URL.revokeObjectURL(n),w("Export ไฟล์ HTML สำเร็จ","success")}const Je=e=>{var s,a;const t=e.target.closest("[data-act]");if(!t||B&&!t.closest(".unlockable")&&t.dataset.act!=="select-favorite")return;const n=t.dataset.act,r=t.closest(u.room),o=(i,c,l)=>{z(i,c).then(d=>{d&&l()})};switch(n){case"add-room":Z();break;case"add-set":Ae(r);break;case"add-deco":De(r);break;case"add-wallpaper":Oe(r);break;case"add-wall":he(t);break;case"del-room":o("ลบห้อง","ยืนยันการลบห้องนี้?",()=>U(r,"ลบห้องแล้ว"));break;case"del-set":o("ลบรายการ","ยืนยันการลบรายการผ้าม่าน?",()=>U(t.closest(u.set),"ลบรายการผ้าม่านแล้ว"));break;case"del-deco":o("ลบรายการ","ยืนยันการลบรายการตกแต่ง?",()=>U(t.closest(u.decoItem),"ลบรายการตกแต่งแล้ว"));break;case"del-wallpaper":o("ลบรายการ","ยืนยันการลบรายการวอลเปเปอร์?",()=>U(t.closest(u.wallpaperItem),"ลบรายการวอลเปเปอร์แล้ว"));break;case"del-wall":o("ลบผนัง","ยืนยันการลบผนังนี้?",()=>U(t.closest(".wall-input-row"),"ลบผนังแล้ว"));break;case"clear-room":o("ล้างข้อมูลในห้อง","ยืนยันลบทุกรายการในห้องนี้?",()=>{r.querySelector(u.setsContainer).innerHTML="",r.querySelector(u.decorationsContainer).innerHTML="",r.querySelector(u.wallpapersContainer).innerHTML="",re(),P(),F(),w("ล้างข้อมูลในห้องแล้ว","success")});break;case"toggle-room-menu":e.preventDefault();const i=t.nextElementSibling;if(!i||!r)return;const c=!i.classList.contains("show");document.querySelectorAll(".room-options-menu.show").forEach(l=>l.classList.remove("show")),document.querySelectorAll(".card.overflow-visible").forEach(l=>l.classList.remove("overflow-visible")),c&&(i.classList.add("show"),r.classList.add("overflow-visible"));break;case"toggle-suspend-room":e.preventDefault(),r==null||r.classList.toggle("is-suspended"),P(),F(),(s=t.closest(".room-options-menu"))==null||s.classList.remove("show"),r==null||r.classList.remove("overflow-visible");break;case"toggle-suspend":e.preventDefault(),(a=t.closest(".item-card"))==null||a.classList.toggle("is-suspended"),J(t),F();break;case"toggle-favorite":{const l=t.dataset.type,d=t.previousElementSibling,m=d==null?void 0:d.value;if(!m||m.trim()===""){w("กรุณากรอกรหัสก่อนบันทึก","warning");return}const p=t.closest(".item-card");if(!p)return;let f=0,h=null;l==="fabric"&&(h=p.querySelector('[name="set_price_per_m"]')),l==="sheer"&&(h=p.querySelector('[name="sheer_price_per_m"]')),l==="deco"&&(h=p.querySelector('[name="deco_price_sqyd"]')),l==="wallpaper"&&(h=p.querySelector('[name="wallpaper_price_roll"]')),h&&h.value&&(f=v(h.value));const S=ie(l,m,f);Y(d),w(S?"บันทึกรหัสโปรดแล้ว":"ลบรหัสโปรดแล้ว","success");break}case"select-favorite":{const l=t.dataset.code,d=t.dataset.price,m=t.closest(".form-group-with-favorites"),p=m?m.querySelector("input[data-favorite-type]"):ce;if(p){p.value=l;const f=t.closest(".item-card");if(f&&d){const h=p.dataset.favoriteType;let S=null;h==="fabric"&&(S=f.querySelector('[name="set_price_per_m"]')),h==="sheer"&&(S=f.querySelector('[name="sheer_price_per_m"]')),h==="deco"&&(S=f.querySelector('[name="deco_price_sqyd"]')),h==="wallpaper"&&(S=f.querySelector('[name="wallpaper_price_roll"]')),S&&(S.tagName==="SELECT"?S.value=d:S.value=$(v(d)),S.dispatchEvent(new Event("change",{bubbles:!0})))}p.dispatchEvent(new Event("input",{bubbles:!0})),te(),w(`เลือกโค้ด ${l} แล้ว`,"success")}break}case"manage-favorites":{e.preventDefault();const l=t.dataset.type;te(),Pe(l);break}}};function Qe(){B=!B,me()}function Ke(){const e=document.querySelector(u.setTpl);if(!e)return;const t=e.content.querySelector('select[name="set_price_per_m"]'),n=e.content.querySelector('select[name="sheer_price_per_m"]'),r=o=>{let s='<option value="" hidden>เลือกราคา</option>';return o.forEach(a=>{s+=`<option value="${a}">${a.toLocaleString("th-TH")}</option>`}),s};t&&(t.innerHTML=r(ee.fabric)),n&&(n.innerHTML=r(ee.sheer))}function Xe(){Ke(),de();const e=document.querySelector(u.orderForm),t=document.querySelector(u.fileImporter),n=document.querySelector(u.menuDropdown),r=document.querySelector(u.quickNavDropdown),o=document.querySelector("#pageBreakBuffer"),s=document.querySelector("#pageBreakBufferValue");o&&s&&o.addEventListener("input",()=>{s.textContent=o.value}),e.addEventListener("input",We),e.addEventListener("change",Ue),e.addEventListener("click",Je),e.addEventListener("blur",je,!0),e.addEventListener("focusin",Ve);const a=c=>{const l=c.target.closest(u.room);l&&pe(l)};e.addEventListener("click",a),e.addEventListener("focusin",a),document.body.addEventListener("click",c=>{c.target.closest("summary")&&setTimeout(H,50)}),document.querySelector(u.lockBtn).addEventListener("click",Qe),document.querySelector(u.toggleAllRoomsBtn).addEventListener("click",Me),document.querySelector(u.quickNavBtn).addEventListener("click",c=>{c.stopPropagation(),n.classList.remove("show"),r.classList.toggle("show")}),document.querySelector(u.quickNavRoomList).addEventListener("click",c=>{const l=c.target.closest("a[data-jump-to]");if(l){c.preventDefault();const d=l.dataset.jumpTo,m=document.getElementById(d);m&&(document.body.classList.add("disable-animations"),m.open=!0,m.scrollIntoView({behavior:"auto",block:"start"}),m.classList.add("scrolling-jump"),setTimeout(()=>{m.classList.remove("scrolling-jump"),document.body.classList.remove("disable-animations"),H()},1e3)),r.classList.remove("show")}});const i=document.querySelector("#addRoomQuickNavBtn");if(i){const c=we(Z,700);i.addEventListener("click",l=>{l.stopPropagation(),c(),r.classList.remove("show")})}document.querySelector(u.menuBtn).addEventListener("click",c=>{c.stopPropagation(),r.classList.remove("show"),n.classList.toggle("show")}),document.querySelector("#themeToggleBtn").addEventListener("click",c=>{c.preventDefault(),Ie()}),document.querySelector("#overviewBtn").addEventListener("click",async c=>{c.preventDefault(),n.classList.remove("show");const l=O(),d=Te(l),m=document.querySelector("#overviewModalBody");m&&(m.innerHTML=d,j("#overviewModal",()=>{}))}),document.querySelector(u.exportPdfBtn).addEventListener("click",async c=>{c.preventDefault(),n.classList.remove("show");const l=await Ne();if(!l)return;const d=O(),m=l.vatOption==="include"?C.baseVatRate:0,p=ke(d,{vatRate:m,pageBreakBuffer:l.pageBreakBuffer});if(!p){w("ไม่มีรายการที่มีราคาสำหรับสร้างเอกสาร","warning");return}l.exportMethod==="html"?Ge(p):Ye(p,l.exportMethod)}),document.querySelector(u.importBtn).addEventListener("click",c=>{c.preventDefault(),n.classList.remove("show"),t.click()}),t.addEventListener("change",c=>{var m;const l=(m=c.target.files)==null?void 0:m[0];if(!l)return;const d=new FileReader;d.onload=p=>{try{const f=JSON.parse(p.target.result);le(f)}catch{w("ไฟล์ JSON ไม่ถูกต้อง","error")}},d.readAsText(l),c.target.value=null}),document.querySelector(u.exportBtn).addEventListener("click",c=>{c.preventDefault(),n.classList.remove("show");try{const l=O(),d=JSON.stringify(l,null,4),m=new Blob([d],{type:"application/json"}),p=URL.createObjectURL(m),f=document.createElement("a"),h=new Date,S=`${h.getFullYear()}${(h.getMonth()+1).toString().padStart(2,"0")}${h.getDate().toString().padStart(2,"0")}`,b=(l.customer_name||"data").trim().replace(/\s+/g,"-");f.href=p,f.download=`MTR-${b}-${S}.json`,f.click(),URL.revokeObjectURL(p),w("Export ข้อมูลสำเร็จ","success")}catch{w("Export ข้อมูลล้มเหลว","error")}}),document.querySelector(u.submitBtn).addEventListener("click",async c=>{if(c.preventDefault(),n.classList.remove("show"),await z("ส่งข้อมูล","ยืนยันการส่งข้อมูลการประเมินราคา?")){const l=O();if(!l.customer_name&&!l.customer_phone){w("กรุณาระบุชื่อหรือเบอร์โทรลูกค้า","warning");return}w("กำลังส่งข้อมูล...","default");try{const d=await fetch(ve,{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});d.ok?w("ส่งข้อมูลสำเร็จ!","success"):w(`ส่งข้อมูลล้มเหลว: ${d.status}`,"error")}catch{w("เกิดข้อผิดพลาดในการเชื่อมต่อ","error")}}}),document.querySelector(u.copyTextBtn).addEventListener("click",async c=>{c.preventDefault(),n.classList.remove("show");const l=document.querySelector(u.copyOptionsModal);if(l.querySelector('input[name="copy_option"][value="customer"]').checked=!0,await j(u.copyOptionsModal)){const d=l.querySelector('input[name="copy_option"]:checked').value,m=$e(O(),d);try{await navigator.clipboard.writeText(m),w("คัดลอกสรุปสำเร็จ!","success")}catch{w("คัดลอกล้มเหลว","error")}}}),document.querySelector(u.clearItemsBtn).addEventListener("click",async c=>{c.preventDefault(),n.classList.remove("show"),await z("ล้างทุกรายการ","คุณแน่ใจหรือไม่ว่าต้องการลบรายการสินค้าทั้งหมด (ข้อมูลลูกค้าและห้องจะยังคงอยู่)?")&&(document.querySelectorAll(u.room).forEach(l=>{l.querySelector(u.setsContainer).innerHTML="",l.querySelector(u.decorationsContainer).innerHTML="",l.querySelector(u.wallpapersContainer).innerHTML=""}),P(),F(),w("ล้างทุกรายการแล้ว","success"))}),document.querySelector(u.clearAllBtn).addEventListener("click",async c=>{c.preventDefault(),n.classList.remove("show"),await z("ลบข้อมูลทั้งหมด","คุณแน่ใจหรือไม่ว่าต้องการลบข้อมูลทั้งหมดในฟอร์มนี้? การกระทำนี้ไม่สามารถย้อนกลับได้")&&(localStorage.removeItem(X),localStorage.removeItem("marnthara.theme"),Be(),window.location.reload())}),window.addEventListener("click",c=>{c.target.closest(".menu-container")||(n.classList.remove("show"),r.classList.remove("show")),c.target.closest(".room-options-container")||(document.querySelectorAll(".room-options-menu.show").forEach(l=>l.classList.remove("show")),document.querySelectorAll(".card.overflow-visible").forEach(l=>l.classList.remove("overflow-visible"))),c.target.closest(".form-group-with-favorites")||te()});try{const c=localStorage.getItem(X);if(c)le(JSON.parse(c));else{Z();const l=document.querySelector("#customerDetailsCard");l&&(l.open=!0)}}catch{localStorage.removeItem(X),Z()}P(),me(),H(),W()}document.addEventListener("DOMContentLoaded",Xe);
