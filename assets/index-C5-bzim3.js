(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(a){if(a.ep)return;a.ep=!0;const s=n(a);fetch(a.href,s)}})();const Qe="input-ui/5.7.0",ze="https://your-make-webhook-url.com/your-unique-path",fe="marnthara.input.v5",Xe=500,F={name:"‡∏°‡πà‡∏≤‡∏ô‡∏ò‡∏≤‡∏£‡∏≤ ‡∏ú‡πâ‡∏≤‡∏°‡πà‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏Ç‡∏≠‡∏á‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á",address:"65/8 ‡∏´‡∏°‡∏π‡πà 2 ‡∏ï.‡∏ó‡πà‡∏≤‡∏®‡∏≤‡∏•‡∏≤ ‡∏≠.‡πÄ‡∏°‡∏∑‡∏≠‡∏á ‡∏à.‡∏•‡∏û‡∏ö‡∏∏‡∏£‡∏µ 15000",phone:"092-985-9395, 082-552-5595",taxId:"1234567890123",logoUrl:"./assets/logo.png",baseVatRate:.07,pdf:{paymentTerms:"‡∏ä‡∏≥‡∏£‡∏∞‡∏°‡∏±‡∏î‡∏à‡∏≥ 50%",priceValidity:"30 ‡∏ß‡∏±‡∏ô",notes:["‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ô‡∏µ‡πâ‡∏£‡∏ß‡∏°‡∏Ñ‡πà‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏•‡πâ‡∏ß","‡∏ä‡∏≥‡∏£‡∏∞‡∏°‡∏±‡∏î‡∏à‡∏≥ 50% ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ú‡∏•‡∏¥‡∏ï‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤","‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏≤‡∏¢‡∏∏ 30 ‡∏ß‡∏±‡∏ô ‡∏ô‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤"]}},Ze=1.19599,we={ROLL_WIDTH_M:.53,ROLL_LENGTH_M:10,STRIPS_PER_ROLL_UNDER_2_5M:3},ye={fabric:[1e3,1100,1200,1300,1400,1500,1600,1700,1800,1900,2e3,2100,2200],sheer:[1e3,1100,1200,1300,1400,1500],style_surcharge:{‡∏•‡∏≠‡∏ô:200,‡∏ï‡∏≤‡πÑ‡∏Å‡πà:0,‡∏à‡∏µ‡∏ö:0},height:[{threshold:3.2,add_per_m:300},{threshold:2.8,add_per_m:200},{threshold:2.5,add_per_m:100}]},h={orderForm:"#orderForm",roomsContainer:"#rooms",setTpl:"#setTpl",wallTpl:"#wallTpl",clearAllBtn:"#clearAllBtn",lockBtn:"#lockBtn",grandTotal:"#grandTotal",modal:"#confirmationModal",modalTitle:"#modalTitle",modalBody:"#modalBody",room:"[data-room]",allItemsContainer:"[data-all-items]",wallsContainer:"[data-walls-container]",sheerWrap:"[data-sheer-wrap]",sheerCodeWrap:"[data-sheer-code-wrap]",roomNameInput:'input[name="room_name"]',toastContainer:"#toast-container",copyTextBtn:"#copyTextBtn",copyOptionsModal:"#copyOptionsModal",menuBtn:"#menuBtn",menuDropdown:"#menuDropdown",importBtn:"#importBtn",exportBtn:"#exportBtn",fileImporter:"#fileImporter",submitBtn:"#submitBtn",clearItemsBtn:"#clearItemsBtn",exportPdfBtn:"#exportPdfBtn",exportOptionsModal:"#exportOptionsModal",printableContent:"#printable-content",quickNavBtn:"#quickNavBtn",quickNavDropdown:"#quickNavDropdown",quickNavRoomList:"#quickNavRoomList",toggleAllRoomsBtn:"#toggleAllRoomsBtn"},g=e=>{typeof e=="string"&&(e=e.replace(/,/g,""));const t=parseFloat(e);return Number.isFinite(t)?t:0},X=e=>{const t=g(e);return t>0?t.toFixed(2):""},H=(e,t=2,n=!1)=>Number.isFinite(e)?e.toLocaleString("en-US",{minimumFractionDigits:n?2:t,maximumFractionDigits:n?2:t}):"0",x=(e,t=0)=>Number.isFinite(e)?e.toLocaleString("th-TH",{minimumFractionDigits:t,maximumFractionDigits:t}):"0",et=(e,t=150)=>{let n;return(...r)=>{clearTimeout(n),n=setTimeout(()=>e(...r),t)}},tt=(e,t=700)=>{let n=!1;return(...r)=>{if(!n){n=!0;try{return e(...r)}finally{setTimeout(()=>{n=!1},t)}}}},T=e=>typeof e!="string"?"":e.replace(/[&<>"']/g,function(t){switch(t){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";default:return"&#039;"}}),We=e=>typeof e!="string"?"":e.replace(/[\\/?%*:|"<>\x00-\x1f]/g,"").trim()||"file";function rt(e){let t=g(e);if(isNaN(t))return"‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á";if(t===0)return"‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ö‡∏≤‡∏ó‡∏ñ‡πâ‡∏ß‡∏ô";const n=["","‡∏´‡∏ô‡∏∂‡πà‡∏á","‡∏™‡∏≠‡∏á","‡∏™‡∏≤‡∏°","‡∏™‡∏µ‡πà","‡∏´‡πâ‡∏≤","‡∏´‡∏Å","‡πÄ‡∏à‡πá‡∏î","‡πÅ‡∏õ‡∏î","‡πÄ‡∏Å‡πâ‡∏≤"],r=["","‡∏™‡∏¥‡∏ö","‡∏£‡πâ‡∏≠‡∏¢","‡∏û‡∏±‡∏ô","‡∏´‡∏°‡∏∑‡πà‡∏ô","‡πÅ‡∏™‡∏ô","‡∏•‡πâ‡∏≤‡∏ô"];let a=Math.floor(t),s=Math.round((t-a)*100);const o=c=>{if(c===0)return"";let d="";const f=String(c);for(let p=0;p<f.length;p++){const _=f[p];f.length-1;const v=f.length-p-1;_!=="0"&&(v===1&&_==="1"?d+=r[v]:v===1&&_==="2"?d+="‡∏¢‡∏µ‡πà"+r[v]:v===0&&_==="1"&&f.length>1?d+="‡πÄ‡∏≠‡πá‡∏î":d+=n[parseInt(_)]+r[v])}return d};let l="";if(a>0){const c=Math.floor(a/1e6),d=a%1e6;c>0&&(l+=o(c)+"‡∏•‡πâ‡∏≤‡∏ô"),l+=o(d),l+="‡∏ö‡∏≤‡∏ó"}let m="";return s>0?m=o(s)+"‡∏™‡∏ï‡∏≤‡∏á‡∏Ñ‡πå":l+="‡∏ñ‡πâ‡∏ß‡∏ô",(l+m).trim()}const Ce="marnthara.favorites.v4",he={fabric:[],sheer:[],wallpaper:[],wooden_blind:[],roller_blind:[],vertical_blind:[],partition:[],pleated_screen:[],aluminum_blind:[]};function Q(){try{const e=localStorage.getItem(Ce);return e?{...he,...JSON.parse(e)}:he}catch(e){return console.error("Failed to parse favorites from localStorage",e),he}}function ge(e){try{localStorage.setItem(Ce,JSON.stringify(e))}catch(t){console.error("Failed to save favorites to localStorage",t)}}function Oe(e){if(!e||typeof e!="object")return console.error("Invalid favorites data for import."),!1;const t={...he,...e};return ge(t),!0}function Ue(e){if(!e||typeof e!="object")return console.error("Invalid favorites data for merge."),0;const t=Q();let n=0;for(const r in e)Object.hasOwnProperty.call(e,r)&&Array.isArray(e[r])&&(t[r]||(t[r]=[]),e[r].forEach(a=>{!t[r].some(o=>o.code===a.code)&&a.code&&(t[r].push(a),n++)}),t[r].sort((a,s)=>a.code.localeCompare(s.code)));return n>0&&ge(t),n}function ot(e,t,n){const r=Q();r[e]||(r[e]=[]);const a=r[e],s=a.find(o=>o.code===t);return s?s.price=n:a.push({code:t,price:n}),a.sort((o,l)=>o.code.localeCompare(l.code)),ge(r),!0}function Te(e,t){const n=Q();if(!n[e])return!1;const r=n[e].findIndex(a=>a.code===t);return r>-1?(n[e].splice(r,1),ge(n),!0):!1}function Ie(e,t){if(!e||!t)return;const n=Q(),r=t.trim();return(n[e]||[]).find(s=>s.code===r)}function nt(e,t){return!!Ie(e,t)}function qe(e,t,n){const r=Ie(e,t);return r&&r.price===n?(Te(e,t),!1):(ot(e,t,n),!0)}function at(){localStorage.removeItem(Ce),console.log("All favorites have been cleared.")}function D(){var n,r,a,s,o,l;const e=Q(),t={app_version:Qe,customer_name:((n=document.querySelector('[name="customer_name"]'))==null?void 0:n.value)||"",customer_phone:((r=document.querySelector('[name="customer_phone"]'))==null?void 0:r.value)||"",customer_address:((a=document.querySelector('[name="customer_address"]'))==null?void 0:a.value)||"",customer_card_open:(s=document.querySelector("#customerDetailsCard"))==null?void 0:s.open,discount:{type:((o=document.querySelector("#discount_type"))==null?void 0:o.value)||"amount",value:g((l=document.querySelector("#discount_value"))==null?void 0:l.value)},rooms:[],favorites:e};return document.querySelectorAll(h.room).forEach(m=>{var d,f;const c={id:m.id,room_name:((d=m.querySelector(h.roomNameInput))==null?void 0:d.value)||"",is_suspended:m.classList.contains("is-suspended"),is_open:m.open,items:[]};(f=m.querySelector(h.allItemsContainer))==null||f.childNodes.forEach(p=>{var u,i,y,b,$,q,S,L,M,A,N,k,C,B,W,O,Y,z,te,R,de,Ne,Fe,Pe;if(p.nodeType!==1||!p.matches(".item-card"))return;const _=p.dataset.type;if(!_)return;let v={type:_,is_suspended:p.classList.contains("is-suspended")};_==="set"?Object.assign(v,{width_m:g((u=p.querySelector('input[name="width_m"]'))==null?void 0:u.value),height_m:g((i=p.querySelector('input[name="height_m"]'))==null?void 0:i.value),style:((y=p.querySelector('select[name="set_style"]'))==null?void 0:y.value)||"",fabric_variant:((b=p.querySelector('select[name="fabric_variant"]'))==null?void 0:b.value)||"",price_per_m_raw:g(($=p.querySelector('select[name="set_price_per_m"]'))==null?void 0:$.value),sheer_price_per_m:g((q=p.querySelector('select[name="sheer_price_per_m"]'))==null?void 0:q.value),fabric_code:((S=p.querySelector('input[name="fabric_code"]'))==null?void 0:S.value)||"",sheer_fabric_code:((L=p.querySelector('input[name="sheer_fabric_code"]'))==null?void 0:L.value)||"",opening_style:((M=p.querySelector('select[name="opening_style"]'))==null?void 0:M.value)||"",track_color:((A=p.querySelector('input[name="track_color"]'))==null?void 0:A.value)||"‡∏Ç‡∏≤‡∏ß",bracket_color:((N=p.querySelector('input[name="bracket_color"]'))==null?void 0:N.value)||"‡∏Ç‡∏≤‡∏ß",finial_color:((k=p.querySelector('input[name="finial_color"]'))==null?void 0:k.value)||"‡∏Ç‡∏≤‡∏ß",grommet_color:((C=p.querySelector('input[name="grommet_color"]'))==null?void 0:C.value)||"‡πÄ‡∏á‡∏¥‡∏ô",notes:((B=p.querySelector('input[name="notes"]'))==null?void 0:B.value)||""}):_==="wallpaper"?Object.assign(v,{height_m:g((W=p.querySelector('[name="wallpaper_height_m"]'))==null?void 0:W.value),wallpaper_code:((O=p.querySelector('[name="wallpaper_code"]'))==null?void 0:O.value)||"",price_per_roll:g((Y=p.querySelector('[name="wallpaper_price_roll"]'))==null?void 0:Y.value),install_cost_per_roll:g((z=p.querySelector('[name="wallpaper_install_cost"]'))==null?void 0:z.value),notes:((te=p.querySelector('[name="wallpaper_notes"]'))==null?void 0:te.value)||"",widths:Array.from(p.querySelectorAll('[name="wall_width_m"]')).map(Ke=>g(Ke.value))}):p.matches(".area-based-item")&&Object.assign(v,{width_m:g((R=p.querySelector('[name="area_width_m"]'))==null?void 0:R.value),height_m:g((de=p.querySelector('[name="area_height_m"]'))==null?void 0:de.value),price_sqyd:g((Ne=p.querySelector('[name="area_price_sqyd"]'))==null?void 0:Ne.value),code:((Fe=p.querySelector('[name="area_code"]'))==null?void 0:Fe.value)||"",notes:((Pe=p.querySelector('[name="area_notes"]'))==null?void 0:Pe.value)||""}),c.items.push(v)}),t.rooms.push(c)}),t}function I(){try{localStorage.setItem(fe,JSON.stringify(D()))}catch(e){console.error("Failed to save data to localStorage:",e)}}const E={stylePlus:e=>ye.style_surcharge[e]??0,heightPlus:e=>{const t=[...ye.height].sort((n,r)=>r.threshold-n.threshold);for(const n of t)if(e>n.threshold)return n.add_per_m;return 0},fabricYardage:(e,t)=>{const n=g(t);return n<=0||!e?0:e==="‡∏ï‡∏≤‡πÑ‡∏Å‡πà"||e==="‡∏à‡∏µ‡∏ö"?(n*2+.6)/.9:e==="‡∏•‡∏≠‡∏ô"?(n*2.6+.6)/.9:0},calculateGrommets:e=>{const t=g(e);if(t<=0)return 0;const a=Math.ceil(t/.3)*.3/.15;return Math.round(a)},wallpaperRolls:(e,t)=>{const n=g(e),r=g(t);if(n<=0||r<=0)return 0;const a=r>2.5?Math.floor(we.ROLL_LENGTH_M/r):we.STRIPS_PER_ROLL_UNDER_2_5M;if(a<=0)return 0;const s=Math.ceil(n/we.ROLL_WIDTH_M);return Math.ceil(s/a)},calculateSetPrice:function(e){var o,l;if(!e||e.is_suspended||g(e.width_m)<=0)return{total:0,opaque:0,sheer:0};const t=this.stylePlus(e.style),n=this.heightPlus(g(e.height_m)),r=g(e.width_m),a=(o=e.fabric_variant)!=null&&o.includes("‡∏ó‡∏∂‡∏ö")&&g(e.price_per_m_raw)>0?(g(e.price_per_m_raw)+t+n)*r:0,s=(l=e.fabric_variant)!=null&&l.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")&&g(e.sheer_price_per_m)>0?(g(e.sheer_price_per_m)+t+n)*r:0;return{total:Math.round(a+s),opaque:Math.round(a),sheer:Math.round(s)}},calculateDecoPrice:function(e){if(!e||e.is_suspended||g(e.width_m)<=0||g(e.height_m)<=0)return{total:0,sqm:0,sqyd:0};const t=g(e.width_m)*g(e.height_m),n=t*Ze,r=n*g(e.price_sqyd);return{total:Math.round(r),sqm:t,sqyd:n}},calculateWallpaperPrice:function(e){var o;if(!e||e.is_suspended)return{total:0,material:0,install:0,rolls:0,sqm:0};const t=((o=e.widths)==null?void 0:o.reduce((l,m)=>l+g(m),0))||0;if(t<=0)return{total:0,material:0,install:0,rolls:0,sqm:0};const n=g(e.height_m),r=this.wallpaperRolls(t,n),a=r*g(e.price_per_roll),s=r*g(e.install_cost_per_roll??300);return{total:Math.round(a+s),material:Math.round(a),install:Math.round(s),rolls:r,sqm:t*n}}},le={set:"‡∏ú‡πâ‡∏≤‡∏°‡πà‡∏≤‡∏ô",wallpaper:"‡∏ß‡∏≠‡∏•‡∏•‡πå‡πÄ‡∏õ‡πÄ‡∏õ‡∏≠‡∏£‡πå",wooden_blind:"‡∏°‡∏π‡πà‡∏•‡∏µ‡πà‡πÑ‡∏°‡πâ",roller_blind:"‡∏°‡πà‡∏≤‡∏ô‡∏°‡πâ‡∏ß‡∏ô",vertical_blind:"‡∏°‡πà‡∏≤‡∏ô‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏á",partition:"‡∏â‡∏≤‡∏Å‡∏Å‡∏±‡πâ‡∏ô‡∏´‡πâ‡∏≠‡∏á",pleated_screen:"‡∏°‡∏∏‡πâ‡∏á‡∏à‡∏µ‡∏ö",aluminum_blind:"‡∏°‡∏π‡πà‡∏•‡∏µ‡πà‡∏≠‡∏•‡∏π‡∏°‡∏¥‡πÄ‡∏ô‡∏µ‡∏¢‡∏°"};function Re(e){let t=`
üìÑ *‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤)*
`,n=!1;return e.rooms.forEach(r=>{if(r.is_suspended||!r.items)return;const a=r.items.filter(o=>o.is_suspended?!1:o.type==="wallpaper"?(o.widths||[]).reduce((l,m)=>l+m,0)>0:o.width_m>0);if(a.length===0)return;n=!0,t+=`
*‡∏´‡πâ‡∏≠‡∏á: ${r.room_name||"‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏"}*
`;let s=0;a.forEach(o=>{s++;const l=le[o.type]||"‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á";o.type==="set"?t+=` ${s}) ${l} ${o.style} (${o.fabric_variant})
`:t+=` ${s}) ${l}
`})}),n?t+`------------------------------
`:""}function st(e){return e.rooms.reduce((t,n)=>{var a;if(n.is_suspended)return t;const r=((a=n.items)==null?void 0:a.reduce((s,o)=>{if(o.is_suspended)return s;switch(o.type){case"set":return s+E.calculateSetPrice(o).total;case"wallpaper":return s+E.calculateWallpaperPrice(o).total;default:return s+E.calculateDecoPrice(o).total}},0))||0;return t+r},0)}function lt(e,t){const n=st(e);let r=0,a="";e.discount&&e.discount.value>0&&(e.discount.type==="percent"?(r=n*(e.discount.value/100),a=`‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î (${e.discount.value}%): -${x(r)} ‡∏ö‡∏≤‡∏ó
`):(r=e.discount.value,a=`‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î: -${x(r)} ‡∏ö‡∏≤‡∏ó
`));const s=n-r;let o=`‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (${new Date().toLocaleDateString("th-TH",{day:"numeric",month:"numeric",year:"numeric"})})
`;if(o+=`‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤: ${e.customer_name||"-"}
`,(t==="customer"||t==="owner")&&(o+=`‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£: ${e.customer_phone||"-"}
`,o+=`‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà: ${e.customer_address||"-"}
`),o+=`------------------------------
`,t==="customer")return o+=Re(e).replace(" (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤)",""),r>0&&(o+=`
‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: ${x(n)} ‡∏ö‡∏≤‡∏ó
`,o+=a),o+=`
‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥: ${x(s)} ‡∏ö‡∏≤‡∏ó
`,o+=`
‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£
${F.name}
‡πÇ‡∏ó‡∏£: ${F.phone}`,o;if(t==="purchase_order"||t==="owner"){t==="owner"&&(o+=Re(e));const l={opaqueFabrics:[],sheerFabrics:[],decorations:{},wallpapers:[],allSets:[]};e.rooms.forEach(u=>{u.is_suspended||!u.items||u.items.forEach(i=>{const y=i.type==="set"||i.type.includes("_blind")||i.type==="partition"||i.type==="pleated_screen";if(!(i.is_suspended||y&&i.width_m<=0))switch(i.type){case"set":l.allSets.push(i),i.fabric_variant.includes("‡∏ó‡∏∂‡∏ö")&&l.opaqueFabrics.push({code:i.fabric_code||"??",yards:E.fabricYardage(i.style,i.width_m)}),i.fabric_variant.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")&&l.sheerFabrics.push({code:i.sheer_fabric_code||"??",yards:E.fabricYardage(i.style,i.width_m)});break;case"wallpaper":const b=(i.widths||[]).reduce((q,S)=>q+S,0);if(b>0){const q=E.wallpaperRolls(b,i.height_m);q>0&&l.wallpapers.push({code:i.wallpaper_code||"xxx",rolls:q})}break;default:const $=le[i.type]||i.type;l.decorations[$]||(l.decorations[$]=[]),l.decorations[$].push({code:i.code||"xxx",width:i.width_m,height:i.height_m});break}})});const m={};if([...l.opaqueFabrics,...l.sheerFabrics].forEach(u=>{m[u.code]=(m[u.code]||0)+u.yards}),Object.keys(m).length>0){o+=`üìã *‡πÅ‡∏à‡∏Å‡πÅ‡∏à‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ (‡∏ú‡πâ‡∏≤)*
`,o+=`------------------------------
`,l.opaqueFabrics.length>0&&l.opaqueFabrics.forEach(u=>{o+=`- ‡∏ú‡πâ‡∏≤‡∏ó‡∏∂‡∏ö (Curtain Fabric)
`,o+=`  ‡∏£‡∏´‡∏±‡∏™: #${u.code||"??"}
`,o+=`  ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${u.yards.toFixed(2)} ‡∏´‡∏•‡∏≤

`}),l.sheerFabrics.length>0&&l.sheerFabrics.forEach(u=>{o+=`- ‡∏ú‡πâ‡∏≤‡πÇ‡∏õ‡∏£‡πà‡∏á (Sheer Fabric)
`,o+=`  ‡∏£‡∏´‡∏±‡∏™: #${u.code||"??"}
`,o+=`  ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${u.yards.toFixed(2)} ‡∏´‡∏•‡∏≤

`}),o+=`------------------------------
`,o+=`üìä *‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ú‡πâ‡∏≤ (‡∏ï‡∏≤‡∏°‡∏£‡∏´‡∏±‡∏™)*
`,o+=`------------------------------
`;for(const[u,i]of Object.entries(m))o+=`  - ‡∏£‡∏´‡∏±‡∏™ #${u}: ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${i.toFixed(2)} ‡∏´‡∏•‡∏≤
`;o+=`
`}const c=l.allSets.filter(u=>u.style==="‡∏ï‡∏≤‡πÑ‡∏Å‡πà"),d=l.allSets.filter(u=>u.style!=="‡∏ï‡∏≤‡πÑ‡∏Å‡πà");if(d.length>0){o+=`------------------------------
`,o+=`üìã *‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ ‡∏£‡∏≤‡∏á (‡∏•‡∏≠‡∏ô/‡∏à‡∏µ‡∏ö)*
`,o+=`------------------------------

`;let u=1;d.forEach(i=>{o+=`(${u++}) ‡∏£‡∏≤‡∏á‡∏°‡πà‡∏≤‡∏ô: ${i.style}, ‡∏™‡∏µ‡∏£‡∏≤‡∏á/‡∏Ç‡∏≤: ${i.track_color}
`,i.fabric_variant.includes("‡∏ó‡∏∂‡∏ö")&&(o+=`  - ‡∏£‡∏≤‡∏á‡∏ó‡∏∂‡∏ö: ${Number(i.width_m).toFixed(2)} ‡∏°. (1 ‡πÄ‡∏™‡πâ‡∏ô)
`),i.fabric_variant.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")&&(o+=`  - ‡∏£‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πà‡∏á: ${Number(i.width_m).toFixed(2)} ‡∏°. (1 ‡πÄ‡∏™‡πâ‡∏ô)
`),i.fabric_variant==="‡∏ó‡∏∂‡∏ö&‡πÇ‡∏õ‡∏£‡πà‡∏á"&&(o+=`  (‚ùóÔ∏è‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏Ç‡∏≤‡∏™‡∏≠‡∏á‡∏ä‡∏±‡πâ‡∏ô)
`),i.notes&&t==="owner"&&(o+=`  ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ${i.notes}
`),o+=`
`})}if(c.length>0){o+=`------------------------------
`,o+=`üìã *‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ ‡∏£‡∏≤‡∏á (‡∏ï‡∏≤‡πÑ‡∏Å‡πà)*
`,o+=`------------------------------

`;let u=1;c.forEach(S=>{o+=`(${u++}) ‡∏£‡∏≤‡∏á‡∏°‡πà‡∏≤‡∏ô: ${S.style}, ‡∏™‡∏µ‡∏£‡∏≤‡∏á/‡∏Ç‡∏≤: ${S.track_color}
`,S.fabric_variant.includes("‡∏ó‡∏∂‡∏ö")&&(o+=`  - ‡∏£‡∏≤‡∏á‡∏ó‡∏∂‡∏ö: ${Number(S.width_m).toFixed(2)} ‡∏°. (1 ‡πÄ‡∏™‡πâ‡∏ô)
`),S.fabric_variant.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")&&(o+=`  - ‡∏£‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πà‡∏á: ${Number(S.width_m).toFixed(2)} ‡∏°. (1 ‡πÄ‡∏™‡πâ‡∏ô)
`),S.notes&&t==="owner"&&(o+=`  ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ${S.notes}
`),o+=`
`}),o+=`--- ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏á‡∏ï‡∏≤‡πÑ‡∏Å‡πà ---
`;const i=[];c.forEach(S=>{S.fabric_variant.includes("‡∏ó‡∏∂‡∏ö")&&i.push(Number(S.width_m)),S.fabric_variant.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")&&i.push(Number(S.width_m))});const y=6;i.sort((S,L)=>L-S);const b=[];for(const S of i){let L=!1;for(let M=0;M<b.length;M++)if(b[M]>=S-.001){b[M]-=S,L=!0;break}L||b.push(y-S)}o+=`‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏£‡∏≤‡∏á‡πÄ‡∏ï‡πá‡∏° (6 ‡πÄ‡∏°‡∏ï‡∏£) ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: *${b.length} ‡πÄ‡∏™‡πâ‡∏ô*

`;const $=i.reduce((S,L)=>{const M=L.toFixed(2);return S[M]=(S[M]||0)+1,S},{}),q=Object.entries($).sort((S,L)=>parseFloat(L[0])-parseFloat(S[0]));if(q.length>0){o+=`*‡∏™‡∏£‡∏∏‡∏õ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡∏î:*
`;for(const[S,L]of q)o+=`  - ‡∏£‡∏≤‡∏á ${S} ‡πÄ‡∏°‡∏ï‡∏£ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô ${L} ‡πÄ‡∏™‡πâ‡∏ô
`;o+=`
`}}const f={};c.forEach(u=>{const i=u.track_color||"‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏",y=u.grommet_color||"‡πÄ‡∏á‡∏¥‡∏ô",b=`${i}|${y}`;f[b]||(f[b]={trackColor:i,grommetColor:y,grommets:0,brackets:0,finials:0}),f[b].grommets+=E.calculateGrommets(u.width_m),f[b].brackets+=u.width_m>=1.6?3:2,f[b].finials+=u.fabric_variant==="‡∏ó‡∏∂‡∏ö&‡πÇ‡∏õ‡∏£‡πà‡∏á"?4:2});const p=l.allSets.length*2;(Object.keys(f).length>0||p>0)&&(o+=`------------------------------
`,o+=`üìã *‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå (Hardware)*
`,o+=`------------------------------

`,Object.values(f).forEach(u=>{u.grommets>0&&(o+=`  - ‡∏ï‡∏≤‡πÑ‡∏Å‡πà ‡∏™‡∏µ${u.grommetColor}: ${u.grommets} ‡∏ï‡∏±‡∏ß
`),u.brackets>0&&(o+=`  - ‡∏Ç‡∏≤‡∏à‡∏±‡∏ö‡∏£‡∏≤‡∏á (‡∏ï‡∏≤‡πÑ‡∏Å‡πà) ‡∏™‡∏µ${u.trackColor}: ${u.brackets} ‡∏ï‡∏±‡∏ß
`),u.finials>0&&(o+=`  - ‡∏´‡∏±‡∏ß‡∏£‡∏≤‡∏á (‡∏ï‡∏≤‡πÑ‡∏Å‡πà) ‡∏™‡∏µ${u.trackColor}: ${u.finials} ‡∏ï‡∏±‡∏ß
`)}),p>0&&(o+=`  - ‡∏ï‡∏∞‡∏Ç‡∏≠‡∏£‡∏ß‡∏ö‡∏°‡πà‡∏≤‡∏ô (‡∏ó‡∏∏‡∏Å‡∏ä‡∏ô‡∏¥‡∏î): ${p} ‡∏ï‡∏±‡∏ß
`),o+=`
`);const _=l.decorations;Object.keys(_).length>0&&Object.entries(_).forEach(([u,i])=>{o+=`------------------------------
`,o+=`üìã *‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ ${u}*
`,o+=`------------------------------

`,i.forEach(y=>{o+=`‡∏£‡∏´‡∏±‡∏™: #${y.code||"xxx"}
‡∏Ç‡∏ô‡∏≤‡∏î: ${y.width.toFixed(2)} x ${y.height.toFixed(2)} m.
‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: 1 ‡∏ä‡∏∏‡∏î

`})});const v={};if(l.wallpapers.forEach(u=>{v[u.code]=(v[u.code]||0)+u.rolls}),Object.keys(v).length>0){o+=`------------------------------
`,o+=`üìã *‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ (Wallpaper)*
`,o+=`------------------------------

`;for(const[u,i]of Object.entries(v))o+=`  - ‡∏£‡∏´‡∏±‡∏™ #${u}: ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${i} ‡∏°‡πâ‡∏ß‡∏ô
`;o+=`
`}if(t==="purchase_order")return o+=`------------------------------
`,o}if(t==="seamstress"||t==="owner"){o+=`
üßµ *‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡πà‡∏≤‡∏á*
`;let l=0;if(e.rooms.forEach(m=>{if(m.is_suspended||!m.items)return;const c=m.items.filter(d=>d.type==="set"&&!d.is_suspended&&d.width_m>0);c.length!==0&&(l>0&&(o+=`==============================
`),o+=`
*‡∏´‡πâ‡∏≠‡∏á: ${m.room_name||"‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏"}*

`,c.forEach((d,f)=>{f>0&&(o+=`--------------------
`),o+=`*‡∏ú‡πâ‡∏≤‡∏°‡πà‡∏≤‡∏ô ${d.style} ${d.fabric_variant}* (${f+1}/${c.length})
`,o+=`  ‡∏Ç‡∏ô‡∏≤‡∏î: ‡∏Å‡∏ß‡πâ‡∏≤‡∏á ${Number(d.width_m).toFixed(2)} x ‡∏™‡∏π‡∏á ${Number(d.height_m).toFixed(2)} ‡∏°.
`,o+=`  ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏õ‡∏¥‡∏î: ${d.opening_style}
`,d.fabric_variant.includes("‡∏ó‡∏∂‡∏ö")&&(o+=`  ‡∏ú‡πâ‡∏≤‡∏ó‡∏∂‡∏ö: ‡∏£‡∏´‡∏±‡∏™ ${d.fabric_code||"-"}
`),d.fabric_variant.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")&&(o+=`  ‡∏ú‡πâ‡∏≤‡πÇ‡∏õ‡∏£‡πà‡∏á: ‡∏£‡∏´‡∏±‡∏™ ${d.sheer_fabric_code||"-"}
`)}),o+=`
`,l++)}),l>0?o+=`==============================
`:o+=`‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡πà‡∏≤‡∏á
------------------------------
`,t==="seamstress")return o}return t==="owner"&&(o+=`
üí∞ *‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: ${x(s)} ‡∏ö‡∏≤‡∏ó*
`),o}function ct(e){if(!e.rooms||e.rooms.length===0)return'<p class="empty-summary">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•</p>';let t="";const n={};e.rooms.forEach(o=>{o.is_suspended||!o.items||o.items.forEach(l=>{if(l.is_suspended)return;let m=null,c=0;switch(l.type){case"set":c=E.calculateSetPrice(l).total,c>0&&(m=l.type);break;case"wallpaper":c=E.calculateWallpaperPrice(l).total,c>0&&(m=l.type);break;default:c=E.calculateDecoPrice(l).total,c>0&&(m=l.type);break}m&&(n[m]=(n[m]||0)+1)})});const r=Object.entries(n).map(([o,l])=>{const m=le[o]||"‡∏Ç‡∏≠‡∏á‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á";return`
            <span class="summary-tag" data-filter-type="${T(o)}" title="‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ">
                ${T(m)} <strong>${l}</strong>
            </span>`}).join("");r&&(t+=`
            <div class="overview-summary-group">
                <h4><i class="ph ph-stack"></i> ‡∏™‡∏£‡∏∏‡∏õ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</h4>
                <div class="summary-tags-container">
                    ${r}
                </div>
            </div>`);let a="",s=0;return e.rooms.forEach(o=>{if(o.is_suspended||!o.items)return;const l={};let m=0;if(o.items.forEach(c=>{if(c.is_suspended)return;let d=null,f=0;switch(c.type){case"set":f=E.calculateSetPrice(c).total,f>0&&(d=c.type);break;case"wallpaper":f=E.calculateWallpaperPrice(c).total,f>0&&(d=c.type);break;default:f=E.calculateDecoPrice(c).total,f>0&&(d=c.type);break}d&&(l[d]=(l[d]||0)+1,m++)}),m>0){s+=m;const c=Object.entries(l).map(([d,f])=>`
                    <div class="overview-item">
                        <span>${T(le[d]||"‡∏Ç‡∏≠‡∏á‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á")}</span>
                        <span>${f}</span>
                    </div>`).join("");a+=`
                <details class="overview-room-card">
                    <summary class="overview-room-summary">
                        <span class="room-name">${T(o.room_name)||"‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á"}</span>
                        <div class="summary-tags">
                            <span class="room-item-count">${m} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
                            <i class="ph ph-caret-down expand-icon"></i>
                        </div>
                    </summary>
                    <div class="overview-room-items">${c}</div>
                </details>`}}),a&&(t+=`
            <div class="overview-breakdown-group">
                <h4><i class="ph ph-map-pin-line"></i> ‡πÅ‡∏à‡∏Å‡πÅ‡∏à‡∏á‡∏ï‡∏≤‡∏°‡∏´‡πâ‡∏≠‡∏á</h4>
                ${a}
            </div>`),s===0?'<p class="empty-summary">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•</p>':t}function it(e,t){const{vatRate:n,pageBreakBuffer:r=3}=t,a=[];e.rooms.forEach(A=>{if(A.is_suspended||!A.items)return;const N=[];A.items.forEach(k=>{if(k.is_suspended)return;let C,B,W,O;const Y=le[k.type]||"‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á";switch(k.type){case"set":B=E.calculateSetPrice(k).total,B>0&&(W=k.width_m||0,O=k.height_m||0,C=`${Y} ${T(k.style)} (${T(k.fabric_variant)}) <br><small>‡∏Ç‡∏ô‡∏≤‡∏î ${W.toFixed(2)} x ${O.toFixed(2)} ‡∏°.${k.notes?` - ${T(k.notes)}`:""}</small>`,N.push({description:C,total:B,units:C.includes("<br>")?1.5:1}));break;case"wallpaper":if(B=E.calculateWallpaperPrice(k).total,B>0){const z=(k.widths||[]).reduce((R,de)=>R+de,0),te=E.wallpaperRolls(z,k.height_m);O=k.height_m||0,C=`${Y} <br><small>‡∏£‡∏´‡∏±‡∏™: ${T(k.wallpaper_code)||"-"}, ‡∏™‡∏π‡∏á ${O.toFixed(2)} ‡∏°. (‡πÉ‡∏ä‡πâ ${te} ‡∏°‡πâ‡∏ß‡∏ô)</small>`,N.push({description:C,total:B,units:C.includes("<br>")?1.5:1})}break;default:B=E.calculateDecoPrice(k).total,B>0&&(W=k.width_m||0,O=k.height_m||0,C=`${Y} <br><small>‡∏£‡∏´‡∏±‡∏™: ${T(k.code)||"-"}, ‡∏Ç‡∏ô‡∏≤‡∏î ${W.toFixed(2)} x ${O.toFixed(2)} ‡∏°.</small>`,N.push({description:C,total:B,units:C.includes("<br>")?1.5:1}));break}}),N.length>0&&(a.push({isRoomHeader:!0,roomName:T(A.room_name)||"‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á",units:1.2}),a.push(...N))});const s=a.reduce((A,N)=>A+(N.total||0),0);if(s===0)return null;let o=0,l="",m=s;e.discount&&e.discount.value>0&&(e.discount.type==="percent"?(o=s*(e.discount.value/100),l=`<tr><td class="pdf-label">‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î (${e.discount.value}%)</td><td class="pdf-amount">-${H(o,2,!0)}</td></tr>`):(o=e.discount.value,l=`<tr><td class="pdf-label">‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î</td><td class="pdf-amount">-${H(o,2,!0)}</td></tr>`),m=s-o,l+=`<tr><td class="pdf-label">‡∏¢‡∏≠‡∏î‡∏´‡∏•‡∏±‡∏á‡∏´‡∏±‡∏Å‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î</td><td class="pdf-amount">${H(m,2,!0)}</td></tr>`);const c=m*n,d=m+c,f=17,p=23,_=[];let v=[],u=0;a.forEach((A,N)=>{const k=_.length===0?f:p,C=u+A.units>k;let B=!1;if(!C&&N<a.length-1){const W=k-(u+A.units);W>0&&W<r&&(B=!0)}(C||B)&&v.length>0&&(_.push(v),v=[],u=0),v.push(A),u+=A.units}),v.length>0&&_.push(v);const i=new Date,y=i.toLocaleDateString("th-TH",{year:"numeric",month:"long",day:"numeric"}),b=`QT-${i.getFullYear()}${(i.getMonth()+1).toString().padStart(2,"0")}${i.getDate().toString().padStart(2,"0")}`;let $="",q=0,S=1;_.forEach((A,N)=>{const k=N===0,C=N===_.length-1,B=`
            <div class="pdf-page-header">
                <div class="pdf-header">
                    <div class="pdf-shop-info">
                        ${`<img src="${F.logoUrl}" alt="Logo" class="pdf-logo">`}
                        <div class="pdf-shop-address">
                            <strong><i class="ph ph-github-logo"></i> ${T(F.name)}</strong><br>
                            ${T(F.address).replace(/\n/g,"<br>")}<br>
                            ‡πÇ‡∏ó‡∏£: ${T(F.phone)} | ‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏ú‡∏π‡πâ‡πÄ‡∏™‡∏µ‡∏¢‡∏†‡∏≤‡∏©‡∏µ: ${T(F.taxId)}
                        </div>
                    </div>
                    <div class="pdf-quote-details">
                        <div class="pdf-title-box"><h1>‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤ ${_.length>1?k?"":"(‡∏ï‡πà‡∏≠)":""}</h1></div>
                        <table class="pdf-quote-meta">
                            <tr><td>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà:</td><td>${b}</td></tr>
                            <tr><td>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</td><td>${y}</td></tr>
                        </table>
                    </div>
                </div>
                ${k?`
                <section class="pdf-customer-details">
                    <div class="pdf-customer-info">
                        <strong>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤:</strong> ${T(e.customer_name)||""}<br>
                        <strong>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:</strong> ${T(e.customer_address).replace(/\n/g,"<br>")||""}<br>
                        <strong>‡πÇ‡∏ó‡∏£:</strong> ${T(e.customer_phone)||""}
                    </div>
                    <div class="pdf-customer-meta">
                        <strong>‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô:</strong> ${T(F.pdf.paymentTerms)}<br>
                        <strong>‡∏¢‡∏∑‡∏ô‡∏£‡∏≤‡∏Ñ‡∏≤:</strong> ${T(F.pdf.priceValidity)}
                    </div>
                </section>`:""}
            </div>`,W=`
            <div class="pdf-page-footer">
                <div class="pdf-footer-info">
                    <span><i class="ph ph-github-logo"></i> ${T(F.name)} | ‡πÇ‡∏ó‡∏£: ${T(F.phone)}</span>
                    <span>‡∏´‡∏ô‡πâ‡∏≤ ${N+1} / ${_.length}</span>
                </div>
            </div>`;let O="";k||(O+=`<tr class="pdf-subtotal-row"><td colspan="4">‡∏¢‡∏≠‡∏î‡∏¢‡∏Å‡∏°‡∏≤ (Brought Forward)</td><td class="pdf-text-right">${H(q,2,!0)}</td></tr>`),A.forEach(R=>{R.isRoomHeader?O+=`<tr class="pdf-room-header"><td colspan="5">‡∏´‡πâ‡∏≠‡∏á: ${R.roomName}</td></tr>`:(O+=`<tr><td class="pdf-text-center">${S++}</td><td>${R.description}</td><td class="pdf-text-center">1</td><td class="pdf-text-right">${H(R.total,2,!0)}</td><td class="pdf-text-right">${H(R.total,2,!0)}</td></tr>`,q+=R.total)});let Y="";C||(Y=`<tfoot><tr class="pdf-subtotal-row"><td colspan="4">‡∏¢‡∏≠‡∏î‡∏¢‡∏Å‡πÑ‡∏õ (Carried Forward)</td><td class="pdf-text-right">${H(q,2,!0)}</td></tr></tfoot>`);let z="";F.pdf.notes&&F.pdf.notes.length>0&&(z=`
                <strong>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</strong>
                <ul>${F.pdf.notes.map(R=>`<li>${T(R)}</li>`).join("")}</ul>
            `);const te=C?`
            <div class="pdf-summary-wrapper">
                <section class="pdf-summary-section">
                    <div class="pdf-amount-in-words">
                        ${z}
                        <div class="pdf-amount-text">( ${rt(d)} )</div>
                    </div>
                    <div class="pdf-totals-block">
                        <table>
                            <tr><td class="pdf-label">‡∏£‡∏ß‡∏°‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</td><td class="pdf-amount">${H(s,2,!0)}</td></tr>
                            ${l}
                            ${n>0?`<tr><td class="pdf-label">‡∏†‡∏≤‡∏©‡∏µ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏° ${(n*100).toFixed(0)}%</td><td class="pdf-amount">${H(c,2,!0)}</td></tr>`:""}
                            <tr class="pdf-grand-total"><td class="pdf-label">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</td><td class="pdf-amount">${H(d,2,!0)}</td></tr>
                        </table>
                    </div>
                </section>
                <footer class="pdf-footer-section">
                    <div class="pdf-signature-box"><p>.................................................</p><p>‡∏ú‡∏π‡πâ‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤</p><p>(<i class="ph ph-github-logo"></i> ${T(F.name)})</p><p>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${y}</p></div>
                    <div class="pdf-signature-box"><p>.................................................</p><p>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ / ‡∏ú‡∏π‡πâ‡∏°‡∏µ‡∏≠‡∏≥‡∏ô‡∏≤‡∏à‡∏•‡∏á‡∏ô‡∏≤‡∏°</p><p>&nbsp;</p><p>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ......./......./............</p></div>
                </footer>
            </div>
        `:"";$+=`
            <div class="pdf-page">
                <div class="pdf-page-content">
                    ${B}
                    <div class="pdf-page-body">
                        <table class="pdf-items-table">
                            <thead><tr><th style="width:5%;">‡∏•‡∏≥‡∏î‡∏±‡∏ö</th><th style="width:50%;">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th><th style="width:10%;">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th><th style="width:17.5%;">‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏´‡∏ô‡πà‡∏ß‡∏¢</th><th style="width:17.5%;">‡∏£‡∏ß‡∏° (‡∏ö‡∏≤‡∏ó)</th></tr></thead>
                            <tbody>${O}</tbody>
                            ${Y}
                        </table>
                        ${te}
                    </div>
                    ${W}
                </div>
            </div>`});const L=e.customer_name||"quote",M=We(L);return{html:`<div id="quotation-template">${$}</div>`,fileName:`${b}_${M}`}}const ne=[],ut=10;function Z(e){ne.push(e),ne.length>ut&&ne.shift()}function dt(){return ne.pop()}function mt(){return ne.length>0}let V=!1,_e=null,P=null,me=null,ae=!1,j=null,$e=null,Le=!1;const He=document.querySelector("#undoBtn"),pe={};function pt(e){if(pe[e])return pe[e];const t=new Promise((n,r)=>{const a=document.createElement("script");a.src=e,a.onload=()=>{console.log(`${e} loaded successfully.`),n()},a.onerror=()=>{console.error(`Script load error for ${e}`),delete pe[e],r(new Error(`Script load error for ${e}`))},document.head.appendChild(a)});return pe[e]=t,t}const ce={set:{templateId:"#setTpl",name:"‡∏ú‡πâ‡∏≤‡∏°‡πà‡∏≤‡∏ô"},wallpaper:{templateId:"#wallpaperTpl",name:"‡∏ß‡∏≠‡∏•‡∏•‡πå‡πÄ‡∏õ‡πÄ‡∏õ‡∏≠‡∏£‡πå"},wooden_blind:{templateId:"#areaBasedTpl",name:"‡∏°‡∏π‡πà‡∏•‡∏µ‡πà‡πÑ‡∏°‡πâ"},roller_blind:{templateId:"#areaBasedTpl",name:"‡∏°‡πà‡∏≤‡∏ô‡∏°‡πâ‡∏ß‡∏ô"},vertical_blind:{templateId:"#areaBasedTpl",name:"‡∏°‡πà‡∏≤‡∏ô‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏á"},partition:{templateId:"#areaBasedTpl",name:"‡∏â‡∏≤‡∏Å‡∏Å‡∏±‡πâ‡∏ô‡∏´‡πâ‡∏≠‡∏á"},pleated_screen:{templateId:"#areaBasedTpl",name:"‡∏°‡∏∏‡πâ‡∏á‡∏à‡∏µ‡∏ö"},aluminum_blind:{templateId:"#areaBasedTpl",name:"‡∏°‡∏π‡πà‡∏•‡∏µ‡πà‡∏≠‡∏•‡∏π‡∏°‡∏¥‡πÄ‡∏ô‡∏µ‡∏¢‡∏°"}},ft={‡∏°‡∏π‡πà‡∏•‡∏µ‡πà‡πÑ‡∏°‡πâ:"wooden_blind",‡∏°‡πà‡∏≤‡∏ô‡∏°‡πâ‡∏ß‡∏ô:"roller_blind",‡∏°‡πà‡∏≤‡∏ô‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏á:"vertical_blind",‡∏â‡∏≤‡∏Å‡∏Å‡∏±‡πâ‡∏ô‡∏´‡πâ‡∏≠‡∏á:"partition",‡∏°‡∏∏‡πâ‡∏á‡∏à‡∏µ‡∏ö:"pleated_screen",‡∏°‡∏π‡πà‡∏•‡∏µ‡πà‡∏≠‡∏•‡∏π‡∏°‡∏¥‡πÄ‡∏ô‡∏µ‡∏¢‡∏°:"aluminum_blind"},xe="marnthara.theme";function Ge(){const e=localStorage.getItem(xe),t=document.querySelector("#themeToggleBtn");if(!t)return;const n=t.querySelector("i"),r=t.querySelector("span");switch(document.body.classList.remove("dark-theme","neutral-theme"),e){case"dark":document.body.classList.add("dark-theme"),n&&(n.className="ph-fill ph-sun"),r&&(r.textContent=" ‡∏™‡∏ß‡πà‡∏≤‡∏á");break;case"neutral":document.body.classList.add("neutral-theme"),n&&(n.className="ph-fill ph-moon"),r&&(r.textContent=" ‡∏°‡∏∑‡∏î");break;default:n&&(n.className="ph-fill ph-palette"),r&&(r.textContent=" ‡∏Å‡∏•‡∏≤‡∏á");break}}function ht(){const e=localStorage.getItem(xe);let t;!e||e==="light"?t="neutral":e==="neutral"?t="dark":t="light",localStorage.setItem(xe,t),Ge()}function K(){He&&(He.disabled=!mt())}function vt(){const e=dt();e&&(Me(e,!1),w("‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß","success")),K()}function yt(e,t){if(!e)return;const n=document.getElementById("filterStatusBar");n&&(n.innerHTML=`
            <span>‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÄ‡∏â‡∏û‡∏≤‡∏∞: <strong>${T(t)}</strong></span>
            <button type="button" class="btn-chip" data-act="clear-filter" title="‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏á">
                <i class="ph ph-x"></i>&nbsp;‡∏õ‡∏¥‡∏î
            </button>
        `,n.classList.add("is-visible"),n.dataset.filterType=e),document.querySelectorAll(h.room).forEach(r=>{let a=0;r.querySelectorAll(".item-card").forEach(s=>{const o=s.dataset.type===e;s.classList.toggle("item-hidden",!o),o&&a++}),r.classList.toggle("item-hidden",a===0)}),ee(),J()}function _t(){const e=document.getElementById("filterStatusBar");e&&(e.classList.remove("is-visible"),e.innerHTML="",e.removeAttribute("data-filter-type")),document.querySelectorAll(".item-hidden").forEach(t=>t.classList.remove("item-hidden")),ee(),J()}function Se(){document.querySelectorAll(".favorite-chips-container.show").forEach(e=>{e.classList.remove("show")}),document.querySelectorAll(".item-card.overflow-visible").forEach(e=>{e.classList.remove("overflow-visible")})}function Ve(e){var m;const t=e.dataset.favoriteType,n=(m=e.closest(".form-group-with-favorites"))==null?void 0:m.querySelector(".favorite-chips-container");if(!t||!n)return;Se();const r=e.closest(".item-card"),s=Q()[t]||[];let l=Array.from(s.reduce((c,d)=>{const f=d.code.trim();return f&&!c.has(f.toLowerCase())&&c.set(f.toLowerCase(),d),c},new Map).values()).map(c=>`<button type="button" class="btn-chip" data-code="${T(c.code)}" data-price="${c.price}">${T(c.code)}</button>`).join("");l+=`<button type="button" class="btn-manage-favorites" data-act="manage-favorites" data-type="${t}"><i class="ph ph-pencil-simple"></i> ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î</button>`,n.innerHTML=l,n.classList.add("show"),r&&r.classList.add("overflow-visible")}function gt(e){const t=e.closest(".form-group-with-favorites"),n=e.closest(".item-card");if(!t||!n)return;const r=e.dataset.code,a=g(e.dataset.price),s=t.querySelector("input[data-favorite-type]");s&&(s.value=r,s.classList.add("input-highlight"),setTimeout(()=>s.classList.remove("input-highlight"),1200));const o=s.dataset.favoriteType;let l;o==="fabric"?l="set_price_per_m":o==="sheer"?l="sheer_price_per_m":o==="wallpaper"?l="wallpaper_price_roll":l="area_price_sqyd";const m=n.querySelector(`[name="${l}"]`);m&&a>0&&(m.tagName==="SELECT"?m.value=a:m.value=x(a),m.classList.add("input-highlight"),setTimeout(()=>m.classList.remove("input-highlight"),1200)),be(s),re(n),I(),Se()}function ve(e){const t=document.querySelector("#favManagerBody"),n=document.querySelector("#favManagerItemTpl"),a=Q()[e]||[];!t||!n||(a.length===0?t.innerHTML='<p class="empty-state">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ</p>':t.innerHTML=a.map(s=>n.innerHTML.replace(/{CODE}/g,T(s.code)).replace(/{PRICE}/g,x(s.price)).replace(/{RAW_PRICE}/g,s.price)).join(""),Ee(null))}function Ee(e){const t=document.querySelector('[data-act="edit-selected-fav"]'),n=document.querySelector('[data-act="del-selected-fav"]');!t||!n||(e?(t.disabled=!1,n.disabled=!1,j={code:e.dataset.code,price:g(e.dataset.price)}):(t.disabled=!0,n.disabled=!0,j=null))}async function St(e){const t=document.querySelector("#favManagerModal");if(!t||!e)return;const n={fabric:"‡∏ú‡πâ‡∏≤‡∏ó‡∏∂‡∏ö",sheer:"‡∏ú‡πâ‡∏≤‡πÇ‡∏õ‡∏£‡πà‡∏á",wallpaper:"‡∏ß‡∏≠‡∏•‡∏•‡πå‡πÄ‡∏õ‡πÄ‡∏õ‡∏≠‡∏£‡πå",wooden_blind:"‡∏°‡∏π‡πà‡∏•‡∏µ‡πà‡πÑ‡∏°‡πâ",roller_blind:"‡∏°‡πà‡∏≤‡∏ô‡∏°‡πâ‡∏ß‡∏ô",vertical_blind:"‡∏°‡πà‡∏≤‡∏ô‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏á",partition:"‡∏â‡∏≤‡∏Å‡∏Å‡∏±‡πâ‡∏ô‡∏´‡πâ‡∏≠‡∏á",pleated_screen:"‡∏°‡∏∏‡πâ‡∏á‡∏à‡∏µ‡∏ö",aluminum_blind:"‡∏°‡∏π‡πà‡∏•‡∏µ‡πà‡∏≠‡∏•‡∏π‡∏°‡∏¥‡πÄ‡∏ô‡∏µ‡∏¢‡∏°",deco:"‡∏Ç‡∏≠‡∏á‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á"};t.dataset.currentType=e,ae=!1,j=null,document.querySelector("#favManagerTitle").textContent=`‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ '${n[e]||e}'`,ve(e),await G("#favManagerModal",()=>{ae&&_e&&Ve(_e)})}function w(e,t="default"){const n=document.querySelector(h.toastContainer);if(!n)return;const r={success:"ph-bold ph-check-circle",warning:"ph-bold ph-warning",error:"ph-bold ph-x-circle",default:"ph-bold ph-info"},a=document.createElement("div");a.className=`toast toast-${t}`,a.innerHTML=`<i class="${r[t]||r.default}"></i> ${e}`,n.appendChild(a),setTimeout(()=>a.classList.add("show"),10),setTimeout(()=>{a.classList.remove("show"),a.addEventListener("transitionend",()=>a.remove())},3e3)}function G(e,t){return new Promise(n=>{const r=document.querySelector(e);if(!r){n(null);return}const a=document.querySelector(".modal-wrapper.visible");a&&a.classList.add("is-underlay"),r.classList.add("visible");const s=r.querySelector('[id$="Confirm"]'),o=r.querySelector('[id$="Cancel"], [data-act="close-modal"]'),l=Array.from(r.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])')).filter(p=>!p.disabled&&p.offsetParent!==null),m=l[0],c=l[l.length-1];setTimeout(()=>m==null?void 0:m.focus(),50);const d=p=>{if(p.key==="Escape"&&!r.classList.contains("is-underlay")){f({cancelled:!0});return}if(p.key==="Tab"){if(l.length<=1){p.preventDefault();return}p.shiftKey?document.activeElement===m&&(c.focus(),p.preventDefault()):document.activeElement===c&&(m.focus(),p.preventDefault())}},f=p=>{r.classList.remove("visible"),document.removeEventListener("keydown",d),s&&(s.onclick=null),o&&(o.onclick=null),a&&a.classList.remove("is-underlay"),typeof p=="object"&&p.cancelled&&t&&t(),n(p)};s&&(s.onclick=()=>f(!0)),o&&(o.onclick=()=>{r.classList.contains("is-underlay")||f({cancelled:!0})}),document.addEventListener("keydown",d)})}async function se(e,t){const n=document.querySelector(h.modal);return n?(n.querySelector(h.modalTitle).textContent=e,n.querySelector(h.modalBody).textContent=t,await G(h.modal)===!0):!0}async function bt(){var n,r,a;const e=document.querySelector(h.exportOptionsModal);if(!e)return null;const t=await G(h.exportOptionsModal);return!t||t.cancelled?null:{vatOption:((n=e.querySelector('input[name="vat_option"]:checked'))==null?void 0:n.value)||"include",exportMethod:((r=e.querySelector("#exportMethod"))==null?void 0:r.value)||"direct",pageBreakBuffer:parseInt((a=e.querySelector("#pageBreakBuffer"))==null?void 0:a.value,10)||3}}async function wt(){const e=document.querySelector("#discountModal");if(!e)return;const t=e.querySelector("#discountSubtotal"),n=e.querySelector("#discountPercent"),r=e.querySelector("#discountAmount"),a=e.querySelector("#discountFinalTotal"),s=document.querySelector("#discount_type"),o=document.querySelector("#discount_value"),l=g(document.querySelector("#originalTotal").dataset.rawTotal||document.querySelector("#grandTotal").textContent);t.textContent=x(l);const m=p=>{if(Le)return;Le=!0;let _=0;if(p==="percent"){const v=g(n.value);_=l*((v>=0?v:0)/100),r.value=_>0?x(Math.round(_)):""}else _=g(r.value);if(_=_>=0?Math.min(_,l):0,p!=="percent"){const v=l>0?_/l*100:0;n.value=v>0&&isFinite(v)?H(v,2):""}a.textContent=x(l-_),setTimeout(()=>{Le=!1},20)};n.addEventListener("input",()=>m("percent")),r.addEventListener("input",()=>m("amount")),r.addEventListener("focus",p=>{g(p.target.value)>0&&(p.target.value=g(p.target.value))}),r.addEventListener("blur",p=>{g(p.target.value)>0&&(p.target.value=x(g(p.target.value))),m("amount")});const c=s.value,d=g(o.value);n.value="",r.value="",d>0?c==="percent"?(n.value=d,m("percent")):(r.value=x(d),m("amount")):m();const f=await G("#discountModal");if(f&&!f.cancelled){const p=g(n.value),_=g(r.value);document.activeElement===n&&p>0?(s.value="percent",o.value=p):_>0?(s.value="amount",o.value=_):(s.value="amount",o.value=0),U(),I()}}async function qt(){var r,a,s,o,l;if(!P)return;const e=document.querySelector("#hardwareModal"),t=((r=P.querySelector('[name="set_style"]'))==null?void 0:r.value)==="‡∏ï‡∏≤‡πÑ‡∏Å‡πà";e.querySelector('[name="modal_track_color"]').value=((a=P.querySelector('[name="track_color"]'))==null?void 0:a.value)||"‡∏Ç‡∏≤‡∏ß",e.querySelector('[name="modal_bracket_color"]').value=((s=P.querySelector('[name="bracket_color"]'))==null?void 0:s.value)||"‡∏Ç‡∏≤‡∏ß",e.querySelector('[name="modal_finial_color"]').value=((o=P.querySelector('[name="finial_color"]'))==null?void 0:o.value)||"‡∏Ç‡∏≤‡∏ß",e.querySelector('[name="modal_grommet_color"]').value=((l=P.querySelector('[name="grommet_color"]'))==null?void 0:l.value)||"‡πÄ‡∏á‡∏¥‡∏ô",e.querySelector("#grommetColorGroup").style.display=t?"":"none";const n=await G("#hardwareModal");n&&!n.cancelled&&(P.querySelector('[name="track_color"]').value=e.querySelector('[name="modal_track_color"]').value,P.querySelector('[name="bracket_color"]').value=e.querySelector('[name="modal_bracket_color"]').value,P.querySelector('[name="finial_color"]').value=e.querySelector('[name="modal_finial_color"]').value,t&&(P.querySelector('[name="grommet_color"]').value=e.querySelector('[name="modal_grommet_color"]').value),I(),w("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÅ‡∏•‡πâ‡∏ß","success")),P=null}function ke(e,t,n){e&&(Z(D()),K(),e.classList.add("item-removing"),e.addEventListener("animationend",()=>{e.remove(),t&&w(t),n&&n(),ie(),ee(),U(),I(),ue()},{once:!0}))}function ee(){document.querySelectorAll(h.room).forEach(e=>{const t=e.querySelectorAll(".item-card:not(.is-suspended):not(.item-hidden)"),n=t.length;t.forEach((a,s)=>{const o=a.querySelector("[data-item-title]");o&&(o.textContent=`${s+1}/${n}`)}),e.querySelectorAll(".item-card.is-suspended, .item-card.item-hidden").forEach(a=>{const s=a.querySelector("[data-item-title]");s&&(s.textContent="-")})})}function Ye(){const e=document.querySelector(h.orderForm),t=document.querySelector(h.lockBtn);!e||!t||(e.classList.toggle("is-locked",V),t.classList.toggle("is-locked",V),t.querySelector("i").className=V?"ph-bold ph-lock-key":"ph-bold ph-lock-key-open",e.querySelectorAll("input, select, textarea, button").forEach(n=>{n.closest(".summary-footer")||n.closest(".main-header")||n.closest(".modal-wrapper")||n.dataset.act==="toggle-more-details"||n.dataset.act==="collapse-room"||(n.disabled=V)}),w(V?"‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ñ‡∏π‡∏Å‡∏•‡πá‡∏≠‡∏Ñ":"‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Ñ‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏•‡πâ‡∏ß",V?"warning":"success"))}function J(){const e=document.querySelectorAll(h.room);if(e.length===0)return;const t=[...e].some(r=>r.open),n=document.querySelector(h.toggleAllRoomsBtn);n&&(n.querySelector("i").className="ph ph-rows",n.querySelector("span").textContent=t?"‡∏¢‡πà‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î":"‡∏Ç‡∏¢‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î")}function $t(){const e=document.querySelectorAll(h.room),t=[...e].some(n=>n.open);e.forEach(n=>{n.open=!t}),setTimeout(()=>{J(),I()},50)}function ie(){const e=document.querySelector(h.quickNavRoomList);e&&(e.innerHTML="",document.querySelectorAll(h.room).forEach(t=>{var a;const n=((a=t.querySelector(h.roomNameInput))==null?void 0:a.value)||"‡∏´‡πâ‡∏≠‡∏á",r=document.createElement("a");r.href=`#${t.id}`,r.dataset.jumpTo=t.id,r.innerHTML=`<i class="ph ph-share-fat"></i> ${n}`,e.appendChild(r)}))}function Je(e){var n;const t=document.getElementById("quickNavBtnText");t&&(e?t.textContent=((n=e.querySelector('input[name="room_name"]'))==null?void 0:n.value)||"...":t.textContent="‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏´‡πâ‡∏≠‡∏á")}function ue(){if(me&&me.disconnect(),!document.getElementById("quickNavBtnText"))return;const e={root:null,rootMargin:"-60px 0px -150px 0px",threshold:0},t=n=>{const r=n.filter(a=>a.isIntersecting).sort((a,s)=>a.target.getBoundingClientRect().top-s.target.getBoundingClientRect().top);r.length>0&&Je(r[0].target)};me=new IntersectionObserver(t,e),document.querySelectorAll(h.room).forEach(n=>me.observe(n))}function be(e){if(!e)return;const t=e.closest(".form-group-with-favorites").querySelector(".btn-favorite");if(!t)return;const n=e.dataset.favoriteType,r=e.value;t.classList.toggle("is-favorite",nt(n,r))}function Be(e,t){const n=ce[e];if(!n)return null;const r=document.querySelector(n.templateId);if(!r||!t)return null;const a=r.content.cloneNode(!0),s=a.firstElementChild;s.dataset.type=e,s.classList.add(`${e.replace(/_/g,"-")}-item`);const o=s.querySelector(".item-type-display");if(o&&(o.textContent=n.name),n.templateId==="#areaBasedTpl"){const l=s.querySelector("input[data-favorite-type]"),m=s.querySelector(".btn-favorite");l&&(l.dataset.favoriteType=e),m&&(m.dataset.type=e)}return t.appendChild(a),s}function Lt(e,t){var a;if(!t)return;const n=t.querySelector(h.allItemsContainer);if(!n)return;Z(D()),K(),Se();const r=Be(e,n);if(r){if(e==="wallpaper"){const s=Ae(r.querySelector('[data-act="add-wall"]'));s&&((a=s.querySelector("input"))==null||a.focus())}else{const s=r.querySelector('input:not([type="hidden"]), select, textarea');s&&s.focus()}r.classList.add("item-created"),r.scrollIntoView({behavior:"smooth",block:"center"}),ee(),U(),I()}}async function je(e,t=null){const n=document.querySelector("#itemTypeModal");if(!n)return null;n.querySelector("#itemTypeModalTitle").textContent=e;let r=t;t&&!ce[t]&&(r="wooden_blind");const a=n.querySelector(`input[name="item_type_option"][value="${r||"set"}"]`);a&&(a.checked=!0);const s=await G("#itemTypeModal");if(!s||s.cancelled)return null;const o=n.querySelector('input[name="item_type_option"]:checked');return o?o.value:null}function kt(e,t){if(!ce[t])return;const r=e.parentElement;r&&(Z(D()),K(),e.classList.add("item-removing"),e.addEventListener("animationend",()=>{var s;const a=Be(t,r);a&&(e.replaceWith(a),a.classList.add("item-created"),a.scrollIntoView({behavior:"smooth",block:"center"}),(s=a.querySelector('input:not([type="hidden"]), select, textarea'))==null||s.focus(),ee(),U(),I(),w("‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß","success"))},{once:!0}))}function oe(){Z(D()),K();const e=document.querySelector(h.roomsContainer);if(!e)return;const t=document.querySelector("#roomTpl");if(!t)return;const n=Array.from(document.querySelectorAll(h.roomNameInput)).map(m=>parseInt(m.value.replace(/[^0-9]/g,""),10)).filter(m=>!isNaN(m)),s=`‡∏´‡πâ‡∏≠‡∏á ${(n.length>0?Math.max(...n):0)+1}`,l=t.content.cloneNode(!0).firstElementChild;if(l){l.id=`room-${Date.now()}`;const m=l.querySelector('input[name="room_name"]'),c=l.querySelector(".room-header-controls .form-group > label");if(m&&c){const f=`room_name_${l.id}`;m.id=f,c.setAttribute("for",f)}m&&(m.value=s);const d=l.querySelector("[data-room-name-display]");d&&(d.textContent=s),l.open=!0,e.appendChild(l),l.classList.add("item-created"),l.scrollIntoView({behavior:"smooth",block:"center"})}ie(),J(),ue(),I()}function Ae(e){var n;const t=(n=e==null?void 0:e.closest(".walls-section"))==null?void 0:n.querySelector(h.wallsContainer);if(t){const r=document.querySelector(h.wallTpl);if(!r)return null;const a=r.content.cloneNode(!0),s=a.querySelector(".wall-input-row");if(!s)return null;const o=s.querySelector("input"),l=s.querySelector("label");if(o&&l){const m=`wall-input-${Date.now()}-${Math.random().toString(36).substring(2,7)}`;o.id=m,l.setAttribute("for",m)}return t.appendChild(a),requestAnimationFrame(()=>{s.classList.add("item-created")}),re(e),s}return null}function re(e){var o,l,m,c,d,f,p,_,v,u,i,y;if(!e)return;const t=e.closest(".item-card");if(!t){U();return}const n=t.dataset.type;let r,a,s;switch(n){case"set":r=t.querySelector("[data-set-summary]"),a={width_m:(o=t.querySelector('input[name="width_m"]'))==null?void 0:o.value,height_m:(l=t.querySelector('input[name="height_m"]'))==null?void 0:l.value,style:(m=t.querySelector('select[name="set_style"]'))==null?void 0:m.value,fabric_variant:(c=t.querySelector('select[name="fabric_variant"]'))==null?void 0:c.value,price_per_m_raw:(d=t.querySelector('select[name="set_price_per_m"]'))==null?void 0:d.value,sheer_price_per_m:(f=t.querySelector('select[name="sheer_price_per_m"]'))==null?void 0:f.value},s=E.calculateSetPrice(a),t.dataset.totalPrice=s.total;let b=`‡∏£‡∏≤‡∏Ñ‡∏≤: <b>${x(s.total)}</b> ‡∏ö.`;s.opaque>0&&s.sheer>0&&(b+=` <small>(‡∏ó‡∏∂‡∏ö: ${x(s.opaque)}, ‡πÇ‡∏õ‡∏£‡πà‡∏á: ${x(s.sheer)})</small>`),r&&(r.innerHTML=b);break;case"wallpaper":r=t.querySelector("[data-wallpaper-summary]"),a={height_m:(p=t.querySelector('input[name="wallpaper_height_m"]'))==null?void 0:p.value,price_per_roll:(_=t.querySelector('input[name="wallpaper_price_roll"]'))==null?void 0:_.value,install_cost_per_roll:(v=t.querySelector('input[name="wallpaper_install_cost"]'))==null?void 0:v.value,widths:Array.from(t.querySelectorAll('input[name="wall_width_m"]')).map(S=>S.value)},s=E.calculateWallpaperPrice(a),t.dataset.totalPrice=s.total;let $=`‡∏£‡∏ß‡∏°: <b>${x(s.total)}</b> ‡∏ö. `;(s.material>0||s.install>0)&&($+=`<small>(‡∏ß‡∏≠‡∏•‡∏•‡πå: ${x(s.material)}, ‡∏Ñ‡πà‡∏≤‡∏ä‡πà‡∏≤‡∏á: ${x(s.install)})</small>`),s.rolls>0&&($+=` &bull; ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà: ${H(s.sqm,2)} ‡∏ï‡∏£.‡∏°. &bull; ‡πÉ‡∏ä‡πâ: ${s.rolls} ‡∏°‡πâ‡∏ß‡∏ô`),r&&(r.innerHTML=$);break;default:r=t.querySelector("[data-area-summary]"),a={width_m:(u=t.querySelector('input[name="area_width_m"]'))==null?void 0:u.value,height_m:(i=t.querySelector('input[name="area_height_m"]'))==null?void 0:i.value,price_sqyd:(y=t.querySelector('input[name="area_price_sqyd"]'))==null?void 0:y.value},s=E.calculateDecoPrice(a),t.dataset.totalPrice=s.total;let q="";s.sqyd>0&&(q=` &bull; ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà: ${H(s.sqyd,2)} ‡∏ï‡∏£.‡∏´‡∏•‡∏≤`),r&&(r.innerHTML=`‡∏£‡∏≤‡∏Ñ‡∏≤: <b>${x(s.total)}</b> ‡∏ö.${q}`);break}U()}function U(){let e=0;document.querySelectorAll(h.room).forEach(o=>{let l=0,m=0;const c=o.classList.contains("is-suspended");o.querySelectorAll(".item-card").forEach(f=>{const p=g(f.dataset.totalPrice),_=f.classList.contains("is-suspended");!c&&!_&&(l+=p,p>0&&m++)});const d=o.querySelector("[data-room-brief]");d&&(c?d.textContent="(‡∏£‡∏∞‡∏á‡∏±‡∏ö‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß)":m>0?d.innerHTML=`<span>${m}</span> &bull; ${x(l)} ‡∏ö‡∏≤‡∏ó`:d.innerHTML="<span>0</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£"),c||(e+=l)});const t=document.querySelector("#discount_type").value,n=g(document.querySelector("#discount_value").value);let r=0;n>0&&(r=t==="percent"?e*(n/100):n);const a=e-r;document.querySelector("#grandTotal").textContent=x(a);const s=document.querySelector("#originalTotal");r>0?(s.textContent=x(e),s.dataset.rawTotal=e,s.style.display="block"):(s.style.display="none",s.dataset.rawTotal="")}async function Me(e,t=!1){if(e!=null&&e.favorites)if(t){const s=document.querySelector("#favoritesConflictModal");if(s){const o=await G("#favoritesConflictModal");if(!o||o.cancelled){w("‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤","warning");return}switch(s.querySelector('input[name="fav_conflict_option"]:checked').value){case"overwrite":Oe(e.favorites)&&w("‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à","success");break;case"merge":const m=Ue(e.favorites);w(`‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡πÄ‡∏û‡∏¥‡πà‡∏° ${m} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà)`,"success");break}}}else Oe(e.favorites);if(!(e!=null&&e.rooms)||!Array.isArray(e.rooms)){e.favorites||w("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå","error");return}const n=document.querySelector(h.roomsContainer);if(!n)return;n.innerHTML="",document.querySelector("#customer_name").value=e.customer_name||"",document.querySelector("#customer_phone").value=e.customer_phone||"",document.querySelector("#customer_address").value=e.customer_address||"",e.discount&&(document.querySelector("#discount_type").value=e.discount.type||"amount",document.querySelector("#discount_value").value=e.discount.value||0),document.querySelector("#customerDetailsCard").open=e.customer_card_open??!0;let r=0;const a=()=>{if(r>=e.rooms.length){document.querySelectorAll("input[data-favorite-type]").forEach(be),U(),ee(),ie(),J(),ue(),t&&w("‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à","success");return}const s=e.rooms[r],o=document.querySelector("#roomTpl");if(!o){console.error("Room template not found.");return}const m=o.content.cloneNode(!0).firstElementChild;if(n.appendChild(m),m){m.id=s.id||`room-${Date.now()}`,s.is_suspended&&m.classList.add("is-suspended"),m.open=s.is_open===!0;const c=s.room_name||"‡∏´‡πâ‡∏≠‡∏á (‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠)",d=m.querySelector('input[name="room_name"]'),f=m.querySelector(".room-header-controls .form-group > label");if(d&&f){const v=`room_name_${m.id}`;d.id=v,f.setAttribute("for",v)}d&&(d.value=c);const p=m.querySelector("[data-room-name-display]");p&&(p.textContent=c);const _=m.querySelector(h.allItemsContainer);if(_&&s.items){const v=document.createDocumentFragment();s.items.forEach(u=>{var y,b,$;u.type==="deco"&&u.deco_type?(u.type=ft[u.deco_type]||"wooden_blind",u.code=u.deco_code,u.width_m=u.deco_width_m,u.height_m=u.deco_height_m,u.price_sqyd=u.deco_price_sqyd,u.notes=u.deco_notes):u.type==="deco"&&(u.type="wooden_blind",u.code=u.deco_code);const i=Be(u.type,v);if(i){switch(u.is_suspended&&i.classList.add("is-suspended"),u.type){case"set":i.querySelector('input[name="width_m"]').value=X(u.width_m),i.querySelector('input[name="height_m"]').value=X(u.height_m),i.querySelector('select[name="set_style"]').value=u.style||u.set_style||"‡∏•‡∏≠‡∏ô",i.querySelector('select[name="fabric_variant"]').value=u.fabric_variant||"‡∏ó‡∏∂‡∏ö",i.querySelector('select[name="set_price_per_m"]').value=u.price_per_m_raw||u.set_price_per_m||"",i.querySelector('select[name="sheer_price_per_m"]').value=u.sheer_price_per_m||"",i.querySelector('select[name="opening_style"]').value=u.opening_style||"‡πÅ‡∏¢‡∏Å‡∏Å‡∏•‡∏≤‡∏á",i.querySelector('input[name="track_color"]').value=u.track_color||"‡∏Ç‡∏≤‡∏ß",i.querySelector('input[name="bracket_color"]').value=u.bracket_color||"‡∏Ç‡∏≤‡∏ß",i.querySelector('input[name="finial_color"]').value=u.finial_color||"‡∏Ç‡∏≤‡∏ß",i.querySelector('input[name="grommet_color"]').value=u.grommet_color||"‡πÄ‡∏á‡∏¥‡∏ô",i.querySelector('input[name="fabric_code"]').value=u.fabric_code||"",i.querySelector('input[name="sheer_fabric_code"]').value=u.sheer_fabric_code||"",i.querySelector('input[name="notes"]').value=u.notes||"";const q=(u.fabric_variant||"").includes("‡πÇ‡∏õ‡∏£‡πà‡∏á");(y=i.querySelector(h.sheerWrap))==null||y.classList.toggle("hidden",!q),(b=i.querySelector(h.sheerCodeWrap))==null||b.classList.toggle("hidden",!q);break;case"wallpaper":i.querySelector('input[name="wallpaper_height_m"]').value=X(u.height_m||u.wallpaper_height_m),i.querySelector('input[name="wallpaper_code"]').value=u.wallpaper_code||"";const S=g(u.price_per_roll||u.wallpaper_price_roll);i.querySelector('input[name="wallpaper_price_roll"]').value=S>0?x(S):"",i.querySelector('input[name="wallpaper_install_cost"]').value=u.hasOwnProperty("install_cost_per_roll")?x(u.install_cost_per_roll):u.wallpaper_install_cost?x(u.wallpaper_install_cost):"300",i.querySelector('input[name="wallpaper_notes"]').value=u.notes||u.wallpaper_notes||"",u.widths&&u.widths.forEach(L=>{const M=Ae(i.querySelector('[data-act="add-wall"]'));M&&(M.querySelector('input[name="wall_width_m"]').value=X(L))});break;default:if((($=ce[u.type])==null?void 0:$.templateId)==="#areaBasedTpl"){i.querySelector('input[name="area_width_m"]').value=X(u.width_m),i.querySelector('input[name="area_height_m"]').value=X(u.height_m);const L=g(u.price_sqyd);i.querySelector('input[name="area_price_sqyd"]').value=L>0?x(L):"",i.querySelector('input[name="area_code"]').value=u.code||"",i.querySelector('input[name="area_notes"]').value=u.notes||""}break}re(i)}}),_.appendChild(v)}}r++,requestAnimationFrame(a)};requestAnimationFrame(a)}function Tt(e){if(document.getElementById("loading-overlay"))return;const t=document.createElement("div");t.id="loading-overlay",t.innerHTML=`<div class="loading-spinner"></div><p>${e}</p>`,document.body.appendChild(t),document.body.style.overflow="hidden"}function xt(){const e=document.getElementById("loading-overlay");e&&e.remove(),document.body.style.overflow=""}async function Et(e,t){var r,a;const n=document.querySelector(h.printableContent);if(!n||!e||!e.html){w("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£","error");return}if(t==="direct"){Tt("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á PDF...");try{typeof html2pdf>"u"&&(w("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏•‡∏ö‡∏£‡∏≤‡∏£‡∏µ PDF...","default"),await pt("https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"));const s=document.createElement("div");s.style.position="fixed",s.style.left="-300mm",s.style.top="0",s.style.width="210mm",s.style.background="#fff",s.innerHTML=e.html,document.body.appendChild(s),await new Promise(l=>setTimeout(l,500));const o={margin:0,filename:`${e.fileName}.pdf`,image:{type:"jpeg",quality:.98},html2canvas:{scale:2,useCORS:!0,logging:!1,width:((r=s.querySelector(".pdf-page"))==null?void 0:r.scrollWidth)||210*3.77,windowWidth:((a=s.querySelector(".pdf-page"))==null?void 0:a.scrollWidth)||210*3.77},jsPDF:{unit:"mm",format:"a4",orientation:"portrait"}};await window.html2pdf().from(s).set(o).save(),w("‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î PDF ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à","success"),document.body.contains(s)&&document.body.removeChild(s)}catch(s){console.error("PDF Generation Error:",s),w("‡∏™‡∏£‡πâ‡∏≤‡∏á PDF ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß, ‡πÇ‡∏õ‡∏£‡∏î‡∏•‡∏≠‡∏á‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 2 (‡∏û‡∏¥‡∏°‡∏û‡πå)","error")}finally{xt()}}t==="print"&&(n.innerHTML=e.html,setTimeout(()=>{window.print(),setTimeout(()=>{n.innerHTML=""},1e3)},Xe))}function Mt(e){if(!e||!e.html){w("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå HTML","error");return}try{const t=`
            <!DOCTYPE html><html lang="th"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
                <title>${e.fileName}</title>
                <link rel="stylesheet" href="https://grobmak.github.io/marnthara-form/src/style.css">
                <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.1/src/bold/style.css">
                <style>#printable-content { display: block !important; } .pdf-page { border: 1px solid #eee; box-shadow: 0 0 10px rgba(0,0,0,0.1); margin: 10mm auto; } i.ph { vertical-align: middle; }</style>
            </head>
            <body>${e.html}</body></html>`,n=new Blob([t],{type:"text/html;charset=utf-8"}),r=URL.createObjectURL(n),a=document.createElement("a");a.href=r,a.download=`${e.fileName}.html`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(r),w("‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå HTML ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à","success")}catch(t){console.error("HTML Export Error:",t),w("‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå HTML ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß","error")}}function Ct(e){if(!e)return;const t=e.closest(".item-card");if(!t)return;const n=g(e.value);let r,a;const s=e.getAttribute("name");if(s==="set_price_per_m"?(r=t.querySelector('input[name="fabric_code"]'),a="fabric"):s==="sheer_price_per_m"?(r=t.querySelector('input[name="sheer_fabric_code"]'),a="sheer"):s==="wallpaper_price_roll"?(r=t.querySelector('input[name="wallpaper_code"]'),a="wallpaper"):s==="area_price_sqyd"&&(r=t.querySelector('input[name="area_code"]'),r&&(a=r.dataset.favoriteType)),r&&a&&r.value.trim()){const o=Ie(a,r.value);o&&o.price!==n&&(r.value="",be(r))}}const It=et(e=>{e.matches('[name$="_price_sqyd"], [name$="_price_roll"], [name$="_price_per_m"]')&&Ct(e),re(e),I()},200);function De(e){var n,r,a;if(V){e.preventDefault();return}const t=e.target;if(t.matches('select[name="fabric_variant"]')){const s=t.closest(".set-item");if(s){const o=(n=t.value)==null?void 0:n.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á");(r=s.querySelector(h.sheerWrap))==null||r.classList.toggle("hidden",!o),(a=s.querySelector(h.sheerCodeWrap))==null||a.classList.toggle("hidden",!o)}}if(t.matches(h.roomNameInput)){const s=t.closest(".room-card");if(s){const o=s.querySelector("[data-room-name-display]");o&&(o.textContent=t.value||"‡∏´‡πâ‡∏≠‡∏á")}ie(),ue()}t.matches("input[data-favorite-type]")&&be(t),It(t)}function Bt(e){const t=e.target;t.matches('[name$="_price_sqyd"], [name$="_price_roll"], [name$="_install_cost"]')?t.value=g(t.value)>0?x(g(t.value)):"":t.matches('input[name$="_m"], input[name$="width_m"]')&&(t.value=X(t.value))}function At(e){const t=e.target;t.matches('[name$="_price_sqyd"], [name$="_price_roll"], [name$="_install_cost"]')&&g(t.value)>0&&(t.value=g(t.value)),t.matches("input[data-favorite-type]")&&(_e=t,Ve(t))}const Nt=async e=>{var d,f,p,_;const t=e.target.closest(".summary-tag[data-filter-type]");if(t){const v=t.dataset.filterType,u=t.textContent.trim().replace(/\s*\d+\s*$/,""),i=document.querySelector("#overviewModal");i&&i.classList.remove("visible"),yt(v,u);return}const n=e.target.closest(".favorite-chips-container .btn-chip");if(n){gt(n);return}const r=e.target.closest(".fav-manager-item");if(r){const v=r.parentElement.querySelector(".is-selected");v&&v.classList.remove("is-selected"),v!==r?(r.classList.add("is-selected"),Ee(r)):Ee(null);return}const a=e.target.closest("[data-act]");if(!a)return;const s=["toggle-more-details","show-discount-modal","collapse-room"];if(V&&!a.closest(".unlockable")&&!s.includes(a.dataset.act))return;const o=a.dataset.act,l=a.closest(h.room),m=a.closest(".item-card"),c=(v,u,i)=>se(v,u).then(y=>y&&i());switch(o){case"add-room":oe();break;case"add-item":{if($e=a.closest(h.room),$e){const i=await je("‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà");i&&Lt(i,$e)}break}case"collapse-room":l&&(e.preventDefault(),l.open=!1,(d=l.querySelector("summary"))==null||d.scrollIntoView({behavior:"smooth",block:"center"}));break;case"clear-filter":_t();break;case"change-type":{const i=m==null?void 0:m.dataset.type;if(m&&i){const y=await je("‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£",i);y&&y!==i&&c("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á","‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà ‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?",()=>kt(m,y))}break}case"add-wall":{const i=Ae(a);i&&((f=i.querySelector('input[name="wall_width_m"]'))==null||f.focus());break}case"show-discount-modal":wt();break;case"open-hardware-modal":{P=m,qt();break}case"apply-hardware-to-room":{const i=a.closest("#hardwareModal"),y=P==null?void 0:P.closest(h.room);if(!i||!y)break;const b=i.querySelector('[name="modal_track_color"]').value,$=i.querySelector('[name="modal_bracket_color"]').value,q=i.querySelector('[name="modal_finial_color"]').value,S=i.querySelector('[name="modal_grommet_color"]').value;y.querySelectorAll(".set-item").forEach(L=>{L.querySelector('[name="track_color"]').value=b,L.querySelector('[name="bracket_color"]').value=$,L.querySelector('[name="finial_color"]').value=q,L.querySelector('[name="grommet_color"]').value=S}),I(),w("‡πÉ‡∏ä‡πâ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß","success");break}case"toggle-more-details":{const i=m==null?void 0:m.querySelector(".item-details-more");if(i){const y=i.classList.toggle("show");a.classList.toggle("expanded",y),a.querySelector("i").className=y?"ph ph-caret-up":"ph ph-caret-down",a.querySelector("span").textContent=y?"‡∏¢‡πà‡∏≠‡∏ô‡πâ‡∏≠‡∏¢‡∏•‡∏á":"‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°"}break}case"toggle-favorite":{const i=a.closest(".form-group-with-favorites").querySelector("input[data-favorite-type]");if(!i||!m)break;const y=i.dataset.favoriteType,b=i.value;let $;y==="fabric"?$="set_price_per_m":y==="sheer"?$="sheer_price_per_m":y==="wallpaper"?$="wallpaper_price_roll":$="area_price_sqyd";const q=m.querySelector(`[name="${$}"]`),S=g(q==null?void 0:q.value);if(!b.trim()){w("‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏´‡∏±‡∏™‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å","warning");break}if(S<=0&&y!=="fabric"&&y!=="sheer"){w("‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å","warning");break}const L=qe(y,b,S);a.classList.toggle("is-favorite",L),w(L?"‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î‡πÅ‡∏•‡πâ‡∏ß":"‡∏•‡∏ö‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î","success"),I();break}case"manage-favorites":{const i=a.dataset.type;_e=a.closest(".form-group-with-favorites").querySelector("input[data-favorite-type]"),St(i);break}case"add-new-fav-form":{const y=a.closest("#favManagerModal").dataset.currentType;if(!y)break;const b=document.querySelector("#favAddModal");b.querySelector("h3").textContent=`‡πÄ‡∏û‡∏¥‡πà‡∏° '${((p=ce[y])==null?void 0:p.name)||y}'`;const $=b.querySelector('[name="fav_code_add"]'),q=b.querySelector('[name="fav_price_add"]');$.value="",q.value="";const S=await G("#favAddModal");if(S&&!S.cancelled){const L=$.value.trim(),M=g(q.value);L&&(qe(y,L,M),ae=!0,ve(y),w("‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î‡πÅ‡∏•‡πâ‡∏ß","success"))}break}case"edit-selected-fav":{if(!j)break;const y=a.closest("#favManagerModal").dataset.currentType;if(!y)break;const b=document.querySelector("#favEditModal");b.querySelector("h3").textContent=`‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç '${j.code}'`;const $=b.querySelector('[name="fav_code_edit"]'),q=b.querySelector('[name="fav_price_edit"]');$.value=j.code,q.value=j.price>0?j.price:"";const S=await G("#favEditModal");if(S&&!S.cancelled){const L=$.value.trim(),M=g(q.value);L&&(L!==j.code&&Te(y,j.code),qe(y,L,M),ae=!0,ve(y),w("‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î‡πÅ‡∏•‡πâ‡∏ß","success"))}break}case"del-selected-fav":{if(!j)break;const y=a.closest("#favManagerModal").dataset.currentType;if(!y)break;await se("‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î",`‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏´‡∏±‡∏™ "${j.code}"?`)&&(Te(y,j.code),ae=!0,ve(y),w("‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î‡πÅ‡∏•‡πâ‡∏ß","success"));break}case"del-room":c("‡∏•‡∏ö‡∏´‡πâ‡∏≠‡∏á","‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ?",()=>ke(l,"‡∏•‡∏ö‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß"));break;case"del-item":c("‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£","‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ?",()=>ke(m,"‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß"));break;case"del-wall":c("‡∏•‡∏ö‡∏ú‡∏ô‡∏±‡∏á","‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ú‡∏ô‡∏±‡∏á‡∏ô‡∏µ‡πâ?",()=>ke(a.closest(".wall-input-row"),"‡∏•‡∏ö‡∏ú‡∏ô‡∏±‡∏á‡πÅ‡∏•‡πâ‡∏ß",()=>re(m)));break;case"clear-room":c("‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á","‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏•‡∏ö‡∏ó‡∏∏‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ?",()=>{Z(D()),K(),l.querySelector(h.allItemsContainer).innerHTML="",ee(),U(),I(),w("‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß","success")});break;case"toggle-room-menu":e.preventDefault();const v=a.nextElementSibling;if(!v||!l)return;const u=!v.classList.contains("show");document.querySelectorAll(".room-options-menu.show").forEach(i=>i.classList.remove("show")),document.querySelectorAll(".card.overflow-visible").forEach(i=>i.classList.remove("overflow-visible")),u&&(v.classList.add("show"),l.classList.add("overflow-visible"));break;case"toggle-suspend-room":e.preventDefault(),l==null||l.classList.toggle("is-suspended"),U(),I(),(_=a.closest(".room-options-menu"))==null||_.classList.remove("show"),l==null||l.classList.remove("overflow-visible");break;case"toggle-suspend":e.preventDefault(),m==null||m.classList.toggle("is-suspended"),re(a),I();break}};function Ft(){V=!V,Ye()}function Pt(e){if(!e||e.closest(".modal-wrapper"))return;const t=e.getAttribute("name"),n=e.closest(".item-card"),s=(o=>{const l=o[t];if(!l)return null;const m=n||document;let c=null;return typeof l=="string"?c=m.querySelector(`[name="${l}"]:not(:disabled)`):typeof l=="function"&&(c=l(e)),!c&&n&&typeof l=="string"&&(c=document.querySelector(`[name="${l}"]:not(:disabled)`)),c})({customer_name:"customer_phone",customer_phone:"customer_address",customer_address:()=>document.querySelector(".room-name-input"),room_name:o=>{var l;return(l=o.closest(".room-card"))==null?void 0:l.querySelector('[data-act="add-item"]')},width_m:"height_m",height_m:"set_price_per_m",set_price_per_m:o=>{var c;const l=o.closest(".set-item"),m=(c=l==null?void 0:l.querySelector('[name="fabric_variant"]'))==null?void 0:c.value;return m!=null&&m.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")?l==null?void 0:l.querySelector('[name="sheer_price_per_m"]'):l==null?void 0:l.querySelector('[data-act="toggle-more-details"]')},sheer_price_per_m:o=>{var l;return(l=o.closest(".item-card"))==null?void 0:l.querySelector('[data-act="toggle-more-details"]')},area_width_m:"area_height_m",area_height_m:"area_price_sqyd",area_price_sqyd:"area_code",wall_width_m:o=>{var m,c;const l=(m=o.closest(".wall-input-row"))==null?void 0:m.nextElementSibling;return l!=null&&l.matches(".wall-input-row")?l.querySelector("input"):(c=o.closest(".item-card"))==null?void 0:c.querySelector('[name="wallpaper_price_roll"]')},wallpaper_price_roll:"wallpaper_height_m",wallpaper_height_m:"wallpaper_code"});s&&(s.focus(),typeof s.select=="function"&&s.select())}function Ot(){const e=document.querySelector(h.setTpl);if(!e)return;const t=e.content.querySelector('select[name="set_price_per_m"]'),n=e.content.querySelector('select[name="sheer_price_per_m"]'),r=a=>{let s='<option value="" hidden>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏Ñ‡∏≤</option>';return Array.isArray(a)?(a.forEach(o=>{s+=`<option value="${o}">${o.toLocaleString("th-TH")}</option>`}),s):(console.error("Price data for dropdown is not available or not an array.",a),s)};t&&(t.innerHTML=r(ye.fabric)),n&&(n.innerHTML=r(ye.sheer))}function Rt(){Ot(),Ge();const e=document.querySelector(h.orderForm),t=document.querySelector(h.fileImporter),n=document.querySelector("#favImporter"),r=document.querySelector(h.menuDropdown),a=document.querySelector(h.quickNavDropdown),s=document.querySelector("#pageBreakBuffer"),o=document.querySelector("#pageBreakBufferValue");s&&o&&s.addEventListener("input",()=>{o.textContent=s.value}),e.addEventListener("input",De),e.addEventListener("change",De),document.addEventListener("click",Nt),e.addEventListener("blur",Bt,!0),e.addEventListener("focusin",At,!0),e.addEventListener("keydown",c=>{const d=c.target;c.key==="Enter"&&!d.matches("textarea, button, [data-act]")&&(c.preventDefault(),Pt(d))});const l=c=>{const d=c.target.closest(h.room);d&&Je(d)};e.addEventListener("click",l),e.addEventListener("focusin",l),document.body.addEventListener("click",c=>{c.target.closest("summary")&&setTimeout(()=>{J(),I()},50)}),document.querySelector("#undoBtn").addEventListener("click",c=>{c.preventDefault(),vt()}),document.querySelector(h.lockBtn).addEventListener("click",Ft),document.querySelector(h.toggleAllRoomsBtn).addEventListener("click",$t),document.querySelector(h.quickNavBtn).addEventListener("click",c=>{var f;c.stopPropagation(),r.classList.remove("show");const d=!a.classList.contains("show");a.classList.toggle("show"),c.currentTarget.setAttribute("aria-expanded",d),d&&((f=document.querySelector(h.menuBtn))==null||f.setAttribute("aria-expanded","false"))}),document.querySelector(h.quickNavRoomList).addEventListener("click",c=>{var f;const d=c.target.closest("a[data-jump-to]");if(d){c.preventDefault();const p=d.dataset.jumpTo,_=document.getElementById(p);_&&(document.body.classList.add("disable-animations"),_.open=!0,_.scrollIntoView({behavior:"auto",block:"start"}),_.classList.add("scrolling-jump"),setTimeout(()=>{_.classList.remove("scrolling-jump"),document.body.classList.remove("disable-animations"),J()},1e3)),a.classList.remove("show"),(f=document.querySelector(h.quickNavBtn))==null||f.setAttribute("aria-expanded","false")}});const m=document.querySelector("#addRoomQuickNavBtn");if(m){const c=tt(oe,700);m.addEventListener("click",d=>{var f;d.stopPropagation(),c(),a.classList.remove("show"),(f=document.querySelector(h.quickNavBtn))==null||f.setAttribute("aria-expanded","false")})}document.querySelector(h.menuBtn).addEventListener("click",c=>{var f;c.stopPropagation(),a.classList.remove("show");const d=!r.classList.contains("show");r.classList.toggle("show"),c.currentTarget.setAttribute("aria-expanded",d),d&&((f=document.querySelector(h.quickNavBtn))==null||f.setAttribute("aria-expanded","false"))}),document.querySelector("#themeToggleBtn").addEventListener("click",c=>{c.preventDefault(),ht()}),document.querySelector("#overviewBtn").addEventListener("click",async c=>{var _;c.preventDefault(),r.classList.remove("show"),(_=document.querySelector(h.menuBtn))==null||_.setAttribute("aria-expanded","false");const d=D(),f=document.querySelector("#overviewModalHeader"),p=document.querySelector("#overviewModalBody");if(f&&p){const v=d.rooms.reduce((y,b)=>{if(b.is_suspended)return y;const $=(b.items||[]).filter(q=>{if(q.is_suspended)return!1;let S=0;switch(q.type){case"set":S=E.calculateSetPrice(q).total;break;case"wallpaper":S=E.calculateWallpaperPrice(q).total;break;default:S=E.calculateDecoPrice(q).total;break}return S>0}).length;return y+$},0),u=document.querySelector(h.grandTotal).textContent||"0",i=d.rooms.filter(y=>!y.is_suspended&&y.items&&y.items.some(b=>!b.is_suspended)).length;f.innerHTML=`
                <div class="overview-stats-grid">
                    <div class="overview-stat-card">
                        <i class="ph-bold ph-map-pin-line"></i>
                        <div class="stat-value">${i}</div>
                        <div class="stat-label">‡∏´‡πâ‡∏≠‡∏á</div>
                    </div>
                    <div class="overview-stat-card">
                        <i class="ph-bold ph-stack"></i>
                        <div class="stat-value">${v}</div>
                        <div class="stat-label">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
                    </div>
                    <div class="overview-stat-card">
                        <i class="ph-bold ph-coins"></i>
                        <div class="stat-value">${u}</div>
                        <div class="stat-label">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°</div>
                    </div>
                </div>
            `,p.innerHTML=ct(d),G("#overviewModal")}}),document.querySelector(h.exportPdfBtn).addEventListener("click",async c=>{var _;c.preventDefault(),r.classList.remove("show"),(_=document.querySelector(h.menuBtn))==null||_.setAttribute("aria-expanded","false");const d=await bt();if(!d)return;const f=D(),p=it(f,{vatRate:d.vatOption==="include"?F.baseVatRate:0,pageBreakBuffer:d.pageBreakBuffer});if(!p){w("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£","warning");return}d.exportMethod==="html"?Mt(p):Et(p,d.exportMethod)}),document.querySelector(h.importBtn).addEventListener("click",c=>{var d;c.preventDefault(),r.classList.remove("show"),(d=document.querySelector(h.menuBtn))==null||d.setAttribute("aria-expanded","false"),t.click()}),t.addEventListener("change",c=>{var p;const d=(p=c.target.files)==null?void 0:p[0];if(!d)return;const f=new FileReader;f.onload=async _=>{try{const v=JSON.parse(_.target.result);await Me(v,!0)}catch(v){w("‡πÑ‡∏ü‡∏•‡πå JSON ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á","error"),console.error("JSON Parse Error:",v)}},f.readAsText(d),c.target.value=null}),document.querySelector(h.exportBtn).addEventListener("click",c=>{var d;c.preventDefault(),r.classList.remove("show"),(d=document.querySelector(h.menuBtn))==null||d.setAttribute("aria-expanded","false");try{const f=D(),p=JSON.stringify(f,null,4),_=new Blob([p],{type:"application/json"}),v=URL.createObjectURL(_),u=document.createElement("a"),i=new Date,y=`${i.getFullYear()}${(i.getMonth()+1).toString().padStart(2,"0")}${i.getDate().toString().padStart(2,"0")}`,b=`${i.getHours().toString().padStart(2,"0")}${i.getMinutes().toString().padStart(2,"0")}`,$=We(f.customer_name||"data");u.href=v,u.download=`MTR-${y}${b}-${$}.json`,u.click(),URL.revokeObjectURL(v),w("Export ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à","success")}catch{w("Export ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß","error")}}),document.querySelector("#importFavsBtn").addEventListener("click",c=>{var d;c.preventDefault(),r.classList.remove("show"),(d=document.querySelector(h.menuBtn))==null||d.setAttribute("aria-expanded","false"),n.click()}),n.addEventListener("change",c=>{var p;const d=(p=c.target.files)==null?void 0:p[0];if(!d)return;const f=new FileReader;f.onload=_=>{try{const v=JSON.parse(_.target.result),u=Ue(v);u>0?w(`‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î‡πÉ‡∏´‡∏°‡πà ${u} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`,"success"):w("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°","default"),I()}catch(v){w("‡πÑ‡∏ü‡∏•‡πå JSON ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á","error"),console.error("Favorites JSON Parse Error:",v)}},f.readAsText(d),c.target.value=null}),document.querySelector("#exportFavsBtn").addEventListener("click",c=>{var d;c.preventDefault(),r.classList.remove("show"),(d=document.querySelector(h.menuBtn))==null||d.setAttribute("aria-expanded","false");try{const f=Q(),p=JSON.stringify(f,null,4),_=new Blob([p],{type:"application/json"}),v=URL.createObjectURL(_),u=document.createElement("a"),i=new Date,y=`${i.getFullYear()}${(i.getMonth()+1).toString().padStart(2,"0")}${i.getDate().toString().padStart(2,"0")}`;u.href=v,u.download=`MTR-Favorites-${y}.json`,u.click(),URL.revokeObjectURL(v),w("Export ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à","success")}catch{w("Export ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß","error")}}),document.querySelector(h.submitBtn).addEventListener("click",async c=>{var d;if(c.preventDefault(),r.classList.remove("show"),(d=document.querySelector(h.menuBtn))==null||d.setAttribute("aria-expanded","false"),await se("‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•","‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏£‡∏≤‡∏Ñ‡∏≤?")){const f=D();if(!f.customer_name&&!f.customer_phone){w("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤","warning");return}w("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...","default");try{const p=await fetch(ze,{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(f)});p.ok?w("‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!","success"):w(`‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ${p.status}`,"error")}catch{w("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠","error")}}}),document.querySelector(h.copyTextBtn).addEventListener("click",async c=>{var p;c.preventDefault(),r.classList.remove("show"),(p=document.querySelector(h.menuBtn))==null||p.setAttribute("aria-expanded","false");const d=document.querySelector(h.copyOptionsModal);d.querySelector('input[name="copy_option"][value="customer"]').checked=!0;const f=await G(h.copyOptionsModal);if(f&&!f.cancelled){const _=d.querySelector('input[name="copy_option"]:checked').value,v=lt(D(),_);try{await navigator.clipboard.writeText(v),w("‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!","success")}catch{w("‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß","error")}}}),document.querySelector(h.clearItemsBtn).addEventListener("click",async c=>{var d;c.preventDefault(),r.classList.remove("show"),(d=document.querySelector(h.menuBtn))==null||d.setAttribute("aria-expanded","false"),await se("‡∏•‡πâ‡∏≤‡∏á‡∏ó‡∏∏‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£","‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡∏´‡πâ‡∏≠‡∏á‡∏à‡∏∞‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡∏≠‡∏¢‡∏π‡πà)?")&&(Z(D()),K(),document.querySelectorAll(h.room).forEach(f=>{const p=f.querySelector(h.allItemsContainer);p&&(p.innerHTML="")}),U(),I(),w("‡∏•‡πâ‡∏≤‡∏á‡∏ó‡∏∏‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß","success"))}),document.querySelector(h.clearAllBtn).addEventListener("click",async c=>{var d;if(c.preventDefault(),r.classList.remove("show"),(d=document.querySelector(h.menuBtn))==null||d.setAttribute("aria-expanded","false"),await se("‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î",'‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô! ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤, ‡∏ó‡∏∏‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£, ‡πÅ‡∏•‡∏∞ "‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î" ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ñ‡∏≤‡∏ß‡∏£ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')){Z(D()),K(),localStorage.removeItem(fe),at();const f=document.querySelector("#customer_name"),p=document.querySelector("#customer_phone"),_=document.querySelector("#customer_address");f&&(f.value=""),p&&(p.value=""),_&&(_.value="");const v=document.querySelector("#discount_type"),u=document.querySelector("#discount_value");v&&(v.value="amount"),u&&(u.value="0");const i=document.querySelector(h.roomsContainer);i&&(i.innerHTML=""),U(),ie(),J(),oe();const y=document.querySelector("#customerDetailsCard");y&&(y.open=!0),w("‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏´‡∏°‡πà","success")}}),window.addEventListener("click",c=>{var d,f;c.target.closest(".modal-wrapper")||(c.target.closest(".menu-container")||(r.classList.contains("show")&&(r.classList.remove("show"),(d=document.querySelector(h.menuBtn))==null||d.setAttribute("aria-expanded","false")),a.classList.contains("show")&&(a.classList.remove("show"),(f=document.querySelector(h.quickNavBtn))==null||f.setAttribute("aria-expanded","false"))),c.target.closest(".room-options-container")||(document.querySelectorAll(".room-options-menu.show").forEach(p=>p.classList.remove("show")),document.querySelectorAll(".card.overflow-visible").forEach(p=>p.classList.remove("overflow-visible"))),c.target.closest(".form-group-with-favorites")||Se())}),window.addEventListener("beforeunload",I);try{const c=localStorage.getItem(fe);if(c&&c.length>2&&c!=="null")Me(JSON.parse(c),!1);else{oe();const d=document.querySelector("#customerDetailsCard");d&&(d.open=!0)}}catch(c){console.error("Failed to load data from localStorage:",c),localStorage.removeItem(fe),oe()}U(),Ye(),J(),ue(),K()}document.addEventListener("DOMContentLoaded",Rt);
