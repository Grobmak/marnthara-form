(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const l of n)if(l.type==="childList")for(const s of l.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function r(n){const l={};return n.integrity&&(l.integrity=n.integrity),n.referrerPolicy&&(l.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?l.credentials="include":n.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function o(n){if(n.ep)return;n.ep=!0;const l=r(n);fetch(n.href,l)}})();const We="input-ui/5.7.0",Ue="https://your-make-webhook-url.com/your-unique-path",pe="marnthara.input.v5",Ve=500,C={name:"‡∏°‡πà‡∏≤‡∏ô‡∏ò‡∏≤‡∏£‡∏≤ ‡∏ú‡πâ‡∏≤‡∏°‡πà‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏Ç‡∏≠‡∏á‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á",address:"65/8 ‡∏´‡∏°‡∏π‡πà 2 ‡∏ï.‡∏ó‡πà‡∏≤‡∏®‡∏≤‡∏•‡∏≤ ‡∏≠.‡πÄ‡∏°‡∏∑‡∏≠‡∏á ‡∏à.‡∏•‡∏û‡∏ö‡∏∏‡∏£‡∏µ 15000",phone:"092-985-9395, 082-552-5595",taxId:"1234567890123",logoUrl:"./assets/logo.png",baseVatRate:.07,pdf:{paymentTerms:"‡∏ä‡∏≥‡∏£‡∏∞‡∏°‡∏±‡∏î‡∏à‡∏≥ 50%",priceValidity:"30 ‡∏ß‡∏±‡∏ô",notes:["‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ô‡∏µ‡πâ‡∏£‡∏ß‡∏°‡∏Ñ‡πà‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏•‡πâ‡∏ß","‡∏ä‡∏≥‡∏£‡∏∞‡∏°‡∏±‡∏î‡∏à‡∏≥ 50% ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ú‡∏•‡∏¥‡∏ï‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤","‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏≤‡∏¢‡∏∏ 30 ‡∏ß‡∏±‡∏ô ‡∏ô‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤"]}},Ye=1.19599,Se={ROLL_WIDTH_M:.53,ROLL_LENGTH_M:10,STRIPS_PER_ROLL_UNDER_2_5M:3},he={fabric:[1e3,1100,1200,1300,1400,1500,1600,1700,1800,1900,2e3,2100,2200],sheer:[1e3,1100,1200,1300,1400,1500],style_surcharge:{‡∏•‡∏≠‡∏ô:200,‡∏ï‡∏≤‡πÑ‡∏Å‡πà:0,‡∏à‡∏µ‡∏ö:0},height:[{threshold:3.2,add_per_m:300},{threshold:2.8,add_per_m:200},{threshold:2.5,add_per_m:100}]},f={orderForm:"#orderForm",roomsContainer:"#rooms",setTpl:"#setTpl",wallTpl:"#wallTpl",clearAllBtn:"#clearAllBtn",lockBtn:"#lockBtn",grandTotal:"#grandTotal",modal:"#confirmationModal",modalTitle:"#modalTitle",modalBody:"#modalBody",room:"[data-room]",allItemsContainer:"[data-all-items]",wallsContainer:"[data-walls-container]",sheerWrap:"[data-sheer-wrap]",sheerCodeWrap:"[data-sheer-code-wrap]",roomNameInput:'input[name="room_name"]',toastContainer:"#toast-container",copyTextBtn:"#copyTextBtn",copyOptionsModal:"#copyOptionsModal",menuBtn:"#menuBtn",menuDropdown:"#menuDropdown",importBtn:"#importBtn",exportBtn:"#exportBtn",fileImporter:"#fileImporter",submitBtn:"#submitBtn",clearItemsBtn:"#clearItemsBtn",exportPdfBtn:"#exportPdfBtn",exportOptionsModal:"#exportOptionsModal",printableContent:"#printable-content",quickNavBtn:"#quickNavBtn",quickNavDropdown:"#quickNavDropdown",quickNavRoomList:"#quickNavRoomList",toggleAllRoomsBtn:"#toggleAllRoomsBtn"},y=e=>{typeof e=="string"&&(e=e.replace(/,/g,""));const t=parseFloat(e);return Number.isFinite(t)?t:0},Q=e=>{const t=y(e);return t>0?t.toFixed(2):""},R=(e,t=2,r=!1)=>Number.isFinite(e)?e.toLocaleString("en-US",{minimumFractionDigits:r?2:t,maximumFractionDigits:r?2:t}):"0",T=(e,t=0)=>Number.isFinite(e)?e.toLocaleString("th-TH",{minimumFractionDigits:t,maximumFractionDigits:t}):"0",Ge=(e,t=150)=>{let r;return(...o)=>{clearTimeout(r),r=setTimeout(()=>e(...o),t)}},Je=(e,t=700)=>{let r=!1;return(...o)=>{if(!r){r=!0;try{return e(...o)}finally{setTimeout(()=>{r=!1},t)}}}},L=e=>typeof e!="string"?"":e.replace(/[&<>"']/g,function(t){switch(t){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";default:return"&#039;"}}),Pe=e=>typeof e!="string"?"":e.replace(/[\\/?%*:|"<>\x00-\x1f]/g,"").trim()||"file";function Qe(e){let t=y(e);if(isNaN(t))return"‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á";if(t===0)return"‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ö‡∏≤‡∏ó‡∏ñ‡πâ‡∏ß‡∏ô";const r=["","‡∏´‡∏ô‡∏∂‡πà‡∏á","‡∏™‡∏≠‡∏á","‡∏™‡∏≤‡∏°","‡∏™‡∏µ‡πà","‡∏´‡πâ‡∏≤","‡∏´‡∏Å","‡πÄ‡∏à‡πá‡∏î","‡πÅ‡∏õ‡∏î","‡πÄ‡∏Å‡πâ‡∏≤"],o=["","‡∏™‡∏¥‡∏ö","‡∏£‡πâ‡∏≠‡∏¢","‡∏û‡∏±‡∏ô","‡∏´‡∏°‡∏∑‡πà‡∏ô","‡πÅ‡∏™‡∏ô","‡∏•‡πâ‡∏≤‡∏ô"];let n=Math.floor(t),l=Math.round((t-n)*100);const s=u=>{if(u===0)return"";let d="";const p=String(u);for(let a=0;a<p.length;a++){const m=p[a];p.length-1;const v=p.length-a-1;m!=="0"&&(v===1&&m==="1"?d+=o[v]:v===1&&m==="2"?d+="‡∏¢‡∏µ‡πà"+o[v]:v===0&&m==="1"&&p.length>1?d+="‡πÄ‡∏≠‡πá‡∏î":d+=r[parseInt(m)]+o[v])}return d};let c="";if(n>0){const u=Math.floor(n/1e6),d=n%1e6;u>0&&(c+=s(u)+"‡∏•‡πâ‡∏≤‡∏ô"),c+=s(d),c+="‡∏ö‡∏≤‡∏ó"}let i="";return l>0?i=s(l)+"‡∏™‡∏ï‡∏≤‡∏á‡∏Ñ‡πå":c+="‡∏ñ‡πâ‡∏ß‡∏ô",(c+i).trim()}const Ie="marnthara.favorites.v4",me={fabric:[],sheer:[],wallpaper:[],wooden_blind:[],roller_blind:[],vertical_blind:[],partition:[],pleated_screen:[],aluminum_blind:[]};function ee(){try{const e=localStorage.getItem(Ie);return e?{...me,...JSON.parse(e)}:me}catch(e){return console.error("Failed to parse favorites from localStorage",e),me}}function Ee(e){try{localStorage.setItem(Ie,JSON.stringify(e))}catch(t){console.error("Failed to save favorites to localStorage",t)}}function Ke(e){if(!e||typeof e!="object")return console.error("Invalid favorites data for import."),!1;const t={...me,...e};return Ee(t),!0}function ze(e,t,r){const o=ee();o[e]||(o[e]=[]);const n=o[e],l=n.find(s=>s.code===t);return l?l.price=r:n.push({code:t,price:r}),n.sort((s,c)=>s.code.localeCompare(c.code)),Ee(o),!0}function Te(e,t){const r=ee();if(!r[e])return!1;const o=r[e].findIndex(n=>n.code===t);return o>-1?(r[e].splice(o,1),Ee(r),!0):!1}function Me(e,t){if(!e||!t)return;const r=ee(),o=t.trim();return(r[e]||[]).find(l=>l.code===o)}function Xe(e,t){return!!Me(e,t)}function be(e,t,r){const o=Me(e,t);return o&&o.price===r?(Te(e,t),!1):(ze(e,t,r),!0)}function Ze(){localStorage.removeItem(Ie),console.log("All favorites have been cleared.")}function W(){var r,o,n,l,s,c;const e=ee(),t={app_version:We,customer_name:((r=document.querySelector('[name="customer_name"]'))==null?void 0:r.value)||"",customer_phone:((o=document.querySelector('[name="customer_phone"]'))==null?void 0:o.value)||"",customer_address:((n=document.querySelector('[name="customer_address"]'))==null?void 0:n.value)||"",customer_card_open:(l=document.querySelector("#customerDetailsCard"))==null?void 0:l.open,discount:{type:((s=document.querySelector("#discount_type"))==null?void 0:s.value)||"amount",value:y((c=document.querySelector("#discount_value"))==null?void 0:c.value)},rooms:[],favorites:e};return document.querySelectorAll(f.room).forEach(i=>{var d,p;const u={id:i.id,room_name:((d=i.querySelector(f.roomNameInput))==null?void 0:d.value)||"",is_suspended:i.classList.contains("is-suspended"),is_open:i.open,items:[]};(p=i.querySelector(f.allItemsContainer))==null||p.childNodes.forEach(a=>{var g,h,_,$,q,b,x,N,G,M,B,w,I,E,H,P,U,J,X,F,ie;if(a.nodeType!==1||!a.matches(".item-card"))return;const m=a.dataset.type;if(!m)return;let v={type:m,is_suspended:a.classList.contains("is-suspended")};m==="set"?Object.assign(v,{width_m:y((g=a.querySelector('input[name="width_m"]'))==null?void 0:g.value),height_m:y((h=a.querySelector('input[name="height_m"]'))==null?void 0:h.value),style:((_=a.querySelector('select[name="set_style"]'))==null?void 0:_.value)||"",fabric_variant:(($=a.querySelector('select[name="fabric_variant"]'))==null?void 0:$.value)||"",price_per_m_raw:y((q=a.querySelector('select[name="set_price_per_m"]'))==null?void 0:q.value),sheer_price_per_m:y((b=a.querySelector('select[name="sheer_price_per_m"]'))==null?void 0:b.value),fabric_code:((x=a.querySelector('input[name="fabric_code"]'))==null?void 0:x.value)||"",sheer_fabric_code:((N=a.querySelector('input[name="sheer_fabric_code"]'))==null?void 0:N.value)||"",opening_style:((G=a.querySelector('select[name="opening_style"]'))==null?void 0:G.value)||"",track_color:((M=a.querySelector('select[name="track_color"]'))==null?void 0:M.value)||"",notes:((B=a.querySelector('input[name="notes"]'))==null?void 0:B.value)||""}):m==="wallpaper"?Object.assign(v,{height_m:y((w=a.querySelector('[name="wallpaper_height_m"]'))==null?void 0:w.value),wallpaper_code:((I=a.querySelector('[name="wallpaper_code"]'))==null?void 0:I.value)||"",price_per_roll:y((E=a.querySelector('[name="wallpaper_price_roll"]'))==null?void 0:E.value),install_cost_per_roll:y((H=a.querySelector('[name="wallpaper_install_cost"]'))==null?void 0:H.value),notes:((P=a.querySelector('[name="wallpaper_notes"]'))==null?void 0:P.value)||"",widths:Array.from(a.querySelectorAll('[name="wall_width_m"]')).map(je=>y(je.value))}):a.matches(".area-based-item")&&Object.assign(v,{width_m:y((U=a.querySelector('[name="area_width_m"]'))==null?void 0:U.value),height_m:y((J=a.querySelector('[name="area_height_m"]'))==null?void 0:J.value),price_sqyd:y((X=a.querySelector('[name="area_price_sqyd"]'))==null?void 0:X.value),code:((F=a.querySelector('[name="area_code"]'))==null?void 0:F.value)||"",notes:((ie=a.querySelector('[name="area_notes"]'))==null?void 0:ie.value)||""}),u.items.push(v)}),t.rooms.push(u)}),t}function A(){try{localStorage.setItem(pe,JSON.stringify(W()))}catch(e){console.error("Failed to save data to localStorage:",e)}}const k={stylePlus:e=>he.style_surcharge[e]??0,heightPlus:e=>{const t=[...he.height].sort((r,o)=>o.threshold-r.threshold);for(const r of t)if(e>r.threshold)return r.add_per_m;return 0},fabricYardage:(e,t)=>{const r=y(t);return r<=0||!e?0:e==="‡∏ï‡∏≤‡πÑ‡∏Å‡πà"||e==="‡∏à‡∏µ‡∏ö"?(r*2+.6)/.9:e==="‡∏•‡∏≠‡∏ô"?(r*2.6+.6)/.9:0},wallpaperRolls:(e,t)=>{const r=y(e),o=y(t);if(r<=0||o<=0)return 0;const n=o>2.5?Math.floor(Se.ROLL_LENGTH_M/o):Se.STRIPS_PER_ROLL_UNDER_2_5M;if(n<=0)return 0;const l=Math.ceil(r/Se.ROLL_WIDTH_M);return Math.ceil(l/n)},calculateSetPrice:function(e){var s,c;if(!e||e.is_suspended||y(e.width_m)<=0)return{total:0,opaque:0,sheer:0};const t=this.stylePlus(e.style),r=this.heightPlus(y(e.height_m)),o=y(e.width_m),n=(s=e.fabric_variant)!=null&&s.includes("‡∏ó‡∏∂‡∏ö")&&y(e.price_per_m_raw)>0?(y(e.price_per_m_raw)+t+r)*o:0,l=(c=e.fabric_variant)!=null&&c.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")&&y(e.sheer_price_per_m)>0?(y(e.sheer_price_per_m)+t+r)*o:0;return{total:Math.round(n+l),opaque:Math.round(n),sheer:Math.round(l)}},calculateDecoPrice:function(e){if(!e||e.is_suspended||y(e.width_m)<=0||y(e.height_m)<=0)return{total:0,sqm:0,sqyd:0};const t=y(e.width_m)*y(e.height_m),r=t*Ye,o=r*y(e.price_sqyd);return{total:Math.round(o),sqm:t,sqyd:r}},calculateWallpaperPrice:function(e){var s;if(!e||e.is_suspended)return{total:0,material:0,install:0,rolls:0,sqm:0};const t=((s=e.widths)==null?void 0:s.reduce((c,i)=>c+y(i),0))||0;if(t<=0)return{total:0,material:0,install:0,rolls:0,sqm:0};const r=y(e.height_m),o=this.wallpaperRolls(t,r),n=o*y(e.price_per_roll),l=o*y(e.install_cost_per_roll??300);return{total:Math.round(n+l),material:Math.round(n),install:Math.round(l),rolls:o,sqm:t*r}}},le={set:"‡∏ú‡πâ‡∏≤‡∏°‡πà‡∏≤‡∏ô",wallpaper:"‡∏ß‡∏≠‡∏•‡∏•‡πå‡πÄ‡∏õ‡πÄ‡∏õ‡∏≠‡∏£‡πå",wooden_blind:"‡∏°‡∏π‡πà‡∏•‡∏µ‡πà‡πÑ‡∏°‡πâ",roller_blind:"‡∏°‡πà‡∏≤‡∏ô‡∏°‡πâ‡∏ß‡∏ô",vertical_blind:"‡∏°‡πà‡∏≤‡∏ô‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏á",partition:"‡∏â‡∏≤‡∏Å‡∏Å‡∏±‡πâ‡∏ô‡∏´‡πâ‡∏≠‡∏á",pleated_screen:"‡∏°‡∏∏‡πâ‡∏á‡∏à‡∏µ‡∏ö",aluminum_blind:"‡∏°‡∏π‡πà‡∏•‡∏µ‡πà‡∏≠‡∏•‡∏π‡∏°‡∏¥‡πÄ‡∏ô‡∏µ‡∏¢‡∏°"};function et(e){return e.rooms.reduce((t,r)=>{var n;if(r.is_suspended)return t;const o=((n=r.items)==null?void 0:n.reduce((l,s)=>{if(s.is_suspended)return l;switch(s.type){case"set":return l+k.calculateSetPrice(s).total;case"wallpaper":return l+k.calculateWallpaperPrice(s).total;default:return l+k.calculateDecoPrice(s).total}},0))||0;return t+o},0)}function tt(e,t){const r=et(e);let o=0,n="";e.discount&&e.discount.value>0&&(e.discount.type==="percent"?(o=r*(e.discount.value/100),n=`‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î (${e.discount.value}%): -${T(o)} ‡∏ö‡∏≤‡∏ó
`):(o=e.discount.value,n=`‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î: -${T(o)} ‡∏ö‡∏≤‡∏ó
`));const l=r-o;let s=`‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (${new Date().toLocaleDateString("th-TH",{day:"numeric",month:"numeric",year:"numeric"})})
`;if(s+=`‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤: ${e.customer_name||"-"}
`,(t==="customer"||t==="owner")&&(s+=`‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£: ${e.customer_phone||"-"}
`,s+=`‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà: ${e.customer_address||"-"}
`),s+=`------------------------------
`,t==="customer")return s+=`
‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
`,e.rooms.forEach(c=>{if(c.is_suspended||!c.items)return;const i=c.items.filter(d=>d.is_suspended?!1:d.type==="wallpaper"?(d.widths||[]).reduce((p,a)=>p+a,0)>0:d.width_m>0);if(i.length===0)return;s+=`
*‡∏´‡πâ‡∏≠‡∏á: ${c.room_name||"‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏"}*
`;let u=0;i.forEach(d=>{u++;const p=le[d.type]||"‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á";d.type==="set"?s+=` ${u}) ${p} ${d.style} (${d.fabric_variant})
`:s+=` ${u}) ${p}
`})}),s+=`------------------------------
`,o>0&&(s+=`
‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: ${T(r)} ‡∏ö‡∏≤‡∏ó
`,s+=n),s+=`
‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥: ${T(l)} ‡∏ö‡∏≤‡∏ó
`,s+=`
‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£
${C.name}
‡πÇ‡∏ó‡∏£: ${C.phone}`,s;if(t==="purchase_order"||t==="owner"){const c={opaqueFabrics:[],sheerFabrics:[],decorations:{},wallpapers:[],allSets:[]};e.rooms.forEach(p=>{p.is_suspended||!p.items||p.items.forEach(a=>{if(!(a.is_suspended||a.width_m<=0))switch(a.type){case"set":c.allSets.push(a),a.fabric_variant.includes("‡∏ó‡∏∂‡∏ö")&&c.opaqueFabrics.push({code:a.fabric_code||"??",yards:k.fabricYardage(a.style,a.width_m)}),a.fabric_variant.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")&&c.sheerFabrics.push({code:a.sheer_fabric_code||"??",yards:k.fabricYardage(a.style,a.width_m)});break;case"wallpaper":const m=(a.widths||[]).reduce((g,h)=>g+h,0);if(m>0){const g=k.wallpaperRolls(m,a.height_m);g>0&&c.wallpapers.push({code:a.wallpaper_code||"xxx",rolls:g})}break;default:const v=le[a.type]||a.type;c.decorations[v]||(c.decorations[v]=[]),c.decorations[v].push({code:a.code||"xxx",width:a.width_m,height:a.height_m});break}})}),s+=`üìã *‡πÅ‡∏à‡∏Å‡πÅ‡∏à‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ (‡∏ú‡πâ‡∏≤)*
`,s+=`------------------------------
`,c.opaqueFabrics.length>0&&c.opaqueFabrics.forEach(p=>{s+=`- ‡∏ú‡πâ‡∏≤‡∏ó‡∏∂‡∏ö (Curtain Fabric)
`,s+=`  ‡∏£‡∏´‡∏±‡∏™: #${p.code||"??"}
`,s+=`  ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${p.yards.toFixed(2)} ‡∏´‡∏•‡∏≤

`}),c.sheerFabrics.length>0&&c.sheerFabrics.forEach(p=>{s+=`- ‡∏ú‡πâ‡∏≤‡πÇ‡∏õ‡∏£‡πà‡∏á (Sheer Fabric)
`,s+=`  ‡∏£‡∏´‡∏±‡∏™: #${p.code||"??"}
`,s+=`  ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${p.yards.toFixed(2)} ‡∏´‡∏•‡∏≤

`});const i={};if([...c.opaqueFabrics,...c.sheerFabrics].forEach(p=>{i[p.code]=(i[p.code]||0)+p.yards}),Object.keys(i).length>0){s+=`------------------------------
`,s+=`üìä *‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ú‡πâ‡∏≤ (‡∏ï‡∏≤‡∏°‡∏£‡∏´‡∏±‡∏™)*
`,s+=`------------------------------
`;for(const[p,a]of Object.entries(i))s+=`  - ‡∏£‡∏´‡∏±‡∏™ #${p}: ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${a.toFixed(2)} ‡∏´‡∏•‡∏≤
`;s+=`
`}if(s+=`------------------------------
`,s+=`üìã *‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ ‡∏£‡∏≤‡∏á*
`,s+=`------------------------------

`,c.allSets.length>0){let p=1;c.allSets.forEach(a=>{s+=`(${p++}) ‡∏£‡∏≤‡∏á‡∏°‡πà‡∏≤‡∏ô: ${a.style}, ‡∏™‡∏µ: ${a.track_color}
`,a.fabric_variant.includes("‡∏ó‡∏∂‡∏ö")&&(s+=`  - ‡∏£‡∏≤‡∏á‡∏ó‡∏∂‡∏ö: ${Number(a.width_m).toFixed(2)} ‡∏°. (1 ‡πÄ‡∏™‡πâ‡∏ô)
`),a.fabric_variant.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")&&(s+=`  - ‡∏£‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πà‡∏á: ${Number(a.width_m).toFixed(2)} ‡∏°. (1 ‡πÄ‡∏™‡πâ‡∏ô)
`),a.fabric_variant==="‡∏ó‡∏∂‡∏ö&‡πÇ‡∏õ‡∏£‡πà‡∏á"&&(s+=`  (‚ùóÔ∏è‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏Ç‡∏≤‡∏™‡∏≠‡∏á‡∏ä‡∏±‡πâ‡∏ô)
`),s+=`
`})}const u=c.decorations;Object.keys(u).length>0&&Object.entries(u).forEach(([p,a])=>{s+=`------------------------------
`,s+=`üìã *‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ ${p}*
`,s+=`------------------------------

`,a.forEach(m=>{s+=`‡∏£‡∏´‡∏±‡∏™: #${m.code||"xxx"}
`,s+=`‡∏Ç‡∏ô‡∏≤‡∏î: ${m.width.toFixed(2)} x ${m.height.toFixed(2)} m.
`,s+=`‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: 1 ‡∏ä‡∏∏‡∏î

`})}),s+=`------------------------------
`,s+=`üìã *‡πÅ‡∏à‡∏Å‡πÅ‡∏à‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ (Wallpaper)*
`,s+=`------------------------------

`,c.wallpapers.length>0&&c.wallpapers.forEach(p=>{s+=`- ‡∏ß‡∏≠‡∏•‡πÄ‡∏õ‡πÄ‡∏õ‡∏≠‡∏£‡πå -
`,s+=`  ‡∏£‡∏´‡∏±‡∏™: #${p.code||"xxx"}
`,s+=`  ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${p.rolls} ‡∏°‡πâ‡∏ß‡∏ô

`});const d={};if(c.wallpapers.forEach(p=>{d[p.code]=(d[p.code]||0)+p.rolls}),Object.keys(d).length>0){s+=`------------------------------
`,s+=`üìä *‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ß‡∏≠‡∏•‡πÄ‡∏õ‡πÄ‡∏õ‡∏≠‡∏£‡πå (‡∏ï‡∏≤‡∏°‡∏£‡∏´‡∏±‡∏™)*
`,s+=`------------------------------
`;for(const[p,a]of Object.entries(d))s+=`  - ‡∏£‡∏´‡∏±‡∏™ #${p}: ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${a} ‡∏°‡πâ‡∏ß‡∏ô
`;s+=`
`}if(s+=`------------------------------
`,t==="purchase_order")return s}return(t==="seamstress"||t==="owner")&&(s+=`
üßµ *‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡πà‡∏≤‡∏á*
`,e.rooms.forEach(c=>{if(c.is_suspended||!c.items)return;const i=c.items.filter(d=>d.type==="set"&&!d.is_suspended&&d.width_m>0);if(i.length===0)return;s+=`
*‡∏´‡πâ‡∏≠‡∏á: ${c.room_name||"‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏"}*
`;let u=1;i.forEach(d=>{s+=`${u++}) *‡∏ú‡πâ‡∏≤‡∏°‡πà‡∏≤‡∏ô ${d.style} ${d.fabric_variant}*
`,s+=`  ‡∏Å‡∏ß‡πâ‡∏≤‡∏á ${Number(d.width_m).toFixed(2)} x ‡∏™‡∏π‡∏á ${Number(d.height_m).toFixed(2)} ‡∏°.
`,s+=`  ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏õ‡∏¥‡∏î: ${d.opening_style}
`,d.fabric_variant.includes("‡∏ó‡∏∂‡∏ö")&&(s+=`  ‡∏ú‡πâ‡∏≤‡∏ó‡∏∂‡∏ö: ‡∏£‡∏´‡∏±‡∏™ ${d.fabric_code||"-"}
`),d.fabric_variant.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")&&(s+=`  ‡∏ú‡πâ‡∏≤‡πÇ‡∏õ‡∏£‡πà‡∏á: ‡∏£‡∏´‡∏±‡∏™ ${d.sheer_fabric_code||"-"}
`)})}),s+=`------------------------------
`,t==="seamstress")||t==="owner"&&(s+=`
üí∞ *‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: ${T(l)} ‡∏ö‡∏≤‡∏ó*
`),s}function rt(e){if(!e.rooms||e.rooms.length===0)return'<p class="empty-summary">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•</p>';let t="";const r={};e.rooms.forEach(s=>{s.is_suspended||!s.items||s.items.forEach(c=>{if(c.is_suspended)return;let i=null,u=0;switch(c.type){case"set":u=k.calculateSetPrice(c).total,u>0&&(i=c.type);break;case"wallpaper":u=k.calculateWallpaperPrice(c).total,u>0&&(i=c.type);break;default:u=k.calculateDecoPrice(c).total,u>0&&(i=c.type);break}i&&(r[i]=(r[i]||0)+1)})});const o=Object.entries(r).map(([s,c])=>{const i=le[s]||"‡∏Ç‡∏≠‡∏á‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á";return`
            <span class="summary-tag" data-filter-type="${L(s)}" title="‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ">
                ${L(i)} <strong>${c}</strong>
            </span>`}).join("");o&&(t+=`
            <div class="overview-summary-group">
                <h4><i class="ph ph-stack"></i> ‡∏™‡∏£‡∏∏‡∏õ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</h4>
                <div class="summary-tags-container">
                    ${o}
                </div>
            </div>`);let n="",l=0;return e.rooms.forEach(s=>{if(s.is_suspended||!s.items)return;const c={};let i=0;if(s.items.forEach(u=>{if(u.is_suspended)return;let d=null,p=0;switch(u.type){case"set":p=k.calculateSetPrice(u).total,p>0&&(d=u.type);break;case"wallpaper":p=k.calculateWallpaperPrice(u).total,p>0&&(d=u.type);break;default:p=k.calculateDecoPrice(u).total,p>0&&(d=u.type);break}d&&(c[d]=(c[d]||0)+1,i++)}),i>0){l+=i;const u=Object.entries(c).map(([d,p])=>`
                    <div class="overview-item">
                        <span>${L(le[d]||"‡∏Ç‡∏≠‡∏á‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á")}</span>
                        <span>${p}</span>
                    </div>`).join("");n+=`
                <details class="overview-room-card">
                    <summary class="overview-room-summary">
                        <span class="room-name">${L(s.room_name)||"‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á"}</span>
                        <div class="summary-tags">
                            <span class="room-item-count">${i} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
                            <i class="ph ph-caret-down expand-icon"></i>
                        </div>
                    </summary>
                    <div class="overview-room-items">${u}</div>
                </details>`}}),n&&(t+=`
            <div class="overview-breakdown-group">
                <h4><i class="ph ph-map-pin-line"></i> ‡πÅ‡∏à‡∏Å‡πÅ‡∏à‡∏á‡∏ï‡∏≤‡∏°‡∏´‡πâ‡∏≠‡∏á</h4>
                ${n}
            </div>`),l===0?'<p class="empty-summary">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•</p>':t}function ot(e,t){const{vatRate:r,pageBreakBuffer:o=3}=t,n=[];e.rooms.forEach(M=>{if(M.is_suspended||!M.items)return;const B=[];M.items.forEach(w=>{if(w.is_suspended)return;let I,E,H,P;const U=le[w.type]||"‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á";switch(w.type){case"set":E=k.calculateSetPrice(w).total,E>0&&(H=w.width_m||0,P=w.height_m||0,I=`${U} ${L(w.style)} (${L(w.fabric_variant)}) <br><small>‡∏Ç‡∏ô‡∏≤‡∏î ${H.toFixed(2)} x ${P.toFixed(2)} ‡∏°.${w.notes?` - ${L(w.notes)}`:""}</small>`,B.push({description:I,total:E,units:I.includes("<br>")?1.5:1}));break;case"wallpaper":if(E=k.calculateWallpaperPrice(w).total,E>0){const J=(w.widths||[]).reduce((F,ie)=>F+ie,0),X=k.wallpaperRolls(J,w.height_m);P=w.height_m||0,I=`${U} <br><small>‡∏£‡∏´‡∏±‡∏™: ${L(w.wallpaper_code)||"-"}, ‡∏™‡∏π‡∏á ${P.toFixed(2)} ‡∏°. (‡πÉ‡∏ä‡πâ ${X} ‡∏°‡πâ‡∏ß‡∏ô)</small>`,B.push({description:I,total:E,units:I.includes("<br>")?1.5:1})}break;default:E=k.calculateDecoPrice(w).total,E>0&&(H=w.width_m||0,P=w.height_m||0,I=`${U} <br><small>‡∏£‡∏´‡∏±‡∏™: ${L(w.code)||"-"}, ‡∏Ç‡∏ô‡∏≤‡∏î ${H.toFixed(2)} x ${P.toFixed(2)} ‡∏°.</small>`,B.push({description:I,total:E,units:I.includes("<br>")?1.5:1}));break}}),B.length>0&&(n.push({isRoomHeader:!0,roomName:L(M.room_name)||"‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á",units:1.2}),n.push(...B))});const l=n.reduce((M,B)=>M+(B.total||0),0);if(l===0)return null;let s=0,c="",i=l;e.discount&&e.discount.value>0&&(e.discount.type==="percent"?(s=l*(e.discount.value/100),c=`<tr><td class="pdf-label">‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î (${e.discount.value}%)</td><td class="pdf-amount">-${R(s,2,!0)}</td></tr>`):(s=e.discount.value,c=`<tr><td class="pdf-label">‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î</td><td class="pdf-amount">-${R(s,2,!0)}</td></tr>`),i=l-s,c+=`<tr><td class="pdf-label">‡∏¢‡∏≠‡∏î‡∏´‡∏•‡∏±‡∏á‡∏´‡∏±‡∏Å‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î</td><td class="pdf-amount">${R(i,2,!0)}</td></tr>`);const u=i*r,d=i+u,p=17,a=23,m=[];let v=[],g=0;n.forEach((M,B)=>{const w=m.length===0?p:a,I=g+M.units>w;let E=!1;if(!I&&B<n.length-1){const H=w-(g+M.units);H>0&&H<o&&(E=!0)}(I||E)&&v.length>0&&(m.push(v),v=[],g=0),v.push(M),g+=M.units}),v.length>0&&m.push(v);const h=new Date,_=h.toLocaleDateString("th-TH",{year:"numeric",month:"long",day:"numeric"}),$=`QT-${h.getFullYear()}${(h.getMonth()+1).toString().padStart(2,"0")}${h.getDate().toString().padStart(2,"0")}`;let q="",b=0,x=1;m.forEach((M,B)=>{const w=B===0,I=B===m.length-1,E=`
            <div class="pdf-page-header">
                <div class="pdf-header">
                    <div class="pdf-shop-info">
                        ${`<img src="${C.logoUrl}" alt="Logo" class="pdf-logo">`}
                        <div class="pdf-shop-address">
                            <strong>${L(C.name)}</strong><br>
                            ${L(C.address).replace(/\n/g,"<br>")}<br>
                            ‡πÇ‡∏ó‡∏£: ${L(C.phone)} | ‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏ú‡∏π‡πâ‡πÄ‡∏™‡∏µ‡∏¢‡∏†‡∏≤‡∏©‡∏µ: ${L(C.taxId)}
                        </div>
                    </div>
                    <div class="pdf-quote-details">
                        <div class="pdf-title-box"><h1>‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤ ${m.length>1?w?"":"(‡∏ï‡πà‡∏≠)":""}</h1></div>
                        <table class="pdf-quote-meta">
                            <tr><td>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà:</td><td>${$}</td></tr>
                            <tr><td>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</td><td>${_}</td></tr>
                        </table>
                    </div>
                </div>
                ${w?`
                <section class="pdf-customer-details">
                    <div class="pdf-customer-info">
                        <strong>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤:</strong> ${L(e.customer_name)||""}<br>
                        <strong>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:</strong> ${L(e.customer_address).replace(/\n/g,"<br>")||""}<br>
                        <strong>‡πÇ‡∏ó‡∏£:</strong> ${L(e.customer_phone)||""}
                    </div>
                    <div class="pdf-customer-meta">
                        <strong>‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô:</strong> ${L(C.pdf.paymentTerms)}<br>
                        <strong>‡∏¢‡∏∑‡∏ô‡∏£‡∏≤‡∏Ñ‡∏≤:</strong> ${L(C.pdf.priceValidity)}
                    </div>
                </section>`:""}
            </div>`,H=`
            <div class="pdf-page-footer">
                <div class="pdf-footer-info">
                    <span>${L(C.name)} | ‡πÇ‡∏ó‡∏£: ${L(C.phone)}</span>
                    <span>‡∏´‡∏ô‡πâ‡∏≤ ${B+1} / ${m.length}</span>
                </div>
            </div>`;let P="";w||(P+=`<tr class="pdf-subtotal-row"><td colspan="4">‡∏¢‡∏≠‡∏î‡∏¢‡∏Å‡∏°‡∏≤ (Brought Forward)</td><td class="pdf-text-right">${R(b,2,!0)}</td></tr>`),M.forEach(F=>{F.isRoomHeader?P+=`<tr class="pdf-room-header"><td colspan="5">‡∏´‡πâ‡∏≠‡∏á: ${F.roomName}</td></tr>`:(P+=`<tr><td class="pdf-text-center">${x++}</td><td>${F.description}</td><td class="pdf-text-center">1</td><td class="pdf-text-right">${R(F.total,2,!0)}</td><td class="pdf-text-right">${R(F.total,2,!0)}</td></tr>`,b+=F.total)});let U="";I||(U=`<tfoot><tr class="pdf-subtotal-row"><td colspan="4">‡∏¢‡∏≠‡∏î‡∏¢‡∏Å‡πÑ‡∏õ (Carried Forward)</td><td class="pdf-text-right">${R(b,2,!0)}</td></tr></tfoot>`);let J="";C.pdf.notes&&C.pdf.notes.length>0&&(J=`
                <strong>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</strong>
                <ul>${C.pdf.notes.map(F=>`<li>${L(F)}</li>`).join("")}</ul>
            `);const X=I?`
            <div class="pdf-summary-wrapper">
                <section class="pdf-summary-section">
                    <div class="pdf-amount-in-words">
                        ${J}
                        <div class="pdf-amount-text">( ${Qe(d)} )</div>
                    </div>
                    <div class="pdf-totals-block">
                        <table>
                            <tr><td class="pdf-label">‡∏£‡∏ß‡∏°‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</td><td class="pdf-amount">${R(l,2,!0)}</td></tr>
                            ${c}
                            ${r>0?`<tr><td class="pdf-label">‡∏†‡∏≤‡∏©‡∏µ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏° ${(r*100).toFixed(0)}%</td><td class="pdf-amount">${R(u,2,!0)}</td></tr>`:""}
                            <tr class="pdf-grand-total"><td class="pdf-label">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</td><td class="pdf-amount">${R(d,2,!0)}</td></tr>
                        </table>
                    </div>
                </section>
                <footer class="pdf-footer-section">
                    <div class="pdf-signature-box"><p>.................................................</p><p>‡∏ú‡∏π‡πâ‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤</p><p>(${L(C.name)})</p><p>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${_}</p></div>
                    <div class="pdf-signature-box"><p>.................................................</p><p>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ / ‡∏ú‡∏π‡πâ‡∏°‡∏µ‡∏≠‡∏≥‡∏ô‡∏≤‡∏à‡∏•‡∏á‡∏ô‡∏≤‡∏°</p><p>&nbsp;</p><p>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ......./......./............</p></div>
                </footer>
            </div>
        `:"";q+=`
            <div class="pdf-page">
                <div class="pdf-page-content">
                    ${E}
                    <div class="pdf-page-body">
                        <table class="pdf-items-table">
                            <thead><tr><th style="width:5%;">‡∏•‡∏≥‡∏î‡∏±‡∏ö</th><th style="width:50%;">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th><th style="width:10%;">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th><th style="width:17.5%;">‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏´‡∏ô‡πà‡∏ß‡∏¢</th><th style="width:17.5%;">‡∏£‡∏ß‡∏° (‡∏ö‡∏≤‡∏ó)</th></tr></thead>
                            <tbody>${P}</tbody>
                            ${U}
                        </table>
                        ${X}
                    </div>
                    ${H}
                </div>
            </div>`});const N=e.customer_name||"quote",G=Pe(N);return{html:`<div id="quotation-template">${q}</div>`,fileName:`${$}_${G}`}}const ne=[],nt=10;function ve(e){ne.push(e),ne.length>nt&&ne.shift()}function at(){return ne.pop()}function st(){return ne.length>0}let j=!1,ye=null,ue=null,ae=!1,O=null,we=null,qe=!1;const Ae=document.querySelector("#undoBtn"),de={};function lt(e){if(de[e])return de[e];const t=new Promise((r,o)=>{const n=document.createElement("script");n.src=e,n.onload=()=>{console.log(`${e} loaded successfully.`),r()},n.onerror=()=>{console.error(`Script load error for ${e}`),delete de[e],o(new Error(`Script load error for ${e}`))},document.head.appendChild(n)});return de[e]=t,t}const ce={set:{templateId:"#setTpl",name:"‡∏ú‡πâ‡∏≤‡∏°‡πà‡∏≤‡∏ô"},wallpaper:{templateId:"#wallpaperTpl",name:"‡∏ß‡∏≠‡∏•‡∏•‡πå‡πÄ‡∏õ‡πÄ‡∏õ‡∏≠‡∏£‡πå"},wooden_blind:{templateId:"#areaBasedTpl",name:"‡∏°‡∏π‡πà‡∏•‡∏µ‡πà‡πÑ‡∏°‡πâ"},roller_blind:{templateId:"#areaBasedTpl",name:"‡∏°‡πà‡∏≤‡∏ô‡∏°‡πâ‡∏ß‡∏ô"},vertical_blind:{templateId:"#areaBasedTpl",name:"‡∏°‡πà‡∏≤‡∏ô‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏á"},partition:{templateId:"#areaBasedTpl",name:"‡∏â‡∏≤‡∏Å‡∏Å‡∏±‡πâ‡∏ô‡∏´‡πâ‡∏≠‡∏á"},pleated_screen:{templateId:"#areaBasedTpl",name:"‡∏°‡∏∏‡πâ‡∏á‡∏à‡∏µ‡∏ö"},aluminum_blind:{templateId:"#areaBasedTpl",name:"‡∏°‡∏π‡πà‡∏•‡∏µ‡πà‡∏≠‡∏•‡∏π‡∏°‡∏¥‡πÄ‡∏ô‡∏µ‡∏¢‡∏°"}},ct={‡∏°‡∏π‡πà‡∏•‡∏µ‡πà‡πÑ‡∏°‡πâ:"wooden_blind",‡∏°‡πà‡∏≤‡∏ô‡∏°‡πâ‡∏ß‡∏ô:"roller_blind",‡∏°‡πà‡∏≤‡∏ô‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏á:"vertical_blind",‡∏â‡∏≤‡∏Å‡∏Å‡∏±‡πâ‡∏ô‡∏´‡πâ‡∏≠‡∏á:"partition",‡∏°‡∏∏‡πâ‡∏á‡∏à‡∏µ‡∏ö:"pleated_screen",‡∏°‡∏π‡πà‡∏•‡∏µ‡πà‡∏≠‡∏•‡∏π‡∏°‡∏¥‡πÄ‡∏ô‡∏µ‡∏¢‡∏°:"aluminum_blind"},$e="marnthara.theme";function Fe(){const e=localStorage.getItem($e),t=document.querySelector("#themeToggleBtn");if(!t)return;const r=t.querySelector("i"),o=t.querySelector("span");switch(document.body.classList.remove("dark-theme","neutral-theme"),e){case"dark":document.body.classList.add("dark-theme"),r&&(r.className="ph-fill ph-sun"),o&&(o.textContent=" ‡∏™‡∏ß‡πà‡∏≤‡∏á");break;case"neutral":document.body.classList.add("neutral-theme"),r&&(r.className="ph-fill ph-moon"),o&&(o.textContent=" ‡∏°‡∏∑‡∏î");break;default:r&&(r.className="ph-fill ph-palette"),o&&(o.textContent=" ‡∏Å‡∏•‡∏≤‡∏á");break}}function it(){const e=localStorage.getItem($e);let t;!e||e==="light"?t="neutral":e==="neutral"?t="dark":t="light",localStorage.setItem($e,t),Fe()}function Z(){Ae&&(Ae.disabled=!st())}function ut(){const e=at();e&&(xe(e),S("‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß","success")),Z()}function dt(e,t){if(!e)return;const r=document.getElementById("filterStatusBar");r&&(r.innerHTML=`
            <span>‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÄ‡∏â‡∏û‡∏≤‡∏∞: <strong>${L(t)}</strong></span>
            <button type="button" class="btn-chip" data-act="clear-filter" title="‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏á">
                <i class="ph ph-x"></i>&nbsp;‡∏õ‡∏¥‡∏î
            </button>
        `,r.classList.add("is-visible"),r.dataset.filterType=e),document.querySelectorAll(f.room).forEach(o=>{let n=0;o.querySelectorAll(".item-card").forEach(l=>{const s=l.dataset.type===e;l.classList.toggle("item-hidden",!s),s&&n++}),o.classList.toggle("item-hidden",n===0)}),z(),V()}function pt(){const e=document.getElementById("filterStatusBar");e&&(e.classList.remove("is-visible"),e.innerHTML="",e.removeAttribute("data-filter-type")),document.querySelectorAll(".item-hidden").forEach(t=>t.classList.remove("item-hidden")),z(),V()}function _e(){document.querySelectorAll(".favorite-chips-container.show").forEach(e=>{e.classList.remove("show")}),document.querySelectorAll(".item-card.overflow-visible").forEach(e=>{e.classList.remove("overflow-visible")})}function Re(e){var i;const t=e.dataset.favoriteType,r=(i=e.closest(".form-group-with-favorites"))==null?void 0:i.querySelector(".favorite-chips-container");if(!t||!r)return;_e();const o=e.closest(".item-card"),l=ee()[t]||[];let c=Array.from(l.reduce((u,d)=>{const p=d.code.trim();return p&&!u.has(p.toLowerCase())&&u.set(p.toLowerCase(),d),u},new Map).values()).map(u=>`<button type="button" class="btn-chip" data-code="${L(u.code)}" data-price="${u.price}">${L(u.code)}</button>`).join("");c+=`<button type="button" class="btn-manage-favorites" data-act="manage-favorites" data-type="${t}"><i class="ph ph-pencil-simple"></i> ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î</button>`,r.innerHTML=c,r.classList.add("show"),o&&o.classList.add("overflow-visible")}function mt(e){const t=e.closest(".favorite-chips-container"),r=e.closest(".form-group-with-favorites"),o=e.closest(".item-card");if(!t||!r||!o)return;const n=e.dataset.code,l=y(e.dataset.price),s=r.querySelector("input[data-favorite-type]");s&&(s.value=n,s.classList.add("input-highlight"),setTimeout(()=>s.classList.remove("input-highlight"),1200));const c=s.dataset.favoriteType;let i;c==="fabric"?i="set_price_per_m":c==="sheer"?i="sheer_price_per_m":c==="wallpaper"?i="wallpaper_price_roll":i="area_price_sqyd";const u=o.querySelector(`[name="${i}"]`);u&&l>0&&(u.tagName==="SELECT"?u.value=l:(u.value=T(l),u.classList.add("input-highlight"),setTimeout(()=>u.classList.remove("input-highlight"),1200))),ge(s),K(o),A(),_e()}function fe(e){const t=document.querySelector("#favManagerBody"),r=document.querySelector("#favManagerItemTpl"),n=ee()[e]||[];!t||!r||(n.length===0?t.innerHTML='<p class="empty-state" style="text-align: center; padding: 2rem; color: var(--on-surface-variant);">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ</p>':t.innerHTML=n.map(l=>r.innerHTML.replace(/{CODE}/g,L(l.code)).replace(/{PRICE}/g,T(l.price)).replace(/{RAW_PRICE}/g,l.price)).join(""),ke(null))}function ke(e){const t=document.querySelector('[data-act="edit-selected-fav"]'),r=document.querySelector('[data-act="del-selected-fav"]');!t||!r||(e?(t.disabled=!1,r.disabled=!1,O={code:e.dataset.code,price:y(e.dataset.price)}):(t.disabled=!0,r.disabled=!0,O=null))}async function ft(e){const t=document.querySelector("#favManagerModal");if(!t||!e)return;const r={fabric:"‡∏ú‡πâ‡∏≤‡∏ó‡∏∂‡∏ö",sheer:"‡∏ú‡πâ‡∏≤‡πÇ‡∏õ‡∏£‡πà‡∏á",wallpaper:"‡∏ß‡∏≠‡∏•‡∏•‡πå‡πÄ‡∏õ‡πÄ‡∏õ‡∏≠‡∏£‡πå",wooden_blind:"‡∏°‡∏π‡πà‡∏•‡∏µ‡πà‡πÑ‡∏°‡πâ",roller_blind:"‡∏°‡πà‡∏≤‡∏ô‡∏°‡πâ‡∏ß‡∏ô",vertical_blind:"‡∏°‡πà‡∏≤‡∏ô‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏á",partition:"‡∏â‡∏≤‡∏Å‡∏Å‡∏±‡πâ‡∏ô‡∏´‡πâ‡∏≠‡∏á",pleated_screen:"‡∏°‡∏∏‡πâ‡∏á‡∏à‡∏µ‡∏ö",aluminum_blind:"‡∏°‡∏π‡πà‡∏•‡∏µ‡πà‡∏≠‡∏•‡∏π‡∏°‡∏¥‡πÄ‡∏ô‡∏µ‡∏¢‡∏°",deco:"‡∏Ç‡∏≠‡∏á‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á"};t.dataset.currentType=e,ae=!1,O=null,document.querySelector("#favManagerTitle").textContent=`‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ '${r[e]||e}'`,fe(e),await Y("#favManagerModal",()=>{ae&&ye&&Re(ye)})}function S(e,t="default"){const r=document.querySelector(f.toastContainer);if(!r)return;const o={success:"ph-bold ph-check-circle",warning:"ph-bold ph-warning",error:"ph-bold ph-x-circle",default:"ph-bold ph-info"},n=document.createElement("div");n.className=`toast toast-${t}`,n.innerHTML=`<i class="${o[t]||o.default}"></i> ${e}`,r.appendChild(n),setTimeout(()=>n.classList.add("show"),10),setTimeout(()=>{n.classList.remove("show"),n.addEventListener("transitionend",()=>n.remove())},3e3)}function Y(e,t){return new Promise(r=>{const o=document.querySelector(e);if(!o){r(null);return}const n=document.querySelector(".modal-wrapper.visible");n&&n.classList.add("is-underlay"),o.classList.add("visible");const l=o.querySelector('[id$="Confirm"]'),s=o.querySelector('[id$="Cancel"], [data-act="close-modal"]'),c=Array.from(o.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])')).filter(a=>!a.disabled&&a.offsetParent!==null),i=c[0],u=c[c.length-1];setTimeout(()=>i==null?void 0:i.focus(),50);const d=a=>{if(a.key==="Escape"&&!o.classList.contains("is-underlay")){p({cancelled:!0});return}if(a.key==="Tab"){if(c.length<=1){a.preventDefault();return}a.shiftKey?document.activeElement===i&&(u.focus(),a.preventDefault()):document.activeElement===u&&(i.focus(),a.preventDefault())}},p=a=>{o.classList.remove("visible"),document.removeEventListener("keydown",d),l&&(l.onclick=null),s&&(s.onclick=null),n&&n.classList.remove("is-underlay"),typeof a=="object"&&a.cancelled&&t&&t(),r(a)};l&&(l.onclick=()=>p(!0)),s&&(s.onclick=()=>{o.classList.contains("is-underlay")||p({cancelled:!0})}),document.addEventListener("keydown",d)})}async function se(e,t){const r=document.querySelector(f.modal);return r?(r.querySelector(f.modalTitle).textContent=e,r.querySelector(f.modalBody).textContent=t,await Y(f.modal)===!0):!0}async function ht(){var r,o,n;const e=document.querySelector(f.exportOptionsModal);if(!e)return null;const t=await Y(f.exportOptionsModal);return!t||t.cancelled?null:{vatOption:((r=e.querySelector('input[name="vat_option"]:checked'))==null?void 0:r.value)||"include",exportMethod:((o=e.querySelector("#exportMethod"))==null?void 0:o.value)||"direct",pageBreakBuffer:parseInt((n=e.querySelector("#pageBreakBuffer"))==null?void 0:n.value,10)||3}}async function vt(){const e=document.querySelector("#discountModal");if(!e)return;const t=e.querySelector("#discountSubtotal"),r=e.querySelector("#discountPercent"),o=e.querySelector("#discountAmount"),n=e.querySelector("#discountFinalTotal"),l=document.querySelector("#discount_type"),s=document.querySelector("#discount_value"),c=y(document.querySelector("#originalTotal").dataset.rawTotal||document.querySelector("#grandTotal").textContent);t.textContent=T(c);const i=a=>{if(qe)return;qe=!0;let m=0;if(a==="percent"){const v=y(r.value);m=c*((v>=0?v:0)/100),o.value=m>0?T(Math.round(m)):""}else m=y(o.value);if(m=m>=0?Math.min(m,c):0,a!=="percent"){const v=c>0?m/c*100:0;r.value=v>0&&isFinite(v)?R(v,2):""}n.textContent=T(c-m),setTimeout(()=>{qe=!1},20)};r.addEventListener("input",()=>i("percent")),o.addEventListener("input",()=>i("amount")),o.addEventListener("focus",a=>{y(a.target.value)>0&&(a.target.value=y(a.target.value))}),o.addEventListener("blur",a=>{y(a.target.value)>0&&(a.target.value=T(y(a.target.value))),i("amount")});const u=l.value,d=y(s.value);r.value="",o.value="",d>0?u==="percent"?(r.value=d,i("percent")):(o.value=T(d),i("amount")):i();const p=await Y("#discountModal");if(p&&!p.cancelled){const a=y(r.value),m=y(o.value);document.activeElement===r&&a>0?(l.value="percent",s.value=a):m>0?(l.value="amount",s.value=m):(l.value="amount",s.value=0),D(),A()}}function Le(e,t,r){e&&(ve(W()),Z(),e.classList.add("item-removing"),e.addEventListener("animationend",()=>{e.remove(),t&&S(t),r&&r(),te(),z(),D(),A(),re()},{once:!0}))}function z(){document.querySelectorAll(f.room).forEach(e=>{const t=e.querySelectorAll(".item-card:not(.is-suspended):not(.item-hidden)"),r=t.length;t.forEach((n,l)=>{const s=n.querySelector("[data-item-title]");s&&(s.textContent=`${l+1}/${r}`)}),e.querySelectorAll(".item-card.is-suspended, .item-card.item-hidden").forEach(n=>{const l=n.querySelector("[data-item-title]");l&&(l.textContent="-")})})}function Oe(){const e=document.querySelector(f.orderForm),t=document.querySelector(f.lockBtn);!e||!t||(e.classList.toggle("is-locked",j),t.classList.toggle("is-locked",j),t.querySelector("i").className=j?"ph-bold ph-lock-key":"ph-bold ph-lock-key-open",e.querySelectorAll("input, select, textarea, button").forEach(r=>{r.closest(".summary-footer")||r.closest(".main-header")||r.closest(".modal-wrapper")||r.dataset.act==="toggle-more-details"||(r.disabled=j)}),S(j?"‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ñ‡∏π‡∏Å‡∏•‡πá‡∏≠‡∏Ñ":"‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Ñ‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏•‡πâ‡∏ß",j?"warning":"success"))}function V(){const e=document.querySelectorAll(f.room);if(e.length===0)return;const t=[...e].some(o=>o.open),r=document.querySelector(f.toggleAllRoomsBtn);r&&(r.querySelector("i").className="ph ph-rows",r.querySelector("span").textContent=t?"‡∏¢‡πà‡∏≠":"‡∏Ç‡∏¢‡∏≤‡∏¢")}function yt(){const e=document.querySelectorAll(f.room),t=[...e].some(r=>r.open);e.forEach(r=>{r.open=!t}),setTimeout(()=>{V(),A()},50)}function te(){const e=document.querySelector(f.quickNavRoomList);e&&(e.innerHTML="",document.querySelectorAll(f.room).forEach(t=>{var n;const r=((n=t.querySelector(f.roomNameInput))==null?void 0:n.value)||"‡∏´‡πâ‡∏≠‡∏á",o=document.createElement("a");o.href=`#${t.id}`,o.dataset.jumpTo=t.id,o.innerHTML=`<i class="ph ph-arrow-bend-left-up"></i> ${r}`,e.appendChild(o)}))}function He(e){var r;const t=document.getElementById("quickNavBtnText");t&&(e?t.textContent=((r=e.querySelector('input[name="room_name"]'))==null?void 0:r.value)||"...":t.textContent="‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏´‡πâ‡∏≠‡∏á")}function re(){if(ue&&ue.disconnect(),!document.getElementById("quickNavBtnText"))return;const e={root:null,rootMargin:"-60px 0px -150px 0px",threshold:0},t=r=>{const o=r.filter(n=>n.isIntersecting).sort((n,l)=>n.target.getBoundingClientRect().top-l.target.getBoundingClientRect().top);o.length>0&&He(o[0].target)};ue=new IntersectionObserver(t,e),document.querySelectorAll(f.room).forEach(r=>ue.observe(r))}function ge(e){if(!e)return;const t=e.closest(".form-group-with-favorites").querySelector(".btn-favorite");if(!t)return;const r=e.dataset.favoriteType,o=e.value;t.classList.toggle("is-favorite",Xe(r,o))}function Be(e,t){const r=ce[e];if(!r)return null;const o=document.querySelector(r.templateId);if(!o||!t)return null;const n=o.content.cloneNode(!0),l=n.firstElementChild;l.dataset.type=e,l.classList.add(`${e.replace(/_/g,"-")}-item`);const s=l.querySelector(".item-type-display");if(s&&(s.textContent=r.name),r.templateId==="#areaBasedTpl"){const c=l.querySelector("input[data-favorite-type]");c&&(c.dataset.favoriteType=e)}return t.appendChild(n),l}function _t(e,t){var n;if(!t)return;const r=t.querySelector(f.allItemsContainer);if(!r)return;_e();const o=Be(e,r);if(o){if(e==="wallpaper"){const l=Ce(o.querySelector('[data-act="add-wall"]'));l&&((n=l.querySelector("input"))==null||n.focus())}else{const l=o.querySelector('input:not([type="hidden"]), select, textarea');l&&l.focus()}o.classList.add("item-created"),o.scrollIntoView({behavior:"smooth",block:"center"}),z(),D(),A()}}async function Ne(e,t=null){const r=document.querySelector("#itemTypeModal");if(!r)return null;r.querySelector("#itemTypeModalTitle").textContent=e;let o=t;t&&!ce[t]&&(o="wooden_blind");const n=r.querySelector(`input[name="item_type_option"][value="${o||"set"}"]`);n&&(n.checked=!0);const l=await Y("#itemTypeModal");if(!l||l.cancelled)return null;const s=r.querySelector('input[name="item_type_option"]:checked');return s?s.value:null}function gt(e,t){if(!ce[t])return;const o=e.parentElement;o&&(e.classList.add("item-removing"),e.addEventListener("animationend",()=>{var l;const n=Be(t,o);n&&(e.replaceWith(n),n.classList.add("item-created"),n.scrollIntoView({behavior:"smooth",block:"center"}),(l=n.querySelector('input:not([type="hidden"]), select, textarea'))==null||l.focus(),z(),D(),A(),S("‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß","success"))},{once:!0}))}function oe(){const e=document.querySelector(f.roomsContainer);if(!e)return;const t=document.querySelector("#roomTpl");if(!t)return;const r=Array.from(document.querySelectorAll(f.roomNameInput)).map(i=>parseInt(i.value.replace(/[^0-9]/g,""),10)).filter(i=>!isNaN(i)),l=`‡∏´‡πâ‡∏≠‡∏á ${(r.length>0?Math.max(...r):0)+1}`,c=t.content.cloneNode(!0).firstElementChild;if(e.appendChild(c),c){c.id=`room-${Date.now()}`;const i=c.querySelector(f.roomNameInput);i&&(i.value=l);const u=c.querySelector("[data-room-name-display]");u&&(u.textContent=l),c.open=!0,c.classList.add("item-created"),c.scrollIntoView({behavior:"smooth",block:"center"})}te(),V(),re()}function Ce(e){var r;const t=(r=e==null?void 0:e.closest(".walls-section"))==null?void 0:r.querySelector(f.wallsContainer);if(t){const o=document.querySelector(f.wallTpl);if(!o)return null;const n=o.content.cloneNode(!0),l=n.querySelector(".wall-input-row");if(!l)return null;const s=l.querySelector("input"),c=l.querySelector("label");if(s&&c){const i=`wall-input-${Date.now()}-${Math.random().toString(36).substring(2,7)}`;s.id=i,c.setAttribute("for",i)}return t.appendChild(n),requestAnimationFrame(()=>{l.classList.add("item-created")}),K(e),l}return null}function K(e){var s,c,i,u,d,p,a,m,v,g,h,_;if(!e)return;const t=e.closest(".item-card");if(!t){D();return}const r=t.dataset.type;let o,n,l;switch(r){case"set":o=t.querySelector("[data-set-summary]"),n={width_m:(s=t.querySelector('input[name="width_m"]'))==null?void 0:s.value,height_m:(c=t.querySelector('input[name="height_m"]'))==null?void 0:c.value,style:(i=t.querySelector('select[name="set_style"]'))==null?void 0:i.value,fabric_variant:(u=t.querySelector('select[name="fabric_variant"]'))==null?void 0:u.value,price_per_m_raw:(d=t.querySelector('select[name="set_price_per_m"]'))==null?void 0:d.value,sheer_price_per_m:(p=t.querySelector('select[name="sheer_price_per_m"]'))==null?void 0:p.value},l=k.calculateSetPrice(n),t.dataset.totalPrice=l.total;let $=`‡∏£‡∏≤‡∏Ñ‡∏≤: <b>${T(l.total)}</b> ‡∏ö.`;l.opaque>0&&l.sheer>0&&($+=` <small>(‡∏ó‡∏∂‡∏ö: ${T(l.opaque)}, ‡πÇ‡∏õ‡∏£‡πà‡∏á: ${T(l.sheer)})</small>`),o&&(o.innerHTML=$);break;case"wallpaper":o=t.querySelector("[data-wallpaper-summary]"),n={height_m:(a=t.querySelector('input[name="wallpaper_height_m"]'))==null?void 0:a.value,price_per_roll:(m=t.querySelector('input[name="wallpaper_price_roll"]'))==null?void 0:m.value,install_cost_per_roll:(v=t.querySelector('input[name="wallpaper_install_cost"]'))==null?void 0:v.value,widths:Array.from(t.querySelectorAll('input[name="wall_width_m"]')).map(x=>x.value)},l=k.calculateWallpaperPrice(n),t.dataset.totalPrice=l.total;let q=`‡∏£‡∏ß‡∏°: <b>${T(l.total)}</b> ‡∏ö. `;(l.material>0||l.install>0)&&(q+=`<small>(‡∏ß‡∏≠‡∏•‡∏•‡πå: ${T(l.material)}, ‡∏Ñ‡πà‡∏≤‡∏ä‡πà‡∏≤‡∏á: ${T(l.install)})</small>`),l.rolls>0&&(q+=` &bull; ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà: ${R(l.sqm,2)} ‡∏ï‡∏£.‡∏°. &bull; ‡πÉ‡∏ä‡πâ: ${l.rolls} ‡∏°‡πâ‡∏ß‡∏ô`),o&&(o.innerHTML=q);break;default:o=t.querySelector("[data-area-summary]"),n={width_m:(g=t.querySelector('input[name="area_width_m"]'))==null?void 0:g.value,height_m:(h=t.querySelector('input[name="area_height_m"]'))==null?void 0:h.value,price_sqyd:(_=t.querySelector('input[name="area_price_sqyd"]'))==null?void 0:_.value},l=k.calculateDecoPrice(n),t.dataset.totalPrice=l.total;let b="";l.sqyd>0&&(b=` &bull; ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà: ${R(l.sqyd,2)} ‡∏ï‡∏£.‡∏´‡∏•‡∏≤`),o&&(o.innerHTML=`‡∏£‡∏≤‡∏Ñ‡∏≤: <b>${T(l.total)}</b> ‡∏ö.${b}`);break}D()}function D(){let e=0;document.querySelectorAll(f.room).forEach(s=>{let c=0,i=0;const u=s.classList.contains("is-suspended");s.querySelectorAll(".item-card").forEach(p=>{const a=y(p.dataset.totalPrice),m=p.classList.contains("is-suspended");!u&&!m&&(c+=a,a>0&&i++)});const d=s.querySelector("[data-room-brief]");d&&(u?d.textContent="(‡∏£‡∏∞‡∏á‡∏±‡∏ö‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß)":i>0?d.innerHTML=`<span>${i}</span> &bull; ${T(c)} ‡∏ö‡∏≤‡∏ó`:d.innerHTML="<span>0</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£"),u||(e+=c)});const t=document.querySelector("#discount_type").value,r=y(document.querySelector("#discount_value").value);let o=0;r>0&&(o=t==="percent"?e*(r/100):r);const n=e-o;document.querySelector("#grandTotal").textContent=T(n);const l=document.querySelector("#originalTotal");o>0?(l.textContent=T(e),l.dataset.rawTotal=e,l.style.display="block"):(l.style.display="none",l.dataset.rawTotal="")}function xe(e){if(e!=null&&e.favorites&&(Ke(e.favorites)?S("‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à","success"):S("‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á","warning")),!(e!=null&&e.rooms)||!Array.isArray(e.rooms)){e.favorites||S("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå","error");return}const t=document.querySelector(f.roomsContainer);if(!t)return;t.innerHTML="",document.querySelector("#customer_name").value=e.customer_name||"",document.querySelector("#customer_phone").value=e.customer_phone||"",document.querySelector("#customer_address").value=e.customer_address||"",e.discount&&(document.querySelector("#discount_type").value=e.discount.type||"amount",document.querySelector("#discount_value").value=e.discount.value||0),document.querySelector("#customerDetailsCard").open=e.customer_card_open??!0;let r=0;const o=()=>{if(r>=e.rooms.length){document.querySelectorAll("input[data-favorite-type]").forEach(ge),document.querySelectorAll(".item-card").forEach(i=>K(i)),z(),D(),te(),V(),re(),S("‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à","success");return}const n=e.rooms[r],l=document.querySelector("#roomTpl");if(!l){console.error("Room template not found.");return}const c=l.content.cloneNode(!0).firstElementChild;if(t.appendChild(c),c){c.id=n.id||`room-${Date.now()}`,n.is_suspended&&c.classList.add("is-suspended"),c.open=n.is_open===!0;const i=n.room_name||"‡∏´‡πâ‡∏≠‡∏á (‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠)",u=c.querySelector(f.roomNameInput),d=c.querySelector("[data-room-name-display]");u&&(u.value=i),d&&(d.textContent=i);const p=c.querySelector(f.allItemsContainer);p&&n.items&&n.items.forEach(a=>{var v,g,h;a.type==="deco"&&a.deco_type?(a.type=ct[a.deco_type]||"wooden_blind",a.code=a.deco_code,a.width_m=a.deco_width_m,a.height_m=a.deco_height_m,a.price_sqyd=a.deco_price_sqyd,a.notes=a.deco_notes):a.type==="deco"&&(a.type="wooden_blind",a.code=a.deco_code);const m=Be(a.type,p);if(m)switch(a.is_suspended&&m.classList.add("is-suspended"),a.type){case"set":m.querySelector('input[name="width_m"]').value=Q(a.width_m),m.querySelector('input[name="height_m"]').value=Q(a.height_m),m.querySelector('select[name="set_style"]').value=a.style||a.set_style||"‡∏•‡∏≠‡∏ô",m.querySelector('select[name="fabric_variant"]').value=a.fabric_variant||"‡∏ó‡∏∂‡∏ö",m.querySelector('select[name="set_price_per_m"]').value=a.price_per_m_raw||a.set_price_per_m||"",m.querySelector('select[name="sheer_price_per_m"]').value=a.sheer_price_per_m||"",m.querySelector('select[name="opening_style"]').value=a.opening_style||"‡πÅ‡∏¢‡∏Å‡∏Å‡∏•‡∏≤‡∏á",m.querySelector('select[name="track_color"]').value=a.track_color||"‡∏Ç‡∏≤‡∏ß",m.querySelector('input[name="fabric_code"]').value=a.fabric_code||"",m.querySelector('input[name="sheer_fabric_code"]').value=a.sheer_fabric_code||"",m.querySelector('input[name="notes"]').value=a.notes||"";const _=(a.fabric_variant||"").includes("‡πÇ‡∏õ‡∏£‡πà‡∏á");(v=m.querySelector(f.sheerWrap))==null||v.classList.toggle("hidden",!_),(g=m.querySelector(f.sheerCodeWrap))==null||g.classList.toggle("hidden",!_);break;case"wallpaper":m.querySelector('input[name="wallpaper_height_m"]').value=Q(a.height_m||a.wallpaper_height_m),m.querySelector('input[name="wallpaper_code"]').value=a.wallpaper_code||"";const $=y(a.price_per_roll||a.wallpaper_price_roll);m.querySelector('input[name="wallpaper_price_roll"]').value=$>0?T($):"",m.querySelector('input[name="wallpaper_install_cost"]').value=a.hasOwnProperty("install_cost_per_roll")?T(a.install_cost_per_roll):a.wallpaper_install_cost?T(a.wallpaper_install_cost):"300",m.querySelector('input[name="wallpaper_notes"]').value=a.notes||a.wallpaper_notes||"",m.querySelector(f.wallsContainer)&&a.widths&&a.widths.forEach(b=>{const x=Ce(m.querySelector('[data-act="add-wall"]'));x&&(x.querySelector('input[name="wall_width_m"]').value=Q(b))});break;default:if(((h=ce[a.type])==null?void 0:h.templateId)==="#areaBasedTpl"){m.querySelector('input[name="area_width_m"]').value=Q(a.width_m),m.querySelector('input[name="area_height_m"]').value=Q(a.height_m);const b=y(a.price_sqyd);m.querySelector('input[name="area_price_sqyd"]').value=b>0?T(b):"",m.querySelector('input[name="area_code"]').value=a.code||"",m.querySelector('input[name="area_notes"]').value=a.notes||""}break}})}r++,requestAnimationFrame(o)};requestAnimationFrame(o)}function St(e){if(document.getElementById("loading-overlay"))return;const t=document.createElement("div");t.id="loading-overlay",t.innerHTML=`<div class="loading-spinner"></div><p>${e}</p>`,document.body.appendChild(t),document.body.style.overflow="hidden"}function bt(){const e=document.getElementById("loading-overlay");e&&e.remove(),document.body.style.overflow=""}async function wt(e,t){var o,n;const r=document.querySelector(f.printableContent);if(!r||!e||!e.html){S("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£","error");return}if(t==="direct"){St("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á PDF...");try{typeof html2pdf>"u"&&(S("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏•‡∏ö‡∏£‡∏≤‡∏£‡∏µ PDF...","default"),await lt("https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"));const l=document.createElement("div");l.style.position="fixed",l.style.left="-300mm",l.style.top="0",l.style.width="210mm",l.style.background="#fff",l.innerHTML=e.html,document.body.appendChild(l),await new Promise(c=>setTimeout(c,500));const s={margin:0,filename:`${e.fileName}.pdf`,image:{type:"jpeg",quality:.98},html2canvas:{scale:2,useCORS:!0,logging:!1,width:((o=l.querySelector(".pdf-page"))==null?void 0:o.scrollWidth)||210*3.77,windowWidth:((n=l.querySelector(".pdf-page"))==null?void 0:n.scrollWidth)||210*3.77},jsPDF:{unit:"mm",format:"a4",orientation:"portrait"}};await window.html2pdf().from(l).set(s).save(),S("‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î PDF ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à","success"),document.body.contains(l)&&document.body.removeChild(l)}catch(l){console.error("PDF Generation Error:",l),S("‡∏™‡∏£‡πâ‡∏≤‡∏á PDF ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß, ‡πÇ‡∏õ‡∏£‡∏î‡∏•‡∏≠‡∏á‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 2 (‡∏û‡∏¥‡∏°‡∏û‡πå)","error")}finally{bt()}}t==="print"&&(r.innerHTML=e.html,setTimeout(()=>{window.print(),setTimeout(()=>{r.innerHTML=""},1e3)},Ve))}function qt(e){if(!e||!e.html){S("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå HTML","error");return}try{const t=`
            <!DOCTYPE html><html lang="th"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
                <title>${e.fileName}</title>
                <link rel="stylesheet" href="https://grobmak.github.io/marnthara-form/src/style.css">
                <style>#printable-content { display: block !important; } .pdf-page { border: 1px solid #eee; box-shadow: 0 0 10px rgba(0,0,0,0.1); margin: 10mm auto; }</style>
            </head>
            <body>${e.html}</body></html>`,r=new Blob([t],{type:"text/html;charset=utf-8"}),o=URL.createObjectURL(r),n=document.createElement("a");n.href=o,n.download=`${e.fileName}.html`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(o),S("‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå HTML ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à","success")}catch(t){console.error("HTML Export Error:",t),S("‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå HTML ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß","error")}}function De(e){if(!e)return;const t=e.closest(".item-card");if(!t)return;const r=y(e.value);let o,n;const l=e.getAttribute("name");if(l==="set_price_per_m"?(o=t.querySelector('input[name="fabric_code"]'),n="fabric"):l==="sheer_price_per_m"?(o=t.querySelector('input[name="sheer_fabric_code"]'),n="sheer"):l==="wallpaper_price_roll"?(o=t.querySelector('input[name="wallpaper_code"]'),n="wallpaper"):l==="area_price_sqyd"&&(o=t.querySelector('input[name="area_code"]'),o&&(n=o.dataset.favoriteType)),o&&n&&o.value.trim()){const s=Me(n,o.value);s&&s.price!==r&&(o.value="",ge(o))}}const Lt=Ge(e=>{e.matches('[name$="_price_sqyd"], [name$="_price_roll"], [name$="_price_per_m"]')&&De(e),K(e),A()},200);function Tt(e){if(j){e.preventDefault();return}if(e.target.matches(f.roomNameInput)){const t=e.target.closest(".room-card");if(t){const r=t.querySelector("[data-room-name-display]");r&&(r.textContent=e.target.value||"‡∏´‡πâ‡∏≠‡∏á")}te(),re()}e.target.matches("input[data-favorite-type]")&&ge(e.target),Lt(e.target)}function $t(e){var o,n,l;if(j)return;const t=e.target;if(t.matches('select[name="fabric_variant"]')){const s=t.closest(".set-item");if(s){const c=(o=t.value)==null?void 0:o.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á");(n=s.querySelector(f.sheerWrap))==null||n.classList.toggle("hidden",!c),(l=s.querySelector(f.sheerCodeWrap))==null||l.classList.toggle("hidden",!c)}}t.matches(f.roomNameInput)&&(te(),re()),t.matches('[name="set_price_per_m"], [name="sheer_price_per_m"]')&&De(t),K(t),A()}function kt(e){const t=e.target;t.matches('[name$="_price_sqyd"], [name$="_price_roll"], [name$="_install_cost"]')?t.value=y(t.value)>0?T(y(t.value)):"":t.matches('input[name$="_m"], input[name$="width_m"]')&&(t.value=Q(t.value))}function xt(e){const t=e.target;t.matches('[name$="_price_sqyd"], [name$="_price_roll"], [name$="_install_cost"]')&&y(t.value)>0&&(t.value=y(t.value)),t.matches("input[data-favorite-type]")&&(ye=t,Re(t))}const It=async e=>{var d,p,a,m;const t=e.target.closest(".summary-tag[data-filter-type]");if(t){const v=t.dataset.filterType,g=t.textContent.trim().replace(/\s*\d+\s*$/,""),h=document.querySelector("#overviewModal");h&&h.classList.remove("visible"),dt(v,g);return}const r=e.target.closest(".favorite-chips-container .btn-chip");if(r){mt(r);return}const o=e.target.closest(".fav-manager-item");if(o){const v=o.parentElement.querySelector(".is-selected");v&&v.classList.remove("is-selected"),v!==o?(o.classList.add("is-selected"),ke(o)):ke(null);return}const n=e.target.closest("[data-act]");if(!n)return;const l=["toggle-more-details","show-discount-modal"];if(j&&!n.closest(".unlockable")&&!l.includes(n.dataset.act))return;const s=n.dataset.act,c=n.closest(f.room),i=n.closest(".item-card"),u=(v,g,h)=>se(v,g).then(_=>_&&h());switch(s){case"add-room":oe();break;case"add-item":{if(we=n.closest(f.room),we){const h=await Ne("‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà");h&&_t(h,we)}break}case"collapse-room":c&&(e.preventDefault(),c.open=!1,(d=c.querySelector("summary"))==null||d.scrollIntoView({behavior:"smooth",block:"center"}));break;case"clear-filter":pt();break;case"change-type":{const h=i==null?void 0:i.dataset.type;if(i&&h){const _=await Ne("‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£",h);_&&_!==h&&u("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á","‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà ‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?",()=>gt(i,_))}break}case"add-wall":{const h=Ce(n);h&&((p=h.querySelector('input[name="wall_width_m"]'))==null||p.focus());break}case"show-discount-modal":vt();break;case"toggle-more-details":{const h=i==null?void 0:i.querySelector(".item-details-more");if(h){const _=h.classList.toggle("show");n.classList.toggle("expanded",_),n.querySelector("i").className=_?"ph ph-caret-up":"ph ph-caret-down",n.querySelector("span").textContent=_?"‡∏¢‡πà‡∏≠‡∏ô‡πâ‡∏≠‡∏¢‡∏•‡∏á":"‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°"}break}case"toggle-favorite":{const h=n.closest(".form-group-with-favorites").querySelector("input[data-favorite-type]");if(!h||!i)break;const _=h.dataset.favoriteType,$=h.value;let q;_==="fabric"?q="set_price_per_m":_==="sheer"?q="sheer_price_per_m":_==="wallpaper"?q="wallpaper_price_roll":q="area_price_sqyd";const b=i.querySelector(`[name="${q}"]`),x=y(b==null?void 0:b.value);if(!$.trim()){S("‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏´‡∏±‡∏™‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å","warning");break}if(x<=0&&_!=="fabric"&&_!=="sheer"){S("‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å","warning");break}const N=be(_,$,x);n.classList.toggle("is-favorite",N),S(N?"‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î‡πÅ‡∏•‡πâ‡∏ß":"‡∏•‡∏ö‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î","success"),A();break}case"manage-favorites":{const h=n.dataset.type;ye=n.closest(".form-group-with-favorites").querySelector("input[data-favorite-type]"),ft(h);break}case"add-new-fav-form":{const _=n.closest("#favManagerModal").dataset.currentType;if(!_)break;const $=document.querySelector("#favAddModal");$.querySelector("h3").textContent=`‡πÄ‡∏û‡∏¥‡πà‡∏° '${((a=ce[_])==null?void 0:a.name)||_}'`;const q=$.querySelector('[name="fav_code_add"]'),b=$.querySelector('[name="fav_price_add"]');q.value="",b.value="";const x=await Y("#favAddModal");if(x&&!x.cancelled){const N=q.value.trim(),G=y(b.value);N&&(be(_,N,G),ae=!0,fe(_),S("‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î‡πÅ‡∏•‡πâ‡∏ß","success"))}break}case"edit-selected-fav":{if(!O)break;const _=n.closest("#favManagerModal").dataset.currentType;if(!_)break;const $=document.querySelector("#favEditModal");$.querySelector("h3").textContent=`‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç '${O.code}'`;const q=$.querySelector('[name="fav_code_edit"]'),b=$.querySelector('[name="fav_price_edit"]');q.value=O.code,b.value=O.price>0?O.price:"";const x=await Y("#favEditModal");if(x&&!x.cancelled){const N=q.value.trim(),G=y(b.value);N&&(N!==O.code&&Te(_,O.code),be(_,N,G),ae=!0,fe(_),S("‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î‡πÅ‡∏•‡πâ‡∏ß","success"))}break}case"del-selected-fav":{if(!O)break;const _=n.closest("#favManagerModal").dataset.currentType;if(!_)break;await se("‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î",`‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏´‡∏±‡∏™ "${O.code}"?`)&&(Te(_,O.code),ae=!0,fe(_),S("‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î‡πÅ‡∏•‡πâ‡∏ß","success"));break}case"del-room":u("‡∏•‡∏ö‡∏´‡πâ‡∏≠‡∏á","‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ?",()=>Le(c,"‡∏•‡∏ö‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß"));break;case"del-item":u("‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£","‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ?",()=>Le(i,"‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß"));break;case"del-wall":u("‡∏•‡∏ö‡∏ú‡∏ô‡∏±‡∏á","‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ú‡∏ô‡∏±‡∏á‡∏ô‡∏µ‡πâ?",()=>Le(n.closest(".wall-input-row"),"‡∏•‡∏ö‡∏ú‡∏ô‡∏±‡∏á‡πÅ‡∏•‡πâ‡∏ß",()=>K(i)));break;case"clear-room":u("‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á","‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏•‡∏ö‡∏ó‡∏∏‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ?",()=>{ve(W()),Z(),c.querySelector(f.allItemsContainer).innerHTML="",z(),D(),A(),S("‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß","success")});break;case"toggle-room-menu":e.preventDefault();const v=n.nextElementSibling;if(!v||!c)return;const g=!v.classList.contains("show");document.querySelectorAll(".room-options-menu.show").forEach(h=>h.classList.remove("show")),document.querySelectorAll(".card.overflow-visible").forEach(h=>h.classList.remove("overflow-visible")),g&&(v.classList.add("show"),c.classList.add("overflow-visible"));break;case"toggle-suspend-room":e.preventDefault(),c==null||c.classList.toggle("is-suspended"),D(),A(),(m=n.closest(".room-options-menu"))==null||m.classList.remove("show"),c==null||c.classList.remove("overflow-visible");break;case"toggle-suspend":e.preventDefault(),i==null||i.classList.toggle("is-suspended"),K(n),A();break}};function Et(){j=!j,Oe()}function Mt(e){if(!e||e.closest(".modal-wrapper"))return;const t=e.getAttribute("name"),r=e.closest(".item-card"),l=(s=>{const c=s[t];if(!c)return null;const i=r||document;let u=null;return typeof c=="string"?u=i.querySelector(`[name="${c}"]:not(:disabled)`):typeof c=="function"&&(u=c(e)),!u&&r&&typeof c=="string"&&(u=document.querySelector(`[name="${c}"]:not(:disabled)`)),u})({customer_name:"customer_phone",customer_phone:"customer_address",customer_address:()=>document.querySelector(".room-name-input"),room_name:s=>{var c;return(c=s.closest(".room-card"))==null?void 0:c.querySelector('[data-act="add-item"]')},width_m:"height_m",height_m:"set_price_per_m",set_price_per_m:s=>{var u;const c=s.closest(".set-item"),i=(u=c==null?void 0:c.querySelector('[name="fabric_variant"]'))==null?void 0:u.value;return i!=null&&i.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")?c==null?void 0:c.querySelector('[name="sheer_price_per_m"]'):c==null?void 0:c.querySelector('[data-act="toggle-more-details"]')},sheer_price_per_m:s=>{var c;return(c=s.closest(".item-card"))==null?void 0:c.querySelector('[data-act="toggle-more-details"]')},area_width_m:"area_height_m",area_height_m:"area_price_sqyd",area_price_sqyd:"area_code",wall_width_m:s=>{var i,u;const c=(i=s.closest(".wall-input-row"))==null?void 0:i.nextElementSibling;return c!=null&&c.matches(".wall-input-row")?c.querySelector("input"):(u=s.closest(".item-card"))==null?void 0:u.querySelector('[name="wallpaper_price_roll"]')},wallpaper_price_roll:"wallpaper_height_m",wallpaper_height_m:"wallpaper_code"});l&&(l.focus(),typeof l.select=="function"&&l.select())}function Bt(){const e=document.querySelector(f.setTpl);if(!e)return;const t=e.content.querySelector('select[name="set_price_per_m"]'),r=e.content.querySelector('select[name="sheer_price_per_m"]'),o=n=>{let l='<option value="" hidden>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏Ñ‡∏≤</option>';return Array.isArray(n)?(n.forEach(s=>{l+=`<option value="${s}">${s.toLocaleString("th-TH")}</option>`}),l):(console.error("Price data for dropdown is not available or not an array.",n),l)};t&&(t.innerHTML=o(he.fabric)),r&&(r.innerHTML=o(he.sheer))}function Ct(){Bt(),Fe();const e=document.querySelector(f.orderForm),t=document.querySelector(f.fileImporter),r=document.querySelector(f.menuDropdown),o=document.querySelector(f.quickNavDropdown),n=document.querySelector("#pageBreakBuffer"),l=document.querySelector("#pageBreakBufferValue");n&&l&&n.addEventListener("input",()=>{l.textContent=n.value}),e.addEventListener("input",Tt),e.addEventListener("change",$t),document.addEventListener("click",It),e.addEventListener("blur",kt,!0),e.addEventListener("focusin",xt,!0),e.addEventListener("keydown",i=>{const u=i.target;i.key==="Enter"&&!u.matches("textarea, button, [data-act]")&&(i.preventDefault(),Mt(u))});const s=i=>{const u=i.target.closest(f.room);u&&He(u)};e.addEventListener("click",s),e.addEventListener("focusin",s),document.body.addEventListener("click",i=>{i.target.closest("summary")&&setTimeout(()=>{V(),A()},50)}),document.querySelector("#undoBtn").addEventListener("click",i=>{i.preventDefault(),ut()}),document.querySelector(f.lockBtn).addEventListener("click",Et),document.querySelector(f.toggleAllRoomsBtn).addEventListener("click",yt),document.querySelector(f.quickNavBtn).addEventListener("click",i=>{var d;i.stopPropagation(),r.classList.remove("show");const u=!o.classList.contains("show");o.classList.toggle("show"),i.currentTarget.setAttribute("aria-expanded",u),u&&((d=document.querySelector(f.menuBtn))==null||d.setAttribute("aria-expanded","false"))}),document.querySelector(f.quickNavRoomList).addEventListener("click",i=>{var d;const u=i.target.closest("a[data-jump-to]");if(u){i.preventDefault();const p=u.dataset.jumpTo,a=document.getElementById(p);a&&(document.body.classList.add("disable-animations"),a.open=!0,a.scrollIntoView({behavior:"auto",block:"start"}),a.classList.add("scrolling-jump"),setTimeout(()=>{a.classList.remove("scrolling-jump"),document.body.classList.remove("disable-animations"),V()},1e3)),o.classList.remove("show"),(d=document.querySelector(f.quickNavBtn))==null||d.setAttribute("aria-expanded","false")}});const c=document.querySelector("#addRoomQuickNavBtn");if(c){const i=Je(oe,700);c.addEventListener("click",u=>{var d;u.stopPropagation(),i(),o.classList.remove("show"),(d=document.querySelector(f.quickNavBtn))==null||d.setAttribute("aria-expanded","false")})}document.querySelector(f.menuBtn).addEventListener("click",i=>{var d;i.stopPropagation(),o.classList.remove("show");const u=!r.classList.contains("show");r.classList.toggle("show"),i.currentTarget.setAttribute("aria-expanded",u),u&&((d=document.querySelector(f.quickNavBtn))==null||d.setAttribute("aria-expanded","false"))}),document.querySelector("#themeToggleBtn").addEventListener("click",i=>{i.preventDefault(),it()}),document.querySelector("#overviewBtn").addEventListener("click",async i=>{var a;i.preventDefault(),r.classList.remove("show"),(a=document.querySelector(f.menuBtn))==null||a.setAttribute("aria-expanded","false");const u=W(),d=document.querySelector("#overviewModalHeader"),p=document.querySelector("#overviewModalBody");if(d&&p){const m=u.rooms.reduce((h,_)=>{if(_.is_suspended)return h;const $=(_.items||[]).filter(q=>{if(q.is_suspended)return!1;let b=0;switch(q.type){case"set":b=k.calculateSetPrice(q).total;break;case"wallpaper":b=k.calculateWallpaperPrice(q).total;break;default:b=k.calculateDecoPrice(q).total;break}return b>0}).length;return h+$},0),v=document.querySelector(f.grandTotal).textContent||"0",g=u.rooms.filter(h=>!h.is_suspended&&h.items&&h.items.some(_=>!_.is_suspended)).length;d.innerHTML=`
                <div class="overview-stats-grid">
                    <div class="overview-stat-card">
                        <i class="ph-bold ph-map-pin-line"></i>
                        <div class="stat-value">${g}</div>
                        <div class="stat-label">‡∏´‡πâ‡∏≠‡∏á</div>
                    </div>
                    <div class="overview-stat-card">
                        <i class="ph-bold ph-stack"></i>
                        <div class="stat-value">${m}</div>
                        <div class="stat-label">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
                    </div>
                    <div class="overview-stat-card">
                        <i class="ph-bold ph-coins"></i>
                        <div class="stat-value">${v}</div>
                        <div class="stat-label">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°</div>
                    </div>
                </div>
            `,p.innerHTML=rt(u),Y("#overviewModal")}}),document.querySelector(f.exportPdfBtn).addEventListener("click",async i=>{var a;i.preventDefault(),r.classList.remove("show"),(a=document.querySelector(f.menuBtn))==null||a.setAttribute("aria-expanded","false");const u=await ht();if(!u)return;const d=W(),p=ot(d,{vatRate:u.vatOption==="include"?C.baseVatRate:0,pageBreakBuffer:u.pageBreakBuffer});if(!p){S("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£","warning");return}u.exportMethod==="html"?qt(p):wt(p,u.exportMethod)}),document.querySelector(f.importBtn).addEventListener("click",i=>{var u;i.preventDefault(),r.classList.remove("show"),(u=document.querySelector(f.menuBtn))==null||u.setAttribute("aria-expanded","false"),t.click()}),t.addEventListener("change",i=>{var p;const u=(p=i.target.files)==null?void 0:p[0];if(!u)return;const d=new FileReader;d.onload=a=>{try{const m=JSON.parse(a.target.result);xe(m)}catch(m){S("‡πÑ‡∏ü‡∏•‡πå JSON ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á","error"),console.error("JSON Parse Error:",m)}},d.readAsText(u),i.target.value=null}),document.querySelector(f.exportBtn).addEventListener("click",i=>{var u;i.preventDefault(),r.classList.remove("show"),(u=document.querySelector(f.menuBtn))==null||u.setAttribute("aria-expanded","false");try{const d=W(),p=JSON.stringify(d,null,4),a=new Blob([p],{type:"application/json"}),m=URL.createObjectURL(a),v=document.createElement("a"),g=new Date,h=`${g.getFullYear()}${(g.getMonth()+1).toString().padStart(2,"0")}${g.getDate().toString().padStart(2,"0")}`,_=`${g.getHours().toString().padStart(2,"0")}${g.getMinutes().toString().padStart(2,"0")}`,$=Pe(d.customer_name||"data");v.href=m,v.download=`MTR-${h}${_}-${$}.json`,v.click(),URL.revokeObjectURL(m),S("Export ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à","success")}catch{S("Export ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß","error")}}),document.querySelector(f.submitBtn).addEventListener("click",async i=>{var u;if(i.preventDefault(),r.classList.remove("show"),(u=document.querySelector(f.menuBtn))==null||u.setAttribute("aria-expanded","false"),await se("‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•","‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏£‡∏≤‡∏Ñ‡∏≤?")){const d=W();if(!d.customer_name&&!d.customer_phone){S("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤","warning");return}S("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...","default");try{const p=await fetch(Ue,{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)});p.ok?S("‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!","success"):S(`‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ${p.status}`,"error")}catch{S("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠","error")}}}),document.querySelector(f.copyTextBtn).addEventListener("click",async i=>{var p;i.preventDefault(),r.classList.remove("show"),(p=document.querySelector(f.menuBtn))==null||p.setAttribute("aria-expanded","false");const u=document.querySelector(f.copyOptionsModal);u.querySelector('input[name="copy_option"][value="customer"]').checked=!0;const d=await Y(f.copyOptionsModal);if(d&&!d.cancelled){const a=u.querySelector('input[name="copy_option"]:checked').value,m=tt(W(),a);try{await navigator.clipboard.writeText(m),S("‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!","success")}catch{S("‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß","error")}}}),document.querySelector(f.clearItemsBtn).addEventListener("click",async i=>{var u;i.preventDefault(),r.classList.remove("show"),(u=document.querySelector(f.menuBtn))==null||u.setAttribute("aria-expanded","false"),await se("‡∏•‡πâ‡∏≤‡∏á‡∏ó‡∏∏‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£","‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡∏´‡πâ‡∏≠‡∏á‡∏à‡∏∞‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡∏≠‡∏¢‡∏π‡πà)?")&&(ve(W()),Z(),document.querySelectorAll(f.room).forEach(d=>{const p=d.querySelector(f.allItemsContainer);p&&(p.innerHTML="")}),D(),A(),S("‡∏•‡πâ‡∏≤‡∏á‡∏ó‡∏∏‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß","success"))}),document.querySelector(f.clearAllBtn).addEventListener("click",async i=>{var u;if(i.preventDefault(),r.classList.remove("show"),(u=document.querySelector(f.menuBtn))==null||u.setAttribute("aria-expanded","false"),await se("‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î",'‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô! ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤, ‡∏ó‡∏∏‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£, ‡πÅ‡∏•‡∏∞ "‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î" ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ñ‡∏≤‡∏ß‡∏£ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')){ve(W()),Z(),localStorage.removeItem(pe),Ze();const d=document.querySelector("#customer_name"),p=document.querySelector("#customer_phone"),a=document.querySelector("#customer_address");d&&(d.value=""),p&&(p.value=""),a&&(a.value="");const m=document.querySelector("#discount_type"),v=document.querySelector("#discount_value");m&&(m.value="amount"),v&&(v.value="0");const g=document.querySelector(f.roomsContainer);g&&(g.innerHTML=""),D(),te(),V(),oe();const h=document.querySelector("#customerDetailsCard");h&&(h.open=!0),S("‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏´‡∏°‡πà","success")}}),window.addEventListener("click",i=>{var u,d;i.target.closest(".modal-wrapper")||(i.target.closest(".menu-container")||(r.classList.contains("show")&&(r.classList.remove("show"),(u=document.querySelector(f.menuBtn))==null||u.setAttribute("aria-expanded","false")),o.classList.contains("show")&&(o.classList.remove("show"),(d=document.querySelector(f.quickNavBtn))==null||d.setAttribute("aria-expanded","false"))),i.target.closest(".room-options-container")||(document.querySelectorAll(".room-options-menu.show").forEach(p=>p.classList.remove("show")),document.querySelectorAll(".card.overflow-visible").forEach(p=>p.classList.remove("overflow-visible"))),i.target.closest(".form-group-with-favorites")||_e())}),window.addEventListener("beforeunload",A);try{const i=localStorage.getItem(pe);if(i&&i.length>2&&i!=="null")xe(JSON.parse(i));else{oe();const u=document.querySelector("#customerDetailsCard");u&&(u.open=!0)}}catch(i){console.error("Failed to load data from localStorage:",i),localStorage.removeItem(pe),oe()}D(),Oe(),V(),re(),Z()}document.addEventListener("DOMContentLoaded",Ct);
