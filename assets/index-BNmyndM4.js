(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(o){if(o.ep)return;o.ep=!0;const a=n(o);fetch(o.href,a)}})();const ge="input-ui/5.6.0-final",Se="https://your-make-webhook-url.com/your-unique-path",X="marnthara.input.v4",qe=500,x={name:"‡∏°‡πà‡∏≤‡∏ô‡∏ò‡∏≤‡∏£‡∏≤ ‡∏ú‡πâ‡∏≤‡∏°‡πà‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏Ç‡∏≠‡∏á‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á",address:"65/8 ‡∏´‡∏°‡∏π‡πà 2 ‡∏ï.‡∏ó‡πà‡∏≤‡∏®‡∏≤‡∏•‡∏≤ ‡∏≠.‡πÄ‡∏°‡∏∑‡∏≠‡∏á ‡∏à.‡∏•‡∏û‡∏ö‡∏∏‡∏£‡∏µ 15000",phone:"092-985-9395, 082-552-5595",taxId:"1234567890123",logoUrl:"https://i.imgur.com/l7y85nI.png",baseVatRate:.07,pdf:{paymentTerms:"‡∏ä‡∏≥‡∏£‡∏∞‡∏°‡∏±‡∏î‡∏à‡∏≥ 50%",priceValidity:"30 ‡∏ß‡∏±‡∏ô",notes:["‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ô‡∏µ‡πâ‡∏£‡∏ß‡∏°‡∏Ñ‡πà‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏•‡πâ‡∏ß","‡∏ä‡∏≥‡∏£‡∏∞‡∏°‡∏±‡∏î‡∏à‡∏≥ 50% ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ú‡∏•‡∏¥‡∏ï‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤","‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏≤‡∏¢‡∏∏ 30 ‡∏ß‡∏±‡∏ô ‡∏ô‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤"]}},we=1.19599,ae={ROLL_WIDTH_M:.53,ROLL_LENGTH_M:10,STRIPS_PER_ROLL_UNDER_2_5M:3},ee={fabric:[1e3,1100,1200,1300,1400,1500,1600,1700,1800,1900,2e3,2100,2200],sheer:[1e3,1100,1200,1300,1400,1500],style_surcharge:{‡∏•‡∏≠‡∏ô:200,‡∏ï‡∏≤‡πÑ‡∏Å‡πà:0,‡∏à‡∏µ‡∏ö:0},height:[{threshold:3.2,add_per_m:300},{threshold:2.8,add_per_m:200},{threshold:2.5,add_per_m:100}]},d={orderForm:"#orderForm",roomsContainer:"#rooms",setTpl:"#setTpl",clearAllBtn:"#clearAllBtn",lockBtn:"#lockBtn",grandTotal:"#grandTotal",setCount:"#setCount",modal:"#confirmationModal",modalTitle:"#modalTitle",modalBody:"#modalBody",room:"[data-room]",set:"[data-set]",setsContainer:"[data-sets]",decorationsContainer:"[data-decorations]",decoItem:"[data-deco-item]",wallpapersContainer:"[data-wallpapers]",wallpaperItem:"[data-wallpaper-item]",wallsContainer:"[data-walls-container]",sheerWrap:"[data-sheer-wrap]",roomNameInput:'input[name="room_name"]',toastContainer:"#toast-container",copyTextBtn:"#copyTextBtn",copyOptionsModal:"#copyOptionsModal",menuBtn:"#menuBtn",menuDropdown:"#menuDropdown",importBtn:"#importBtn",exportBtn:"#exportBtn",fileImporter:"#fileImporter",submitBtn:"#submitBtn",clearItemsBtn:"#clearItemsBtn",exportPdfBtn:"#exportPdfBtn",exportOptionsModal:"#exportOptionsModal",printableContent:"#printable-content",quickNavBtn:"#quickNavBtn",quickNavDropdown:"#quickNavDropdown",quickNavRoomList:"#quickNavRoomList",toggleAllRoomsBtn:"#toggleAllRoomsBtn",allDetailsCards:'.card[id="customerDetailsCard"], .room-card'},v=t=>{typeof t=="string"&&(t=t.replace(/,/g,""));const e=parseFloat(t);return Number.isFinite(e)?e:0},A=t=>{const e=v(t);return e>0?e.toFixed(2):""},I=(t,e=2,n=!1)=>Number.isFinite(t)?t.toLocaleString("en-US",{minimumFractionDigits:n?2:e,maximumFractionDigits:n?2:e}):"0",$=(t,e=0)=>Number.isFinite(t)?t.toLocaleString("th-TH",{minimumFractionDigits:e,maximumFractionDigits:e}):"0",ie=(t,e=150)=>{let n;return(...r)=>{clearTimeout(n),n=setTimeout(()=>t(...r),e)}},be=(t,e=700)=>{let n=!1;return(...r)=>{if(!n){n=!0;try{return t(...r)}finally{setTimeout(()=>{n=!1},e)}}}};function Le(t){let e=v(t);if(isNaN(e))return"‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á";if(e===0)return"‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ö‡∏≤‡∏ó‡∏ñ‡πâ‡∏ß‡∏ô";const n=["","‡∏´‡∏ô‡∏∂‡πà‡∏á","‡∏™‡∏≠‡∏á","‡∏™‡∏≤‡∏°","‡∏™‡∏µ‡πà","‡∏´‡πâ‡∏≤","‡∏´‡∏Å","‡πÄ‡∏à‡πá‡∏î","‡πÅ‡∏õ‡∏î","‡πÄ‡∏Å‡πâ‡∏≤"],r=["","‡∏™‡∏¥‡∏ö","‡∏£‡πâ‡∏≠‡∏¢","‡∏û‡∏±‡∏ô","‡∏´‡∏°‡∏∑‡πà‡∏ô","‡πÅ‡∏™‡∏ô","‡∏•‡πâ‡∏≤‡∏ô"];let o=Math.floor(e),a=Math.round((e-o)*100);const s=c=>{if(c===0)return"";let u="";const m=String(c);for(let p=0;p<m.length;p++){const f=m[p];m.length-1;const h=m.length-p-1;f!=="0"&&(h===1&&f==="1"?u+=r[h]:h===1&&f==="2"?u+="‡∏¢‡∏µ‡πà"+r[h]:h===0&&f==="1"&&m.length>1?u+="‡πÄ‡∏≠‡πá‡∏î":u+=n[parseInt(f)]+r[h])}return u};let i="";if(o>0){const c=Math.floor(o/1e6),u=o%1e6;c>0&&(i+=s(c)+"‡∏•‡πâ‡∏≤‡∏ô"),i+=s(u),i+="‡∏ö‡∏≤‡∏ó"}let l="";return a>0?l=s(a)+"‡∏™‡∏ï‡∏≤‡∏á‡∏Ñ‡πå":i+="‡∏ñ‡πâ‡∏ß‡∏ô",(i+l).trim()}function H(){var e,n,r,o;const t={app_version:ge,customer_name:((e=document.querySelector('[name="customer_name"]'))==null?void 0:e.value)||"",customer_phone:((n=document.querySelector('[name="customer_phone"]'))==null?void 0:n.value)||"",customer_address:((r=document.querySelector('[name="customer_address"]'))==null?void 0:r.value)||"",customer_card_open:(o=document.querySelector("#customerDetailsCard"))==null?void 0:o.open,rooms:[]};return document.querySelectorAll(d.room).forEach(a=>{var i;const s={id:a.id,room_name:((i=a.querySelector(d.roomNameInput))==null?void 0:i.value)||"",is_suspended:a.classList.contains("is-suspended"),sets:[],decorations:[],wallpapers:[]};a.querySelectorAll(d.set).forEach(l=>{var c,u,m,p,f,h,S,b,_,g,y;s.sets.push({width_m:v((c=l.querySelector('input[name="width_m"]'))==null?void 0:c.value),height_m:v((u=l.querySelector('input[name="height_m"]'))==null?void 0:u.value),style:((m=l.querySelector('select[name="set_style"]'))==null?void 0:m.value)||"",fabric_variant:((p=l.querySelector('select[name="fabric_variant"]'))==null?void 0:p.value)||"",price_per_m_raw:v((f=l.querySelector('select[name="set_price_per_m"]'))==null?void 0:f.value),sheer_price_per_m:v((h=l.querySelector('select[name="sheer_price_per_m"]'))==null?void 0:h.value),fabric_code:((S=l.querySelector('input[name="fabric_code"]'))==null?void 0:S.value)||"",sheer_fabric_code:((b=l.querySelector('input[name="sheer_fabric_code"]'))==null?void 0:b.value)||"",opening_style:((_=l.querySelector('select[name="opening_style"]'))==null?void 0:_.value)||"",track_color:((g=l.querySelector('select[name="track_color"]'))==null?void 0:g.value)||"",notes:((y=l.querySelector('input[name="notes"]'))==null?void 0:y.value)||"",is_suspended:l.classList.contains("is-suspended")})}),a.querySelectorAll(d.decoItem).forEach(l=>{var c,u,m,p,f,h;s.decorations.push({type:((c=l.querySelector('[name="deco_type"]'))==null?void 0:c.value)||"",width_m:v((u=l.querySelector('[name="deco_width_m"]'))==null?void 0:u.value),height_m:v((m=l.querySelector('[name="deco_height_m"]'))==null?void 0:m.value),price_sqyd:v((p=l.querySelector('[name="deco_price_sqyd"]'))==null?void 0:p.value),deco_code:((f=l.querySelector('[name="deco_code"]'))==null?void 0:f.value)||"",notes:((h=l.querySelector('[name="deco_notes"]'))==null?void 0:h.value)||"",is_suspended:l.classList.contains("is-suspended")})}),a.querySelectorAll(d.wallpaperItem).forEach(l=>{var c,u,m,p,f;s.wallpapers.push({height_m:v((c=l.querySelector('[name="wallpaper_height_m"]'))==null?void 0:c.value),wallpaper_code:((u=l.querySelector('[name="wallpaper_code"]'))==null?void 0:u.value)||"",price_per_roll:v((m=l.querySelector('[name="wallpaper_price_roll"]'))==null?void 0:m.value),install_cost_per_roll:v((p=l.querySelector('[name="wallpaper_install_cost"]'))==null?void 0:p.value),notes:((f=l.querySelector('[name="wallpaper_notes"]'))==null?void 0:f.value)||"",widths:Array.from(l.querySelectorAll('[name="wall_width_m"]')).map(h=>v(h.value)),is_suspended:l.classList.contains("is-suspended")})}),t.rooms.push(s)}),t}function P(){localStorage.setItem(X,JSON.stringify(H()))}const L={stylePlus:t=>ee.style_surcharge[t]??0,heightPlus:t=>{const e=[...ee.height].sort((n,r)=>r.threshold-n.threshold);for(const n of e)if(t>n.threshold)return n.add_per_m;return 0},fabricYardage:(t,e)=>{const n=v(e);return n<=0||!t?0:t==="‡∏ï‡∏≤‡πÑ‡∏Å‡πà"||t==="‡∏à‡∏µ‡∏ö"?(n*2+.6)/.9:t==="‡∏•‡∏≠‡∏ô"?(n*2.6+.6)/.9:0},wallpaperRolls:(t,e)=>{const n=v(t),r=v(e);if(n<=0||r<=0)return 0;const o=r>2.5?Math.floor(ae.ROLL_LENGTH_M/r):ae.STRIPS_PER_ROLL_UNDER_2_5M;if(o<=0)return 0;const a=Math.ceil(n/ae.ROLL_WIDTH_M);return Math.ceil(a/o)},calculateSetPrice:function(t){var s,i;if(!t||t.is_suspended||v(t.width_m)<=0)return{total:0,opaque:0,sheer:0};const e=this.stylePlus(t.style),n=this.heightPlus(v(t.height_m)),r=v(t.width_m),o=(s=t.fabric_variant)!=null&&s.includes("‡∏ó‡∏∂‡∏ö")&&v(t.price_per_m_raw)>0?(v(t.price_per_m_raw)+e+n)*r:0,a=(i=t.fabric_variant)!=null&&i.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")&&v(t.sheer_price_per_m)>0?(v(t.sheer_price_per_m)+e+n)*r:0;return{total:Math.round(o+a),opaque:Math.round(o),sheer:Math.round(a)}},calculateDecoPrice:function(t){if(!t||t.is_suspended||v(t.width_m)<=0)return{total:0,sqm:0,sqyd:0};const e=v(t.width_m)*v(t.height_m),n=e*we,r=n*v(t.price_sqyd);return{total:Math.round(r),sqm:e,sqyd:n}},calculateWallpaperPrice:function(t){var s;if(!t||t.is_suspended)return{total:0,material:0,install:0,rolls:0,sqm:0};const e=((s=t.widths)==null?void 0:s.reduce((i,l)=>i+v(l),0))||0;if(e<=0)return{total:0,material:0,install:0,rolls:0,sqm:0};const n=v(t.height_m),r=this.wallpaperRolls(e,n),o=r*v(t.price_per_roll),a=r*(v(t.install_cost_per_roll)||0);return{total:Math.round(o+a),material:Math.round(o),install:Math.round(a),rolls:r,sqm:e*n}}};function $e(t){return t.rooms.reduce((e,n)=>{if(n.is_suspended)return e;const r=n.sets.reduce((s,i)=>s+L.calculateSetPrice(i).total,0),o=n.decorations.reduce((s,i)=>s+L.calculateDecoPrice(i).total,0),a=n.wallpapers.reduce((s,i)=>s+L.calculateWallpaperPrice(i).total,0);return e+r+o+a},0)}function Te(t,e){const n=$e(t);let r=`‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (${new Date().toLocaleDateString("th-TH",{day:"numeric",month:"numeric",year:"numeric"})})
`;if(r+=`‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤: ${t.customer_name||"-"}
`,(e==="customer"||e==="owner")&&(r+=`‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£: ${t.customer_phone||"-"}
`,r+=`‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà: ${t.customer_address||"-"}
`),r+=`------------------------------
`,e==="customer")return r+=`
‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
`,t.rooms.forEach(o=>{if(o.is_suspended||[...o.sets,...o.decorations,...o.wallpapers].filter(i=>i.is_suspended?!1:i.widths?i.widths.reduce((l,c)=>l+c,0)>0:i.width_m>0).length===0)return;r+=`
*‡∏´‡πâ‡∏≠‡∏á: ${o.room_name||"‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏"}*
`;let s=0;o.sets.forEach(i=>{i.is_suspended||i.width_m<=0||(s++,r+=` ${s}) ‡∏ú‡πâ‡∏≤‡∏°‡πà‡∏≤‡∏ô ${i.style} (${i.fabric_variant})
`)}),o.decorations.forEach(i=>{i.is_suspended||i.width_m<=0||(s++,r+=` ${s}) ${i.type||"‡∏Ç‡∏≠‡∏á‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á"}
`)}),o.wallpapers.forEach(i=>{i.is_suspended||i.widths.reduce((l,c)=>l+c,0)<=0||(s++,r+=` ${s}) ‡∏ß‡∏≠‡∏•‡πÄ‡∏õ‡πÄ‡∏õ‡∏≠‡∏£‡πå
`)})}),r+=`------------------------------
`,r+=`
‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: ${$(n)} ‡∏ö‡∏≤‡∏ó
`,r+=`
‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£
${x.name}
‡πÇ‡∏ó‡∏£: ${x.phone}`,r;if(e==="purchase_order"||e==="owner"){const o={opaqueFabrics:[],sheerFabrics:[],decorations:[],wallpapers:[],allSets:[]};if(t.rooms.forEach(a=>{a.is_suspended||(a.sets.forEach(s=>{s.is_suspended||s.width_m<=0||(o.allSets.push(s),s.fabric_variant.includes("‡∏ó‡∏∂‡∏ö")&&o.opaqueFabrics.push({code:s.fabric_code||"??",yards:L.fabricYardage(s.style,s.width_m)}),s.fabric_variant.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")&&o.sheerFabrics.push({code:s.sheer_fabric_code||"??",yards:L.fabricYardage(s.style,s.width_m)}))}),a.decorations.forEach(s=>{s.is_suspended||!s.type||s.width_m<=0||o.decorations.push({type:s.type,code:s.deco_code||"xxx",width:s.width_m,height:s.height_m})}),a.wallpapers.forEach(s=>{if(s.is_suspended)return;const i=s.widths.reduce((l,c)=>l+c,0);if(i>0){const l=L.wallpaperRolls(i,s.height_m);l>0&&o.wallpapers.push({code:s.wallpaper_code||"xxx",rolls:l})}}))}),r+=`üìã *‡∏™‡∏£‡∏∏‡∏õ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏ú‡πâ‡∏≤*
`,r+=`------------------------------
`,o.opaqueFabrics.length>0&&o.opaqueFabrics.forEach(a=>{r+=`- ‡∏ú‡πâ‡∏≤‡∏ó‡∏∂‡∏ö (Curtain Fabric)
`,r+=`‡∏£‡∏´‡∏±‡∏™: #${a.code||"??"}
`,r+=`‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${a.yards.toFixed(2)} ‡∏´‡∏•‡∏≤

`}),o.sheerFabrics.length>0&&o.sheerFabrics.forEach(a=>{r+=`- ‡∏ú‡πâ‡∏≤‡πÇ‡∏õ‡∏£‡πà‡∏á (Sheer Fabric)
`,r+=`‡∏£‡∏´‡∏±‡∏™: #${a.code||"??"}
`,r+=`‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${a.yards.toFixed(2)} ‡∏´‡∏•‡∏≤

`}),r+=`------------------------------
`,r+=`üìã *‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ ‡∏£‡∏≤‡∏á*
`,r+=`------------------------------

`,o.allSets.length>0){let a=1;o.allSets.forEach(s=>{r+=`(${a++}) ‡∏£‡∏≤‡∏á‡∏°‡πà‡∏≤‡∏ô: ${s.style}, ‡∏™‡∏µ: ${s.track_color}
`,s.fabric_variant.includes("‡∏ó‡∏∂‡∏ö")&&(r+=`  - ‡∏£‡∏≤‡∏á‡∏ó‡∏∂‡∏ö: ${s.width_m.toFixed(2)} ‡∏°. (1 ‡πÄ‡∏™‡πâ‡∏ô)
`),s.fabric_variant.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")&&(r+=`  - ‡∏£‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πà‡∏á: ${s.width_m.toFixed(2)} ‡∏°. (1 ‡πÄ‡∏™‡πâ‡∏ô)
`),s.fabric_variant==="‡∏ó‡∏∂‡∏ö&‡πÇ‡∏õ‡∏£‡πà‡∏á"&&(r+=`  (‚ùóÔ∏è‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏Ç‡∏≤‡∏™‡∏≠‡∏á‡∏ä‡∏±‡πâ‡∏ô)
`),r+=`
`})}if(r+=`------------------------------
`,r+=`üìã *‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ Blind*
`,r+=`------------------------------

`,o.decorations.length>0){const a={‡∏°‡∏π‡πà‡∏•‡∏µ‡πà‡πÑ‡∏°‡πâ:"Wooden Blind",‡∏°‡πà‡∏≤‡∏ô‡∏°‡πâ‡∏ß‡∏ô:"Roller Blind",‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏á:"Vertical Blind",‡∏â‡∏≤‡∏Å‡∏Å‡∏±‡πâ‡∏ô‡∏´‡πâ‡∏≠‡∏á:"Partition",‡∏°‡∏∏‡πâ‡∏á‡∏à‡∏µ‡∏ö:"Pleated Insect Screen",‡∏°‡∏π‡πà‡∏•‡∏µ‡πà‡∏°‡∏¥‡πÄ‡∏ô‡∏µ‡∏¢‡∏°:"Aluminium Blind"};o.decorations.forEach(s=>{const i=a[s.type]?` (${a[s.type]})`:"";r+=`- ${s.type}${i}
`,r+=`‡∏£‡∏´‡∏±‡∏™: #${s.code||"xxx"}
`,r+=`‡∏Ç‡∏ô‡∏≤‡∏î: ${s.width.toFixed(2)} x ${s.height.toFixed(2)} m.
`,r+=`‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: 1 ‡∏ä‡∏∏‡∏î

`})}if(r+=`------------------------------
`,r+=`üìã *‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ Wallpaper*
`,r+=`------------------------------

`,o.wallpapers.length>0&&o.wallpapers.forEach(a=>{r+=`- ‡∏ß‡∏≠‡∏•‡πÄ‡∏õ‡πÄ‡∏õ‡∏≠‡∏£‡πå -
`,r+=`‡∏£‡∏´‡∏±‡∏™: #${a.code||"xxx"}
`,r+=`‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${a.rolls} ‡∏°‡πâ‡∏ß‡∏ô

`}),r+=`------------------------------
`,e==="purchase_order")return r}return(e==="seamstress"||e==="owner")&&(r+=`
üßµ *‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡πà‡∏≤‡∏á*
`,t.rooms.forEach(o=>{if(o.is_suspended||o.sets.filter(i=>!i.is_suspended&&i.width_m>0).length===0)return;r+=`
*‡∏´‡πâ‡∏≠‡∏á: ${o.room_name||"‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏"}*
`;let s=1;o.sets.forEach(i=>{i.is_suspended||i.width_m<=0||(r+=`${s++}) *‡∏ú‡πâ‡∏≤‡∏°‡πà‡∏≤‡∏ô ${i.style} ${i.fabric_variant}*
`,r+=`  ‡∏Å‡∏ß‡πâ‡∏≤‡∏á ${i.width_m} x ‡∏™‡∏π‡∏á ${i.height_m} ‡∏°.
`,r+=`  ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏õ‡∏¥‡∏î: ${i.opening_style}
`,i.fabric_variant.includes("‡∏ó‡∏∂‡∏ö")&&(r+=`  ‡∏ú‡πâ‡∏≤‡∏ó‡∏∂‡∏ö: ‡∏£‡∏´‡∏±‡∏™ ${i.fabric_code||"-"}
`),i.fabric_variant.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")&&(r+=`  ‡∏ú‡πâ‡∏≤‡πÇ‡∏õ‡∏£‡πà‡∏á: ‡∏£‡∏´‡∏±‡∏™ ${i.sheer_fabric_code||"-"}
`))})}),r+=`------------------------------
`,e==="seamstress")||e==="owner"&&(r+=`
üí∞ *‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: ${$(n)} ‡∏ö‡∏≤‡∏ó*
`),r}function ke(t){if(!t.rooms||t.rooms.length===0)return'<p class="empty-summary">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•</p>';const e={};let n=0,r="";if(t.rooms.forEach(s=>{if(s.is_suspended)return;const i={};s.sets.forEach(c=>{if(L.calculateSetPrice(c).total>0){const u="‡∏ú‡πâ‡∏≤‡∏°‡πà‡∏≤‡∏ô";i[u]=(i[u]||0)+1,e[u]=(e[u]||0)+1}}),s.decorations.forEach(c=>{if(c.type&&L.calculateDecoPrice(c).total>0){const u=c.type;i[u]=(i[u]||0)+1,e[u]=(e[u]||0)+1}}),s.wallpapers.forEach(c=>{if(L.calculateWallpaperPrice(c).total>0){const u="‡∏ß‡∏≠‡∏•‡πÄ‡∏õ‡πÄ‡∏õ‡∏≠‡∏£‡πå";i[u]=(i[u]||0)+1,e[u]=(e[u]||0)+1}});const l=Object.entries(i);l.length>0&&(r+=`<tr class="room-header-row"><td colspan="3">${s.room_name||"‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á"}</td></tr>`,l.forEach(([c,u])=>{r+=`<tr><td></td><td class="item-type-cell">${c}</td><td class="pdf-text-center">${u}</td></tr>`,n+=u}))}),n===0)return'<p class="empty-summary">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•</p>';let a=`<div id="detailed-material-summary">
        <h4><i class="ph ph-stack"></i> ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ó‡∏∏‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</h4>
        <ul><li class="summary-note">${Object.entries(e).map(([s,i])=>`${s}: ${i}`).join(" , ")}</li></ul>
    </div>`;return a+=`<table>
        <thead><tr><th>‡∏´‡πâ‡∏≠‡∏á</th><th>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th><th class="pdf-text-center">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th></tr></thead>
        <tbody>${r}</tbody>
    </table>`,a}function Ee(t,e){const{vatRate:n,pageBreakBuffer:r=3}=e,o=[];t.rooms.forEach(T=>{if(T.is_suspended)return;const k=[];T.sets.forEach(q=>{const E=L.calculateSetPrice(q).total;if(E>0){let C=`‡∏ú‡πâ‡∏≤‡∏°‡πà‡∏≤‡∏ô ${q.style} (${q.fabric_variant}) <br><small>‡∏Ç‡∏ô‡∏≤‡∏î ${q.width_m.toFixed(2)} x ${q.height_m.toFixed(2)} ‡∏°.${q.notes?` - ${q.notes}`:""}</small>`;k.push({description:C,total:E,units:C.includes("<br>")?1.5:1})}}),T.decorations.forEach(q=>{const E=L.calculateDecoPrice(q).total;if(E>0){let C=`${q.type||"‡∏á‡∏≤‡∏ô‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á"} <br><small>‡∏£‡∏´‡∏±‡∏™: ${q.deco_code||"-"}, ‡∏Ç‡∏ô‡∏≤‡∏î ${q.width_m.toFixed(2)} x ${q.height_m.toFixed(2)} ‡∏°.</small>`;k.push({description:C,total:E,units:C.includes("<br>")?1.5:1})}}),T.wallpapers.forEach(q=>{const E=L.calculateWallpaperPrice(q).total;if(E>0){const C=q.widths.reduce((Q,ne)=>Q+ne,0),O=L.wallpaperRolls(C,q.height_m);let F=`‡∏ß‡∏≠‡∏•‡πÄ‡∏õ‡πÄ‡∏õ‡∏≠‡∏£‡πå <br><small>‡∏£‡∏´‡∏±‡∏™: ${q.wallpaper_code||"-"}, ‡∏™‡∏π‡∏á ${q.height_m.toFixed(2)} ‡∏°. (‡πÉ‡∏ä‡πâ ${O} ‡∏°‡πâ‡∏ß‡∏ô)</small>`;k.push({description:F,total:E,units:F.includes("<br>")?1.5:1})}}),k.length>0&&(o.push({isRoomHeader:!0,roomName:T.room_name||"‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á",units:1.2}),o.push(...k))});const a=o.reduce((T,k)=>T+(k.total||0),0);if(a===0)return null;const s=a*n,i=a+s,l=17,c=23,u=[];let m=[],p=0;o.forEach((T,k)=>{const q=u.length===0?l:c,E=p+T.units>q;let C=!1;if(!E&&k<o.length-1){const O=q-(p+T.units);O>0&&O<r&&(C=!0)}(E||C)&&m.length>0&&(u.push(m),m=[],p=0),m.push(T),p+=T.units}),m.length>0&&u.push(m);const f=new Date,h=f.toLocaleDateString("th-TH",{year:"numeric",month:"long",day:"numeric"}),S=`QT-${f.getFullYear()}${(f.getMonth()+1).toString().padStart(2,"0")}${f.getDate().toString().padStart(2,"0")}`;let b="",_=0,g=1;u.forEach((T,k)=>{const q=k===0,E=k===u.length-1,C=`
            <div class="pdf-page-header">
                <div class="pdf-header">
                    <div class="pdf-shop-info">
                        ${`<img src="${x.logoUrl}" alt="Logo" class="pdf-logo">`}
                        <div class="pdf-shop-address">
                            <strong>${x.name}</strong><br>
                            ${x.address.replace(/\n/g,"<br>")}<br>
                            ‡πÇ‡∏ó‡∏£: ${x.phone} | ‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏ú‡∏π‡πâ‡πÄ‡∏™‡∏µ‡∏¢‡∏†‡∏≤‡∏©‡∏µ: ${x.taxId}
                        </div>
                    </div>
                    <div class="pdf-quote-details">
                        <div class="pdf-title-box"><h1>‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤ ${u.length>1?q?"":"(‡∏ï‡πà‡∏≠)":""}</h1></div>
                        <table class="pdf-quote-meta">
                            <tr><td>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà:</td><td>${S}</td></tr>
                            <tr><td>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</td><td>${h}</td></tr>
                        </table>
                    </div>
                </div>
                ${q?`
                <section class="pdf-customer-details">
                    <div class="pdf-customer-info">
                        <strong>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤:</strong> ${t.customer_name||""}<br>
                        <strong>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:</strong> ${t.customer_address.replace(/\n/g,"<br>")||""}<br>
                        <strong>‡πÇ‡∏ó‡∏£:</strong> ${t.customer_phone||""}
                    </div>
                    <div class="pdf-customer-meta">
                        <strong>‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô:</strong> ${x.pdf.paymentTerms}<br>
                        <strong>‡∏¢‡∏∑‡∏ô‡∏£‡∏≤‡∏Ñ‡∏≤:</strong> ${x.pdf.priceValidity}
                    </div>
                </section>`:""}
            </div>`,O=`
            <div class="pdf-page-footer">
                <div class="pdf-footer-info">
                    <span>${x.name} | ‡πÇ‡∏ó‡∏£: ${x.phone}</span>
                    <span>‡∏´‡∏ô‡πâ‡∏≤ ${k+1} / ${u.length}</span>
                </div>
            </div>`;let F="";q||(F+=`<tr class="pdf-subtotal-row"><td colspan="4">‡∏¢‡∏≠‡∏î‡∏¢‡∏Å‡∏°‡∏≤ (Brought Forward)</td><td class="pdf-text-right">${I(_,2,!0)}</td></tr>`),T.forEach(M=>{M.isRoomHeader?F+=`<tr class="pdf-room-header"><td colspan="5">‡∏´‡πâ‡∏≠‡∏á: ${M.roomName}</td></tr>`:(F+=`<tr><td class="pdf-text-center">${g++}</td><td>${M.description}</td><td class="pdf-text-center">1</td><td class="pdf-text-right">${I(M.total,2,!0)}</td><td class="pdf-text-right">${I(M.total,2,!0)}</td></tr>`,_+=M.total)});let Q="";E||(Q=`<tfoot><tr class="pdf-subtotal-row"><td colspan="4">‡∏¢‡∏≠‡∏î‡∏¢‡∏Å‡πÑ‡∏õ (Carried Forward)</td><td class="pdf-text-right">${I(_,2,!0)}</td></tr></tfoot>`);const ne=E?`
            <div class="pdf-summary-wrapper">
                <section class="pdf-summary-section">
                    <div class="pdf-amount-in-words">
                        <strong>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</strong>
                        <ul>${x.pdf.notes.map(M=>`<li>${M}</li>`).join("")}</ul>
                        <div class="pdf-amount-text">( ${Le(i)} )</div>
                    </div>
                    <div class="pdf-totals-block">
                        <table>
                            <tr><td colspan="2" class="pdf-label">‡∏£‡∏ß‡∏°‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</td><td class="pdf-amount">${I(a,2,!0)}</td></tr>
                            ${n>0?`<tr><td colspan="2" class="pdf-label">‡∏†‡∏≤‡∏©‡∏µ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏° ${(n*100).toFixed(0)}%</td><td class="pdf-amount">${I(s,2,!0)}</td></tr>`:""}
                            <tr class="pdf-grand-total"><td colspan="2" class="pdf-label">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</td><td class="pdf-amount">${I(i,2,!0)}</td></tr>
                        </table>
                    </div>
                </section>
                <footer class="pdf-footer-section">
                    <div class="pdf-signature-box"><p>.................................................</p><p>‡∏ú‡∏π‡πâ‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤</p><p>(${x.name})</p><p>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${h}</p></div>
                    <div class="pdf-signature-box"><p>.................................................</p><p>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ / ‡∏ú‡∏π‡πâ‡∏°‡∏µ‡∏≠‡∏≥‡∏ô‡∏≤‡∏à‡∏•‡∏á‡∏ô‡∏≤‡∏°</p><p>&nbsp;</p><p>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ......./......./............</p></div>
                </footer>
            </div>
        `:"";b+=`
            <div class="pdf-page">
                <div class="pdf-page-content">
                    ${C}
                    <div class="pdf-page-body">
                        <table class="pdf-items-table">
                            <thead><tr><th style="width:5%;">‡∏•‡∏≥‡∏î‡∏±‡∏ö</th><th style="width:50%;">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th><th style="width:10%;">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th><th style="width:17.5%;">‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏´‡∏ô‡πà‡∏ß‡∏¢</th><th style="width:17.5%;">‡∏£‡∏ß‡∏° (‡∏ö‡∏≤‡∏ó)</th></tr></thead>
                            <tbody>${F}</tbody>
                            ${Q}
                        </table>
                        ${ne}
                    </div>
                    ${O}
                </div>
            </div>`});const N=(t.customer_name||"quote").trim().replace(/\s+/g,"-");return{html:`<div id="quotation-template">${b}</div>`,fileName:`${S}_${N}`}}const ue="marnthara.favorites.v2";function D(){try{const t=localStorage.getItem(ue),e={fabric:[],sheer:[],deco:[],wallpaper:[]};return t?{...e,...JSON.parse(t)}:e}catch(t){return console.error("Failed to parse favorites from localStorage",t),{fabric:[],sheer:[],deco:[],wallpaper:[]}}}function xe(t,e){var r;return!t||!e||(r=D()[t])==null?void 0:r.find(o=>o.code===e.trim())}function se(t){try{localStorage.setItem(ue,JSON.stringify(t))}catch(e){console.error("Failed to save favorites to localStorage",e)}}function Ce(t,e,n=0){if(!t||!e||typeof e!="string"||e.trim()==="")return!1;const r=e.trim(),o=D();o[t]||(o[t]=[]);const a=o[t].findIndex(i=>i.code===r);let s=!1;return a>-1?(o[t].splice(a,1),s=!1):(o[t].push({code:r,price:n}),o[t].sort((i,l)=>i.code.localeCompare(l.code)),s=!0),se(o),s}function Be(t,e){if(!t||!e)return;const n=D();if(!n[t])return;const r=n[t].findIndex(o=>o.code===e);r>-1&&(n[t].splice(r,1),se(n))}function Ie(t,e,n){if(!t||!e)return;const r=D();if(!r[t])return;const o=r[t].find(a=>a.code===e);o&&(o.price=n,se(r))}function Ne(t,e){var r;return!t||!e?!1:((r=D()[t])==null?void 0:r.some(o=>o.code===e.trim()))??!1}let B=!1,V=null,K=null;const de="marnthara.theme";function me(){const t=localStorage.getItem(de),e=document.querySelector("#themeToggleBtn");if(!e)return;const n=e.querySelector("i"),r=e.querySelector("span");t==="dark"?(document.body.classList.add("dark-theme"),n&&(n.className="ph-fill ph-sun"),r&&(r.textContent=" Light Mode")):(document.body.classList.remove("dark-theme"),n&&(n.className="ph-fill ph-moon"),r&&(r.textContent=" Dark Mode"))}function Me(){document.body.classList.toggle("dark-theme");const t=document.body.classList.contains("dark-theme");localStorage.setItem(de,t?"dark":"light"),me()}function w(t,e="default"){const n=document.querySelector(d.toastContainer);if(!n)return;const r={success:"ph-bold ph-check-circle",warning:"ph-bold ph-warning",error:"ph-bold ph-x-circle",default:"ph-bold ph-info"},o=document.createElement("div");o.className=`toast toast-${e}`,o.innerHTML=`<i class="${r[e]||r.default}"></i> ${t}`,n.appendChild(o),setTimeout(()=>o.classList.add("show"),10),setTimeout(()=>{o.classList.remove("show"),o.addEventListener("transitionend",()=>o.remove())},3e3)}function te(t,e){return new Promise(n=>{const r=document.querySelector(t);if(!r){n(null);return}r.classList.add("visible");const o=r.querySelector('[id$="Confirm"]'),a=r.querySelector('[id$="Cancel"]'),s=l=>{r.classList.remove("visible"),o&&(o.onclick=null),a&&(a.onclick=null),document.removeEventListener("keydown",i),!l&&e&&e(),n(l)},i=l=>{l.key==="Escape"&&s(!1)};o&&(o.onclick=()=>s(!0)),a&&(a.onclick=()=>s(!1)),document.addEventListener("keydown",i)})}async function z(t,e){const n=document.querySelector(d.modal);if(!n)return!0;const r=n.querySelector(d.modalTitle),o=n.querySelector(d.modalBody);return r&&(r.textContent=t),o&&(o.textContent=e),await te(d.modal)}async function Pe(){const t=document.querySelector(d.exportOptionsModal);if(!t||!await te(d.exportOptionsModal))return null;const n=t.querySelector('input[name="vat_option"]:checked'),r=t.querySelector("#exportMethod"),o=t.querySelector("#pageBreakBuffer");return{vatOption:n?n.value:"include",exportMethod:r?r.value:"direct",pageBreakBuffer:o?parseInt(o.value,10):3}}function j(t,e){t&&(t.classList.add("item-removing"),t.addEventListener("animationend",()=>{t.remove(),e&&w(e),oe(),re(),R(),P(),U()},{once:!0}))}function re(){document.querySelectorAll(d.room).forEach(t=>{const e=t.querySelectorAll(".item-card"),n=e.length;e.forEach((r,o)=>{const a=r.querySelector("[data-item-title]");a&&(a.textContent=`${o+1}/${n}`)})})}function pe(){const t=document.querySelector(d.orderForm),e=document.querySelector(d.lockBtn);if(!t||!e)return;const n=t.querySelectorAll("input, select, textarea, button");t.classList.toggle("is-locked",B),e.classList.toggle("is-locked",B);const r=e.querySelector("i");r&&(r.className=B?"ph-bold ph-lock-key":"ph-bold ph-lock-key-open"),n.forEach(o=>{o.closest(".summary-footer")||o.closest(".main-header")||o.closest(".modal-wrapper")||(o.disabled=B)}),w(B?"‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ñ‡∏π‡∏Å‡∏•‡πá‡∏≠‡∏Ñ":"‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Ñ‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏•‡πâ‡∏ß",B?"warning":"success")}function W(){const t=document.querySelectorAll(d.allDetailsCards);if(t.length===0)return;const e=[...t].some(r=>r.open),n=document.querySelector(d.toggleAllRoomsBtn);if(n){const r=n.querySelector("i"),o=n.querySelector("span");r&&(r.className=e?"ph ph-rows-slash":"ph ph-rows"),o&&(o.textContent=e?"‡∏¢‡πà‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î":"‡∏Ç‡∏¢‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î")}}function Re(){const t=document.querySelectorAll(d.allDetailsCards),e=[...t].some(n=>n.open);t.forEach(n=>{n.open=!e}),setTimeout(W,50)}function oe(){const t=document.querySelector(d.quickNavRoomList);if(!t)return;t.innerHTML="",document.querySelectorAll(d.room).forEach(n=>{const r=n.querySelector(d.roomNameInput),o=r?r.value:"‡∏´‡πâ‡∏≠‡∏á",a=document.createElement("a");a.href=`#${n.id}`,a.dataset.jumpTo=n.id,a.innerHTML=`<i class="ph ph-arrow-bend-left-up"></i> ${o||"‡∏´‡πâ‡∏≠‡∏á (‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠)"}`,t.appendChild(a)})}function fe(t){const e=document.getElementById("quickNavBtnText");if(e)if(t){const n=t.querySelector('input[name="room_name"]');n&&(e.textContent=n.value||"...")}else e.textContent="‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏´‡πâ‡∏≠‡∏á"}function U(){if(K&&K.disconnect(),!document.getElementById("quickNavBtnText"))return;const e={root:null,rootMargin:"-60px 0px -150px 0px",threshold:0},n=o=>{const a=o.filter(s=>s.isIntersecting).sort((s,i)=>s.target.getBoundingClientRect().top-i.target.getBoundingClientRect().top);a.length>0&&fe(a[0].target)};K=new IntersectionObserver(n,e),document.querySelectorAll(d.room).forEach(o=>K.observe(o))}function he(t){const e=D()[t]||[];if(e.length===0)return'<div class="fav-manager-empty">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î</div>';let n='<ul class="fav-manager-list">';return e.forEach(r=>{n+=`
            <li class="fav-manager-item">
                <span class="code" title="${r.code}">${r.code}</span>
                <input type="text" inputmode="numeric" class="price-input fav-manager-price-input" 
                       value="${$(r.price)}" 
                       data-type="${t}" 
                       data-code="${r.code}">
                <button type="button" class="btn-icon danger" 
                        data-act="delete-favorite" 
                        data-type="${t}" 
                        data-code="${r.code}" 
                        title="‡∏•‡∏ö">
                    <i class="ph-bold ph-trash"></i>
                </button>
            </li>`}),n+="</ul>",n}function Fe(t){const e={fabric:"‡∏ú‡πâ‡∏≤‡∏ó‡∏∂‡∏ö",sheer:"‡∏ú‡πâ‡∏≤‡πÇ‡∏õ‡∏£‡πà‡∏á",deco:"‡∏Ç‡∏≠‡∏á‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á",wallpaper:"‡∏ß‡∏≠‡∏•‡πÄ‡∏õ‡πÄ‡∏õ‡∏≠‡∏£‡πå"},n=document.querySelector("#favoritesManagerModal");if(!n)return;const r=n.querySelector("#favManagerTitle"),o=n.querySelector("#favManagerBody"),a=n.querySelector("#favManagerCancel");r&&(r.textContent=`‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î: ${e[t]||t}`),o&&(o.innerHTML=he(t),o.dataset.currentType=t),n.classList.add("visible");const s=()=>{n.classList.remove("visible"),a&&a.removeEventListener("click",s),document.removeEventListener("keydown",i),V&&_e(V)},i=l=>{l.key==="Escape"&&s()};a&&a.addEventListener("click",s),document.addEventListener("keydown",i)}function ce(){document.querySelectorAll(".favorite-chips-container.show").forEach(t=>{t.classList.remove("show")}),V=null}function Y(t){if(!t)return;const e=t.closest(".form-group").querySelector(".btn-favorite");if(!e)return;const n=e.dataset.type,r=Ne(n,t.value);e.classList.toggle("is-favorite",r),e.querySelector("i").className=r?"ph-fill ph-star":"ph ph-star"}function _e(t){ce();const e=t.dataset.favoriteType;if(!e)return;const n=D()[e]||[];if(n.length===0)return;const r=t.closest(".form-group-with-favorites").querySelector(".favorite-chips-container");r&&(r.innerHTML="",n.forEach(o=>{const a=document.createElement("button");a.type="button",a.className="btn-chip",a.textContent=o.code,a.dataset.act="select-favorite",a.dataset.code=o.code,a.dataset.price=o.price,r.appendChild(a)}),r.classList.add("show"))}function G(t,e,n=!0){const r=document.querySelector(t);if(!r||!e)return null;const o=r.content.cloneNode(!0),a=o.firstElementChild;e.appendChild(o),a.querySelectorAll("input[data-favorite-type]").forEach(Y),n&&a&&(a.classList.add("item-created"),a.scrollIntoView({behavior:"smooth",block:"center"}));const s=a.querySelector('input:not([type="hidden"]), select, textarea');return s&&s.focus(),re(),R(),P(),a}function Z(){const t=document.querySelector(d.roomsContainer);if(!t)return;const e=document.querySelectorAll(d.roomNameInput);let n=0;e.forEach(a=>{const s=a.value.match(/\d+/g);if(s){const i=parseInt(s[s.length-1],10);i>n&&(n=i)}});const r=n+1,o=G("#roomTpl",t,!0);if(o){o.id=`room-${Date.now()}`;const a=o.querySelector(d.roomNameInput);a&&(a.value=`‡∏´‡πâ‡∏≠‡∏á ${r}`),o.open=!0}oe(),W(),U()}function Ae(t){if(!t)return;const e=t.querySelector(d.setsContainer);e&&G("#setTpl",e)}function De(t){if(!t)return;const e=t.querySelector(d.decorationsContainer);e&&G("#decoTpl",e)}function Oe(t){if(!t)return;const e=t.querySelector(d.wallpapersContainer);if(e){const n=G("#wallpaperTpl",e);n&&ye(n.querySelector('[data-act="add-wall"]'))}}function ye(t){var n;const e=(n=t==null?void 0:t.closest(".walls-section"))==null?void 0:n.querySelector(d.wallsContainer);e&&(G("#wallTpl",e,!0),J(t))}function ve(t){var o,a;if(!t)return;const e=(o=t.querySelector('select[name="fabric_variant"]'))==null?void 0:o.value,n=e&&e.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á");(a=t.querySelector(d.sheerWrap))==null||a.classList.toggle("hidden",!n);const r=t.querySelector('input[name="sheer_fabric_code"]');if(r){const s=r.closest(".form-group-with-favorites");s&&s.classList.toggle("hidden",!n)}}const He=ie(t=>{J(t),P()}),We=ie((t,e,n)=>{Ie(t,e,v(n)),w(`‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≠‡∏á ${e} ‡πÅ‡∏•‡πâ‡∏ß`,"default")},500);function Ue(t){if(B){w("‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ñ‡∏π‡∏Å‡∏•‡πá‡∏≠‡∏Ñ ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏î‡πâ","warning"),t.preventDefault();return}const e=t.target;if(e.matches("input[data-favorite-type]")&&Y(e),e.matches(d.roomNameInput)&&U(),e.matches(".fav-manager-price-input")){const{type:n,code:r}=e.dataset;We(n,r,e.value)}else He(e)}function je(t){if(B)return;const e=t.target;if(e.matches('select[name="fabric_variant"]')&&ve(e.closest(d.set)),e.matches('select[name="deco_type"]')){const r=e.closest(d.decoItem),o=r==null?void 0:r.querySelector(".deco-type-display");o&&(o.textContent=e.value||"‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á")}if(e.matches(d.roomNameInput)&&(oe(),U()),["set_price_per_m","sheer_price_per_m","deco_price_sqyd","wallpaper_price_roll"].includes(e.name)){const r=e.closest(".item-card");if(r){let o;if(e.name==="set_price_per_m"&&(o=r.querySelector('[name="fabric_code"]')),e.name==="sheer_price_per_m"&&(o=r.querySelector('[name="sheer_fabric_code"]')),e.name==="deco_price_sqyd"&&(o=r.querySelector('[name="deco_code"]')),e.name==="wallpaper_price_roll"&&(o=r.querySelector('[name="wallpaper_code"]')),o&&o.value){const a=o.dataset.favoriteType,s=xe(a,o.value);s&&v(e.value)!==s.price&&(o.value="",Y(o),w("‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏Ñ‡∏≤‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö Favorite","warning"))}}}J(e),P()}function Ve(t){const e=t.target,n=e.matches('[name="deco_price_sqyd"], [name="wallpaper_price_roll"], [name="wallpaper_install_cost"], .fav-manager-price-input'),r=e.matches('input[name="width_m"], input[name="height_m"], input[name="deco_width_m"], input[name="deco_height_m"], input[name="wallpaper_height_m"], input[name="wall_width_m"]');if(n){const o=v(e.value);o>0?e.value=$(o):e.value=""}else r&&(e.value=A(e.value))}function Ye(t){const e=t.target;e.matches("input[data-favorite-type]")&&(V=e,_e(e))}function J(t){var o,a,s,i,l,c,u,m,p,f,h,S;if(!t)return;const e=t.closest(d.set);if(e){const b=e.querySelector("[data-set-summary]");if(b){const _={width_m:(o=e.querySelector('input[name="width_m"]'))==null?void 0:o.value,height_m:(a=e.querySelector('input[name="height_m"]'))==null?void 0:a.value,style:(s=e.querySelector('select[name="set_style"]'))==null?void 0:s.value,fabric_variant:(i=e.querySelector('select[name="fabric_variant"]'))==null?void 0:i.value,price_per_m_raw:(l=e.querySelector('select[name="set_price_per_m"]'))==null?void 0:l.value,sheer_price_per_m:(c=e.querySelector('select[name="sheer_price_per_m"]'))==null?void 0:c.value},g=L.calculateSetPrice(_);let y=`‡∏£‡∏≤‡∏Ñ‡∏≤: <b>${$(g.total)}</b> ‡∏ö.`;g.opaque>0&&g.sheer>0&&(y+=` <small>(‡∏ó‡∏∂‡∏ö: ${$(g.opaque)}, ‡πÇ‡∏õ‡∏£‡πà‡∏á: ${$(g.sheer)})</small>`),b.innerHTML=y}}const n=t.closest(d.decoItem);if(n){const b=n.querySelector("[data-deco-summary]");if(b){const _={width_m:(u=n.querySelector('input[name="deco_width_m"]'))==null?void 0:u.value,height_m:(m=n.querySelector('input[name="deco_height_m"]'))==null?void 0:m.value,price_sqyd:(p=n.querySelector('input[name="deco_price_sqyd"]'))==null?void 0:p.value},g=L.calculateDecoPrice(_);b.innerHTML=`‡∏£‡∏≤‡∏Ñ‡∏≤: <b>${$(g.total)}</b> ‡∏ö. &bull; ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà: ${I(g.sqyd,2)} ‡∏ï‡∏£.‡∏´‡∏•‡∏≤`}}const r=t.closest(d.wallpaperItem);if(r){const b=r.querySelector("[data-wallpaper-summary]");if(b){const _={height_m:(f=r.querySelector('input[name="wallpaper_height_m"]'))==null?void 0:f.value,price_per_roll:(h=r.querySelector('input[name="wallpaper_price_roll"]'))==null?void 0:h.value,install_cost_per_roll:(S=r.querySelector('input[name="wallpaper_install_cost"]'))==null?void 0:S.value,widths:Array.from(r.querySelectorAll('input[name="wall_width_m"]')).map(N=>N.value)},g=L.calculateWallpaperPrice(_);let y=`‡∏£‡∏ß‡∏°: <b>${$(g.total)}</b> ‡∏ö. `;(g.material>0||g.install>0)&&(y+=`<small>(‡∏ß‡∏≠‡∏•‡∏•‡πå: ${$(g.material)}, ‡∏Ñ‡πà‡∏≤‡∏ä‡πà‡∏≤‡∏á: ${$(g.install)})</small>`),y+=` &bull; ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà: ${I(g.sqm,2)} ‡∏ï‡∏£.‡∏°. &bull; ‡πÉ‡∏ä‡πâ: ${g.rolls} ‡∏°‡πâ‡∏ß‡∏ô`,b.innerHTML=y}}R()}function R(){let t=0,e=0;document.querySelectorAll(d.room).forEach(o=>{let a=0,s=0;const i=o.classList.contains("is-suspended");o.querySelectorAll(d.set).forEach(c=>{var m,p,f,h,S,b;const u=L.calculateSetPrice({is_suspended:i||c.classList.contains("is-suspended"),width_m:(m=c.querySelector('input[name="width_m"]'))==null?void 0:m.value,height_m:(p=c.querySelector('input[name="height_m"]'))==null?void 0:p.value,style:(f=c.querySelector('select[name="set_style"]'))==null?void 0:f.value,fabric_variant:(h=c.querySelector('select[name="fabric_variant"]'))==null?void 0:h.value,price_per_m_raw:(S=c.querySelector('select[name="set_price_per_m"]'))==null?void 0:S.value,sheer_price_per_m:(b=c.querySelector('select[name="sheer_price_per_m"]'))==null?void 0:b.value}).total;a+=u,u>0&&(e++,s++)}),o.querySelectorAll(d.decoItem).forEach(c=>{var m,p,f;const u=L.calculateDecoPrice({is_suspended:i||c.classList.contains("is-suspended"),width_m:(m=c.querySelector('input[name="deco_width_m"]'))==null?void 0:m.value,height_m:(p=c.querySelector('input[name="deco_height_m"]'))==null?void 0:p.value,price_sqyd:(f=c.querySelector('input[name="deco_price_sqyd"]'))==null?void 0:f.value}).total;a+=u,u>0&&(e++,s++)}),o.querySelectorAll(d.wallpaperItem).forEach(c=>{var m,p,f;const u=L.calculateWallpaperPrice({is_suspended:i||c.classList.contains("is-suspended"),height_m:(m=c.querySelector('input[name="wallpaper_height_m"]'))==null?void 0:m.value,price_per_roll:(p=c.querySelector('input[name="wallpaper_price_roll"]'))==null?void 0:p.value,install_cost_per_roll:(f=c.querySelector('input[name="wallpaper_install_cost"]'))==null?void 0:f.value,widths:Array.from(c.querySelectorAll('input[name="wall_width_m"]')).map(h=>h.value)}).total;a+=u,u>0&&(e++,s++)});const l=o.querySelector("[data-room-brief]");l&&(i?l.textContent="(‡∏£‡∏∞‡∏á‡∏±‡∏ö‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß)":s>0?l.innerHTML=`<span>${s}</span> &bull; ${$(a)} ‡∏ö‡∏≤‡∏ó`:l.textContent=""),t+=i?0:a});const n=document.querySelector(d.grandTotal),r=document.querySelector(d.setCount);n&&(n.textContent=$(t)),r&&(r.textContent=e)}function le(t){if(!t||!t.rooms)return;const e=document.querySelector(d.roomsContainer);if(!e)return;e.innerHTML="";const n=document.querySelector("#customer_name"),r=document.querySelector("#customer_phone"),o=document.querySelector("#customer_address");n&&(n.value=t.customer_name||""),r&&(r.value=t.customer_phone||""),o&&(o.value=t.customer_address||""),t.rooms.forEach(a=>{const s=document.querySelector("#roomTpl");if(!s)return;const i=s.content.cloneNode(!0),l=i.querySelector(d.room);if(!l)return;l.id=a.id||`room-${Date.now()}`,a.is_suspended&&l.classList.add("is-suspended");const c=l.querySelector(d.roomNameInput);c&&(c.value=a.room_name||"‡∏´‡πâ‡∏≠‡∏á (‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠)");const u=l.querySelector(d.setsContainer),m=l.querySelector(d.decorationsContainer),p=l.querySelector(d.wallpapersContainer),f=document.querySelector("#setTpl"),h=document.querySelector("#decoTpl"),S=document.querySelector("#wallpaperTpl"),b=document.querySelector("#wallTpl");u&&f&&a.sets&&a.sets.forEach(_=>{const g=f.content.cloneNode(!0),y=g.querySelector(d.set);_.is_suspended&&y.classList.add("is-suspended"),y.querySelector('input[name="width_m"]').value=A(_.width_m),y.querySelector('input[name="height_m"]').value=A(_.height_m),y.querySelector('select[name="set_style"]').value=_.style||"‡∏•‡∏≠‡∏ô",y.querySelector('select[name="fabric_variant"]').value=_.fabric_variant||"‡∏ó‡∏∂‡∏ö",y.querySelector('select[name="set_price_per_m"]').value=_.price_per_m_raw||"",y.querySelector('select[name="sheer_price_per_m"]').value=_.sheer_price_per_m||"",y.querySelector('select[name="opening_style"]').value=_.opening_style||"‡πÅ‡∏¢‡∏Å‡∏Å‡∏•‡∏≤‡∏á",y.querySelector('select[name="track_color"]').value=_.track_color||"‡∏Ç‡∏≤‡∏ß",y.querySelector('input[name="fabric_code"]').value=_.fabric_code||"",y.querySelector('input[name="sheer_fabric_code"]').value=_.sheer_fabric_code||"",y.querySelector('input[name="notes"]').value=_.notes||"",ve(y),u.appendChild(g)}),m&&h&&a.decorations&&a.decorations.forEach(_=>{const g=h.content.cloneNode(!0),y=g.querySelector(d.decoItem);_.is_suspended&&y.classList.add("is-suspended");const N=y.querySelector('select[name="deco_type"]');N.value=_.type||"",y.querySelector(".deco-type-display").textContent=_.type||"‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á",y.querySelector('input[name="deco_width_m"]').value=A(_.width_m),y.querySelector('input[name="deco_height_m"]').value=A(_.height_m),y.querySelector('input[name="deco_price_sqyd"]').value=$(_.price_sqyd)||"",y.querySelector('input[name="deco_code"]').value=_.deco_code||"",y.querySelector('input[name="deco_notes"]').value=_.notes||"",m.appendChild(g)}),p&&S&&a.wallpapers&&a.wallpapers.forEach(_=>{const g=S.content.cloneNode(!0),y=g.querySelector(d.wallpaperItem);_.is_suspended&&y.classList.add("is-suspended"),y.querySelector('input[name="wallpaper_height_m"]').value=A(_.height_m),y.querySelector('input[name="wallpaper_code"]').value=_.wallpaper_code||"",y.querySelector('input[name="wallpaper_price_roll"]').value=$(_.price_per_roll)||"",y.querySelector('input[name="wallpaper_install_cost"]').value=_.hasOwnProperty("install_cost_per_roll")?$(_.install_cost_per_roll):"300",y.querySelector('input[name="wallpaper_notes"]').value=_.notes||"";const N=y.querySelector(d.wallsContainer);N&&b&&_.widths&&_.widths.forEach(T=>{const k=b.content.cloneNode(!0);k.querySelector('input[name="wall_width_m"]').value=A(T),N.appendChild(k)}),p.appendChild(g)}),e.appendChild(i)}),document.querySelectorAll("input[data-favorite-type]").forEach(Y),document.querySelectorAll(".item-card").forEach(a=>{J(a)}),re(),R(),oe(),W(),U(),w("‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à","success")}function Ge(t,e){const n=document.querySelector(d.printableContent);!n||!t||!t.html||(n.innerHTML=t.html,setTimeout(()=>{if(e==="direct"){const r=document.getElementById("quotation-template");r&&html2pdf().from(r).set({margin:[15,12,10,12],filename:`${t.fileName}.pdf`,pagebreak:{mode:["css","legacy"]},html2canvas:{scale:2,useCORS:!0},jsPDF:{unit:"mm",format:"a4",orientation:"portrait"}}).save().then(()=>{n.innerHTML=""})}else e==="print"&&(window.print(),n.innerHTML="")},qe))}function Je(t){if(!t||!t.html)return;const e=new Blob([t.html],{type:"text/html;charset=utf-8"}),n=URL.createObjectURL(e),r=document.createElement("a");r.href=n,r.download=`${t.fileName}.html`,r.click(),URL.revokeObjectURL(n),w("Export ‡πÑ‡∏ü‡∏•‡πå HTML ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à","success")}const Qe=t=>{var a,s;const e=t.target.closest("[data-act]");if(!e||B&&!e.closest(".unlockable")&&e.dataset.act!=="select-favorite")return;const n=e.dataset.act,r=e.closest(d.room),o=(i,l,c)=>{z(i,l).then(u=>{u&&c()})};switch(n){case"add-room":Z();break;case"add-set":Ae(r);break;case"add-deco":De(r);break;case"add-wallpaper":Oe(r);break;case"add-wall":ye(e);break;case"del-room":o("‡∏•‡∏ö‡∏´‡πâ‡∏≠‡∏á","‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ?",()=>j(r,"‡∏•‡∏ö‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß"));break;case"del-set":o("‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£","‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡πâ‡∏≤‡∏°‡πà‡∏≤‡∏ô?",()=>j(e.closest(d.set),"‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡πâ‡∏≤‡∏°‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß"));break;case"del-deco":o("‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£","‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á?",()=>j(e.closest(d.decoItem),"‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß"));break;case"del-wallpaper":o("‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£","‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ß‡∏≠‡∏•‡πÄ‡∏õ‡πÄ‡∏õ‡∏≠‡∏£‡πå?",()=>j(e.closest(d.wallpaperItem),"‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ß‡∏≠‡∏•‡πÄ‡∏õ‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÅ‡∏•‡πâ‡∏ß"));break;case"del-wall":o("‡∏•‡∏ö‡∏ú‡∏ô‡∏±‡∏á","‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ú‡∏ô‡∏±‡∏á‡∏ô‡∏µ‡πâ?",()=>j(e.closest(".wall-input-row"),"‡∏•‡∏ö‡∏ú‡∏ô‡∏±‡∏á‡πÅ‡∏•‡πâ‡∏ß"));break;case"clear-room":o("‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á","‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏•‡∏ö‡∏ó‡∏∏‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ?",()=>{r.querySelector(d.setsContainer).innerHTML="",r.querySelector(d.decorationsContainer).innerHTML="",r.querySelector(d.wallpapersContainer).innerHTML="",re(),R(),P(),w("‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß","success")});break;case"toggle-room-menu":t.preventDefault();const i=e.nextElementSibling;if(!i||!r)return;const l=!i.classList.contains("show");document.querySelectorAll(".room-options-menu.show").forEach(c=>c.classList.remove("show")),document.querySelectorAll(".card.overflow-visible").forEach(c=>c.classList.remove("overflow-visible")),l&&(i.classList.add("show"),r.classList.add("overflow-visible"));break;case"toggle-suspend-room":t.preventDefault(),r==null||r.classList.toggle("is-suspended"),R(),P(),(a=e.closest(".room-options-menu"))==null||a.classList.remove("show"),r==null||r.classList.remove("overflow-visible");break;case"toggle-suspend":t.preventDefault(),(s=e.closest(".item-card"))==null||s.classList.toggle("is-suspended"),J(e),P();break;case"manage-favorites":{const c=e.dataset.type;c&&Fe(c);break}case"delete-favorite":{const{type:c,code:u}=e.dataset;Be(c,u);const m=document.querySelector("#favManagerBody");m&&m.dataset.currentType===c&&(m.innerHTML=he(c)),w(`‡∏•‡∏ö‡∏£‡∏´‡∏±‡∏™ ${u} ‡πÅ‡∏•‡πâ‡∏ß`,"success");break}case"toggle-favorite":{const c=e.dataset.type,u=e.closest(".form-group").querySelector("input[data-favorite-type]"),m=u==null?void 0:u.value;if(!m||m.trim()===""){w("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å","warning");return}const p=e.closest(".item-card");if(!p)return;let f=0,h=null;c==="fabric"&&(h=p.querySelector('[name="set_price_per_m"]')),c==="sheer"&&(h=p.querySelector('[name="sheer_price_per_m"]')),c==="deco"&&(h=p.querySelector('[name="deco_price_sqyd"]')),c==="wallpaper"&&(h=p.querySelector('[name="wallpaper_price_roll"]')),h&&h.value&&(f=v(h.value));const S=Ce(c,m,f);Y(u),w(S?"‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏´‡∏±‡∏™‡πÇ‡∏õ‡∏£‡∏î‡πÅ‡∏•‡πâ‡∏ß":"‡∏•‡∏ö‡∏£‡∏´‡∏±‡∏™‡πÇ‡∏õ‡∏£‡∏î‡πÅ‡∏•‡πâ‡∏ß","success");break}case"select-favorite":{const c=e.dataset.code,u=e.dataset.price,m=e.closest(".form-group-with-favorites"),p=m?m.querySelector("input[data-favorite-type]"):V;if(p){p.value=c;const f=e.closest(".item-card");if(f&&u){const h=p.dataset.favoriteType;let S=null;h==="fabric"&&(S=f.querySelector('[name="set_price_per_m"]')),h==="sheer"&&(S=f.querySelector('[name="sheer_price_per_m"]')),h==="deco"&&(S=f.querySelector('[name="deco_price_sqyd"]')),h==="wallpaper"&&(S=f.querySelector('[name="wallpaper_price_roll"]')),S&&(S.tagName==="SELECT"?S.value=u:S.value=$(v(u)),S.dispatchEvent(new Event("change",{bubbles:!0})))}p.dispatchEvent(new Event("input",{bubbles:!0})),ce(),w(`‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î ${c} ‡πÅ‡∏•‡πâ‡∏ß`,"success")}break}}};function Ke(){B=!B,pe()}function Xe(){const t=document.querySelector(d.setTpl);if(!t)return;const e=t.content.querySelector('select[name="set_price_per_m"]'),n=t.content.querySelector('select[name="sheer_price_per_m"]'),r=o=>{let a='<option value="" hidden>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏Ñ‡∏≤</option>';return o.forEach(s=>{a+=`<option value="${s}">${s.toLocaleString("th-TH")}</option>`}),a};e&&(e.innerHTML=r(ee.fabric)),n&&(n.innerHTML=r(ee.sheer))}function ze(){Xe(),me();const t=document.querySelector(d.orderForm),e=document.querySelector(d.fileImporter),n=document.querySelector(d.menuDropdown),r=document.querySelector(d.quickNavDropdown),o=document.querySelector("#pageBreakBuffer"),a=document.querySelector("#pageBreakBufferValue");o&&a&&o.addEventListener("input",()=>{a.textContent=o.value}),t.addEventListener("input",Ue),t.addEventListener("change",je),t.addEventListener("click",Qe),t.addEventListener("blur",Ve,!0),t.addEventListener("focusin",Ye);const s=l=>{const c=l.target.closest(d.room);c&&fe(c)};t.addEventListener("click",s),t.addEventListener("focusin",s),document.body.addEventListener("click",l=>{l.target.closest("summary")&&setTimeout(W,50)}),document.querySelector(d.lockBtn).addEventListener("click",Ke),document.querySelector(d.toggleAllRoomsBtn).addEventListener("click",Re),document.querySelector(d.quickNavBtn).addEventListener("click",l=>{l.stopPropagation(),n.classList.remove("show"),r.classList.toggle("show")}),document.querySelector(d.quickNavRoomList).addEventListener("click",l=>{const c=l.target.closest("a[data-jump-to]");if(c){l.preventDefault();const u=c.dataset.jumpTo,m=document.getElementById(u);m&&(document.body.classList.add("disable-animations"),m.open=!0,m.scrollIntoView({behavior:"auto",block:"start"}),m.classList.add("scrolling-jump"),setTimeout(()=>{m.classList.remove("scrolling-jump"),document.body.classList.remove("disable-animations"),W()},1e3)),r.classList.remove("show")}});const i=document.querySelector("#addRoomQuickNavBtn");if(i){const l=be(Z,700);i.addEventListener("click",c=>{c.stopPropagation(),l(),r.classList.remove("show")})}document.querySelector(d.menuBtn).addEventListener("click",l=>{l.stopPropagation(),r.classList.remove("show"),n.classList.toggle("show")}),document.querySelector("#themeToggleBtn").addEventListener("click",l=>{l.preventDefault(),Me()}),document.querySelector("#overviewBtn").addEventListener("click",async l=>{l.preventDefault(),n.classList.remove("show");const c=H(),u=ke(c),m=document.querySelector("#overviewModalBody");m&&(m.innerHTML=u,te("#overviewModal",()=>{}))}),document.querySelector(d.exportPdfBtn).addEventListener("click",async l=>{l.preventDefault(),n.classList.remove("show");const c=await Pe();if(!c)return;const u=H(),m=c.vatOption==="include"?x.baseVatRate:0,p=Ee(u,{vatRate:m,pageBreakBuffer:c.pageBreakBuffer});if(!p){w("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£","warning");return}c.exportMethod==="html"?Je(p):Ge(p,c.exportMethod)}),document.querySelector(d.importBtn).addEventListener("click",l=>{l.preventDefault(),n.classList.remove("show"),e.click()}),e.addEventListener("change",l=>{var m;const c=(m=l.target.files)==null?void 0:m[0];if(!c)return;const u=new FileReader;u.onload=p=>{try{const f=JSON.parse(p.target.result);le(f)}catch{w("‡πÑ‡∏ü‡∏•‡πå JSON ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á","error")}},u.readAsText(c),l.target.value=null}),document.querySelector(d.exportBtn).addEventListener("click",l=>{l.preventDefault(),n.classList.remove("show");try{const c=H(),u=JSON.stringify(c,null,4),m=new Blob([u],{type:"application/json"}),p=URL.createObjectURL(m),f=document.createElement("a"),h=new Date,S=`${h.getFullYear()}${(h.getMonth()+1).toString().padStart(2,"0")}${h.getDate().toString().padStart(2,"0")}`,b=(c.customer_name||"data").trim().replace(/\s+/g,"-");f.href=p,f.download=`MTR-${b}-${S}.json`,f.click(),URL.revokeObjectURL(p),w("Export ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à","success")}catch{w("Export ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß","error")}}),document.querySelector(d.submitBtn).addEventListener("click",async l=>{if(l.preventDefault(),n.classList.remove("show"),await z("‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•","‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏£‡∏≤‡∏Ñ‡∏≤?")){const c=H();if(!c.customer_name&&!c.customer_phone){w("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤","warning");return}w("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...","default");try{const u=await fetch(Se,{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)});u.ok?w("‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!","success"):w(`‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ${u.status}`,"error")}catch{w("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠","error")}}}),document.querySelector(d.copyTextBtn).addEventListener("click",async l=>{l.preventDefault(),n.classList.remove("show");const c=document.querySelector(d.copyOptionsModal);if(c.querySelector('input[name="copy_option"][value="customer"]').checked=!0,await te(d.copyOptionsModal)){const u=c.querySelector('input[name="copy_option"]:checked').value,m=Te(H(),u);try{await navigator.clipboard.writeText(m),w("‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!","success")}catch{w("‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß","error")}}}),document.querySelector(d.clearItemsBtn).addEventListener("click",async l=>{l.preventDefault(),n.classList.remove("show"),await z("‡∏•‡πâ‡∏≤‡∏á‡∏ó‡∏∏‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£","‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡∏´‡πâ‡∏≠‡∏á‡∏à‡∏∞‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡∏≠‡∏¢‡∏π‡πà)?")&&(document.querySelectorAll(d.room).forEach(c=>{c.querySelector(d.setsContainer).innerHTML="",c.querySelector(d.decorationsContainer).innerHTML="",c.querySelector(d.wallpapersContainer).innerHTML=""}),R(),P(),w("‡∏•‡πâ‡∏≤‡∏á‡∏ó‡∏∏‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß","success"))}),document.querySelector(d.clearAllBtn).addEventListener("click",async l=>{l.preventDefault(),n.classList.remove("show"),await z("‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î","‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ô‡∏µ‡πâ? ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏î‡πâ")&&(localStorage.removeItem(X),localStorage.removeItem("marnthara.theme"),window.location.reload())}),window.addEventListener("click",l=>{l.target.closest(".menu-container")||(n.classList.remove("show"),r.classList.remove("show")),l.target.closest(".room-options-container")||(document.querySelectorAll(".room-options-menu.show").forEach(c=>c.classList.remove("show")),document.querySelectorAll(".card.overflow-visible").forEach(c=>c.classList.remove("overflow-visible"))),l.target.closest(".form-group-with-favorites")||ce()});try{const l=localStorage.getItem(X);if(l)le(JSON.parse(l));else{Z();const c=document.querySelector("#customerDetailsCard");c&&(c.open=!0)}}catch{localStorage.removeItem(X),Z()}R(),pe(),W(),U()}document.addEventListener("DOMContentLoaded",ze);
