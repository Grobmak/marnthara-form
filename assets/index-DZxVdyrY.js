(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))o(l);new MutationObserver(l=>{for(const s of l)if(s.type==="childList")for(const n of s.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&o(n)}).observe(document,{childList:!0,subtree:!0});function r(l){const s={};return l.integrity&&(s.integrity=l.integrity),l.referrerPolicy&&(s.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?s.credentials="include":l.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(l){if(l.ep)return;l.ep=!0;const s=r(l);fetch(l.href,s)}})();const We="input-ui/5.6.2-dev",Ue="https://your-make-webhook-url.com/your-unique-path",de="marnthara.input.v5",De=500,B={name:"‡∏°‡πà‡∏≤‡∏ô‡∏ò‡∏≤‡∏£‡∏≤ ‡∏ú‡πâ‡∏≤‡∏°‡πà‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏Ç‡∏≠‡∏á‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á",address:"65/8 ‡∏´‡∏°‡∏π‡πà 2 ‡∏ï.‡∏ó‡πà‡∏≤‡∏®‡∏≤‡∏•‡∏≤ ‡∏≠.‡πÄ‡∏°‡∏∑‡∏≠‡∏á ‡∏à.‡∏•‡∏û‡∏ö‡∏∏‡∏£‡∏µ 15000",phone:"092-985-9395, 082-552-5595",taxId:"1234567890123",logoUrl:"https://i.imgur.com/l7y85nI.png",baseVatRate:.07,pdf:{paymentTerms:"‡∏ä‡∏≥‡∏£‡∏∞‡∏°‡∏±‡∏î‡∏à‡∏≥ 50%",priceValidity:"30 ‡∏ß‡∏±‡∏ô",notes:["‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ô‡∏µ‡πâ‡∏£‡∏ß‡∏°‡∏Ñ‡πà‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏•‡πâ‡∏ß","‡∏ä‡∏≥‡∏£‡∏∞‡∏°‡∏±‡∏î‡∏à‡∏≥ 50% ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ú‡∏•‡∏¥‡∏ï‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤","‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏≤‡∏¢‡∏∏ 30 ‡∏ß‡∏±‡∏ô ‡∏ô‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤"]}},Ve=1.19599,ge={ROLL_WIDTH_M:.53,ROLL_LENGTH_M:10,STRIPS_PER_ROLL_UNDER_2_5M:3},fe={fabric:[1e3,1100,1200,1300,1400,1500,1600,1700,1800,1900,2e3,2100,2200],sheer:[1e3,1100,1200,1300,1400,1500],style_surcharge:{‡∏•‡∏≠‡∏ô:200,‡∏ï‡∏≤‡πÑ‡∏Å‡πà:0,‡∏à‡∏µ‡∏ö:0},height:[{threshold:3.2,add_per_m:300},{threshold:2.8,add_per_m:200},{threshold:2.5,add_per_m:100}]},m={orderForm:"#orderForm",roomsContainer:"#rooms",setTpl:"#setTpl",clearAllBtn:"#clearAllBtn",lockBtn:"#lockBtn",grandTotal:"#grandTotal",modal:"#confirmationModal",modalTitle:"#modalTitle",modalBody:"#modalBody",room:"[data-room]",allItemsContainer:"[data-all-items]",wallsContainer:"[data-walls-container]",sheerWrap:"[data-sheer-wrap]",roomNameInput:'input[name="room_name"]',toastContainer:"#toast-container",copyTextBtn:"#copyTextBtn",copyOptionsModal:"#copyOptionsModal",menuBtn:"#menuBtn",menuDropdown:"#menuDropdown",importBtn:"#importBtn",exportBtn:"#exportBtn",fileImporter:"#fileImporter",submitBtn:"#submitBtn",clearItemsBtn:"#clearItemsBtn",exportPdfBtn:"#exportPdfBtn",exportOptionsModal:"#exportOptionsModal",printableContent:"#printable-content",quickNavBtn:"#quickNavBtn",quickNavDropdown:"#quickNavDropdown",quickNavRoomList:"#quickNavRoomList",toggleAllRoomsBtn:"#toggleAllRoomsBtn"},y=e=>{typeof e=="string"&&(e=e.replace(/,/g,""));const t=parseFloat(e);return Number.isFinite(t)?t:0},G=e=>{const t=y(e);return t>0?t.toFixed(2):""},P=(e,t=2,r=!1)=>Number.isFinite(e)?e.toLocaleString("en-US",{minimumFractionDigits:r?2:t,maximumFractionDigits:r?2:t}):"0",w=(e,t=0)=>Number.isFinite(e)?e.toLocaleString("th-TH",{minimumFractionDigits:t,maximumFractionDigits:t}):"0",Ye=(e,t=150)=>{let r;return(...o)=>{clearTimeout(r),r=setTimeout(()=>e(...o),t)}},Ge=(e,t=700)=>{let r=!1;return(...o)=>{if(!r){r=!0;try{return e(...o)}finally{setTimeout(()=>{r=!1},t)}}}},q=e=>typeof e!="string"?"":e.replace(/[&<>"']/g,function(t){switch(t){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";default:return"&#039;"}}),Ne=e=>typeof e!="string"?"":e.replace(/[\\/?%*:|"<>\x00-\x1f]/g,"").trim()||"file";function Je(e){let t=y(e);if(isNaN(t))return"‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á";if(t===0)return"‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ö‡∏≤‡∏ó‡∏ñ‡πâ‡∏ß‡∏ô";const r=["","‡∏´‡∏ô‡∏∂‡πà‡∏á","‡∏™‡∏≠‡∏á","‡∏™‡∏≤‡∏°","‡∏™‡∏µ‡πà","‡∏´‡πâ‡∏≤","‡∏´‡∏Å","‡πÄ‡∏à‡πá‡∏î","‡πÅ‡∏õ‡∏î","‡πÄ‡∏Å‡πâ‡∏≤"],o=["","‡∏™‡∏¥‡∏ö","‡∏£‡πâ‡∏≠‡∏¢","‡∏û‡∏±‡∏ô","‡∏´‡∏°‡∏∑‡πà‡∏ô","‡πÅ‡∏™‡∏ô","‡∏•‡πâ‡∏≤‡∏ô"];let l=Math.floor(t),s=Math.round((t-l)*100);const n=u=>{if(u===0)return"";let d="";const p=String(u);for(let i=0;i<p.length;i++){const h=p[i];p.length-1;const f=p.length-i-1;h!=="0"&&(f===1&&h==="1"?d+=o[f]:f===1&&h==="2"?d+="‡∏¢‡∏µ‡πà"+o[f]:f===0&&h==="1"&&p.length>1?d+="‡πÄ‡∏≠‡πá‡∏î":d+=r[parseInt(h)]+o[f])}return d};let a="";if(l>0){const u=Math.floor(l/1e6),d=l%1e6;u>0&&(a+=n(u)+"‡∏•‡πâ‡∏≤‡∏ô"),a+=n(d),a+="‡∏ö‡∏≤‡∏ó"}let c="";return s>0?c=n(s)+"‡∏™‡∏ï‡∏≤‡∏á‡∏Ñ‡πå":a+="‡∏ñ‡πâ‡∏ß‡∏ô",(a+c).trim()}const xe="marnthara.favorites.v4",pe={fabric:[],sheer:[],wallpaper:[],wooden_blind:[],roller_blind:[],vertical_blind:[],partition:[],pleated_screen:[],aluminum_blind:[]};function Z(){try{const e=localStorage.getItem(xe);return e?{...pe,...JSON.parse(e)}:pe}catch(e){return console.error("Failed to parse favorites from localStorage",e),pe}}function Ie(e){try{localStorage.setItem(xe,JSON.stringify(e))}catch(t){console.error("Failed to save favorites to localStorage",t)}}function Qe(e){if(!e||typeof e!="object")return console.error("Invalid favorites data for import."),!1;const t={...pe,...e};return Ie(t),!0}function Ke(e,t,r){const o=Z();o[e]||(o[e]=[]);const l=o[e],s=l.find(n=>n.code===t);return s?s.price=r:l.push({code:t,price:r}),l.sort((n,a)=>n.code.localeCompare(a.code)),Ie(o),!0}function Le(e,t){const r=Z();if(!r[e])return!1;const o=r[e].findIndex(l=>l.code===t);return o>-1?(r[e].splice(o,1),Ie(r),!0):!1}function Ee(e,t){if(!e||!t)return;const r=Z(),o=t.trim();return(r[e]||[]).find(s=>s.code===o)}function ze(e,t){return!!Ee(e,t)}function Se(e,t,r){const o=Ee(e,t);return o&&o.price===r?(Le(e,t),!1):(Ke(e,t,r),!0)}function Xe(){localStorage.removeItem(xe),console.log("All favorites have been cleared.")}function W(){var r,o,l,s,n,a;const e=Z(),t={app_version:We,customer_name:((r=document.querySelector('[name="customer_name"]'))==null?void 0:r.value)||"",customer_phone:((o=document.querySelector('[name="customer_phone"]'))==null?void 0:o.value)||"",customer_address:((l=document.querySelector('[name="customer_address"]'))==null?void 0:l.value)||"",customer_card_open:(s=document.querySelector("#customerDetailsCard"))==null?void 0:s.open,discount:{type:((n=document.querySelector("#discount_type"))==null?void 0:n.value)||"amount",value:y((a=document.querySelector("#discount_value"))==null?void 0:a.value)},rooms:[],favorites:e};return document.querySelectorAll(m.room).forEach(c=>{var d,p;const u={id:c.id,room_name:((d=c.querySelector(m.roomNameInput))==null?void 0:d.value)||"",is_suspended:c.classList.contains("is-suspended"),is_open:c.open,items:[]};(p=c.querySelector(m.allItemsContainer))==null||p.childNodes.forEach(i=>{var v,_,b,$,L,T,j,ce,le,E,M,S,x,I,O,A,U,Y,K,N,ie;if(i.nodeType!==1||!i.matches(".item-card"))return;const h=i.dataset.type;if(!h)return;let f={type:h,is_suspended:i.classList.contains("is-suspended")};h==="set"?Object.assign(f,{width_m:y((v=i.querySelector('input[name="width_m"]'))==null?void 0:v.value),height_m:y((_=i.querySelector('input[name="height_m"]'))==null?void 0:_.value),style:((b=i.querySelector('select[name="set_style"]'))==null?void 0:b.value)||"",fabric_variant:(($=i.querySelector('select[name="fabric_variant"]'))==null?void 0:$.value)||"",price_per_m_raw:y((L=i.querySelector('select[name="set_price_per_m"]'))==null?void 0:L.value),sheer_price_per_m:y((T=i.querySelector('select[name="sheer_price_per_m"]'))==null?void 0:T.value),fabric_code:((j=i.querySelector('input[name="fabric_code"]'))==null?void 0:j.value)||"",sheer_fabric_code:((ce=i.querySelector('input[name="sheer_fabric_code"]'))==null?void 0:ce.value)||"",opening_style:((le=i.querySelector('select[name="opening_style"]'))==null?void 0:le.value)||"",track_color:((E=i.querySelector('select[name="track_color"]'))==null?void 0:E.value)||"",notes:((M=i.querySelector('input[name="notes"]'))==null?void 0:M.value)||""}):h==="wallpaper"?Object.assign(f,{height_m:y((S=i.querySelector('[name="wallpaper_height_m"]'))==null?void 0:S.value),wallpaper_code:((x=i.querySelector('[name="wallpaper_code"]'))==null?void 0:x.value)||"",price_per_roll:y((I=i.querySelector('[name="wallpaper_price_roll"]'))==null?void 0:I.value),install_cost_per_roll:y((O=i.querySelector('[name="wallpaper_install_cost"]'))==null?void 0:O.value),notes:((A=i.querySelector('[name="wallpaper_notes"]'))==null?void 0:A.value)||"",widths:Array.from(i.querySelectorAll('[name="wall_width_m"]')).map(je=>y(je.value))}):i.matches(".area-based-item")&&Object.assign(f,{width_m:y((U=i.querySelector('[name="area_width_m"]'))==null?void 0:U.value),height_m:y((Y=i.querySelector('[name="area_height_m"]'))==null?void 0:Y.value),price_sqyd:y((K=i.querySelector('[name="area_price_sqyd"]'))==null?void 0:K.value),code:((N=i.querySelector('[name="area_code"]'))==null?void 0:N.value)||"",notes:((ie=i.querySelector('[name="area_notes"]'))==null?void 0:ie.value)||""}),u.items.push(f)}),t.rooms.push(u)}),t}function C(){try{localStorage.setItem(de,JSON.stringify(W()))}catch(e){console.error("Failed to save data to localStorage:",e)}}const k={stylePlus:e=>fe.style_surcharge[e]??0,heightPlus:e=>{const t=[...fe.height].sort((r,o)=>o.threshold-r.threshold);for(const r of t)if(e>r.threshold)return r.add_per_m;return 0},fabricYardage:(e,t)=>{const r=y(t);return r<=0||!e?0:e==="‡∏ï‡∏≤‡πÑ‡∏Å‡πà"||e==="‡∏à‡∏µ‡∏ö"?(r*2+.6)/.9:e==="‡∏•‡∏≠‡∏ô"?(r*2.6+.6)/.9:0},wallpaperRolls:(e,t)=>{const r=y(e),o=y(t);if(r<=0||o<=0)return 0;const l=o>2.5?Math.floor(ge.ROLL_LENGTH_M/o):ge.STRIPS_PER_ROLL_UNDER_2_5M;if(l<=0)return 0;const s=Math.ceil(r/ge.ROLL_WIDTH_M);return Math.ceil(s/l)},calculateSetPrice:function(e){var n,a;if(!e||e.is_suspended||y(e.width_m)<=0)return{total:0,opaque:0,sheer:0};const t=this.stylePlus(e.style),r=this.heightPlus(y(e.height_m)),o=y(e.width_m),l=(n=e.fabric_variant)!=null&&n.includes("‡∏ó‡∏∂‡∏ö")&&y(e.price_per_m_raw)>0?(y(e.price_per_m_raw)+t+r)*o:0,s=(a=e.fabric_variant)!=null&&a.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")&&y(e.sheer_price_per_m)>0?(y(e.sheer_price_per_m)+t+r)*o:0;return{total:Math.round(l+s),opaque:Math.round(l),sheer:Math.round(s)}},calculateDecoPrice:function(e){if(!e||e.is_suspended||y(e.width_m)<=0||y(e.height_m)<=0)return{total:0,sqm:0,sqyd:0};const t=y(e.width_m)*y(e.height_m),r=t*Ve,o=r*y(e.price_sqyd);return{total:Math.round(o),sqm:t,sqyd:r}},calculateWallpaperPrice:function(e){var n;if(!e||e.is_suspended)return{total:0,material:0,install:0,rolls:0,sqm:0};const t=((n=e.widths)==null?void 0:n.reduce((a,c)=>a+y(c),0))||0;if(t<=0)return{total:0,material:0,install:0,rolls:0,sqm:0};const r=y(e.height_m),o=this.wallpaperRolls(t,r),l=o*y(e.price_per_roll),s=o*y(e.install_cost_per_roll??300);return{total:Math.round(l+s),material:Math.round(l),install:Math.round(s),rolls:o,sqm:t*r}}},D={set:"‡∏ú‡πâ‡∏≤‡∏°‡πà‡∏≤‡∏ô",wallpaper:"‡∏ß‡∏≠‡∏•‡∏•‡πå‡πÄ‡∏õ‡πÄ‡∏õ‡∏≠‡∏£‡πå",wooden_blind:"‡∏°‡∏π‡πà‡∏•‡∏µ‡πà‡πÑ‡∏°‡πâ",roller_blind:"‡∏°‡πà‡∏≤‡∏ô‡∏°‡πâ‡∏ß‡∏ô",vertical_blind:"‡∏°‡πà‡∏≤‡∏ô‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏á",partition:"‡∏â‡∏≤‡∏Å‡∏Å‡∏±‡πâ‡∏ô‡∏´‡πâ‡∏≠‡∏á",pleated_screen:"‡∏°‡∏∏‡πâ‡∏á‡∏à‡∏µ‡∏ö",aluminum_blind:"‡∏°‡∏π‡πà‡∏•‡∏µ‡πà‡∏≠‡∏•‡∏π‡∏°‡∏¥‡πÄ‡∏ô‡∏µ‡∏¢‡∏°"};function Ze(e){return e.rooms.reduce((t,r)=>{var l;if(r.is_suspended)return t;const o=((l=r.items)==null?void 0:l.reduce((s,n)=>{if(n.is_suspended)return s;switch(n.type){case"set":return s+k.calculateSetPrice(n).total;case"wallpaper":return s+k.calculateWallpaperPrice(n).total;default:return s+k.calculateDecoPrice(n).total}},0))||0;return t+o},0)}function et(e,t){const r=Ze(e);let o=0,l="";e.discount&&e.discount.value>0&&(e.discount.type==="percent"?(o=r*(e.discount.value/100),l=`‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î (${e.discount.value}%): -${w(o)} ‡∏ö‡∏≤‡∏ó
`):(o=e.discount.value,l=`‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î: -${w(o)} ‡∏ö‡∏≤‡∏ó
`));const s=r-o;let n=`‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (${new Date().toLocaleDateString("th-TH",{day:"numeric",month:"numeric",year:"numeric"})})
`;if(n+=`‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤: ${e.customer_name||"-"}
`,(t==="customer"||t==="owner")&&(n+=`‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£: ${e.customer_phone||"-"}
`,n+=`‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà: ${e.customer_address||"-"}
`),n+=`------------------------------
`,t==="customer")return n+=`
‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
`,e.rooms.forEach(a=>{if(a.is_suspended||!a.items)return;const c=a.items.filter(d=>d.is_suspended?!1:d.type==="wallpaper"?(d.widths||[]).reduce((p,i)=>p+i,0)>0:d.width_m>0);if(c.length===0)return;n+=`
*‡∏´‡πâ‡∏≠‡∏á: ${a.room_name||"‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏"}*
`;let u=0;c.forEach(d=>{u++;const p=D[d.type]||"‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á";d.type==="set"?n+=` ${u}) ${p} ${d.style} (${d.fabric_variant})
`:n+=` ${u}) ${p}
`})}),n+=`------------------------------
`,o>0&&(n+=`
‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: ${w(r)} ‡∏ö‡∏≤‡∏ó
`,n+=l),n+=`
‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥: ${w(s)} ‡∏ö‡∏≤‡∏ó
`,n+=`
‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£
${B.name}
‡πÇ‡∏ó‡∏£: ${B.phone}`,n;if(t==="purchase_order"||t==="owner"){const a={opaqueFabrics:[],sheerFabrics:[],decorations:{},wallpapers:[],allSets:[]};e.rooms.forEach(p=>{p.is_suspended||!p.items||p.items.forEach(i=>{if(!(i.is_suspended||i.width_m<=0))switch(i.type){case"set":a.allSets.push(i),i.fabric_variant.includes("‡∏ó‡∏∂‡∏ö")&&a.opaqueFabrics.push({code:i.fabric_code||"??",yards:k.fabricYardage(i.style,i.width_m)}),i.fabric_variant.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")&&a.sheerFabrics.push({code:i.sheer_fabric_code||"??",yards:k.fabricYardage(i.style,i.width_m)});break;case"wallpaper":const h=(i.widths||[]).reduce((v,_)=>v+_,0);if(h>0){const v=k.wallpaperRolls(h,i.height_m);v>0&&a.wallpapers.push({code:i.wallpaper_code||"xxx",rolls:v})}break;default:const f=D[i.type]||i.type;a.decorations[f]||(a.decorations[f]=[]),a.decorations[f].push({code:i.code||"xxx",width:i.width_m,height:i.height_m});break}})}),n+=`üìã *‡πÅ‡∏à‡∏Å‡πÅ‡∏à‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ (‡∏ú‡πâ‡∏≤)*
`,n+=`------------------------------
`,a.opaqueFabrics.length>0&&a.opaqueFabrics.forEach(p=>{n+=`- ‡∏ú‡πâ‡∏≤‡∏ó‡∏∂‡∏ö (Curtain Fabric)
`,n+=`  ‡∏£‡∏´‡∏±‡∏™: #${p.code||"??"}
`,n+=`  ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${p.yards.toFixed(2)} ‡∏´‡∏•‡∏≤

`}),a.sheerFabrics.length>0&&a.sheerFabrics.forEach(p=>{n+=`- ‡∏ú‡πâ‡∏≤‡πÇ‡∏õ‡∏£‡πà‡∏á (Sheer Fabric)
`,n+=`  ‡∏£‡∏´‡∏±‡∏™: #${p.code||"??"}
`,n+=`  ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${p.yards.toFixed(2)} ‡∏´‡∏•‡∏≤

`});const c={};if([...a.opaqueFabrics,...a.sheerFabrics].forEach(p=>{c[p.code]=(c[p.code]||0)+p.yards}),Object.keys(c).length>0){n+=`------------------------------
`,n+=`üìä *‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ú‡πâ‡∏≤ (‡∏ï‡∏≤‡∏°‡∏£‡∏´‡∏±‡∏™)*
`,n+=`------------------------------
`;for(const[p,i]of Object.entries(c))n+=`  - ‡∏£‡∏´‡∏±‡∏™ #${p}: ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${i.toFixed(2)} ‡∏´‡∏•‡∏≤
`;n+=`
`}if(n+=`------------------------------
`,n+=`üìã *‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ ‡∏£‡∏≤‡∏á*
`,n+=`------------------------------

`,a.allSets.length>0){let p=1;a.allSets.forEach(i=>{n+=`(${p++}) ‡∏£‡∏≤‡∏á‡∏°‡πà‡∏≤‡∏ô: ${i.style}, ‡∏™‡∏µ: ${i.track_color}
`,i.fabric_variant.includes("‡∏ó‡∏∂‡∏ö")&&(n+=`  - ‡∏£‡∏≤‡∏á‡∏ó‡∏∂‡∏ö: ${Number(i.width_m).toFixed(2)} ‡∏°. (1 ‡πÄ‡∏™‡πâ‡∏ô)
`),i.fabric_variant.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")&&(n+=`  - ‡∏£‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πà‡∏á: ${Number(i.width_m).toFixed(2)} ‡∏°. (1 ‡πÄ‡∏™‡πâ‡∏ô)
`),i.fabric_variant==="‡∏ó‡∏∂‡∏ö&‡πÇ‡∏õ‡∏£‡πà‡∏á"&&(n+=`  (‚ùóÔ∏è‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏Ç‡∏≤‡∏™‡∏≠‡∏á‡∏ä‡∏±‡πâ‡∏ô)
`),n+=`
`})}const u=a.decorations;Object.keys(u).length>0&&Object.entries(u).forEach(([p,i])=>{n+=`------------------------------
`,n+=`üìã *‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ ${p}*
`,n+=`------------------------------

`,i.forEach(h=>{n+=`‡∏£‡∏´‡∏±‡∏™: #${h.code||"xxx"}
`,n+=`‡∏Ç‡∏ô‡∏≤‡∏î: ${h.width.toFixed(2)} x ${h.height.toFixed(2)} m.
`,n+=`‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: 1 ‡∏ä‡∏∏‡∏î

`})}),n+=`------------------------------
`,n+=`üìã *‡πÅ‡∏à‡∏Å‡πÅ‡∏à‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ (Wallpaper)*
`,n+=`------------------------------

`,a.wallpapers.length>0&&a.wallpapers.forEach(p=>{n+=`- ‡∏ß‡∏≠‡∏•‡πÄ‡∏õ‡πÄ‡∏õ‡∏≠‡∏£‡πå -
`,n+=`  ‡∏£‡∏´‡∏±‡∏™: #${p.code||"xxx"}
`,n+=`  ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${p.rolls} ‡∏°‡πâ‡∏ß‡∏ô

`});const d={};if(a.wallpapers.forEach(p=>{d[p.code]=(d[p.code]||0)+p.rolls}),Object.keys(d).length>0){n+=`------------------------------
`,n+=`üìä *‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ß‡∏≠‡∏•‡πÄ‡∏õ‡πÄ‡∏õ‡∏≠‡∏£‡πå (‡∏ï‡∏≤‡∏°‡∏£‡∏´‡∏±‡∏™)*
`,n+=`------------------------------
`;for(const[p,i]of Object.entries(d))n+=`  - ‡∏£‡∏´‡∏±‡∏™ #${p}: ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${i} ‡∏°‡πâ‡∏ß‡∏ô
`;n+=`
`}if(n+=`------------------------------
`,t==="purchase_order")return n}return(t==="seamstress"||t==="owner")&&(n+=`
üßµ *‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡πà‡∏≤‡∏á*
`,e.rooms.forEach(a=>{if(a.is_suspended||!a.items)return;const c=a.items.filter(d=>d.type==="set"&&!d.is_suspended&&d.width_m>0);if(c.length===0)return;n+=`
*‡∏´‡πâ‡∏≠‡∏á: ${a.room_name||"‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏"}*
`;let u=1;c.forEach(d=>{n+=`${u++}) *‡∏ú‡πâ‡∏≤‡∏°‡πà‡∏≤‡∏ô ${d.style} ${d.fabric_variant}*
`,n+=`  ‡∏Å‡∏ß‡πâ‡∏≤‡∏á ${Number(d.width_m).toFixed(2)} x ‡∏™‡∏π‡∏á ${Number(d.height_m).toFixed(2)} ‡∏°.
`,n+=`  ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏õ‡∏¥‡∏î: ${d.opening_style}
`,d.fabric_variant.includes("‡∏ó‡∏∂‡∏ö")&&(n+=`  ‡∏ú‡πâ‡∏≤‡∏ó‡∏∂‡∏ö: ‡∏£‡∏´‡∏±‡∏™ ${d.fabric_code||"-"}
`),d.fabric_variant.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á")&&(n+=`  ‡∏ú‡πâ‡∏≤‡πÇ‡∏õ‡∏£‡πà‡∏á: ‡∏£‡∏´‡∏±‡∏™ ${d.sheer_fabric_code||"-"}
`)})}),n+=`------------------------------
`,t==="seamstress")||t==="owner"&&(n+=`
üí∞ *‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: ${w(s)} ‡∏ö‡∏≤‡∏ó*
`),n}function tt(e){if(!e.rooms||e.rooms.length===0)return'<p class="empty-summary">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•</p>';let t=0,r="";const o={};e.rooms.forEach(n=>{n.is_suspended||!n.items||n.items.forEach(a=>{if(a.is_suspended)return;let c=null,u=0;switch(a.type){case"set":u=k.calculateSetPrice(a).total,u>0&&(c=D.set);break;case"wallpaper":u=k.calculateWallpaperPrice(a).total,u>0&&(c=D.wallpaper);break;default:u=k.calculateDecoPrice(a).total,u>0&&(c=D[a.type]||"‡∏Ç‡∏≠‡∏á‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á");break}c&&(o[c]=(o[c]||0)+1)})});const l=Object.entries(o).map(([n,a])=>`
            <div class="overview-summary-item">
                <span class="overview-summary-label">${q(n)}</span>
                <span class="overview-summary-value">${a} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
            </div>`).join("");l&&(r+=`
            <div class="overview-summary-group">
                <h4><i class="ph ph-stack"></i> ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</h4>
                ${l}
            </div>`);let s="";return e.rooms.forEach(n=>{if(n.is_suspended||!n.items)return;const a={};let c=0;if(n.items.forEach(u=>{if(u.is_suspended)return;let d=null,p=0;switch(u.type){case"set":p=k.calculateSetPrice(u).total,p>0&&(d=D.set);break;case"wallpaper":p=k.calculateWallpaperPrice(u).total,p>0&&(d=D.wallpaper);break;default:p=k.calculateDecoPrice(u).total,p>0&&(d=D[u.type]||"‡∏Ç‡∏≠‡∏á‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á");break}d&&(a[d]=(a[d]||0)+1,c++)}),c>0){t+=c;const u=Object.entries(a).map(([d,p])=>`
                    <div class="overview-item">
                        <span>${q(d)}</span>
                        <span>${p}</span>
                    </div>`).join("");s+=`
                <details class="overview-room-card" open>
                    <summary class="overview-room-summary">
                        <span class="room-name">${q(n.room_name)||"‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á"}</span>
                        <div class="summary-tags">
                            <span class="room-item-count">${c} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
                            <i class="ph ph-caret-down expand-icon"></i>
                        </div>
                    </summary>
                    <div class="overview-room-items">${u}</div>
                </details>`}}),s&&(r+=`
            <div class="overview-breakdown-group">
                <h4><i class="ph ph-map-pin-line"></i> ‡πÅ‡∏à‡∏Å‡πÅ‡∏à‡∏á‡∏ï‡∏≤‡∏°‡∏´‡πâ‡∏≠‡∏á</h4>
                ${s}
            </div>`),t===0?'<p class="empty-summary">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•</p>':r}function rt(e,t){const{vatRate:r,pageBreakBuffer:o=3}=t,l=[];e.rooms.forEach(E=>{if(E.is_suspended||!E.items)return;const M=[];E.items.forEach(S=>{if(S.is_suspended)return;let x,I,O,A;const U=D[S.type]||"‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á";switch(S.type){case"set":I=k.calculateSetPrice(S).total,I>0&&(O=S.width_m||0,A=S.height_m||0,x=`${U} ${q(S.style)} (${q(S.fabric_variant)}) <br><small>‡∏Ç‡∏ô‡∏≤‡∏î ${O.toFixed(2)} x ${A.toFixed(2)} ‡∏°.${S.notes?` - ${q(S.notes)}`:""}</small>`,M.push({description:x,total:I,units:x.includes("<br>")?1.5:1}));break;case"wallpaper":if(I=k.calculateWallpaperPrice(S).total,I>0){const Y=(S.widths||[]).reduce((N,ie)=>N+ie,0),K=k.wallpaperRolls(Y,S.height_m);A=S.height_m||0,x=`${U} <br><small>‡∏£‡∏´‡∏±‡∏™: ${q(S.wallpaper_code)||"-"}, ‡∏™‡∏π‡∏á ${A.toFixed(2)} ‡∏°. (‡πÉ‡∏ä‡πâ ${K} ‡∏°‡πâ‡∏ß‡∏ô)</small>`,M.push({description:x,total:I,units:x.includes("<br>")?1.5:1})}break;default:I=k.calculateDecoPrice(S).total,I>0&&(O=S.width_m||0,A=S.height_m||0,x=`${U} <br><small>‡∏£‡∏´‡∏±‡∏™: ${q(S.code)||"-"}, ‡∏Ç‡∏ô‡∏≤‡∏î ${O.toFixed(2)} x ${A.toFixed(2)} ‡∏°.</small>`,M.push({description:x,total:I,units:x.includes("<br>")?1.5:1}));break}}),M.length>0&&(l.push({isRoomHeader:!0,roomName:q(E.room_name)||"‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á",units:1.2}),l.push(...M))});const s=l.reduce((E,M)=>E+(M.total||0),0);if(s===0)return null;let n=0,a="",c=s;e.discount&&e.discount.value>0&&(e.discount.type==="percent"?(n=s*(e.discount.value/100),a=`<tr><td class="pdf-label">‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î (${e.discount.value}%)</td><td class="pdf-amount">-${P(n,2,!0)}</td></tr>`):(n=e.discount.value,a=`<tr><td class="pdf-label">‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î</td><td class="pdf-amount">-${P(n,2,!0)}</td></tr>`),c=s-n,a+=`<tr><td class="pdf-label">‡∏¢‡∏≠‡∏î‡∏´‡∏•‡∏±‡∏á‡∏´‡∏±‡∏Å‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î</td><td class="pdf-amount">${P(c,2,!0)}</td></tr>`);const u=c*r,d=c+u,p=17,i=23,h=[];let f=[],v=0;l.forEach((E,M)=>{const S=h.length===0?p:i,x=v+E.units>S;let I=!1;if(!x&&M<l.length-1){const O=S-(v+E.units);O>0&&O<o&&(I=!0)}(x||I)&&f.length>0&&(h.push(f),f=[],v=0),f.push(E),v+=E.units}),f.length>0&&h.push(f);const _=new Date,b=_.toLocaleDateString("th-TH",{year:"numeric",month:"long",day:"numeric"}),$=`QT-${_.getFullYear()}${(_.getMonth()+1).toString().padStart(2,"0")}${_.getDate().toString().padStart(2,"0")}`;let L="",T=0,j=1;h.forEach((E,M)=>{const S=M===0,x=M===h.length-1,I=`
            <div class="pdf-page-header">
                <div class="pdf-header">
                    <div class="pdf-shop-info">
                        ${`<img src="${B.logoUrl}" alt="Logo" class="pdf-logo">`}
                        <div class="pdf-shop-address">
                            <strong>${q(B.name)}</strong><br>
                            ${q(B.address).replace(/\n/g,"<br>")}<br>
                            ‡πÇ‡∏ó‡∏£: ${q(B.phone)} | ‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏ú‡∏π‡πâ‡πÄ‡∏™‡∏µ‡∏¢‡∏†‡∏≤‡∏©‡∏µ: ${q(B.taxId)}
                        </div>
                    </div>
                    <div class="pdf-quote-details">
                        <div class="pdf-title-box"><h1>‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤ ${h.length>1?S?"":"(‡∏ï‡πà‡∏≠)":""}</h1></div>
                        <table class="pdf-quote-meta">
                            <tr><td>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà:</td><td>${$}</td></tr>
                            <tr><td>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</td><td>${b}</td></tr>
                        </table>
                    </div>
                </div>
                ${S?`
                <section class="pdf-customer-details">
                    <div class="pdf-customer-info">
                        <strong>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤:</strong> ${q(e.customer_name)||""}<br>
                        <strong>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:</strong> ${q(e.customer_address).replace(/\n/g,"<br>")||""}<br>
                        <strong>‡πÇ‡∏ó‡∏£:</strong> ${q(e.customer_phone)||""}
                    </div>
                    <div class="pdf-customer-meta">
                        <strong>‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô:</strong> ${q(B.pdf.paymentTerms)}<br>
                        <strong>‡∏¢‡∏∑‡∏ô‡∏£‡∏≤‡∏Ñ‡∏≤:</strong> ${q(B.pdf.priceValidity)}
                    </div>
                </section>`:""}
            </div>`,O=`
            <div class="pdf-page-footer">
                <div class="pdf-footer-info">
                    <span>${q(B.name)} | ‡πÇ‡∏ó‡∏£: ${q(B.phone)}</span>
                    <span>‡∏´‡∏ô‡πâ‡∏≤ ${M+1} / ${h.length}</span>
                </div>
            </div>`;let A="";S||(A+=`<tr class="pdf-subtotal-row"><td colspan="4">‡∏¢‡∏≠‡∏î‡∏¢‡∏Å‡∏°‡∏≤ (Brought Forward)</td><td class="pdf-text-right">${P(T,2,!0)}</td></tr>`),E.forEach(N=>{N.isRoomHeader?A+=`<tr class="pdf-room-header"><td colspan="5">‡∏´‡πâ‡∏≠‡∏á: ${N.roomName}</td></tr>`:(A+=`<tr><td class="pdf-text-center">${j++}</td><td>${N.description}</td><td class="pdf-text-center">1</td><td class="pdf-text-right">${P(N.total,2,!0)}</td><td class="pdf-text-right">${P(N.total,2,!0)}</td></tr>`,T+=N.total)});let U="";x||(U=`<tfoot><tr class="pdf-subtotal-row"><td colspan="4">‡∏¢‡∏≠‡∏î‡∏¢‡∏Å‡πÑ‡∏õ (Carried Forward)</td><td class="pdf-text-right">${P(T,2,!0)}</td></tr></tfoot>`);let Y="";B.pdf.notes&&B.pdf.notes.length>0&&(Y=`
                <strong>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</strong>
                <ul>${B.pdf.notes.map(N=>`<li>${q(N)}</li>`).join("")}</ul>
            `);const K=x?`
            <div class="pdf-summary-wrapper">
                <section class="pdf-summary-section">
                    <div class="pdf-amount-in-words">
                        ${Y}
                        <div class="pdf-amount-text">( ${Je(d)} )</div>
                    </div>
                    <div class="pdf-totals-block">
                        <table>
                            <tr><td class="pdf-label">‡∏£‡∏ß‡∏°‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</td><td class="pdf-amount">${P(s,2,!0)}</td></tr>
                            ${a}
                            ${r>0?`<tr><td class="pdf-label">‡∏†‡∏≤‡∏©‡∏µ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏° ${(r*100).toFixed(0)}%</td><td class="pdf-amount">${P(u,2,!0)}</td></tr>`:""}
                            <tr class="pdf-grand-total"><td class="pdf-label">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</td><td class="pdf-amount">${P(d,2,!0)}</td></tr>
                        </table>
                    </div>
                </section>
                <footer class="pdf-footer-section">
                    <div class="pdf-signature-box"><p>.................................................</p><p>‡∏ú‡∏π‡πâ‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤</p><p>(${q(B.name)})</p><p>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${b}</p></div>
                    <div class="pdf-signature-box"><p>.................................................</p><p>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ / ‡∏ú‡∏π‡πâ‡∏°‡∏µ‡∏≠‡∏≥‡∏ô‡∏≤‡∏à‡∏•‡∏á‡∏ô‡∏≤‡∏°</p><p>&nbsp;</p><p>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ......./......./............</p></div>
                </footer>
            </div>
        `:"";L+=`
            <div class="pdf-page">
                <div class="pdf-page-content">
                    ${I}
                    <div class="pdf-page-body">
                        <table class="pdf-items-table">
                            <thead><tr><th style="width:5%;">‡∏•‡∏≥‡∏î‡∏±‡∏ö</th><th style="width:50%;">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th><th style="width:10%;">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th><th style="width:17.5%;">‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏´‡∏ô‡πà‡∏ß‡∏¢</th><th style="width:17.5%;">‡∏£‡∏ß‡∏° (‡∏ö‡∏≤‡∏ó)</th></tr></thead>
                            <tbody>${A}</tbody>
                            ${U}
                        </table>
                        ${K}
                    </div>
                    ${O}
                </div>
            </div>`});const ce=e.customer_name||"quote",le=Ne(ce);return{html:`<div id="quotation-template">${L}</div>`,fileName:`${$}_${le}`}}const re=[],ot=10;function he(e){re.push(e),re.length>ot&&re.shift()}function nt(){return re.pop()}function at(){return re.length>0}let H=!1,ve=null,ue=null,oe=!1,F=null,be=null,we=!1;const Ce=document.querySelector("#undoBtn"),ne={set:{templateId:"#setTpl",name:"‡∏ú‡πâ‡∏≤‡∏°‡πà‡∏≤‡∏ô"},wallpaper:{templateId:"#wallpaperTpl",name:"‡∏ß‡∏≠‡∏•‡∏•‡πå‡πÄ‡∏õ‡πÄ‡∏õ‡∏≠‡∏£‡πå"},wooden_blind:{templateId:"#areaBasedTpl",name:"‡∏°‡∏π‡πà‡∏•‡∏µ‡πà‡πÑ‡∏°‡πâ"},roller_blind:{templateId:"#areaBasedTpl",name:"‡∏°‡πà‡∏≤‡∏ô‡∏°‡πâ‡∏ß‡∏ô"},vertical_blind:{templateId:"#areaBasedTpl",name:"‡∏°‡πà‡∏≤‡∏ô‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏á"},partition:{templateId:"#areaBasedTpl",name:"‡∏â‡∏≤‡∏Å‡∏Å‡∏±‡πâ‡∏ô‡∏´‡πâ‡∏≠‡∏á"},pleated_screen:{templateId:"#areaBasedTpl",name:"‡∏°‡∏∏‡πâ‡∏á‡∏à‡∏µ‡∏ö"},aluminum_blind:{templateId:"#areaBasedTpl",name:"‡∏°‡∏π‡πà‡∏•‡∏µ‡πà‡∏≠‡∏•‡∏π‡∏°‡∏¥‡πÄ‡∏ô‡∏µ‡∏¢‡∏°"}},st={‡∏°‡∏π‡πà‡∏•‡∏µ‡πà‡πÑ‡∏°‡πâ:"wooden_blind",‡∏°‡πà‡∏≤‡∏ô‡∏°‡πâ‡∏ß‡∏ô:"roller_blind",‡∏°‡πà‡∏≤‡∏ô‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏á:"vertical_blind",‡∏â‡∏≤‡∏Å‡∏Å‡∏±‡πâ‡∏ô‡∏´‡πâ‡∏≠‡∏á:"partition",‡∏°‡∏∏‡πâ‡∏á‡∏à‡∏µ‡∏ö:"pleated_screen",‡∏°‡∏π‡πà‡∏•‡∏µ‡πà‡∏≠‡∏•‡∏π‡∏°‡∏¥‡πÄ‡∏ô‡∏µ‡∏¢‡∏°:"aluminum_blind"},Te="marnthara.theme";function Pe(){const e=localStorage.getItem(Te),t=document.querySelector("#themeToggleBtn");if(!t)return;const r=t.querySelector("i"),o=t.querySelector("span");switch(document.body.classList.remove("dark-theme","neutral-theme"),e){case"dark":document.body.classList.add("dark-theme"),r&&(r.className="ph-fill ph-sun"),o&&(o.textContent=" ‡∏™‡∏ß‡πà‡∏≤‡∏á");break;case"neutral":document.body.classList.add("neutral-theme"),r&&(r.className="ph-fill ph-moon"),o&&(o.textContent=" ‡∏°‡∏∑‡∏î");break;default:r&&(r.className="ph-fill ph-palette"),o&&(o.textContent=" ‡∏Å‡∏•‡∏≤‡∏á");break}}function ct(){const e=localStorage.getItem(Te);let t;!e||e==="light"?t="neutral":e==="neutral"?t="dark":t="light",localStorage.setItem(Te,t),Pe()}function X(){Ce&&(Ce.disabled=!at())}function lt(){const e=nt();e&&(ke(e),g("‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß","success")),X()}function ye(){document.querySelectorAll(".favorite-chips-container.show").forEach(e=>{e.classList.remove("show")})}function Fe(e){var a;const t=e.dataset.favoriteType,r=(a=e.closest(".form-group-with-favorites"))==null?void 0:a.querySelector(".favorite-chips-container");if(!t||!r)return;ye();const l=Z()[t]||[];let n=Array.from(l.reduce((c,u)=>{const d=u.code.trim();return d&&!c.has(d.toLowerCase())&&c.set(d.toLowerCase(),u),c},new Map).values()).map(c=>`<button type="button" class="btn-chip" data-code="${q(c.code)}" data-price="${c.price}">${q(c.code)}</button>`).join("");n+=`<button type="button" class="btn-manage-favorites" data-act="manage-favorites" data-type="${t}"><i class="ph ph-pencil-simple"></i> ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î</button>`,r.innerHTML=n,r.classList.add("show")}function it(e){const t=e.closest(".favorite-chips-container"),r=e.closest(".form-group-with-favorites"),o=e.closest(".item-card");if(!t||!r||!o)return;const l=e.dataset.code,s=y(e.dataset.price),n=r.querySelector("input[data-favorite-type]");n&&(n.value=l,n.classList.add("input-highlight"),setTimeout(()=>n.classList.remove("input-highlight"),1200));const a=n.dataset.favoriteType;let c;a==="fabric"?c="set_price_per_m":a==="sheer"?c="sheer_price_per_m":a==="wallpaper"?c="wallpaper_price_roll":c="area_price_sqyd";const u=o.querySelector(`[name="${c}"]`);u&&s>0&&(u.tagName==="SELECT"?u.value=s:(u.value=w(s),u.classList.add("input-highlight"),setTimeout(()=>u.classList.remove("input-highlight"),1200))),_e(n),Q(o),C(),ye()}function me(e){const t=document.querySelector("#favManagerBody"),r=document.querySelector("#favManagerItemTpl"),l=Z()[e]||[];!t||!r||(l.length===0?t.innerHTML='<p class="empty-state" style="text-align: center; padding: 2rem; color: var(--on-surface-variant);">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ</p>':t.innerHTML=l.map(s=>r.innerHTML.replace(/{CODE}/g,q(s.code)).replace(/{PRICE}/g,w(s.price)).replace(/{RAW_PRICE}/g,s.price)).join(""),$e(null))}function $e(e){const t=document.querySelector('[data-act="edit-selected-fav"]'),r=document.querySelector('[data-act="del-selected-fav"]');!t||!r||(e?(t.disabled=!1,r.disabled=!1,F={code:e.dataset.code,price:y(e.dataset.price)}):(t.disabled=!0,r.disabled=!0,F=null))}async function ut(e){const t=document.querySelector("#favManagerModal");if(!t||!e)return;const r={fabric:"‡∏ú‡πâ‡∏≤‡∏ó‡∏∂‡∏ö",sheer:"‡∏ú‡πâ‡∏≤‡πÇ‡∏õ‡∏£‡πà‡∏á",wallpaper:"‡∏ß‡∏≠‡∏•‡πÄ‡∏õ‡πÄ‡∏õ‡∏≠‡∏£‡πå",wooden_blind:"‡∏°‡∏π‡πà‡∏•‡∏µ‡πà‡πÑ‡∏°‡πâ",roller_blind:"‡∏°‡πà‡∏≤‡∏ô‡∏°‡πâ‡∏ß‡∏ô",vertical_blind:"‡∏°‡πà‡∏≤‡∏ô‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏á",partition:"‡∏â‡∏≤‡∏Å‡∏Å‡∏±‡πâ‡∏ô‡∏´‡πâ‡∏≠‡∏á",pleated_screen:"‡∏°‡∏∏‡πâ‡∏á‡∏à‡∏µ‡∏ö",aluminum_blind:"‡∏°‡∏π‡πà‡∏•‡∏µ‡πà‡∏≠‡∏•‡∏π‡∏°‡∏¥‡πÄ‡∏ô‡∏µ‡∏¢‡∏°",deco:"‡∏Ç‡∏≠‡∏á‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á"};t.dataset.currentType=e,oe=!1,F=null,document.querySelector("#favManagerTitle").textContent=`‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ '${r[e]||e}'`,me(e),await V("#favManagerModal",()=>{oe&&ve&&Fe(ve)})}function g(e,t="default"){const r=document.querySelector(m.toastContainer);if(!r)return;const o={success:"ph-bold ph-check-circle",warning:"ph-bold ph-warning",error:"ph-bold ph-x-circle",default:"ph-bold ph-info"},l=document.createElement("div");l.className=`toast toast-${t}`,l.innerHTML=`<i class="${o[t]||o.default}"></i> ${e}`,r.appendChild(l),setTimeout(()=>l.classList.add("show"),10),setTimeout(()=>{l.classList.remove("show"),l.addEventListener("transitionend",()=>l.remove())},3e3)}function V(e,t){return new Promise(r=>{const o=document.querySelector(e);if(!o){r(null);return}const l=document.querySelector(".modal-wrapper.visible");l&&l.classList.add("is-underlay"),o.classList.add("visible");const s=o.querySelector('[id$="Confirm"]'),n=o.querySelector('[id$="Cancel"], [data-act="close-modal"]'),a=Array.from(o.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])')).filter(i=>!i.disabled&&i.offsetParent!==null),c=a[0],u=a[a.length-1];setTimeout(()=>c==null?void 0:c.focus(),50);const d=i=>{if(i.key==="Escape"&&!o.classList.contains("is-underlay")){p({cancelled:!0});return}if(i.key==="Tab"){if(a.length<=1){i.preventDefault();return}i.shiftKey?document.activeElement===c&&(u.focus(),i.preventDefault()):document.activeElement===u&&(c.focus(),i.preventDefault())}},p=i=>{o.classList.remove("visible"),document.removeEventListener("keydown",d),s&&(s.onclick=null),n&&(n.onclick=null),l&&l.classList.remove("is-underlay"),typeof i=="object"&&i.cancelled&&t&&t(),r(i)};s&&(s.onclick=()=>p(!0)),n&&(n.onclick=()=>{o.classList.contains("is-underlay")||p({cancelled:!0})}),document.addEventListener("keydown",d)})}async function z(e,t){const r=document.querySelector(m.modal);return r?(r.querySelector(m.modalTitle).textContent=e,r.querySelector(m.modalBody).textContent=t,await V(m.modal)===!0):!0}async function dt(){var r,o,l;const e=document.querySelector(m.exportOptionsModal);if(!e)return null;const t=await V(m.exportOptionsModal);return!t||t.cancelled?null:{vatOption:((r=e.querySelector('input[name="vat_option"]:checked'))==null?void 0:r.value)||"include",exportMethod:((o=e.querySelector("#exportMethod"))==null?void 0:o.value)||"direct",pageBreakBuffer:parseInt((l=e.querySelector("#pageBreakBuffer"))==null?void 0:l.value,10)||3}}async function pt(){const e=document.querySelector("#discountModal");if(!e)return;const t=e.querySelector("#discountSubtotal"),r=e.querySelector("#discountPercent"),o=e.querySelector("#discountAmount"),l=e.querySelector("#discountFinalTotal"),s=document.querySelector("#discount_type"),n=document.querySelector("#discount_value"),a=y(document.querySelector("#originalTotal").dataset.rawTotal||document.querySelector("#grandTotal").textContent);t.textContent=w(a);const c=i=>{if(we)return;we=!0;let h=0;if(i==="percent"){const f=y(r.value);h=a*((f>=0?f:0)/100),o.value=h>0?w(Math.round(h)):""}else h=y(o.value);if(h=h>=0?Math.min(h,a):0,i!=="percent"){const f=a>0?h/a*100:0;r.value=f>0&&isFinite(f)?P(f,2):""}l.textContent=w(a-h),setTimeout(()=>{we=!1},20)};r.addEventListener("input",()=>c("percent")),o.addEventListener("input",()=>c("amount")),o.addEventListener("focus",i=>{y(i.target.value)>0&&(i.target.value=y(i.target.value))}),o.addEventListener("blur",i=>{y(i.target.value)>0&&(i.target.value=w(y(i.target.value))),c("amount")});const u=s.value,d=y(n.value);r.value="",o.value="",d>0?u==="percent"?(r.value=d,c("percent")):(o.value=w(d),c("amount")):c();const p=await V("#discountModal");if(p&&!p.cancelled){const i=y(r.value),h=y(o.value);document.activeElement===r&&i>0?(s.value="percent",n.value=i):h>0?(s.value="amount",n.value=h):(s.value="amount",n.value=0),R(),C()}}function qe(e,t,r){e&&(he(W()),X(),e.classList.add("item-removing"),e.addEventListener("animationend",()=>{e.remove(),t&&g(t),r&&r(),se(),ae(),R(),C(),ee()},{once:!0}))}function ae(){document.querySelectorAll(m.room).forEach(e=>{const t=e.querySelectorAll(".item-card:not(.is-suspended)"),r=t.length;t.forEach((l,s)=>{const n=l.querySelector("[data-item-title]");n&&(n.textContent=`${s+1}/${r}`)}),e.querySelectorAll(".item-card.is-suspended").forEach(l=>{const s=l.querySelector("[data-item-title]");s&&(s.textContent="-")})})}function Oe(){const e=document.querySelector(m.orderForm),t=document.querySelector(m.lockBtn);!e||!t||(e.classList.toggle("is-locked",H),t.classList.toggle("is-locked",H),t.querySelector("i").className=H?"ph-bold ph-lock-key":"ph-bold ph-lock-key-open",e.querySelectorAll("input, select, textarea, button").forEach(r=>{r.closest(".summary-footer")||r.closest(".main-header")||r.closest(".modal-wrapper")||r.dataset.act==="toggle-more-details"||(r.disabled=H)}),g(H?"‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ñ‡∏π‡∏Å‡∏•‡πá‡∏≠‡∏Ñ":"‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Ñ‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏•‡πâ‡∏ß",H?"warning":"success"))}function J(){const e=document.querySelectorAll(m.room);if(e.length===0)return;const t=[...e].some(o=>o.open),r=document.querySelector(m.toggleAllRoomsBtn);r&&(r.querySelector("i").className="ph ph-rows",r.querySelector("span").textContent=t?"‡∏¢‡πà‡∏≠":"‡∏Ç‡∏¢‡∏≤‡∏¢")}function mt(){const e=document.querySelectorAll(m.room),t=[...e].some(r=>r.open);e.forEach(r=>{r.open=!t}),setTimeout(()=>{J(),C()},50)}function se(){const e=document.querySelector(m.quickNavRoomList);e&&(e.innerHTML="",document.querySelectorAll(m.room).forEach(t=>{var l;const r=((l=t.querySelector(m.roomNameInput))==null?void 0:l.value)||"‡∏´‡πâ‡∏≠‡∏á",o=document.createElement("a");o.href=`#${t.id}`,o.dataset.jumpTo=t.id,o.innerHTML=`<i class="ph ph-arrow-bend-left-up"></i> ${r}`,e.appendChild(o)}))}function Re(e){var r;const t=document.getElementById("quickNavBtnText");t&&(e?t.textContent=((r=e.querySelector('input[name="room_name"]'))==null?void 0:r.value)||"...":t.textContent="‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏´‡πâ‡∏≠‡∏á")}function ee(){if(ue&&ue.disconnect(),!document.getElementById("quickNavBtnText"))return;const e={root:null,rootMargin:"-60px 0px -150px 0px",threshold:0},t=r=>{const o=r.filter(l=>l.isIntersecting).sort((l,s)=>l.target.getBoundingClientRect().top-s.target.getBoundingClientRect().top);o.length>0&&Re(o[0].target)};ue=new IntersectionObserver(t,e),document.querySelectorAll(m.room).forEach(r=>ue.observe(r))}function _e(e){if(!e)return;const t=e.nextElementSibling;if(!t||!t.matches(".btn-favorite")||!e.closest(".item-card"))return;const o=e.dataset.favoriteType,l=e.value;t.classList.toggle("is-favorite",ze(o,l))}function Me(e,t){const r=ne[e];if(!r)return null;const o=document.querySelector(r.templateId);if(!o||!t)return null;const l=o.content.cloneNode(!0),s=l.firstElementChild;s.dataset.type=e,s.classList.add(`${e.replace(/_/g,"-")}-item`);const n=s.querySelector(".item-type-display");if(n&&(n.textContent=r.name),r.templateId==="#areaBasedTpl"){const a=s.querySelector("input[data-favorite-type]");a&&(a.dataset.favoriteType=e)}return t.appendChild(l),s}function ft(e,t){var l;if(!t)return;const r=t.querySelector(m.allItemsContainer);if(!r)return;ye();const o=Me(e,r);if(o){if(e==="wallpaper"){const s=Be(o.querySelector('[data-act="add-wall"]'));s&&((l=s.querySelector("input"))==null||l.focus())}else{const s=o.querySelector('input:not([type="hidden"]), select, textarea');s&&s.focus()}o.classList.add("item-created"),o.scrollIntoView({behavior:"smooth",block:"center"}),ae(),R(),C()}}async function Ae(e,t=null){const r=document.querySelector("#itemTypeModal");if(!r)return null;r.querySelector("#itemTypeModalTitle").textContent=e;let o=t;t&&!ne[t]&&(o="wooden_blind");const l=r.querySelector(`input[name="item_type_option"][value="${o||"set"}"]`);l&&(l.checked=!0);const s=await V("#itemTypeModal");if(!s||s.cancelled)return null;const n=r.querySelector('input[name="item_type_option"]:checked');return n?n.value:null}function ht(e,t){if(!ne[t])return;const o=e.parentElement;o&&(e.classList.add("item-removing"),e.addEventListener("animationend",()=>{var s;const l=Me(t,o);l&&(e.replaceWith(l),l.classList.add("item-created"),l.scrollIntoView({behavior:"smooth",block:"center"}),(s=l.querySelector('input:not([type="hidden"]), select, textarea'))==null||s.focus(),ae(),R(),C(),g("‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß","success"))},{once:!0}))}function te(){const e=document.querySelector(m.roomsContainer);if(!e)return;const t=document.querySelector("#roomTpl");if(!t)return;const r=Array.from(document.querySelectorAll(m.roomNameInput)).map(a=>parseInt(a.value.replace(/[^0-9]/g,""),10)).filter(a=>!isNaN(a)),l=(r.length>0?Math.max(...r):0)+1,n=t.content.cloneNode(!0).firstElementChild;e.appendChild(n),n&&(n.id=`room-${Date.now()}`,n.querySelector(m.roomNameInput).value=`‡∏´‡πâ‡∏≠‡∏á ${l}`,n.open=!0,n.classList.add("item-created"),n.scrollIntoView({behavior:"smooth",block:"center"})),se(),J(),ee()}function Be(e){var r;const t=(r=e==null?void 0:e.closest(".walls-section"))==null?void 0:r.querySelector(m.wallsContainer);if(t){const l=document.querySelector("#wallTpl").content.cloneNode(!0),s=l.firstElementChild;return t.appendChild(l),s.classList.add("item-created"),Q(e),s}return null}function Q(e){var n,a,c,u,d,p,i,h,f,v,_,b;if(!e)return;const t=e.closest(".item-card");if(!t){R();return}const r=t.dataset.type;let o,l,s;switch(r){case"set":o=t.querySelector("[data-set-summary]"),l={width_m:(n=t.querySelector('input[name="width_m"]'))==null?void 0:n.value,height_m:(a=t.querySelector('input[name="height_m"]'))==null?void 0:a.value,style:(c=t.querySelector('select[name="set_style"]'))==null?void 0:c.value,fabric_variant:(u=t.querySelector('select[name="fabric_variant"]'))==null?void 0:u.value,price_per_m_raw:(d=t.querySelector('select[name="set_price_per_m"]'))==null?void 0:d.value,sheer_price_per_m:(p=t.querySelector('select[name="sheer_price_per_m"]'))==null?void 0:p.value},s=k.calculateSetPrice(l),t.dataset.totalPrice=s.total;let $=`‡∏£‡∏≤‡∏Ñ‡∏≤: <b>${w(s.total)}</b> ‡∏ö.`;s.opaque>0&&s.sheer>0&&($+=` <small>(‡∏ó‡∏∂‡∏ö: ${w(s.opaque)}, ‡πÇ‡∏õ‡∏£‡πà‡∏á: ${w(s.sheer)})</small>`),o&&(o.innerHTML=$);break;case"wallpaper":o=t.querySelector("[data-wallpaper-summary]"),l={height_m:(i=t.querySelector('input[name="wallpaper_height_m"]'))==null?void 0:i.value,price_per_roll:(h=t.querySelector('input[name="wallpaper_price_roll"]'))==null?void 0:h.value,install_cost_per_roll:(f=t.querySelector('input[name="wallpaper_install_cost"]'))==null?void 0:f.value,widths:Array.from(t.querySelectorAll('input[name="wall_width_m"]')).map(j=>j.value)},s=k.calculateWallpaperPrice(l),t.dataset.totalPrice=s.total;let L=`‡∏£‡∏ß‡∏°: <b>${w(s.total)}</b> ‡∏ö. `;(s.material>0||s.install>0)&&(L+=`<small>(‡∏ß‡∏≠‡∏•‡∏•‡πå: ${w(s.material)}, ‡∏Ñ‡πà‡∏≤‡∏ä‡πà‡∏≤‡∏á: ${w(s.install)})</small>`),s.rolls>0&&(L+=` &bull; ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà: ${P(s.sqm,2)} ‡∏ï‡∏£.‡∏°. &bull; ‡πÉ‡∏ä‡πâ: ${s.rolls} ‡∏°‡πâ‡∏ß‡∏ô`),o&&(o.innerHTML=L);break;default:o=t.querySelector("[data-area-summary]"),l={width_m:(v=t.querySelector('input[name="area_width_m"]'))==null?void 0:v.value,height_m:(_=t.querySelector('input[name="area_height_m"]'))==null?void 0:_.value,price_sqyd:(b=t.querySelector('input[name="area_price_sqyd"]'))==null?void 0:b.value},s=k.calculateDecoPrice(l),t.dataset.totalPrice=s.total;let T="";s.sqyd>0&&(T=` &bull; ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà: ${P(s.sqyd,2)} ‡∏ï‡∏£.‡∏´‡∏•‡∏≤`),o&&(o.innerHTML=`‡∏£‡∏≤‡∏Ñ‡∏≤: <b>${w(s.total)}</b> ‡∏ö.${T}`);break}R()}function R(){let e=0;document.querySelectorAll(m.room).forEach(n=>{let a=0,c=0;const u=n.classList.contains("is-suspended");n.querySelectorAll(".item-card").forEach(p=>{const i=y(p.dataset.totalPrice),h=p.classList.contains("is-suspended");!u&&!h&&(a+=i,i>0&&c++)});const d=n.querySelector("[data-room-brief]");d&&(u?d.textContent="(‡∏£‡∏∞‡∏á‡∏±‡∏ö‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß)":c>0?d.innerHTML=`<span>${c}</span> &bull; ${w(a)} ‡∏ö‡∏≤‡∏ó`:d.innerHTML="<span>0</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£"),u||(e+=a)});const t=document.querySelector("#discount_type").value,r=y(document.querySelector("#discount_value").value);let o=0;r>0&&(o=t==="percent"?e*(r/100):r);const l=e-o;document.querySelector("#grandTotal").textContent=w(l);const s=document.querySelector("#originalTotal");o>0?(s.textContent=w(e),s.dataset.rawTotal=e,s.style.display="block"):(s.style.display="none",s.dataset.rawTotal="")}function ke(e){if(e!=null&&e.favorites&&(Qe(e.favorites)?g("‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à","success"):g("‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á","warning")),!(e!=null&&e.rooms)||!Array.isArray(e.rooms)){e.favorites||g("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå","error");return}const t=document.querySelector(m.roomsContainer);t&&(t.innerHTML="",document.querySelector("#customer_name").value=e.customer_name||"",document.querySelector("#customer_phone").value=e.customer_phone||"",document.querySelector("#customer_address").value=e.customer_address||"",e.discount&&(document.querySelector("#discount_type").value=e.discount.type||"amount",document.querySelector("#discount_value").value=e.discount.value||0),document.querySelector("#customerDetailsCard").open=e.customer_card_open??!0,e.rooms.forEach(r=>{const o=document.querySelector("#roomTpl");if(!o)return;const s=o.content.cloneNode(!0).firstElementChild;if(t.appendChild(s),!s)return;s.id=r.id||`room-${Date.now()}`,r.is_suspended&&s.classList.add("is-suspended"),s.open=r.is_open===!0,s.querySelector(m.roomNameInput).value=r.room_name||"‡∏´‡πâ‡∏≠‡∏á (‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠)";const n=s.querySelector(m.allItemsContainer);!n||!r.items||r.items.forEach(a=>{var u,d,p;a.type==="deco"&&a.deco_type?(a.type=st[a.deco_type]||"wooden_blind",a.code=a.deco_code,a.width_m=a.deco_width_m,a.height_m=a.deco_height_m,a.price_sqyd=a.deco_price_sqyd,a.notes=a.deco_notes):a.type==="deco"&&(a.type="wooden_blind",a.code=a.deco_code);const c=Me(a.type,n);if(c)switch(a.is_suspended&&c.classList.add("is-suspended"),a.type){case"set":c.querySelector('input[name="width_m"]').value=G(a.width_m),c.querySelector('input[name="height_m"]').value=G(a.height_m),c.querySelector('select[name="set_style"]').value=a.style||a.set_style||"‡∏•‡∏≠‡∏ô",c.querySelector('select[name="fabric_variant"]').value=a.fabric_variant||"‡∏ó‡∏∂‡∏ö",c.querySelector('select[name="set_price_per_m"]').value=a.price_per_m_raw||a.set_price_per_m||"",c.querySelector('select[name="sheer_price_per_m"]').value=a.sheer_price_per_m||"",c.querySelector('select[name="opening_style"]').value=a.opening_style||"‡πÅ‡∏¢‡∏Å‡∏Å‡∏•‡∏≤‡∏á",c.querySelector('select[name="track_color"]').value=a.track_color||"‡∏Ç‡∏≤‡∏ß",c.querySelector('input[name="fabric_code"]').value=a.fabric_code||"",c.querySelector('input[name="sheer_fabric_code"]').value=a.sheer_fabric_code||"",c.querySelector('input[name="notes"]').value=a.notes||"";const i=(a.fabric_variant||"").includes("‡πÇ‡∏õ‡∏£‡πà‡∏á");(u=c.querySelector(m.sheerWrap))==null||u.classList.toggle("hidden",!i),(d=c.querySelector('input[name="sheer_fabric_code"]'))==null||d.closest(".form-group-with-favorites").classList.toggle("hidden",!i);break;case"wallpaper":c.querySelector('input[name="wallpaper_height_m"]').value=G(a.height_m||a.wallpaper_height_m),c.querySelector('input[name="wallpaper_code"]').value=a.wallpaper_code||"",c.querySelector('input[name="wallpaper_price_roll"]').value=w(a.price_per_roll||a.wallpaper_price_roll)||"",c.querySelector('input[name="wallpaper_install_cost"]').value=a.hasOwnProperty("install_cost_per_roll")?w(a.install_cost_per_roll):a.wallpaper_install_cost?w(a.wallpaper_install_cost):"300",c.querySelector('input[name="wallpaper_notes"]').value=a.notes||a.wallpaper_notes||"",c.querySelector(m.wallsContainer)&&a.widths&&a.widths.forEach(f=>{const v=Be(c.querySelector('[data-act="add-wall"]'));v&&(v.querySelector('input[name="wall_width_m"]').value=G(f))});break;default:((p=ne[a.type])==null?void 0:p.templateId)==="#areaBasedTpl"&&(c.querySelector('input[name="area_width_m"]').value=G(a.width_m),c.querySelector('input[name="area_height_m"]').value=G(a.height_m),c.querySelector('input[name="area_price_sqyd"]').value=w(a.price_sqyd)||"",c.querySelector('input[name="area_code"]').value=a.code||"",c.querySelector('input[name="area_notes"]').value=a.notes||"");break}})}),document.querySelectorAll("input[data-favorite-type]").forEach(_e),document.querySelectorAll(".item-card").forEach(r=>Q(r)),ae(),R(),se(),J(),ee(),g("‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à","success"))}function vt(e){if(document.getElementById("loading-overlay"))return;const t=document.createElement("div");t.id="loading-overlay",t.innerHTML=`<div class="loading-spinner"></div><p>${e}</p>`,document.body.appendChild(t),document.body.style.overflow="hidden"}function yt(){const e=document.getElementById("loading-overlay");e&&e.remove(),document.body.style.overflow=""}async function _t(e,t){var o,l;const r=document.querySelector(m.printableContent);if(!r||!e||!e.html){g("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£","error");return}if(t==="direct"){vt("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á PDF...");const s=document.createElement("div");s.style.position="fixed",s.style.left="-300mm",s.style.top="0",s.style.width="210mm",s.style.background="#fff",s.innerHTML=e.html,document.body.appendChild(s),await new Promise(n=>setTimeout(n,500));try{const n={margin:0,filename:`${e.fileName}.pdf`,image:{type:"jpeg",quality:.98},html2canvas:{scale:2,useCORS:!0,logging:!1,width:((o=s.querySelector(".pdf-page"))==null?void 0:o.scrollWidth)||791.7,windowWidth:((l=s.querySelector(".pdf-page"))==null?void 0:l.scrollWidth)||791.7},jsPDF:{unit:"mm",format:"a4",orientation:"portrait"}};await html2pdf().from(s).set(n).save(),g("‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î PDF ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à","success")}catch(n){console.error("PDF Generation Error:",n),g("‡∏™‡∏£‡πâ‡∏≤‡∏á PDF ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß, ‡πÇ‡∏õ‡∏£‡∏î‡∏•‡∏≠‡∏á‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 2 (‡∏û‡∏¥‡∏°‡∏û‡πå)","error")}finally{yt(),document.body.removeChild(s)}}t==="print"&&(r.innerHTML=e.html,setTimeout(()=>{window.print(),setTimeout(()=>{r.innerHTML=""},1e3)},De))}function gt(e){if(!e||!e.html){g("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå HTML","error");return}try{const t=`
            <!DOCTYPE html><html lang="th"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
                <title>${e.fileName}</title>
                <link rel="stylesheet" href="https://grobmak.github.io/marnthara-form/src/style.css">
                <style>#printable-content { display: block !important; } .pdf-page { border: 1px solid #eee; box-shadow: 0 0 10px rgba(0,0,0,0.1); margin: 10mm auto; }</style>
            </head>
            <body>${e.html}</body></html>`,r=new Blob([t],{type:"text/html;charset=utf-8"}),o=URL.createObjectURL(r),l=document.createElement("a");l.href=o,l.download=`${e.fileName}.html`,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(o),g("‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå HTML ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à","success")}catch(t){console.error("HTML Export Error:",t),g("‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå HTML ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß","error")}}function He(e){if(!e)return;const t=e.closest(".item-card");if(!t)return;const r=y(e.value);let o,l;const s=e.getAttribute("name");if(s==="set_price_per_m"?(o=t.querySelector('input[name="fabric_code"]'),l="fabric"):s==="sheer_price_per_m"?(o=t.querySelector('input[name="sheer_fabric_code"]'),l="sheer"):s==="wallpaper_price_roll"?(o=t.querySelector('input[name="wallpaper_code"]'),l="wallpaper"):s==="area_price_sqyd"&&(o=t.querySelector('input[name="area_code"]'),o&&(l=o.dataset.favoriteType)),o&&l&&o.value.trim()){const n=Ee(l,o.value);n&&n.price!==r&&(o.value="",_e(o))}}const St=Ye(e=>{e.matches('[name$="_price_sqyd"], [name$="_price_roll"], [name$="_price_per_m"]')&&He(e),Q(e),C()},200);function bt(e){if(H){e.preventDefault();return}e.target.matches(m.roomNameInput)&&ee(),e.target.matches("input[data-favorite-type]")&&_e(e.target),St(e.target)}function wt(e){var o,l,s;if(H)return;const t=e.target;if(t.matches('select[name="fabric_variant"]')){const n=t.closest(".set-item");if(n){const a=(o=t.value)==null?void 0:o.includes("‡πÇ‡∏õ‡∏£‡πà‡∏á");(l=n.querySelector(m.sheerWrap))==null||l.classList.toggle("hidden",!a),(s=n.querySelector('input[name="sheer_fabric_code"]'))==null||s.closest(".form-group-with-favorites").classList.toggle("hidden",!a)}}t.matches(m.roomNameInput)&&(se(),ee()),t.matches('[name="set_price_per_m"], [name="sheer_price_per_m"]')&&He(t),Q(t),C()}function qt(e){const t=e.target;t.matches('[name$="_price_sqyd"], [name$="_price_roll"], [name$="_install_cost"]')?t.value=y(t.value)>0?w(y(t.value)):"":t.matches('input[name$="_m"], input[name$="width_m"]')&&(t.value=G(t.value))}function Lt(e){const t=e.target;t.matches('[name$="_price_sqyd"], [name$="_price_roll"], [name$="_install_cost"]')&&y(t.value)>0&&(t.value=y(t.value)),t.matches("input[data-favorite-type]")&&(ve=t,Fe(t))}const Tt=async e=>{var u,d,p;const t=e.target.closest(".favorite-chips-container .btn-chip");if(t){it(t);return}const r=e.target.closest(".fav-manager-item");if(r){const i=r.parentElement.querySelector(".is-selected");i&&i.classList.remove("is-selected"),i!==r?(r.classList.add("is-selected"),$e(r)):$e(null);return}const o=e.target.closest("[data-act]");if(!o)return;const l=["toggle-more-details","show-discount-modal"];if(H&&!o.closest(".unlockable")&&!l.includes(o.dataset.act))return;const s=o.dataset.act,n=o.closest(m.room),a=o.closest(".item-card"),c=(i,h,f)=>z(i,h).then(v=>v&&f());switch(s){case"add-room":te();break;case"add-item":{if(be=o.closest(m.room),be){const f=await Ae("‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà");f&&ft(f,be)}break}case"change-type":{const f=a==null?void 0:a.dataset.type;if(a&&f){const v=await Ae("‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£",f);v&&v!==f&&c("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á","‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà ‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?",()=>ht(a,v))}break}case"add-wall":{const f=Be(o);f&&((u=f.querySelector('input[name="wall_width_m"]'))==null||u.focus());break}case"show-discount-modal":pt();break;case"toggle-more-details":{const f=a==null?void 0:a.querySelector(".item-details-more");if(f){const v=f.classList.toggle("show");o.classList.toggle("expanded",v),o.querySelector("i").className=v?"ph ph-caret-up":"ph ph-caret-down",o.querySelector("span").textContent=v?"‡∏¢‡πà‡∏≠‡∏ô‡πâ‡∏≠‡∏¢‡∏•‡∏á":"‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°"}break}case"toggle-favorite":{const f=o.previousElementSibling;if(!f||!a)break;const v=f.dataset.favoriteType,_=f.value;let b;v==="fabric"?b="set_price_per_m":v==="sheer"?b="sheer_price_per_m":v==="wallpaper"?b="wallpaper_price_roll":b="area_price_sqyd";const $=a.querySelector(`[name="${b}"]`),L=y($==null?void 0:$.value);if(!_.trim()){g("‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏´‡∏±‡∏™‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å","warning");break}if(L<=0&&v!=="fabric"&&v!=="sheer"){g("‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å","warning");break}const T=Se(v,_,L);o.classList.toggle("is-favorite",T),g(T?"‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î‡πÅ‡∏•‡πâ‡∏ß":"‡∏•‡∏ö‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î","success"),C();break}case"manage-favorites":{const f=o.dataset.type;ve=o.closest(".form-group-with-favorites").querySelector("input[data-favorite-type]"),ut(f);break}case"add-new-fav-form":{const v=o.closest("#favManagerModal").dataset.currentType;if(!v)break;const _=document.querySelector("#favAddModal");_.querySelector("h3").textContent=`‡πÄ‡∏û‡∏¥‡πà‡∏° '${((d=ne[v])==null?void 0:d.name)||v}'`;const b=_.querySelector("#fav_code_add"),$=_.querySelector("#fav_price_add");b.value="",$.value="";const L=await V("#favAddModal");if(L&&!L.cancelled){const T=b.value.trim(),j=y($.value);T&&(Se(v,T,j),oe=!0,me(v),g("‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î‡πÅ‡∏•‡πâ‡∏ß","success"))}break}case"edit-selected-fav":{if(!F)break;const v=o.closest("#favManagerModal").dataset.currentType;if(!v)break;const _=document.querySelector("#favEditModal");_.querySelector("h3").textContent=`‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç '${F.code}'`;const b=_.querySelector("#fav_code_edit"),$=_.querySelector("#fav_price_edit");b.value=F.code,$.value=F.price>0?F.price:"";const L=await V("#favEditModal");if(L&&!L.cancelled){const T=b.value.trim(),j=y($.value);T&&(T!==F.code&&Le(v,F.code),Se(v,T,j),oe=!0,me(v),g("‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î‡πÅ‡∏•‡πâ‡∏ß","success"))}break}case"del-selected-fav":{if(!F)break;const v=o.closest("#favManagerModal").dataset.currentType;if(!v)break;await z("‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î",`‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏´‡∏±‡∏™ "${F.code}"?`)&&(Le(v,F.code),oe=!0,me(v),g("‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î‡πÅ‡∏•‡πâ‡∏ß","success"));break}case"del-room":c("‡∏•‡∏ö‡∏´‡πâ‡∏≠‡∏á","‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ?",()=>qe(n,"‡∏•‡∏ö‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß"));break;case"del-item":c("‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£","‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ?",()=>qe(a,"‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß"));break;case"del-wall":c("‡∏•‡∏ö‡∏ú‡∏ô‡∏±‡∏á","‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ú‡∏ô‡∏±‡∏á‡∏ô‡∏µ‡πâ?",()=>qe(o.closest(".wall-input-row"),"‡∏•‡∏ö‡∏ú‡∏ô‡∏±‡∏á‡πÅ‡∏•‡πâ‡∏ß",()=>Q(a)));break;case"clear-room":c("‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á","‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏•‡∏ö‡∏ó‡∏∏‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ?",()=>{he(W()),X(),n.querySelector(m.allItemsContainer).innerHTML="",ae(),R(),C(),g("‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß","success")});break;case"toggle-room-menu":e.preventDefault();const i=o.nextElementSibling;if(!i||!n)return;const h=!i.classList.contains("show");document.querySelectorAll(".room-options-menu.show").forEach(f=>f.classList.remove("show")),document.querySelectorAll(".card.overflow-visible").forEach(f=>f.classList.remove("overflow-visible")),h&&(i.classList.add("show"),n.classList.add("overflow-visible"));break;case"toggle-suspend-room":e.preventDefault(),n==null||n.classList.toggle("is-suspended"),R(),C(),(p=o.closest(".room-options-menu"))==null||p.classList.remove("show"),n==null||n.classList.remove("overflow-visible");break;case"toggle-suspend":e.preventDefault(),a==null||a.classList.toggle("is-suspended"),Q(o),C();break}};function $t(){H=!H,Oe()}function kt(){const e=document.querySelector(m.setTpl);if(!e)return;const t=e.content.querySelector('select[name="set_price_per_m"]'),r=e.content.querySelector('select[name="sheer_price_per_m"]'),o=l=>{let s='<option value="" hidden>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏Ñ‡∏≤</option>';return l.forEach(n=>{s+=`<option value="${n}">${n.toLocaleString("th-TH")}</option>`}),s};t&&(t.innerHTML=o(fe.fabric)),r&&(r.innerHTML=o(fe.sheer))}function xt(){kt(),Pe();const e=document.querySelector(m.orderForm),t=document.querySelector(m.fileImporter),r=document.querySelector(m.menuDropdown),o=document.querySelector(m.quickNavDropdown),l=document.querySelector("#pageBreakBuffer"),s=document.querySelector("#pageBreakBufferValue");l&&s&&l.addEventListener("input",()=>{s.textContent=l.value}),e.addEventListener("input",bt),e.addEventListener("change",wt),document.addEventListener("click",Tt),e.addEventListener("blur",qt,!0),e.addEventListener("focusin",Lt,!0);const n=c=>{const u=c.target.closest(m.room);u&&Re(u)};e.addEventListener("click",n),e.addEventListener("focusin",n),document.body.addEventListener("click",c=>{c.target.closest("summary")&&setTimeout(()=>{J(),C()},50)}),document.querySelector("#undoBtn").addEventListener("click",async c=>{c.preventDefault(),await z("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö","‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î?")&&lt()}),document.querySelector(m.lockBtn).addEventListener("click",$t),document.querySelector(m.toggleAllRoomsBtn).addEventListener("click",mt),document.querySelector(m.quickNavBtn).addEventListener("click",c=>{var d;c.stopPropagation(),r.classList.remove("show");const u=!o.classList.contains("show");o.classList.toggle("show"),c.currentTarget.setAttribute("aria-expanded",u),u&&((d=document.querySelector(m.menuBtn))==null||d.setAttribute("aria-expanded","false"))}),document.querySelector(m.quickNavRoomList).addEventListener("click",c=>{var d;const u=c.target.closest("a[data-jump-to]");if(u){c.preventDefault();const p=u.dataset.jumpTo,i=document.getElementById(p);i&&(document.body.classList.add("disable-animations"),i.open=!0,i.scrollIntoView({behavior:"auto",block:"start"}),i.classList.add("scrolling-jump"),setTimeout(()=>{i.classList.remove("scrolling-jump"),document.body.classList.remove("disable-animations"),J()},1e3)),o.classList.remove("show"),(d=document.querySelector(m.quickNavBtn))==null||d.setAttribute("aria-expanded","false")}});const a=document.querySelector("#addRoomQuickNavBtn");if(a){const c=Ge(te,700);a.addEventListener("click",u=>{var d;u.stopPropagation(),c(),o.classList.remove("show"),(d=document.querySelector(m.quickNavBtn))==null||d.setAttribute("aria-expanded","false")})}document.querySelector(m.menuBtn).addEventListener("click",c=>{var d;c.stopPropagation(),o.classList.remove("show");const u=!r.classList.contains("show");r.classList.toggle("show"),c.currentTarget.setAttribute("aria-expanded",u),u&&((d=document.querySelector(m.quickNavBtn))==null||d.setAttribute("aria-expanded","false"))}),document.querySelector("#themeToggleBtn").addEventListener("click",c=>{c.preventDefault(),ct()}),document.querySelector("#overviewBtn").addEventListener("click",async c=>{var i;c.preventDefault(),r.classList.remove("show"),(i=document.querySelector(m.menuBtn))==null||i.setAttribute("aria-expanded","false");const u=W(),d=document.querySelector("#overviewModalHeader"),p=document.querySelector("#overviewModalBody");if(d&&p){const h=u.rooms.reduce((_,b)=>{if(b.is_suspended)return _;const $=(b.items||[]).filter(L=>{if(L.is_suspended)return!1;let T=0;switch(L.type){case"set":T=k.calculateSetPrice(L).total;break;case"wallpaper":T=k.calculateWallpaperPrice(L).total;break;default:T=k.calculateDecoPrice(L).total;break}return T>0}).length;return _+$},0),f=document.querySelector(m.grandTotal).textContent||"0",v=u.rooms.filter(_=>!_.is_suspended&&_.items&&_.items.some(b=>!b.is_suspended)).length;d.innerHTML=`
                <div class="overview-stats-grid">
                    <div class="overview-stat-card">
                        <i class="ph-bold ph-map-pin-line"></i>
                        <div class="stat-value">${v}</div>
                        <div class="stat-label">‡∏´‡πâ‡∏≠‡∏á</div>
                    </div>
                    <div class="overview-stat-card">
                        <i class="ph-bold ph-stack"></i>
                        <div class="stat-value">${h}</div>
                        <div class="stat-label">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
                    </div>
                    <div class="overview-stat-card">
                        <i class="ph-bold ph-coins"></i>
                        <div class="stat-value">${f}</div>
                        <div class="stat-label">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°</div>
                    </div>
                </div>
            `,p.innerHTML=tt(u),V("#overviewModal")}}),document.querySelector(m.exportPdfBtn).addEventListener("click",async c=>{var i;c.preventDefault(),r.classList.remove("show"),(i=document.querySelector(m.menuBtn))==null||i.setAttribute("aria-expanded","false");const u=await dt();if(!u)return;const d=W(),p=rt(d,{vatRate:u.vatOption==="include"?B.baseVatRate:0,pageBreakBuffer:u.pageBreakBuffer});if(!p){g("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£","warning");return}u.exportMethod==="html"?gt(p):_t(p,u.exportMethod)}),document.querySelector(m.importBtn).addEventListener("click",c=>{var u;c.preventDefault(),r.classList.remove("show"),(u=document.querySelector(m.menuBtn))==null||u.setAttribute("aria-expanded","false"),t.click()}),t.addEventListener("change",c=>{var p;const u=(p=c.target.files)==null?void 0:p[0];if(!u)return;const d=new FileReader;d.onload=i=>{try{const h=JSON.parse(i.target.result);ke(h)}catch(h){g("‡πÑ‡∏ü‡∏•‡πå JSON ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á","error"),console.error("JSON Parse Error:",h)}},d.readAsText(u),c.target.value=null}),document.querySelector(m.exportBtn).addEventListener("click",c=>{var u;c.preventDefault(),r.classList.remove("show"),(u=document.querySelector(m.menuBtn))==null||u.setAttribute("aria-expanded","false");try{const d=W(),p=JSON.stringify(d,null,4),i=new Blob([p],{type:"application/json"}),h=URL.createObjectURL(i),f=document.createElement("a"),v=new Date,_=`${v.getFullYear()}${(v.getMonth()+1).toString().padStart(2,"0")}${v.getDate().toString().padStart(2,"0")}`,b=`${v.getHours().toString().padStart(2,"0")}${v.getMinutes().toString().padStart(2,"0")}`,$=Ne(d.customer_name||"data");f.href=h,f.download=`MTR-${_}${b}-${$}.json`,f.click(),URL.revokeObjectURL(h),g("Export ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à","success")}catch{g("Export ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß","error")}}),document.querySelector(m.submitBtn).addEventListener("click",async c=>{var u;if(c.preventDefault(),r.classList.remove("show"),(u=document.querySelector(m.menuBtn))==null||u.setAttribute("aria-expanded","false"),await z("‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•","‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏£‡∏≤‡∏Ñ‡∏≤?")){const d=W();if(!d.customer_name&&!d.customer_phone){g("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤","warning");return}g("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...","default");try{const p=await fetch(Ue,{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)});p.ok?g("‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!","success"):g(`‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ${p.status}`,"error")}catch{g("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠","error")}}}),document.querySelector(m.copyTextBtn).addEventListener("click",async c=>{var p;c.preventDefault(),r.classList.remove("show"),(p=document.querySelector(m.menuBtn))==null||p.setAttribute("aria-expanded","false");const u=document.querySelector(m.copyOptionsModal);u.querySelector('input[name="copy_option"][value="customer"]').checked=!0;const d=await V(m.copyOptionsModal);if(d&&!d.cancelled){const i=u.querySelector('input[name="copy_option"]:checked').value,h=et(W(),i);try{await navigator.clipboard.writeText(h),g("‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!","success")}catch{g("‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß","error")}}}),document.querySelector(m.clearItemsBtn).addEventListener("click",async c=>{var u;c.preventDefault(),r.classList.remove("show"),(u=document.querySelector(m.menuBtn))==null||u.setAttribute("aria-expanded","false"),await z("‡∏•‡πâ‡∏≤‡∏á‡∏ó‡∏∏‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£","‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡∏´‡πâ‡∏≠‡∏á‡∏à‡∏∞‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡∏≠‡∏¢‡∏π‡πà)?")&&(he(W()),X(),document.querySelectorAll(m.room).forEach(d=>{const p=d.querySelector(m.allItemsContainer);p&&(p.innerHTML="")}),R(),C(),g("‡∏•‡πâ‡∏≤‡∏á‡∏ó‡∏∏‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß","success"))}),document.querySelector(m.clearAllBtn).addEventListener("click",async c=>{var u;if(c.preventDefault(),r.classList.remove("show"),(u=document.querySelector(m.menuBtn))==null||u.setAttribute("aria-expanded","false"),await z("‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î",'‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô! ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤, ‡∏ó‡∏∏‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£, ‡πÅ‡∏•‡∏∞ "‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î" ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ñ‡∏≤‡∏ß‡∏£ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')){he(W()),X(),localStorage.removeItem(de),localStorage.removeItem("marnthara.theme"),Xe();const d=document.querySelector("#customer_name"),p=document.querySelector("#customer_phone"),i=document.querySelector("#customer_address");d&&(d.value=""),p&&(p.value=""),i&&(i.value="");const h=document.querySelector("#discount_type"),f=document.querySelector("#discount_value");h&&(h.value="amount"),f&&(f.value="0");const v=document.querySelector(m.roomsContainer);v&&(v.innerHTML=""),R(),se(),J(),te();const _=document.querySelector("#customerDetailsCard");_&&(_.open=!0),g("‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏´‡∏°‡πà","success")}}),window.addEventListener("click",c=>{var u,d;c.target.closest(".modal-wrapper")||(c.target.closest(".menu-container")||(r.classList.contains("show")&&(r.classList.remove("show"),(u=document.querySelector(m.menuBtn))==null||u.setAttribute("aria-expanded","false")),o.classList.contains("show")&&(o.classList.remove("show"),(d=document.querySelector(m.quickNavBtn))==null||d.setAttribute("aria-expanded","false"))),c.target.closest(".room-options-container")||(document.querySelectorAll(".room-options-menu.show").forEach(p=>p.classList.remove("show")),document.querySelectorAll(".card.overflow-visible").forEach(p=>p.classList.remove("overflow-visible"))),c.target.closest(".form-group-with-favorites")||ye())}),window.addEventListener("beforeunload",C);try{const c=localStorage.getItem(de);if(c&&c.length>2&&c!=="null")ke(JSON.parse(c));else{te();const u=document.querySelector("#customerDetailsCard");u&&(u.open=!0)}}catch(c){console.error("Failed to load data from localStorage:",c),localStorage.removeItem(de),te()}R(),Oe(),J(),ee(),X()}document.addEventListener("DOMContentLoaded",xt);
