<!DOCTYPE html>
<html lang="th">
Â  <head>
Â  Â  <meta charset="utf-8" />
Â  Â  <meta name="viewport" content="width=device-width,initial-scale=1" />
Â  Â  <title>Marnthara Input</title>
Â  Â  <style>
Â  Â  Â  :root {
Â  Â  Â  Â  --bg: #111215;
Â  Â  Â  Â  --fg: #e7e7ea;
Â  Â  Â  Â  --line: #2f2f33;
Â  Â  Â  Â  --muted: #b8b8bf;
Â  Â  Â  Â  --danger: #ff5a5f;
Â  Â  Â  Â  --primary: #3a82f7;
Â  Â  Â  Â  --secondary: #2ebd85;
Â  Â  Â  Â  --room1: #1a1b20;
Â  Â  Â  Â  --room2: #20222a;
Â  Â  Â  Â  --room3: #252830;
Â  Â  Â  Â  --accent-dark: #2f2f33;
Â  Â  Â  }
Â  Â  Â  * {
Â  Â  Â  Â  box-sizing: border-box;
Â  Â  Â  }
Â  Â  Â  body {
Â  Â  Â  Â  margin: 0;
Â  Â  Â  Â  padding: 16px 16px 80px 16px;
Â  Â  Â  Â  background: var(--bg);
Â  Â  Â  Â  color: var(--fg);
Â  Â  Â  Â  font-family: system-ui, Segoe UI, Roboto, Arial;
Â  Â  Â  }
Â  Â  Â  h1 {
Â  Â  Â  Â  font-size: 18px;
Â  Â  Â  Â  margin: 0;
Â  Â  Â  Â  padding: 0;
Â  Â  Â  }
Â  Â  Â  .card {
Â  Â  Â  Â  border: 1px solid var(--line);
Â  Â  Â  Â  border-radius: 14px;
Â  Â  Â  Â  padding: 12px;
Â  Â  Â  Â  margin: 12px 0;
Â  Â  Â  Â  background: #1a1b20;
Â  Â  Â  }
Â  Â  Â  .room {
Â  Â  Â  Â  border: 1px solid var(--primary); /* Increased border for clarity */
Â  Â  Â  Â  margin-bottom: 24px; /* More spacing between rooms */
Â  Â  Â  }
Â  Â  Â  .room > summary {
Â  Â  Â  Â  padding: 12px;
Â  Â  Â  Â  background: var(--line);
Â  Â  Â  Â  border-radius: 12px 12px 0 0;
Â  Â  Â  Â  margin: -12px;
Â  Â  Â  Â  margin-bottom: 0;
Â  Â  Â  }
Â  Â  Â  .room > div,
Â  Â  Â  .room > .total {
Â  Â  Â  Â  padding-top: 12px;
Â  Â  Â  }
Â  Â  Â  .row {
Â  Â  Â  Â  display: grid;
Â  Â  Â  Â  grid-template-columns: 1fr 1fr;
Â  Â  Â  Â  gap: 10px;
Â  Â  Â  }
Â  Â  Â  .row.three-col {
Â  Â  Â  Â  grid-template-columns: repeat(3, 1fr);
Â  Â  Â  }
Â  Â  Â  label {
Â  Â  Â  Â  font-size: 12px;
Â  Â  Â  Â  color: var(--muted);
Â  Â  Â  Â  display: block;
Â  Â  Â  Â  margin: 6px 0 4px;
Â  Â  Â  }
Â  Â  Â  .field {
Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  padding: 0.55rem 0.7rem;
Â  Â  Â  Â  border: 1px solid var(--line);
Â  Â  Â  Â  border-radius: 0.6rem;
Â  Â  Â  Â  background: #000;
Â  Â  Â  Â  color: inherit;
Â  Â  Â  Â  -webkit-appearance: none;
Â  Â  Â  Â  -moz-appearance: none;
Â  Â  Â  Â  appearance: none;
Â  Â  Â  }
Â  Â  Â  .small {
Â  Â  Â  Â  font-size: 12px;
Â  Â  Â  Â  color: var(--muted);
Â  Â  Â  }
Â  Â  Â  .price {
Â  Â  Â  Â  font-weight: 600;
Â  Â  Â  Â  color: var(--secondary);
Â  Â  Â  }
Â  Â  Â  .room-head {
Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  gap: 8px;
Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  margin-bottom: 8px;
Â  Â  Â  }
Â  Â  Â  .room-head .sp {
Â  Â  Â  Â  flex: 1;
Â  Â  Â  }
Â  Â  Â  .btn {
Â  Â  Â  Â  display: inline-flex;
Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  gap: 0.35rem;
Â  Â  Â  Â  border: 1px solid var(--line);
Â  Â  Â  Â  background: transparent;
Â  Â  Â  Â  color: var(--primary);
Â  Â  Â  Â  border-radius: 0.5rem;
Â  Â  Â  Â  font-weight: 500;
Â  Â  Â  Â  transition: opacity 0.15s ease;
Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  }
Â  Â  Â  .btn:hover {
Â  Â  Â  Â  opacity: 0.85;
Â  Â  Â  }
Â  Â  Â  .btn-xs {
Â  Â  Â  Â  padding: 0.2rem 0.45rem;
Â  Â  Â  Â  font-size: 0.85rem;
Â  Â  Â  Â  line-height: 1.1;
Â  Â  Â  }
Â  Â  Â  .btn-icon {
Â  Â  Â  Â  width: 1.8rem;
Â  Â  Â  Â  height: 1.8rem;
Â  Â  Â  Â  padding: 0;
Â  Â  Â  Â  display: inline-grid;
Â  Â  Â  Â  place-items: center;
Â  Â  Â  }
Â  Â  Â  .btn-danger {
Â  Â  Â  Â  border-color: var(--danger);
Â  Â  Â  Â  color: var(--danger);
Â  Â  Â  }
Â  Â  Â  .actions {
Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  gap: 8px;
Â  Â  Â  Â  justify-content: flex-end;
Â  Â  Â  Â  margin-top: 10px;
Â  Â  Â  }
Â  Â  Â  .total {
Â  Â  Â  Â  border-top: 1px solid var(--line);
Â  Â  Â  Â  padding-top: 10px;
Â  Â  Â  Â  margin-top: 12px;
Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  justify-content: space-between;
Â  Â  Â  Â  align-items: center;
Â  Â  Â  }
Â  Â  Â  .hidden {
Â  Â  Â  Â  display: none;
Â  Â  Â  }
Â  Â  Â  details.room > summary {
Â  Â  Â  Â  list-style: none;
Â  Â  Â  }
Â  Â  Â  details.room > summary::-webkit-details-marker {
Â  Â  Â  Â  display: none;
Â  Â  Â  }
Â  Â  Â  summary {
Â  Â  Â  Â  user-select: none;
Â  Â  Â  Â  pointer-events: none;
Â  Â  Â  }
Â  Â  Â  summary * {
Â  Â  Â  Â  pointer-events: auto;
Â  Â  Â  }
Â  Â  Â  .chev {
Â  Â  Â  Â  display: inline-block;
Â  Â  Â  Â  transition: transform 0.2s;
Â  Â  Â  }
Â  Â  Â  details[open] .chev {
Â  Â  Â  Â  transform: rotate(180deg);
Â  Â  Â  }
Â  Â  Â  details[open] [data-room-brief] {
Â  Â  Â  Â  display: none;
Â  Â  Â  }
Â  Â  Â  [data-room-brief] {
Â  Â  Â  Â  display: inline-block;
Â  Â  Â  Â  margin-left: 6px;
Â  Â  Â  Â  padding: 0.2rem 0.5rem;
Â  Â  Â  Â  border: 1px solid var(--line);
Â  Â  Â  Â  border-radius: 0.5rem;
Â  Â  Â  Â  background: #0d0e12;
Â  Â  Â  Â  color: var(--muted);
Â  Â  Â  }
Â  Â  Â  [data-room-brief] .num {
Â  Â  Â  Â  color: var(--primary);
Â  Â  Â  Â  font-weight: 600;
Â  Â  Â  }
Â  Â  Â  [data-room-brief] .num.price {
Â  Â  Â  Â  color: var(--secondary);
Â  Â  Â  }
Â  Â  Â  .room-head input[name="room_name"] {
Â  Â  Â  Â  flex: 0 0 50%;
Â  Â  Â  }
Â  Â  Â  .badge {
Â  Â  Â  Â  border: 1px solid var(--line);
Â  Â  Â  Â  border-radius: 0.4rem;
Â  Â  Â  Â  padding: 0.05rem 0.35rem;
Â  Â  Â  }
Â  Â  Â  .actions-split {
Â  Â  Â  Â  justify-content: space-between;
Â  Â  Â  }
Â  Â  Â  .actions-note {
Â  Â  Â  Â  align-items: center;
Â  Â  Â  }
Â  Â  Â  .actions-note .note {
Â  Â  Â  Â  color: var(--muted);
Â  Â  Â  }
Â  Â  Â  .actions .sp {
Â  Â  Â  Â  flex: 1;
Â  Â  Â  }
Â  Â  Â  .sticky-footer {
Â  Â  Â  Â  position: fixed;
Â  Â  Â  Â  bottom: 0;
Â  Â  Â  Â  left: 0;
Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  background: var(--accent-dark);
Â  Â  Â  Â  border-top: 1px solid var(--line);
Â  Â  Â  Â  padding: 10px 16px;
Â  Â  Â  Â  display: grid;
Â  Â  Â  Â  grid-template-columns: 1fr 1fr 1fr 1fr 1fr;
Â  Â  Â  Â  gap: 10px;
Â  Â  Â  Â  z-index: 1000;
Â  Â  Â  }
Â  Â  Â  .sticky-footer .summary-item {
Â  Â  Â  Â  text-align: center;
Â  Â  Â  }
Â  Â  Â  .sticky-footer .summary-label {
Â  Â  Â  Â  font-size: 11px;
Â  Â  Â  Â  color: var(--muted);
Â  Â  Â  Â  margin-bottom: 2px;
Â  Â  Â  }
Â  Â  Â  .sticky-footer .summary-value {
Â  Â  Â  Â  font-weight: 600;
Â  Â  Â  Â  font-size: 15px;
Â  Â  Â  Â  color: var(--primary);
Â  Â  Â  }
Â  Â  Â  .sticky-footer .summary-value.price {
Â  Â  Â  Â  color: var(--secondary);
Â  Â  Â  }
Â  Â  Â  .header {
Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  justify-content: space-between;
Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  margin-bottom: 12px;
Â  Â  Â  }
Â  Â  Â  .header .actions {
Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  gap: 8px;
Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  justify-content: flex-end;
Â  Â  Â  Â  flex: 1;
Â  Â  Â  }
Â  Â  Â  .header h1 {
Â  Â  Â  Â  flex: 1;
Â  Â  Â  }
Â  Â  Â  .header .sp {
Â  Â  Â  Â  flex: 1;
Â  Â  Â  }
Â  Â  Â  .room-head .badge {
Â  Â  Â  Â  flex: 0 0 auto;
Â  Â  Â  }
Â  Â  Â  .set {
Â  Â  Â  Â  background: #0d0e12;
Â  Â  Â  Â  border: 1px solid #2f2f33;
Â  Â  Â  Â  margin-bottom: 8px;
Â  Â  Â  Â  border-left: 2px solid var(--primary); /* Clearer set demarcation */
Â  Â  Â  }
Â  Â  Â  details:not([open]) .room-head input[name="room_name"] {
Â  Â  Â  Â  width: 80%;
Â  Â  Â  Â  flex-grow: 0;
Â  Â  Â  }
Â  Â  Â  .field[disabled] {
Â  Â  Â  Â  opacity: 0.6;
Â  Â  Â  Â  cursor: not-allowed;
Â  Â  Â  }
Â  Â  Â  .btn-primary {
Â  Â  Â  Â  color: var(--primary);
Â  Â  Â  Â  border-color: var(--primary);
Â  Â  Â  }
Â  Â  Â  .btn-danger {
Â  Â  Â  Â  border-color: var(--danger);
Â  Â  Â  Â  color: var(--danger);
Â  Â  Â  }
Â  Â  Â  .btn-add-room {
Â  Â  Â  Â  border-color: var(--primary);
Â  Â  Â  Â  color: var(--primary);
Â  Â  Â  Â  background: #1a1b20;
Â  Â  Â  }
Â  Â  Â  .room-actions {
Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  gap: 8px;
Â  Â  Â  }
Â  Â  Â  .set-badge {
Â  Â  Â  Â  font-size: 14px; /* Increased font size */
Â  Â  Â  Â  font-weight: bold; /* Bold text */
Â  Â  Â  Â  background: var(--primary); /* Blue background */
Â  Â  Â  Â  color: #fff; /* White text */
Â  Â  Â  Â  border: none; /* No border */
Â  Â  Â  Â  border-radius: 99px;
Â  Â  Â  Â  width: 24px;
Â  Â  Â  Â  height: 24px;
Â  Â  Â  Â  display: inline-flex;
Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  line-height: 1;
Â  Â  Â  Â  flex-shrink: 0;
Â  Â  Â  }
Â  Â  Â  .set-head {
Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  gap: 8px;
Â  Â  Â  Â  margin-bottom: 4px;
Â  Â  Â  }
Â  Â  Â  .set-head .sp {
Â  Â  Â  Â  flex: 1;
Â  Â  Â  }
Â  Â  Â  .btn-clear-data {
Â  Â  Â  Â  color: var(--muted);
Â  Â  Â  Â  border-color: var(--line);
Â  Â  Â  }
Â  Â  </style>
Â  </head>
Â  <body>
Â  Â  <div class="header">
Â  Â  Â  <h1>Marnthara</h1>
Â  Â  Â  <button type="button" class="btn btn-xs btn-add-room" id="addRoomHeaderBtn">
Â  Â  Â  Â  + à¹€à¸à¸´à¹ˆà¸¡à¸«à¹‰à¸­à¸‡
Â  Â  Â  </button>
Â  Â  Â  <div class="sp"></div>
Â  Â  Â  <button type="button" class="btn btn-xs btn-primary" id="lockBtn">
Â  Â  Â  Â  <span class="lock-text">à¸¥à¹‡à¸­à¸„</span> <span class="lock-icon">ğŸ”’</span>
Â  Â  Â  </button>
Â  Â  Â  <div class="sp"></div>
Â  Â  Â  <button type="button" class="btn btn-xs btn-danger" id="clearAllBtn">
Â  Â  Â  Â  à¸¥à¹‰à¸²à¸‡à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸” ğŸ—‘ï¸
Â  Â  Â  </button>
Â  Â  </div>

Â  Â  <form id="orderForm" method="post" target="hiddenFrame">
Â  Â  Â  <div class="card" id="customerInfo">
Â  Â  Â  Â  <div class="row three-col">
Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  <label>à¸Šà¸·à¹ˆà¸­à¸¥à¸¹à¸à¸„à¹‰à¸²</label>
Â  Â  Â  Â  Â  Â  <input
Â  Â  Â  Â  Â  Â  Â  class="field"
Â  Â  Â  Â  Â  Â  Â  type="text"
Â  Â  Â  Â  Â  Â  Â  name="customer_name"
Â  Â  Â  Â  Â  Â  Â  placeholder="à¹€à¸Šà¹ˆà¸™ à¸„à¸¸à¸“à¸ªà¸¡à¸Šà¸²à¸¢"
Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  <label>à¸—à¸µà¹ˆà¸­à¸¢à¸¹à¹ˆ</label>
Â  Â  Â  Â  Â  Â  <input
Â  Â  Â  Â  Â  Â  Â  class="field"
Â  Â  Â  Â  Â  Â  Â  type="text"
Â  Â  Â  Â  Â  Â  Â  name="customer_address"
Â  Â  Â  Â  Â  Â  Â  placeholder="à¹€à¸Šà¹ˆà¸™ 123/45 à¸«à¸¡à¸¹à¹ˆà¸šà¹‰à¸²à¸™..."
Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  <label>à¹€à¸šà¸­à¸£à¹Œà¹‚à¸—à¸£</label>
Â  Â  Â  Â  Â  Â  <input
Â  Â  Â  Â  Â  Â  Â  class="field"
Â  Â  Â  Â  Â  Â  Â  type="tel"
Â  Â  Â  Â  Â  Â  Â  name="customer_phone"
Â  Â  Â  Â  Â  Â  Â  placeholder="08xxxxxxxx"
Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>

Â  Â  Â  <input type="hidden" name="payload" id="payload" />
Â  Â  Â  <div id="rooms"></div>
Â  Â  Â  <div class="actions actions-split">
Â  Â  Â  Â  <button type="button" class="btn btn-xs" id="copyJsonBtn">
Â  Â  Â  Â  Â  à¸„à¸±à¸”à¸¥à¸­à¸ JSON
Â  Â  Â  Â  </button>
Â  Â  Â  Â  <button type="submit" class="btn btn-xs">à¸ªà¹ˆà¸‡à¹„à¸›à¸„à¸³à¸™à¸§à¸“</button>
Â  Â  Â  </div>
Â  Â  </form>

Â  Â  <div class="sticky-footer">
Â  Â  Â  <div class="summary-item">
Â  Â  Â  Â  <div class="summary-label">à¸£à¸²à¸„à¸²à¸£à¸§à¸¡</div>
Â  Â  Â  Â  <div class="summary-value price" id="grandTotal">0</div>
Â  Â  Â  </div>
Â  Â  Â  <div class="summary-item">
Â  Â  Â  Â  <div class="summary-label">à¸ˆà¸³à¸™à¸§à¸™à¸Šà¸¸à¸”</div>
Â  Â  Â  Â  <div class="summary-value" id="setCount">0</div>
Â  Â  Â  </div>
Â  Â  Â  <div class="summary-item">
Â  Â  Â  Â  <div class="summary-label">à¸œà¹‰à¸²à¸—à¸¶à¸šà¸—à¸µà¹ˆà¹ƒà¸Šà¹‰</div>
Â  Â  Â  Â  <div class="summary-value" id="grandFabric">0</div>
Â  Â  Â  </div>
Â  Â  Â  <div class="summary-item">
Â  Â  Â  Â  <div class="summary-label">à¸œà¹‰à¸²à¹‚à¸›à¸£à¹ˆà¸‡à¸—à¸µà¹ˆà¹ƒà¸Šà¹‰</div>
Â  Â  Â  Â  <div class="summary-value" id="grandSheerFabric">0</div>
Â  Â  Â  </div>
Â  Â  Â  <div class="summary-item">
Â  Â  Â  Â  <div class="summary-label">à¸£à¸²à¸‡à¸—à¸µà¹ˆà¹ƒà¸Šà¹‰ (à¸¡.)</div>
Â  Â  Â  Â  <div class="summary-value" id="grandTrack">0</div>
Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <iframe name="hiddenFrame" class="hidden"></iframe>

Â  Â  <template id="roomTpl">
Â  Â  Â  <details class="card room" data-room open>
Â  Â  Â  Â  <summary class="room-head">
Â  Â  Â  Â  Â  <button
Â  Â  Â  Â  Â  Â  type="button"
Â  Â  Â  Â  Â  Â  class="btn btn-xs"
Â  Â  Â  Â  Â  Â  data-act="toggle-room"
Â  Â  Â  Â  Â  Â  data-label-closed="à¸‚à¸¢à¸²à¸¢"
Â  Â  Â  Â  Â  Â  data-label-open="à¸¢à¹ˆà¸­"
Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  à¸¢à¹ˆà¸­
Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  <span class="badge small">à¸«à¹‰à¸­à¸‡</span>
Â  Â  Â  Â  Â  <input
Â  Â  Â  Â  Â  Â  class="field"
Â  Â  Â  Â  Â  Â  type="text"
Â  Â  Â  Â  Â  Â  name="room_name"
Â  Â  Â  Â  Â  Â  placeholder="à¸«à¹‰à¸­à¸‡ 01"
Â  Â  Â  Â  Â  Â  required
Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  <span class="small" data-room-brief>à¸ˆà¸¸à¸” 0 â€¢ à¸Šà¸¸à¸” 0 â€¢ à¸£à¸²à¸„à¸² 0 à¸šà¸²à¸—</span>
Â  Â  Â  Â  Â  <span class="sp"></span>
Â  Â  Â  Â  Â  <button
Â  Â  Â  Â  Â  Â  type="button"
Â  Â  Â  Â  Â  Â  class="btn btn-icon btn-danger"
Â  Â  Â  Â  Â  Â  data-act="del-room"
Â  Â  Â  Â  Â  Â  title="à¸¥à¸šà¸«à¹‰à¸­à¸‡"
Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  âœ•
Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  </summary>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <div data-sets></div>

Â  Â  Â  Â  <div class="total">
Â  Â  Â  Â  Â  <div class="room-actions">
Â  Â  Â  Â  Â  Â  <button type="button" class="btn btn-xs btn-add-room" data-act="add-room">+ à¹€à¸à¸´à¹ˆà¸¡à¸«à¹‰à¸­à¸‡</button>
Â  Â  Â  Â  Â  Â  <button
Â  Â  Â  Â  Â  Â  Â  type="button"
Â  Â  Â  Â  Â  Â  Â  class="btn btn-icon btn-add-room"
Â  Â  Â  Â  Â  Â  Â  data-act="dup-room"
Â  Â  Â  Â  Â  Â  Â  title="à¸à¹‡à¸­à¸›à¸«à¹‰à¸­à¸‡"
Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  â§‰
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="room-actions">
Â  Â  Â  Â  Â  Â  <button type="button" class="btn btn-xs" data-act="add-set">
Â  Â  Â  Â  Â  Â  Â  + à¹€à¸à¸´à¹ˆà¸¡à¸Šà¸¸à¸”
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  <button
Â  Â  Â  Â  Â  Â  Â  type="button"
Â  Â  Â  Â  Â  Â  Â  class="btn btn-icon"
Â  Â  Â  Â  Â  Â  Â  data-act="dup-set"
Â  Â  Â  Â  Â  Â  Â  title="à¸à¹‡à¸­à¸›à¸Šà¸¸à¸”"
Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  â§‰
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="price" data-room-total>0 à¸šà¸²à¸—</div>
Â  Â  Â  Â  </div>
Â  Â  Â  </details>
Â  Â  </template>

Â  Â  <template id="setTpl">
Â  Â  Â  <div class="card set" data-set>
Â  Â  Â  Â  <div class="set-head">
Â  Â  Â  Â  Â  <div class="set-badge" data-set-title></div>
Â  Â  Â  Â  Â  <span class="small" data-set-units>à¸ˆà¸³à¸™à¸§à¸™ 0 à¸Šà¸¸à¸”</span>
Â  Â  Â  Â  Â  <span class="sp"></span>
Â  Â  Â  Â  Â  <button type="button" class="btn btn-xs btn-clear-data" data-act="clear-set">
Â  Â  Â  Â  Â  Â  à¸¥à¹‰à¸²à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥
Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  <button
Â  Â  Â  Â  Â  Â  type="button"
Â  Â  Â  Â  Â  Â  class="btn btn-icon btn-danger"
Â  Â  Â  Â  Â  Â  data-act="del-set"
Â  Â  Â  Â  Â  Â  title="à¸¥à¸šà¸Šà¸¸à¸”"
Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  âˆ’
Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="row">
Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  <label>à¸à¸§à¹‰à¸²à¸‡ (à¸¡.)</label>
Â  Â  Â  Â  Â  Â  <input
Â  Â  Â  Â  Â  Â  Â  class="field"
Â  Â  Â  Â  Â  Â  Â  name="width_m"
Â  Â  Â  Â  Â  Â  Â  type="number"
Â  Â  Â  Â  Â  Â  Â  step="0.01"
Â  Â  Â  Â  Â  Â  Â  min="0"
Â  Â  Â  Â  Â  Â  Â  inputmode="decimal"
Â  Â  Â  Â  Â  Â  Â  placeholder="à¹€à¸Šà¹ˆà¸™ 3.50"
Â  Â  Â  Â  Â  Â  Â  required
Â  Â  Â  Â  Â  Â  Â  autocomplete="off"
Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  <label>à¸ªà¸¹à¸‡ (à¸¡.)</label>
Â  Â  Â  Â  Â  Â  <input
Â  Â  Â  Â  Â  Â  Â  class="field"
Â  Â  Â  Â  Â  Â  Â  name="height_m"
Â  Â  Â  Â  Â  Â  Â  type="number"
Â  Â  Â  Â  Â  Â  Â  step="0.01"
Â  Â  Â  Â  Â  Â  Â  min="0"
Â  Â  Â  Â  Â  Â  Â  inputmode="decimal"
Â  Â  Â  Â  Â  Â  Â  placeholder="à¹€à¸Šà¹ˆà¸™ 2.80"
Â  Â  Â  Â  Â  Â  Â  required
Â  Â  Â  Â  Â  Â  Â  autocomplete="off"
Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="row three-col">
Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  <label>à¸£à¸²à¸„à¸²à¸œà¹‰à¸² (à¸•à¹ˆà¸­à¹€à¸¡à¸•à¸£)</label>
Â  Â  Â  Â  Â  Â  <select class="field" name="price_per_m" required>
Â  Â  Â  Â  Â  Â  Â  <option value="" hidden>à¹€à¸¥à¸·à¸­à¸</option>
Â  Â  Â  Â  Â  Â  Â  <option value=""></option>
Â  Â  Â  Â  Â  Â  Â  <option value="1000">1,000</option>
Â  Â  Â  Â  Â  Â  Â  <option value="1200">1,200</option>
Â  Â  Â  Â  Â  Â  Â  <option value="1300">1,300</option>
Â  Â  Â  Â  Â  Â  Â  <option value="1400">1,400</option>
Â  Â  Â  Â  Â  Â  Â  <option value="1500">1,500</option>
Â  Â  Â  Â  Â  Â  Â  <option value="1600">1,600</option>
Â  Â  Â  Â  Â  Â  Â  <option value="1700">1,700</option>
Â  Â  Â  Â  Â  Â  Â  <option value="1800">1,800</option>
Â  Â  Â  Â  Â  Â  Â  <option value="1900">1,900</option>
Â  Â  Â  Â  Â  Â  Â  <option value="2000">2,000</option>
Â  Â  Â  Â  Â  Â  Â  <option value="2100">2,100</option>
Â  Â  Â  Â  Â  Â  Â  <option value="2200">2,200</option>
Â  Â  Â  Â  Â  Â  Â  <option value="2300">2,300</option>
Â  Â  Â  Â  Â  Â  Â  <option value="2400">2,400</option>
Â  Â  Â  Â  Â  Â  Â  <option value="2500">2,500</option>
Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  <label>à¸ªà¹„à¸•à¸¥à¹Œ</label>
Â  Â  Â  Â  Â  Â  <select class="field" name="style" required>
Â  Â  Â  Â  Â  Â  Â  <option value="" hidden>à¹€à¸¥à¸·à¸­à¸</option>
Â  Â  Â  Â  Â  Â  Â  <option value=""></option>
Â  Â  Â  Â  Â  Â  Â  <option>à¸¥à¸­à¸™</option>
Â  Â  Â  Â  Â  Â  Â  <option>à¸•à¸²à¹„à¸à¹ˆ</option>
Â  Â  Â  Â  Â  Â  Â  <option>à¸ˆà¸µà¸š</option>
Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  <label>à¸£à¸¹à¸›à¹à¸šà¸šà¹€à¸›à¸´à¸”à¸œà¹‰à¸²</label>
Â  Â  Â  Â  Â  Â  <select class="field" name="open_type" required>
Â  Â  Â  Â  Â  Â  Â  <option value="" hidden>à¹€à¸¥à¸·à¸­à¸</option>
Â  Â  Â  Â  Â  Â  Â  <option value=""></option>
Â  Â  Â  Â  Â  Â  Â  <option>à¹à¸¢à¸à¸à¸¥à¸²à¸‡</option>
Â  Â  Â  Â  Â  Â  Â  <option>à¸ªà¹„à¸¥à¸”à¹Œà¹€à¸”à¸µà¹ˆà¸¢à¸§</option>
Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="row">
Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  <label>à¸Šà¸™à¸´à¸”à¸œà¹‰à¸²à¸‚à¸­à¸‡à¸ˆà¸¸à¸”à¸™à¸µà¹‰</label>
Â  Â  Â  Â  Â  Â  <select class="field" name="fabric_variant">
Â  Â  Â  Â  Â  Â  Â  <option>à¸—à¸¶à¸š</option>
Â  Â  Â  Â  Â  Â  Â  <option>à¹‚à¸›à¸£à¹ˆà¸‡</option>
Â  Â  Â  Â  Â  Â  Â  <option>à¸—à¸¶à¸š&à¹‚à¸›à¸£à¹ˆà¸‡</option>
Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div data-sheer-wrap class="hidden">
Â  Â  Â  Â  Â  Â  <label>à¸£à¸²à¸„à¸²à¸œà¹‰à¸²à¹‚à¸›à¸£à¹ˆà¸‡ (à¸•à¹ˆà¸­à¹€à¸¡à¸•à¸£)</label>
Â  Â  Â  Â  Â  Â  <select class="field" name="sheer_price_per_m">
Â  Â  Â  Â  Â  Â  Â  <option value="" hidden>à¹€à¸¥à¸·à¸­à¸</option>
Â  Â  Â  Â  Â  Â  Â  <option value=""></option>
Â  Â  Â  Â  Â  Â  Â  <option value="1000">1,000</option>
Â  Â  Â  Â  Â  Â  Â  <option value="1100">1,100</option>
Â  Â  Â  Â  Â  Â  Â  <option value="1200">1,200</option>
Â  Â  Â  Â  Â  Â  Â  <option value="1300">1,300</option>
Â  Â  Â  Â  Â  Â  Â  <option value="1400">1,400</option>
Â  Â  Â  Â  Â  Â  Â  <option value="1500">1,500</option>
Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="small" style="margin-top: 8px">
Â  Â  Â  Â  Â  <span data-opaque-price-label>à¸—à¸¶à¸š: <span class="price" data-set-price-opaque>0</span> à¸šà¸²à¸—</span>
Â  Â  Â  Â  Â  <span data-sheer-price-label class="hidden"> â€¢ à¹‚à¸›à¸£à¹ˆà¸‡: <span class="price" data-set-price-sheer>0</span> à¸šà¸²à¸—</span>
Â  Â  Â  Â  Â  <span data-opaque-yardage-label> â€¢ à¸—à¸¶à¸š: <span class="price" data-set-yardage-opaque>0</span> à¸«à¸¥à¸²</span>
Â  Â  Â  Â  Â  <span data-sheer-yardage-label class="hidden"> â€¢ à¹‚à¸›à¸£à¹ˆà¸‡: <span class="price" data-set-yardage-sheer>0</span> à¸«à¸¥à¸²</span>
Â  Â  Â  Â  Â  <span data-track-label> â€¢ à¸£à¸²à¸‡: <span class="price" data-set-track>0</span> à¸¡.</span>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  </template>

Â  Â  <script>
Â  Â  Â  const APP_VERSION = "input-ui/1.0.14";
Â  Â  Â  const WEBHOOK_URL =
Â  Â  Â  Â  "https://your-make-webhook-url.com/your-unique-path";
Â  Â  Â  const STORAGE_KEY = "marnthara.input.v1";

Â  Â  Â  const PRICING = {
Â  Â  Â  Â  fabric: [1000, 1200, 1300, 1400, 1500, 1600, 1700, 1800, 1900, 2000, 2100, 2200, 2300, 2400, 2500],
Â  Â  Â  Â  sheer: [1000, 1100, 1200, 1300, 1400, 1500],
Â  Â  Â  Â  style_surcharge: { "à¸¥à¸­à¸™": 200, "à¸•à¸²à¹„à¸à¹ˆ": 0, "à¸ˆà¸µà¸š": 0 },
Â  Â  Â  Â  height: [
Â  Â  Â  Â  Â  { threshold: 3.2, add_per_m: 300 },
Â  Â  Â  Â  Â  { threshold: 2.8, add_per_m: 200 },
Â  Â  Â  Â  Â  { threshold: 2.5, add_per_m: 150 },
Â  Â  Â  Â  ],
Â  Â  Â  };
Â  Â  Â  const CALC = {
Â  Â  Â  Â  fabricYardage: (style, width) => {
Â  Â  Â  Â  Â  let yards = 0;
Â  Â  Â  Â  Â  if (width > 0) {
Â  Â  Â  Â  Â  Â  if (style === "à¸•à¸²à¹„à¸à¹ˆ" || style === "à¸ˆà¸µà¸š") {
Â  Â  Â  Â  Â  Â  Â  yards = (width * 2.0 + 0.6) / 0.9;
Â  Â  Â  Â  Â  Â  } else if (style === "à¸¥à¸­à¸™") {
Â  Â  Â  Â  Â  Â  Â  yards = (width * 2.6 + 0.6) / 0.9;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  return yards > 0 ? yards : 0;
Â  Â  Â  Â  },
Â  Â  Â  };
Â  Â  Â Â 
Â  Â  Â  const stylePlus = (s) => PRICING.style_surcharge[s] ?? 0;
Â  Â  Â  const heightPlus = (h) => {
Â  Â  Â  Â  const sorted = [...PRICING.height].sort((a,b) => b.threshold - a.threshold);
Â  Â  Â  Â  for(const entry of sorted) {
Â  Â  Â  Â  Â  if (h > entry.threshold) {
Â  Â  Â  Â  Â  Â  return entry.add_per_m;
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  return 0;
Â  Â  Â  };

Â  Â  Â  const roomsEl = document.getElementById("rooms");
Â  Â  Â  const orderForm = document.getElementById("orderForm");
Â  Â  Â  orderForm.action = WEBHOOK_URL;

Â  Â  Â  const copyBtn = document.getElementById("copyJsonBtn");
Â  Â  Â  const clearAllBtn = document.getElementById("clearAllBtn");
Â  Â  Â  const lockBtn = document.getElementById("lockBtn");
Â  Â  Â  const addRoomHeaderBtn = document.getElementById("addRoomHeaderBtn");
Â  Â  Â Â 
Â  Â  Â  let roomCount = 0;
Â  Â  Â  let isLocked = false;

Â  Â  Â  function toNum(v) {
Â  Â  Â  Â  const n = parseFloat(v);
Â  Â  Â  Â  return Number.isFinite(n) ? n : 0;
Â  Â  Â  }
Â  Â  Â  function clamp01(n) {
Â  Â  Â  Â  return Math.max(0, toNum(n));
Â  Â  Â  }
Â  Â  Â  function fmt(n, fixed = 2, asCurrency = false) {
Â  Â  Â  Â  if (Number.isFinite(n)) {
Â  Â  Â  Â  Â  if (asCurrency) {
Â  Â  Â  Â  Â  Â  return n.toLocaleString("th-TH", { minimumFractionDigits: 0, maximumFractionDigits: 0 });
Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  return n.toFixed(fixed).toLocaleString("th-TH");
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  return n.toLocaleString("th-TH");
Â  Â  Â  }
Â  Â  Â  function debounce(fn, ms = 120) {
Â  Â  Â  Â  let t;
Â  Â  Â  Â  return (...a) => {
Â  Â  Â  Â  Â  clearTimeout(t);
Â  Â  Â  Â  Â  t = setTimeout(() => fn(...a), ms);
Â  Â  Â  Â  };
Â  Â  Â  }
Â  Â  Â  function addRoom(prefill) {
Â  Â  Â  Â  if (isLocked) return;
Â  Â  Â  Â  roomCount++;
Â  Â  Â  Â  const frag = document.getElementById("roomTpl").content.cloneNode(true);
Â  Â  Â  Â  const room = frag.querySelector("[data-room]");
Â  Â  Â  Â  room.dataset.index = roomCount;
Â  Â  Â  Â  const bg = ["var(--room1)", "var(--room2)", "var(--room3)"][
Â  Â  Â  Â  Â  (roomCount - 1) % 3
Â  Â  Â  Â  ];
Â  Â  Â  Â  room.style.background = bg;
Â  Â  Â  Â  roomsEl.appendChild(frag);
Â  Â  Â  Â  const created = roomsEl.querySelector("[data-room]:last-of-type");
Â  Â  Â  Â Â 
Â  Â  Â  Â  updateToggleBtnText(created.querySelector('[data-act="toggle-room"]'));

Â  Â  Â  Â  if (prefill) {
Â  Â  Â  Â  Â  created.querySelector('input[name="room_name"]').value =
Â  Â  Â  Â  Â  Â  prefill.room_name || "";
Â  Â  Â  Â  }

Â  Â  Â  Â  if (prefill && prefill.sets && prefill.sets.length) {
Â  Â  Â  Â  Â  prefill.sets.forEach((s) => addSet(created, s));
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  addSet(created);
Â  Â  Â  Â  }

Â  Â  Â  Â  renumber();
Â  Â  Â  Â  recalcAll();
Â  Â  Â  Â  updateLockState();

Â  Â  Â  Â  created.scrollIntoView({ behavior: 'smooth', block: 'end' });
Â  Â  Â  }

Â  Â  Â  function populatePriceOptions(selectEl, prices) {
Â  Â  Â  Â  selectEl.innerHTML = `<option value="" hidden>à¹€à¸¥à¸·à¸­à¸</option><option value=""></option>`;
Â  Â  Â  Â  prices.forEach(price => {
Â  Â  Â  Â  Â  const option = document.createElement('option');
Â  Â  Â  Â  Â  option.value = price;
Â  Â  Â  Â  Â  option.textContent = price.toLocaleString("th-TH");
Â  Â  Â  Â  Â  selectEl.appendChild(option);
Â  Â  Â  Â  });
Â  Â  Â  }

Â  Â  Â  function addSet(roomEl, prefill) {
Â  Â  Â  Â  if (isLocked) return;
Â  Â  Â  Â  const setsWrap = roomEl.querySelector("[data-sets]");
Â  Â  Â  Â  const frag = document.getElementById("setTpl").content.cloneNode(true);
Â  Â  Â  Â  setsWrap.appendChild(frag);
Â  Â  Â  Â  const created = setsWrap.querySelector("[data-set]:last-of-type");
Â  Â  Â  Â  
Â  Â  Â  Â  const ppmSel = created.querySelector('select[name="price_per_m"]');
Â  Â  Â  Â  const sheerSel = created.querySelector('select[name="sheer_price_per_m"]');
Â  Â  Â  Â  populatePriceOptions(ppmSel, PRICING.fabric);
Â  Â  Â  Â  populatePriceOptions(sheerSel, PRICING.sheer);

Â  Â  Â  Â  const mapDefault = (v) => v || "à¸—à¸¶à¸š";

Â  Â  Â  Â  const fvSel = created.querySelector('select[name="fabric_variant"]');
Â  Â  Â  Â  fvSel.value = prefill?.fabric_variant || "à¸—à¸¶à¸š";
Â  Â  Â  Â Â 
Â  Â  Â  Â  const otSel = created.querySelector('select[name="open_type"]');
Â  Â  Â  Â  otSel.value = prefill?.open_type || "";

Â  Â  Â  Â  if (prefill) {
Â  Â  Â  Â  Â  created.querySelector('input[name="width_m"]').value =
Â  Â  Â  Â  Â  Â  prefill.width_m ?? "";
Â  Â  Â  Â  Â  created.querySelector('input[name="height_m"]').value =
Â  Â  Â  Â  Â  Â  prefill.height_m ?? "";
Â  Â  Â  Â  Â  created.querySelector('select[name="price_per_m"]').value =
Â  Â  Â  Â  Â  Â  prefill.price_per_m_raw || "";
Â  Â  Â  Â  Â  created.querySelector('select[name="style"]').value =
Â  Â  Â  Â  Â  Â  prefill.style || "";
Â  Â  Â  Â  Â  created.querySelector('select[name="sheer_price_per_m"]').value =
Â  Â  Â  Â  Â  Â  prefill.sheer_price_per_m || "";
Â  Â  Â  Â  }

Â  Â  Â  Â  toggleSetFabricUI(created);
Â  Â  Â  Â  renumber();
Â  Â  Â  Â  recalcAll();
Â  Â  Â  Â  updateLockState();
Â  Â  Â  Â Â 
Â  Â  Â  Â  created.scrollIntoView({ behavior: 'smooth', block: 'end' });
Â  Â  Â  }

Â  Â  Â  function toggleSetFabricUI(set) {
Â  Â  Â  Â  const variant = set.querySelector(
Â  Â  Â  Â  Â  'select[name="fabric_variant"]'
Â  Â  Â  Â  ).value;
Â  Â  Â  Â  const hasSheer = variant === "à¹‚à¸›à¸£à¹ˆà¸‡" || variant === "à¸—à¸¶à¸š&à¹‚à¸›à¸£à¹ˆà¸‡";
Â  Â  Â  Â  const hasOpaque = variant !== "à¹‚à¸›à¸£à¹ˆà¸‡";
Â  Â  Â  Â Â 
Â  Â  Â  Â  set.querySelector("[data-sheer-wrap]").classList.toggle("hidden", !hasSheer);
Â  Â  Â  Â  set.querySelector("[data-sheer-price-label]").classList.toggle("hidden", !hasSheer);
Â  Â  Â  Â  set.querySelector("[data-sheer-yardage-label]").classList.toggle("hidden", !hasSheer);

Â  Â  Â  Â  set.querySelector("[data-opaque-price-label]").classList.toggle("hidden", !hasOpaque);
Â  Â  Â  Â  set.querySelector("[data-opaque-yardage-label]").classList.toggle("hidden", !hasOpaque);
Â  Â  Â  }
Â  Â  Â Â 
Â  Â  Â  function updateToggleBtnText(btn) {
Â  Â  Â  Â  const details = btn.closest("details");
Â  Â  Â  Â  if (!details) return;
Â  Â  Â  Â  const label = details.open ? btn.dataset.labelOpen : btn.dataset.labelClosed;
Â  Â  Â  Â  btn.textContent = label;
Â  Â  Â  }

Â  Â  Â  function delRoom(btn) {
Â  Â  Â  Â  if (isLocked) return;
Â  Â  Â  Â  if (!confirm("à¸„à¸¸à¸“à¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¸¥à¸šà¸«à¹‰à¸­à¸‡à¸™à¸µà¹‰à¹ƒà¸Šà¹ˆà¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ?")) return;
Â  Â  Â  Â  btn.closest("[data-room]").remove();
Â  Â  Â  Â  renumber();
Â  Â  Â  Â  recalcAll();
Â  Â  Â  Â  saveData();
Â  Â  Â  Â  updateLockState();
Â  Â  Â  }

Â  Â  Â  function delSet(btn) {
Â  Â  Â  Â  if (isLocked) return;
Â  Â  Â  Â  if (!confirm("à¸„à¸¸à¸“à¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¸¥à¸šà¸Šà¸¸à¸”à¸™à¸µà¹‰à¹ƒà¸Šà¹ˆà¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ?")) return;
Â  Â  Â  Â  const room = btn.closest("[data-room]");
Â  Â  Â  Â  btn.closest("[data-set]").remove();
Â  Â  Â  Â  if (room.querySelectorAll("[data-set]").length === 0) addSet(room);
Â  Â  Â  Â  renumber();
Â  Â  Â  Â  recalcAll();
Â  Â  Â  Â  saveData();
Â  Â  Â  Â  updateLockState();
Â  Â  Â  }

Â  Â  Â  function dupRoom(btn) {
Â  Â  Â  Â  if (isLocked) return;
Â  Â  Â  Â  const src = btn.closest("[data-room]");
Â  Â  Â  Â  const data = serializeRoom(src);
Â  Â  Â  Â  if (data.room_name) data.room_name = data.room_name + " (copy)";
Â  Â  Â  Â  addRoom(data);
Â  Â  Â  }

Â  Â  Â  function dupSet(btn) {
Â  Â  Â  Â  if (isLocked) return;
Â  Â  Â  Â  const src = btn.closest("[data-set]");
Â  Â  Â  Â  const room = btn.closest("[data-room]");
Â  Â  Â  Â  const data = serializeSet(src);
Â  Â  Â  Â  addSet(room, data);
Â  Â  Â  }

Â  Â  Â  function clearSet(btn) {
Â  Â  Â  Â  if (isLocked) return;
Â  Â  Â  Â  if (!confirm("à¸„à¸¸à¸“à¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¸¥à¹‰à¸²à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸Šà¸¸à¸”à¸™à¸µà¹‰à¹ƒà¸Šà¹ˆà¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ?")) return;
Â  Â  Â  Â  const set = btn.closest("[data-set]");
Â  Â  Â  Â  set.querySelector('input[name="width_m"]').value = "";
Â  Â  Â  Â  set.querySelector('input[name="height_m"]').value = "";
Â  Â  Â  Â  const fvSel = set.querySelector('select[name="fabric_variant"]');
Â  Â  Â  Â  if (fvSel) fvSel.value = "à¸—à¸¶à¸š";
Â  Â  Â  Â  const sheerSel = set.querySelector('select[name="sheer_price_per_m"]');
Â  Â  Â  Â  if (sheerSel) sheerSel.value = "";
Â  Â  Â  Â  const otSel = set.querySelector('select[name="open_type"]');
Â  Â  Â  Â  if (otSel) otSel.value = "";
Â  Â  Â  Â  const styleSel = set.querySelector('select[name="style"]');
Â  Â  Â  Â  if(styleSel) styleSel.value = "";
Â  Â  Â  Â  const ppmSel = set.querySelector('select[name="price_per_m"]');
Â  Â  Â  Â  if(ppmSel) ppmSel.value = "";
Â  Â  Â  Â  toggleSetFabricUI(set);
Â  Â  Â  Â  recalcAll();
Â  Â  Â  Â  saveData();
Â  Â  Â  Â  updateLockState();
Â  Â  Â  }

Â  Â  Â  function clearRoom(btn) {
Â  Â  Â  Â  if (isLocked) return;
Â  Â  Â  Â  if (!confirm("à¸„à¸¸à¸“à¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¸¥à¹‰à¸²à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸«à¹‰à¸­à¸‡à¸™à¸µà¹‰à¹ƒà¸Šà¹ˆà¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ?")) return;
Â  Â  Â  Â  const room = btn.closest("[data-room]");
Â  Â  Â  Â  room.querySelector('input[name="room_name"]').value = "";
Â  Â  Â  Â  const wrap = room.querySelector("[data-sets]");
Â  Â  Â  Â  wrap.innerHTML = "";
Â  Â  Â  Â  addSet(room);
Â  Â  Â  Â  recalcAll();
Â  Â  Â  Â  saveData();
Â  Â  Â  Â  updateLockState();
Â  Â  Â  }
Â  Â  Â Â 
Â  Â  Â  function clearAllData() {
Â  Â  Â  Â  if (isLocked) return;
Â  Â  Â  Â  if (!confirm("à¸„à¸¸à¸“à¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¸¥à¹‰à¸²à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¹ƒà¸Šà¹ˆà¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ?")) return;
Â  Â  Â  Â  roomsEl.innerHTML = "";
Â  Â  Â  Â  roomCount = 0;
Â  Â  Â  Â Â 
Â  Â  Â  Â  const customerInputs = document.querySelectorAll('#customerInfo input');
Â  Â  Â  Â  customerInputs.forEach(input => {
Â  Â  Â  Â  Â  input.value = "";
Â  Â  Â  Â  });

Â  Â  Â  Â  addRoom();
Â  Â  Â  Â  saveData();
Â  Â  Â  Â  updateLockState();
Â  Â  Â  }
Â  Â  Â  
Â  Â  Â  function saveData() {
Â  Â  Â  Â  const payload = buildPayload();
Â  Â  Â  Â  localStorage.setItem(STORAGE_KEY, JSON.stringify(payload));
Â  Â  Â  }

Â  Â  Â  function loadData() {
Â  Â  Â  Â  const storedData = localStorage.getItem(STORAGE_KEY);
Â  Â  Â  Â  if (storedData) {
Â  Â  Â  Â  Â  const payload = JSON.parse(storedData);
Â  Â  Â  Â  Â  document.querySelector('input[name="customer_name"]').value = payload.customer_name;
Â  Â  Â  Â  Â  document.querySelector('input[name="customer_address"]').value = payload.customer_address;
Â  Â  Â  Â  Â  document.querySelector('input[name="customer_phone"]').value = payload.customer_phone;
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  roomsEl.innerHTML = "";
Â  Â  Â  Â  Â  roomCount = 0;
Â  Â  Â  Â  Â  if (payload.rooms && payload.rooms.length > 0) {
Â  Â  Â  Â  Â  Â  payload.rooms.forEach(roomData => addRoom(roomData));
Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  addRoom();
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  addRoom();
Â  Â  Â  Â  }
Â  Â  Â  }

Â  Â  Â  function toggleLock() {
Â  Â  Â  Â  isLocked = !isLocked;
Â  Â  Â  Â  updateLockState();
Â  Â  Â  }

Â  Â  Â  function updateLockState() {
Â  Â  Â  Â  const fields = document.querySelectorAll('#orderForm input, #orderForm select');
Â  Â  Â  Â  fields.forEach(field => {
Â  Â  Â  Â  Â  field.disabled = isLocked;
Â  Â  Â  Â  });

Â  Â  Â  Â  const buttons = document.querySelectorAll('#orderForm button:not(#clearAllBtn)');
Â  Â  Â  Â  buttons.forEach(button => {
Â  Â  Â  Â  Â  Â  if (!button.matches('[data-act="toggle-room"]')) {
Â  Â  Â  Â  Â  Â  Â  Â  button.disabled = isLocked;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  Â  Â Â 
Â  Â  Â  Â  lockBtn.classList.toggle('btn-danger', isLocked);
Â  Â  Â  Â  lockBtn.classList.toggle('btn-primary', !isLocked);
Â  Â  Â  Â  lockBtn.querySelector('.lock-text').textContent = isLocked ? 'à¸›à¸¥à¸”à¸¥à¹‡à¸­à¸„' : 'à¸¥à¹‡à¸­à¸„';
Â  Â  Â  Â  lockBtn.querySelector('.lock-icon').textContent = isLocked ? 'ğŸ”“' : 'ğŸ”’';
Â  Â  Â  Â  clearAllBtn.disabled = false;
Â  Â  Â  Â  addRoomHeaderBtn.disabled = false;
Â  Â  Â  Â Â 
Â  Â  Â  }

Â  Â  Â  function renumber() {
Â  Â  Â  Â  [...document.querySelectorAll("[data-room]")].forEach((room, rIdx) => {
Â  Â  Â  Â  Â  const input = room.querySelector('input[name="room_name"]');
Â  Â  Â  Â  Â  if (input && !input.value)
Â  Â  Â  Â  Â  Â  input.placeholder = `à¸«à¹‰à¸­à¸‡ ${String(rIdx + 1).padStart(2, "0")}`;
Â  Â  Â  Â  Â  let setCount = 0;
Â  Â  Â  Â  Â  [...room.querySelectorAll("[data-set]")].forEach((set) => {
Â  Â  Â  Â  Â  Â  setCount++;
Â  Â  Â  Â  Â  Â  const lbl = set.querySelector("[data-set-title]");
Â  Â  Â  Â  Â  Â  if (lbl)
Â  Â  Â  Â  Â  Â  Â  lbl.textContent = setCount;
Â  Â  Â  Â  Â  });
Â  Â  Â  Â  });
Â  Â  Â  }

Â  Â  Â  function recalcAll() {
Â  Â  Â  Â  let grand = 0;
Â  Â  Â  Â  let allSets = 0;
Â  Â  Â  Â  let grandOpaqueYards = 0;
Â  Â  Â  Â  let grandSheerYards = 0;
Â  Â  Â  Â  let grandTrack = 0;

Â  Â  Â  Â  [...document.querySelectorAll("[data-room]")].forEach((room) => {
Â  Â  Â  Â  Â  let roomSum = 0;
Â  Â  Â  Â  Â  let roomUnits = 0;
Â  Â  Â  Â  Â  let roomOpaqueYards = 0;
Â  Â  Â  Â  Â  let roomSheerYards = 0;
Â  Â  Â  Â  Â  let roomTrack = 0;
Â  Â  Â  Â  Â  const points = room.querySelectorAll("[data-set]").length;

Â  Â  Â  Â  Â  room.querySelectorAll("[data-set]").forEach((set) => {
Â  Â  Â  Â  Â  Â  const w = clamp01(set.querySelector('input[name="width_m"]').value);
Â  Â  Â  Â  Â  Â  const h = clamp01(
Â  Â  Â  Â  Â  Â  Â  set.querySelector('input[name="height_m"]').value
Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  const hPlus = heightPlus(h);
Â  Â  Â  Â  Â  Â  const variant = set.querySelector(
Â  Â  Â  Â  Â  Â  Â  'select[name="fabric_variant"]'
Â  Â  Â  Â  Â  Â  ).value;
Â  Â  Â  Â  Â  Â  const style = set.querySelector('select[name="style"]').value;
Â  Â  Â  Â  Â  Â  const baseRaw = toNum(set.querySelector('select[name="price_per_m"]').value);
Â  Â  Â  Â  Â  Â  const sPlus = stylePlus(style);

Â  Â  Â  Â  Â  Â  const hasOpaque = variant !== "à¹‚à¸›à¸£à¹ˆà¸‡";
Â  Â  Â  Â  Â  Â  const hasSheer = variant === "à¹‚à¸›à¸£à¹ˆà¸‡" || variant === "à¸—à¸¶à¸š&à¹‚à¸›à¸£à¹ˆà¸‡";
Â  Â  Â  Â  Â  Â  const sheerBase = hasSheer
Â  Â  Â  Â  Â  Â  Â  ? clamp01(set.querySelector('[name="sheer_price_per_m"]').value)
Â  Â  Â  Â  Â  Â  Â  : 0;
Â  Â  Â  Â  Â  Â  const opaquePerM = hasOpaque ? baseRaw + sPlus + hPlus : 0;
Â  Â  Â  Â  Â  Â  const sheerPerM = hasSheer ? sheerBase + sPlus + hPlus : 0;
Â  Â  Â  Â  Â  Â  const opaquePrice = Math.round(opaquePerM * w);
Â  Â  Â  Â  Â  Â  const sheerPrice = Math.round(sheerPerM * w);
Â  Â  Â  Â  Â  Â  const total = opaquePrice + sheerPrice;
Â  Â  Â  Â  Â  Â  const units = (opaquePrice > 0 ? 1 : 0) + (sheerPrice > 0 ? 1 : 0);
Â  Â  Â  Â  Â  Â  const yards = CALC.fabricYardage(style, w);
Â  Â  Â  Â  Â  Â  const track = variant === "à¸—à¸¶à¸š&à¹‚à¸›à¸£à¹ˆà¸‡" ? w * 2 : w;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  set.querySelector('[data-set-price-opaque]').textContent = fmt(opaquePrice, 0, true);
Â  Â  Â  Â  Â  Â  set.querySelector('[data-set-price-sheer]').textContent = fmt(sheerPrice, 0, true);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Fix: Show/hide yardage labels correctly
Â  Â  Â  Â  Â  Â  set.querySelector('[data-opaque-yardage-label]').classList.toggle('hidden', !hasOpaque);
Â  Â  Â  Â  Â  Â  set.querySelector('[data-sheer-yardage-label]').classList.toggle('hidden', !hasSheer);

Â  Â  Â  Â  Â  Â  set.querySelector('[data-set-yardage-opaque]').textContent = fmt(yards, 2);
Â  Â  Â  Â  Â  Â  set.querySelector('[data-set-yardage-sheer]').textContent = fmt(yards, 2);
Â  Â  Â  Â  Â  Â  set.querySelector('[data-set-track]').textContent = fmt(track, 2);

Â  Â  Â  Â  Â  Â  roomSum += total;
Â  Â  Â  Â  Â  Â  roomUnits += units;
Â  Â  Â  Â  Â  Â  if(hasOpaque) roomOpaqueYards += yards;
Â  Â  Â  Â  Â  Â  if(hasSheer) roomSheerYards += yards;
Â  Â  Â  Â  Â  Â  if (hasOpaque || hasSheer) roomTrack += track;
Â  Â  Â  Â  Â  Â  allSets += units;
Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  const rt = room.querySelector("[data-room-total]");
Â  Â  Â  Â  Â  if (rt) rt.textContent = fmt(roomSum, 0, true) + " à¸šà¸²à¸—";

Â  Â  Â  Â  Â  const brief = room.querySelector("[data-room-brief]");
Â  Â  Â  Â  Â  if (brief) {
Â  Â  Â  Â  Â  Â  brief.innerHTML = `à¸ˆà¸¸à¸” <span class=\"num\">${fmt(points, 0, true)}</span> â€¢ à¸Šà¸¸à¸” <span class=\"num\">${fmt(roomUnits, 0, true)}</span> â€¢ à¸£à¸²à¸„à¸² <span class=\"num price\">${fmt(roomSum, 0, true)}</span> à¸šà¸²à¸—`;
Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  grand += roomSum;
Â  Â  Â  Â  Â  grandOpaqueYards += roomOpaqueYards;
Â  Â  Â  Â  Â  grandSheerYards += roomSheerYards;
Â  Â  Â  Â  Â  grandTrack += roomTrack;
Â  Â  Â  Â  });

Â  Â  Â  Â  document.getElementById("grandTotal").textContent = fmt(grand, 0, true);
Â  Â  Â  Â  document.getElementById("setCount").textContent = fmt(allSets, 0, true);
Â  Â  Â  Â  document.getElementById("grandFabric").textContent = fmt(grandOpaqueYards, 2);
Â  Â  Â  Â  document.getElementById("grandSheerFabric").textContent = fmt(grandSheerYards, 2);
Â  Â  Â  Â  document.getElementById("grandTrack").textContent = fmt(grandTrack, 2);
Â  Â  Â  }

Â  Â  Â  function serializeSet(set, idx = 0) {
Â  Â  Â  Â  const width = clamp01(set.querySelector('input[name="width_m"]').value);
Â  Â  Â  Â  const height = clamp01(
Â  Â  Â  Â  Â  set.querySelector('input[name="height_m"]').value
Â  Â  Â  Â  );
Â  Â  Â  Â  const fabric_variant = set.querySelector(
Â  Â  Â  Â  Â  'select[name="fabric_variant"]'
Â  Â  Â  Â  ).value;
Â  Â  Â  Â  const open_type = set.querySelector('select[name="open_type"]').value || "";
Â  Â  Â  Â  const style = set.querySelector('select[name="style"]').value;
Â  Â  Â  Â  const ppmRaw = toNum(set.querySelector('select[name="price_per_m"]').value);
Â  Â  Â  Â  const hasOpaque = fabric_variant !== "à¹‚à¸›à¸£à¹ˆà¸‡";
Â  Â  Â  Â  const hasSheer = fabric_variant === "à¹‚à¸›à¸£à¹ˆà¸‡" || fabric_variant === "à¸—à¸¶à¸š&à¹‚à¸›à¸£à¹ˆà¸‡";
Â  Â  Â  Â  const sheer_price_per_m = hasSheer
Â  Â  Â  Â  Â  ? clamp01(set.querySelector('[name="sheer_price_per_m"]').value)
Â  Â  Â  Â  Â  : 0;
Â  Â  Â  Â  const yards = CALC.fabricYardage(style, width);
Â  Â  Â  Â  const track = fabric_variant === "à¸—à¸¶à¸š&à¹‚à¸›à¸£à¹ˆà¸‡" ? width * 2 : width;

Â  Â  Â  Â  return {
Â  Â  Â  Â  Â  point_idx: idx + 1,
Â  Â  Â  Â  Â  width_m: width,
Â  Â  Â  Â  Â  height_m: height,
Â  Â  Â  Â  Â  fabric_variant,
Â  Â  Â  Â  Â  open_type,
Â  Â  Â  Â  Â  style,
Â  Â  Â  Â  Â  price_per_m_raw: ppmRaw,
Â  Â  Â  Â  Â  sheer_price_per_m,
Â  Â  Â  Â  Â  fabric_yards_opaque: hasOpaque ? yards : 0,
Â  Â  Â  Â  Â  fabric_yards_sheer: hasSheer ? yards : 0,
Â  Â  Â  Â  Â  track_m: track,
Â  Â  Â  Â  };
Â  Â  Â  }

Â  Â  Â  function serializeRoom(room) {
Â  Â  Â  Â  return {
Â  Â  Â  Â  Â  room_id: Number(room.dataset.index) || null,
Â  Â  Â  Â  Â  room_name: room.querySelector('input[name="room_name"]').value || "",
Â  Â  Â  Â  Â  sets: [...room.querySelectorAll("[data-set]")].map((set, i) =>
Â  Â  Â  Â  Â  Â  serializeSet(set, i)
Â  Â  Â  Â  Â  ),
Â  Â  Â  Â  };
Â  Â  Â  }

Â  Â  Â  function buildPayload() {
Â  Â  Â  Â  const roomsData = [];
Â  Â  Â  Â  let totalTHB = 0;
Â  Â  Â  Â  let allSets = 0;
Â  Â  Â  Â  let totalOpaqueYards = 0;
Â  Â  Â  Â  let totalSheerYards = 0;
Â  Â  Â  Â  let totalTrack = 0;

Â  Â  Â  Â  document.querySelectorAll("[data-room]").forEach((room) => {
Â  Â  Â  Â  Â  const roomObj = serializeRoom(room);
Â  Â  Â  Â  Â  roomObj.sets = [];

Â  Â  Â  Â  Â  room.querySelectorAll("[data-set]").forEach((set, i) => {
Â  Â  Â  Â  Â  Â  const w = clamp01(set.querySelector('input[name="width_m"]').value);
Â  Â  Â  Â  Â  Â  const h = clamp01(
Â  Â  Â  Â  Â  Â  Â  set.querySelector('input[name="height_m"]').value
Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  const hPlus = heightPlus(h);
Â  Â  Â  Â  Â  Â  const variant = set.querySelector(
Â  Â  Â  Â  Â  Â  Â  'select[name="fabric_variant"]'
Â  Â  Â  Â  Â  Â  ).value;
Â  Â  Â  Â  Â  Â  const open_type = set.querySelector('select[name="open_type"]').value || "";
Â  Â  Â  Â  Â  Â  const style = set.querySelector('select[name="style"]').value;
Â  Â  Â  Â  Â  Â  const baseRaw = toNum(set.querySelector('select[name="price_per_m"]').value);
Â  Â  Â  Â  Â  Â  const sPlus = stylePlus(style);
Â  Â  Â  Â  Â  Â  const hasOpaque = variant !== "à¹‚à¸›à¸£à¹ˆà¸‡";
Â  Â  Â  Â  Â  Â  const hasSheer = variant === "à¹‚à¸›à¸£à¹ˆà¸‡" || variant === "à¸—à¸¶à¸š&à¹‚à¸›à¸£à¹ˆà¸‡";
Â  Â  Â  Â  Â  Â  const sheerBase = hasSheer
Â  Â  Â  Â  Â  Â  Â  ? clamp01(set.querySelector('[name="sheer_price_per_m"]').value)
Â  Â  Â  Â  Â  Â  Â  : 0;
Â  Â  Â  Â  Â  Â  const opaquePerM = hasOpaque ? baseRaw + sPlus + hPlus : 0;
Â  Â  Â  Â  Â  Â  const sheerPerM = hasSheer ? sheerBase + sPlus + hPlus : 0;
Â  Â  Â  Â  Â  Â  const price_opaque = Math.round(opaquePerM * w);
Â  Â  Â  Â  Â  Â  const price_sheer = Math.round(sheerPerM * w);
Â  Â  Â  Â  Â  Â  const price = price_opaque + price_sheer;
Â  Â  Â  Â  Â  Â  const units = (price_opaque > 0 ? 1 : 0) + (price_sheer > 0 ? 1 : 0);
Â  Â  Â  Â  Â  Â  const yards = CALC.fabricYardage(style, w);
Â  Â  Â  Â  Â  Â  const track = variant === "à¸—à¸¶à¸š&à¹‚à¸›à¸£à¹ˆà¸‡" ? w * 2 : w;

Â  Â  Â  Â  Â  Â  roomObj.sets.push({
Â  Â  Â  Â  Â  Â  Â  point_idx: i + 1,
Â  Â  Â  Â  Â  Â  Â  width_m: w,
Â  Â  Â  Â  Â  Â  Â  height_m: h,
Â  Â  Â  Â  Â  Â  Â  fabric_variant: variant,
Â  Â  Â  Â  Â  Â  Â  open_type: open_type,
Â  Â  Â  Â  Â  Â  Â  style: style,
Â  Â  Â  Â  Â  Â  Â  price_per_m_raw: baseRaw,
Â  Â  Â  Â  Â  Â  Â  price_per_m_opaque: opaquePerM,
Â  Â  Â  Â  Â  Â  Â  price_per_m_sheer: sheerPerM,
Â  Â  Â  Â  Â  Â  Â  price_opaque,
Â  Â  Â  Â  Â  Â  Â  price_sheer,
Â  Â  Â  Â  Â  Â  Â  price,
Â  Â  Â  Â  Â  Â  Â  units,
Â  Â  Â  Â  Â  Â  Â  fabric_yards_opaque: hasOpaque ? yards : 0,
Â  Â  Â  Â  Â  Â  Â  fabric_yards_sheer: hasSheer ? yards : 0,
Â  Â  Â  Â  Â  Â  Â  track_m: track
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  totalTHB += price;
Â  Â  Â  Â  Â  Â  allSets += units;
Â  Â  Â  Â  Â  Â  if(hasOpaque) totalOpaqueYards += yards;
Â  Â  Â  Â  Â  Â  if(hasSheer) totalSheerYards += yards;
Â  Â  Â  Â  Â  Â  if (hasOpaque || hasSheer) totalTrack += track;
Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  roomsData.push(roomObj);
Â  Â  Â  Â  });

Â  Â  Â  Â  return {
Â  Â  Â  Â  Â  customer_name: document.querySelector('input[name="customer_name"]').value || "",
Â  Â  Â  Â  Â  customer_address: document.querySelector('input[name="customer_address"]').value || "",
Â  Â  Â  Â  Â  customer_phone: document.querySelector('input[name="customer_phone"]').value || "",
Â  Â  Â  Â  Â  app_version: APP_VERSION,
Â  Â  Â  Â  Â  generated_at: new Date().toISOString(),
Â  Â  Â  Â  Â  total_thb: totalTHB,
Â  Â  Â  Â  Â  total_sets: allSets,
Â  Â  Â  Â  Â  total_yards: totalOpaqueYards + totalSheerYards,
Â  Â  Â  Â  Â  total_opaque_yards: totalOpaqueYards,
Â  Â  Â  Â  Â  total_sheer_yards: totalSheerYards,
Â  Â  Â  Â  Â  total_track_m: totalTrack,
Â  Â  Â  Â  Â  rooms: roomsData,
Â  Â  Â  Â  };
Â  Â  Â  }

Â  Â  Â  document.addEventListener("change", (e) => {
Â  Â  Â  Â  const el = e.target;
Â  Â  Â  Â  if (el.matches('[name="fabric_variant"]')) {
Â  Â  Â  Â  Â  toggleSetFabricUI(el.closest("[data-set]"));
Â  Â  Â  Â  }
Â  Â  Â  Â  debounce(() => { recalcAll(); saveData(); })();
Â  Â  Â  });
Â  Â  Â  document.addEventListener("input", debounce(() => { recalcAll(); saveData(); }));
Â  Â  Â  document.addEventListener("click", (e) => {
Â  Â  Â  Â  const btn = e.target.closest("button[data-act]");
Â  Â  Â  Â  if (!btn) return;
Â  Â  Â  Â  const act = btn.dataset.act;
Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  if (act === "del-room") delRoom(btn);
Â  Â  Â  Â  else if (act === "del-set") delSet(btn);
Â  Â  Â  Â  else if (act === "add-set") addSet(btn.closest("[data-room]"));
Â  Â  Â  Â  else if (act === "add-room") addRoom();
Â  Â  Â  Â  else if (act === "dup-room") dupRoom(btn);
Â  Â  Â  Â  else if (act === "dup-set") dupSet(btn);
Â  Â  Â  Â  else if (act === "clear-set") clearSet(btn);
Â  Â  Â  Â  else if (act === "toggle-room") {
Â  Â  Â  Â  Â  const details = btn.closest("details");
Â  Â  Â  Â  Â  details.open = !details.open;
Â  Â  Â  Â  Â  updateToggleBtnText(btn);
Â  Â  Â  Â  }
Â  Â  Â  });
Â  Â  Â  document.addEventListener("submit", (e) => {
Â  Â  Â  Â  if (isLocked) {
Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  const form = e.target;
Â  Â  Â  Â  if (form.id === "orderForm") {
Â  Â  Â  Â  Â  const payloadEl = form.querySelector("#payload");
Â  Â  Â  Â  Â  payloadEl.value = JSON.stringify(buildPayload());
Â  Â  Â  Â  }
Â  Â  Â  });
Â  Â  Â Â 
Â  Â  Â  clearAllBtn.addEventListener("click", clearAllData);
Â  Â  Â  lockBtn.addEventListener("click", toggleLock);
Â  Â  Â  addRoomHeaderBtn.addEventListener("click", addRoom);
Â  Â  Â  copyBtn.addEventListener("click", () => {
Â  Â  Â  Â  navigator.clipboard.writeText(JSON.stringify(buildPayload(), null, 2));
Â  Â  Â  });
Â  Â  Â Â 
Â  Â  Â  window.addEventListener('load', loadData);
Â  Â  Â  updateLockState();
Â  Â  </script>
Â  </body>
</html>