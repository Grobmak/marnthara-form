<!DOCTYPE html>
<html lang="th" dir="ltr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="description" content="Marnthara Tool - ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏Ñ‡∏¥‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ú‡πâ‡∏≤‡∏°‡πà‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏Ç‡∏≠‡∏á‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á" />
  <title>Marnthara - Fixed UI</title>

  <script src="https://unpkg.com/@phosphor-icons/web"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"
    integrity="sha512-GsLlZN/3F2ErC5ifS5QtgpiJtWd43JWSuIgh7mbzZ8zBps+dvLusV+eNQATqgA/HdeKFVgA5v3S/cIrLF7QnIg=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <style>
/* ----- Reset + Variables ----- */
@import "https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@300;500;700&display=swap";
:root{
  --font-family: "Noto Sans Thai", sans-serif;
  --bg:#F8F9FC; --surface:rgba(255,255,255,.95); --glass-border:rgba(255,255,255,.5);
  --primary:#ADBBD2; --on-surface:#202124; --outline:#DDE2E7;
  --shadow:0 6px 18px rgba(0,0,0,.08);
  --radius-lg:16px;
}
*{box-sizing:border-box;margin:0;padding:0}
html{scroll-behavior:smooth}
body{font-family:var(--font-family);background:var(--bg);color:var(--on-surface);padding-bottom:96px}
a{color:inherit;text-decoration:none}
.hidden{display:none!important}

/* ----- Layout ----- */
.container{max-width:900px;margin:12px auto;padding:12px}
.main-header{position:sticky;top:0;z-index:40;background:var(--surface);backdrop-filter:blur(8px);border-bottom:1px solid var(--glass-border);display:flex;align-items:center;gap:12px;padding:12px;border-radius:0 0 var(--radius-lg) var(--radius-lg);box-shadow:var(--shadow)}
.header-title{font-weight:700;color:var(--primary);font-size:1.4rem;flex:1}
.header-actions{display:flex;gap:8px;align-items:center}

/* menu */
.menu-container{position:relative}
.menu-btn{background:var(--primary);color:#fff;padding:.5rem .9rem;border-radius:12px;border:0;cursor:pointer}
.menu-dropdown{position:absolute;right:0;top:calc(100% + 8px);width:260px;background:var(--surface);border:1px solid var(--outline);border-radius:12px;padding:.4rem 0;box-shadow:0 10px 30px rgba(0,0,0,.12);max-height:60vh;overflow:auto;display:none;z-index:60}
.menu-dropdown a{display:block;padding:.6rem 12px;font-weight:600;color:var(--on-surface)}
.menu-dropdown a:hover{background:#f1f3f8;color:var(--primary)}

/* main content */
.card{background:var(--surface);border:1px solid var(--outline);border-radius:12px;box-shadow:var(--shadow);margin:12px 0;padding:12px}
.card h2{display:flex;align-items:center;gap:.6rem;font-size:1.1rem}
.form-grid-2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.form-group{display:flex;flex-direction:column;gap:6px}
.form-group label{font-size:.9rem;color:#555}
input,textarea,select{padding:.6rem;border-radius:10px;border:1px solid var(--outline);background:#fff}

/* footer fixed */
.summary-footer{position:fixed;left:0;right:0;bottom:0;background:var(--surface);border-top:1px solid var(--glass-border);padding:10px;box-shadow:0 -8px 20px rgba(0,0,0,.06);z-index:80}
.summary-grid{max-width:900px;margin:0 auto;display:flex;justify-content:space-between;align-items:center;gap:8px;padding:0 12px}
.btn{padding:.5rem .9rem;border-radius:12px;border:0;cursor:pointer;background:var(--primary);color:#fff;font-weight:700}

/* templates area tweaks */
.items-container{display:flex;flex-direction:column;gap:10px;margin-top:10px}
.item-card{border-left:4px solid #f7a; padding:10px;border-radius:8px;background:#fff;border:1px solid var(--outline)}

/* responsive */
@media (max-width:720px){
  .form-grid-2{grid-template-columns:1fr}
  .menu-dropdown{left:12px;right:12px;top:64px;width:auto;max-height:calc(100vh - 140px)}
  .header-title{font-size:1.1rem}
  body{padding-bottom:120px}
}
  </style>
</head>
<body>
  <div class="container">
    <header class="main-header">
      <div class="header-title">Marnthara</div>
      <div class="header-actions">
        <div class="menu-container">
          <button id="menuBtn" class="menu-btn" aria-haspopup="true" aria-controls="menuDropdown" aria-expanded="false">‚â° ‡πÄ‡∏°‡∏ô‡∏π</button>
          <nav id="menuDropdown" class="menu-dropdown" aria-hidden="true">
            <a href="#" id="overviewBtn">üìã ‡∏™‡∏£‡∏∏‡∏õ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°</a>
            <a href="#" id="copyTextBtn">üìù ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏™‡∏£‡∏∏‡∏õ (LINE)</a>
            <a href="#" id="exportPdfBtn">üìÑ ‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤ (PDF)</a>
            <hr />
            <a href="#" id="themeToggleBtn">üåì ‡∏™‡∏•‡∏±‡∏ö‡∏ò‡∏µ‡∏°</a>
          </nav>
        </div>
      </div>
    </header>

    <main id="app" role="main">
      <form id="orderForm" novalidate autocomplete="off">
        <section class="card" id="customerCard">
          <h2> <i class="ph ph-user-circle"></i> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</h2>
          <div class="form-grid-2">
            <div class="form-group">
              <label for="customer_name">‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</label>
              <input id="customer_name" name="customer_name" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠" />
            </div>
            <div class="form-group">
              <label for="customer_phone">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
              <input id="customer_phone" name="customer_phone" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£" />
            </div>
          </div>
          <div class="form-group" style="margin-top:10px">
            <label for="customer_address">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</label>
            <textarea id="customer_address" name="customer_address" rows="2" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà"></textarea>
          </div>
        </section>

        <section class="card" id="roomsCard">
          <h2> ‡∏´‡πâ‡∏≠‡∏á/‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</h2>
          <div id="roomsContainer" class="items-container"></div>
          <div style="margin-top:8px">
            <button id="addRoomBtn" type="button" class="btn">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡πâ‡∏≠‡∏á</button>
          </div>
        </section>
      </form>
    </main>
  </div>

  <div class="summary-footer" role="contentinfo">
    <div class="summary-grid">
      <div>
        <button id="lockBtn" class="btn" style="background:#666">üîí</button>
      </div>
      <div style="text-align:right">
        <div> <span id="setCount">0</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
        <div style="font-weight:700">‡∏£‡∏ß‡∏° <span id="grandTotal">0</span> ‡∏ö‡∏≤‡∏ó</div>
      </div>
      <div>
        <button id="exportBtn" class="btn">Export JSON</button>
      </div>
    </div>
  </div>

  <div id="printable" style="display:none"></div>

  <!-- Templates -->
  <template id="roomTemplate">
    <div class="room">
      <div style="display:flex;align-items:center;gap:8px;justify-content:space-between">
        <input class="room-name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: ‡∏´‡πâ‡∏≠‡∏á 1)" style="flex:1;padding:.5rem;border-radius:8px;border:1px solid #ddd" />
        <button class="del-room" title="‡∏•‡∏ö‡∏´‡πâ‡∏≠‡∏á" style="margin-left:8px;padding:.4rem .6rem;border-radius:8px">üóë</button>
      </div>
      <div class="sets" style="margin-top:8px"></div>
      <div style="margin-top:8px">
        <button class="add-set btn" type="button" style="background:#4CAF50">+ ‡∏ú‡πâ‡∏≤‡∏°‡πà‡∏≤‡∏ô</button>
      </div>
    </div>
  </template>

  <template id="setTemplate">
    <div class="item-card">
      <div style="display:flex;gap:8px;align-items:center">
        <div style="flex:1">
          <div style="display:flex;gap:8px">
            <input class="width" placeholder="‡∏Å‡∏ß‡πâ‡∏≤‡∏á(m)" style="width:90px;padding:.4rem;border-radius:6px;border:1px solid #ddd" />
            <input class="height" placeholder="‡∏™‡∏π‡∏á(m)" style="width:90px;padding:.4rem;border-radius:6px;border:1px solid #ddd" />
            <select class="variant" style="padding:.4rem;border-radius:6px;border:1px solid #ddd">
              <option value="‡∏ó‡∏∂‡∏ö">‡∏ú‡πâ‡∏≤‡∏ó‡∏∂‡∏ö</option>
              <option value="‡πÇ‡∏õ‡∏£‡πà‡∏á">‡∏ú‡πâ‡∏≤‡πÇ‡∏õ‡∏£‡πà‡∏á</option>
              <option value="‡∏ó‡∏∂‡∏ö&‡πÇ‡∏õ‡∏£‡πà‡∏á">‡∏ó‡∏∂‡∏ö&‡πÇ‡∏õ‡∏£‡πà‡∏á</option>
            </select>
            <input class="price" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏°." style="width:120px;padding:.4rem;border-radius:6px;border:1px solid #ddd" />
          </div>
        </div>
        <button class="del-set" title="‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£" style="padding:.4rem .6rem;border-radius:6px">‚úñ</button>
      </div>
      <div style="margin-top:8px">‡∏£‡∏ß‡∏°: <span class="set-total">0</span> ‡∏ö‡∏≤‡∏ó</div>
    </div>
  </template>

  <script>
/* Minimal interactive script: menu, theme, rooms/sets, calc, export */
(function(){
  const $ = s => document.querySelector(s);
  const $$ = s => Array.from(document.querySelectorAll(s));
  const menuBtn = $('#menuBtn'), menu = $('#menuDropdown');
  const themeBtn = $('#themeToggleBtn');
  const roomsContainer = $('#roomsContainer');
  const addRoomBtn = $('#addRoomBtn');
  const setCountEl = $('#setCount'), grandTotalEl = $('#grandTotal');
  const exportBtn = $('#exportBtn');

  function showMenu(show){
    menu.style.display = show ? 'block' : 'none';
    menu.setAttribute('aria-hidden', show ? 'false' : 'true');
    menuBtn.setAttribute('aria-expanded', show ? 'true' : 'false');
  }
  menuBtn?.addEventListener('click', e => { e.stopPropagation(); showMenu(menu.style.display !== 'block'); });
  document.addEventListener('click', ()=> showMenu(false));

  // theme
  const THEME_KEY = 'marnthara.theme';
  function applyTheme(){
    const t = localStorage.getItem(THEME_KEY) || 'light';
    document.body.classList.toggle('dark-theme', t === 'dark');
  }
  themeBtn?.addEventListener('click', e => { e.preventDefault(); const now = document.body.classList.contains('dark-theme') ? 'light' : 'dark'; localStorage.setItem(THEME_KEY, now); applyTheme(); });
  applyTheme();

  // utils
  const num = v => { const n = parseFloat(String(v||'').replace(/,/g,'')); return isNaN(n)?0:n; }
  const fmt = n => (Math.round(n)).toLocaleString('th-TH');

  // state in-memory
  const STATE_KEY = 'marnthara.tmp';
  let APP = JSON.parse(localStorage.getItem(STATE_KEY) || '{"rooms":[{"name":"‡∏´‡πâ‡∏≠‡∏á 1","sets":[]}]}');

  function save(){ localStorage.setItem(STATE_KEY, JSON.stringify(APP)); }
  function calcSet(s){
    const w = num(s.width.value), h = num(s.height.value), price = num(s.price.value);
    const variant = s.variant.value||'‡∏ó‡∏∂‡∏ö';
    let total = 0;
    if(variant === '‡∏ó‡∏∂‡∏ö&‡πÇ‡∏õ‡∏£‡πà‡∏á'){
      // assume price covers opaque; no separate sheer input here -> double-count if needed
      total = price * w * 2;
    } else {
      total = price * w;
    }
    s.totalEl.textContent = fmt(total);
    return total;
  }

  function render(){
    roomsContainer.innerHTML = '';
    let overall = 0; let count = 0;
    APP.rooms.forEach((r,ri) => {
      const rt = document.getElementById('roomTemplate').content.firstElementChild.cloneNode(true);
      const nameInput = rt.querySelector('.room-name');
      nameInput.value = r.name || `‡∏´‡πâ‡∏≠‡∏á ${ri+1}`;
      nameInput.addEventListener('input', ()=>{ APP.rooms[ri].name = nameInput.value; save(); });

      const setsWrap = rt.querySelector('.sets');
      r.sets.forEach((s,si)=>{
        const st = document.getElementById('setTemplate').content.firstElementChild.cloneNode(true);
        const width = st.querySelector('.width'); width.value = s.width || '';
        const height = st.querySelector('.height'); height.value = s.height || '';
        const variant = st.querySelector('.variant'); variant.value = s.variant || '‡∏ó‡∏∂‡∏ö';
        const price = st.querySelector('.price'); price.value = s.price || '';
        const totalEl = st.querySelector('.set-total');
        const delBtn = st.querySelector('.del-set');

        const bindUpdate = () => {
          APP.rooms[ri].sets[si] = { width: width.value, height: height.value, variant: variant.value, price: price.value };
          save();
          const t = calcSet({ width, height, variant, price, totalEl });
          overall += t;
          if(t>0) count++;
          updateSummary(overall,count);
        };
        // attach totalEl for calcSet
        const setObj = { width, height, variant, price, totalEl };
        width.addEventListener('input', ()=>{ bindUpdate(); render(); });
        height.addEventListener('input', ()=>{ bindUpdate(); render(); });
        variant.addEventListener('change', ()=>{ bindUpdate(); render(); });
        price.addEventListener('input', ()=>{ bindUpdate(); render(); });

        delBtn.addEventListener('click', ()=>{ APP.rooms[ri].sets.splice(si,1); save(); render(); });

        calcSet(setObj);
        setsWrap.appendChild(st);
      });

      // add-set button
      rt.querySelector('.add-set')?.addEventListener('click', ()=>{ APP.rooms[ri].sets.push({width:'',height:'',variant:'‡∏ó‡∏∂‡∏ö',price:''}); save(); render(); });

      rt.querySelector('.del-room')?.addEventListener('click', ()=>{ APP.rooms.splice(ri,1); save(); render(); });

      roomsContainer.appendChild(rt);
    });

    // if no rooms, ensure one
    if(APP.rooms.length===0){ APP.rooms.push({name:'‡∏´‡πâ‡∏≠‡∏á 1',sets:[]}); save(); render(); return; }

    // compute overall & count fresh
    overall = 0; count = 0;
    APP.rooms.forEach(r=>{
      r.sets.forEach(s=>{
        const p = (parseFloat(s.price||0) || 0) * (parseFloat(s.width||0) || 0);
        if(s.variant === '‡∏ó‡∏∂‡∏ö&‡πÇ‡∏õ‡∏£‡πà‡∏á') overall += p*2;
        else overall += p;
        if(p>0) count++;
      });
    });
    updateSummary(overall,count);
  }

  function updateSummary(total,count){
    setCountEl.textContent = String(count);
    grandTotalEl.textContent = String(fmt(total));
  }

  // add room
  addRoomBtn.addEventListener('click', ()=>{ APP.rooms.push({name:`‡∏´‡πâ‡∏≠‡∏á ${APP.rooms.length+1}`,sets:[]}); save(); render(); });

  // export json
  exportBtn.addEventListener('click', ()=> {
    const blob = new Blob([JSON.stringify(APP, null, 2)], {type:'application/json'});
    const a = document.createElement('a'); a.href = URL.createObjectURL(blob);
    a.download = `marnthara-${new Date().toISOString().slice(0,10)}.json`; a.click();
    URL.revokeObjectURL(a.href);
  });

  // export PDF simple
  $('#exportPdfBtn')?.addEventListener('click', (e)=>{ e.preventDefault();
    const printable = document.getElementById('printable');
    let html = `<div style="font-family:Arial;padding:18px"><h2>‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤</h2>`;
    html += `<p>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤: ${$('#customer_name').value || '-'}</p>`;
    APP.rooms.forEach((r,ri)=>{
      html += `<h4>‡∏´‡πâ‡∏≠‡∏á: ${r.name||'‡∏´‡πâ‡∏≠‡∏á'+(ri+1)}</h4>`;
      if(!r.sets.length) html += `<p>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>`;
      else {
        html += `<ul>`;
        r.sets.forEach(s=> html += `<li>${s.variant} - ${s.width} x ${s.height} ‡∏°. : ${s.price||0} /‡∏°.</li>`);
        html += `</ul>`;
      }
    });
    html += `</div>`; printable.innerHTML = html; printable.style.display='block';
    try{
      html2pdf().from(printable).set({filename:'quote.pdf', margin:10, html2canvas:{scale:2}}).save().finally(()=>printable.style.display='none');
    }catch(e){ alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á PDF'); printable.style.display='none'; }
  });

  // initial render
  render();
})();
  </script>
</body>
</html>
