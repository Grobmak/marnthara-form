<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
    <title>Marnthara Quote (v3.1)</title>
    <link rel="stylesheet" href="style.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>

    <header class="header">
        <h1>Marnthara Quote</h1>
        <div class="header-actions">
            <button type="button" class="btn btn-icon" id="menuBtn" title="เมนู">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M3 4H21V6H3V4ZM3 11H21V13H3V11ZM3 18H21V20H3V18Z"></path></svg>
            </button>
        </div>
        <div class="menu-dropdown" id="menuDropdown">
            <button type="button" class="btn" id="addRoomHeaderBtn">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M11 11V5H13V11H19V13H13V19H11V13H5V11H11Z"></path></svg>
                เพิ่มห้อง
            </button>
             <button type="button" class="btn" id="lockBtn">
                <svg class="lock-icon-open" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M18 8H17V6C17 3.24 14.76 1 12 1C9.24 1 7 3.24 7 6V8H6C4.9 8 4 8.9 4 10V20C4 21.1 4.9 22 6 22H18C19.1 22 20 21.1 20 20V10C20 8.9 19.1 8 18 8ZM12 17C10.9 17 10 16.1 10 15C10 13.9 10.9 13 12 13C13.1 13 14 13.9 14 15C14 16.1 13.1 17 12 17ZM9 8V6C9 4.34 10.34 3 12 3C13.66 3 15 4.34 15 6V8H9Z"></path></svg>
                <svg class="lock-icon-closed" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M18 8H17V6C17 3.24 14.76 1 12 1C9.24 1 7 3.24 7 6H9C9 4.34 10.34 3 12 3C13.66 3 15 4.34 15 6V8H18V10H20V20C20 21.1 19.1 22 18 22H6C4.9 22 4 21.1 4 20V10C4 8.9 4.9 8 6 8H7V6C7 5.45 7.45 5 8 5C8.55 5 9 5.45 9 6H7V8H6V10H4V8H6V6C6 2.69 8.69 0 12 0C15.31 0 18 2.69 18 6V8ZM12 17C10.9 17 10 16.1 10 15C10 13.9 10.9 13 12 13C13.1 13 14 13.9 14 15C14 16.1 13.1 17 12 17Z"></path></svg>
                <span class="lock-text">ล็อคฟอร์ม</span>
            </button>
            <button type="button" class="btn" id="importBtn">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M13 10H18.5L13 4.5V10ZM6 2H14L20 8V20C20 21.1 19.1 22 18 22H6C4.89 22 4 21.1 4 20V4C4 2.9 4.89 2 6 2ZM11.03 14L9.5 15.53L11.03 17.06L9.97 18.12L7.38 15.53L9.97 12.94L11.03 14ZM14.03 14L15.56 12.47L14.03 11L15.1 9.94L17.69 12.53L15.1 15.12L14.03 14Z"></path></svg>
                Import (JSON)
            </button>
            <button type="button" class="btn" id="exportBtn">
                 <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M19 9H15V3H9V9H5L12 16L19 9ZM5 18V20H19V18H5Z"></path></svg>
                 Export (JSON)
            </button>
            <div class="divider"></div>
            <button type="button" class="btn btn-danger" id="clearAllBtn">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M17 6H22V8H20V21C20 21.5523 19.5523 22 19 22H5C4.44772 22 4 21.5523 4 21V8H2V6H7V3C7 2.44772 7.44772 2 8 2H16C16.5523 2 17 2.44772 17 3V6ZM18 8H6V20H18V8ZM9 11H11V17H9V11ZM13 11H15V17H13V11ZM9 4V6H15V4H9Z"></path></svg>
                ล้างทั้งหมด
            </button>
        </div>
    </header>

    <main>
        <form id="orderForm" method="post" target="hiddenFrame">
            <div class="card" id="customerInfo">
                <div class="card-header">ข้อมูลลูกค้า</div>
                <div class="card-body">
                    <div class="row two-col">
                        <div><label for="customer_name">ชื่อลูกค้า</label><input class="field" id="customer_name" type="text" name="customer_name" placeholder="เช่น คุณสมชาย" /></div>
                        <div><label for="customer_phone">เบอร์โทร</label><input class="field" id="customer_phone" type="tel" name="customer_phone" placeholder="088-555-9955" /></div>
                    </div>
                    <div class="row">
                        <div><label for="customer_address">รายละเอียดเพิ่มเติม</label><input class="field" id="customer_address" type="text" name="customer_address" placeholder="เช่น ที่อยู่, โครงการ" /></div>
                    </div>
                </div>
            </div>
            <input type="hidden" name="payload" id="payload" />
            <div id="rooms"></div>
        </form>
    </main>

    <div class="sticky-footer">
        <div class="footer-summary">
            <div class="summary-grid">
                <div class="summary-item"><span class="summary-label">ผ้าม่าน</span><span class="summary-value" id="setCountSets">0</span></div>
                <div class="summary-item"><span class="summary-label">ตกแต่ง</span><span class="summary-value" id="setCountDeco">0</span></div>
                <div class="summary-item"><span class="summary-label">รวม</span><span class="summary-value" id="setCount">0 ชุด</span></div>
            </div>
            <div class="grand-total-wrap">
                <span class="summary-label">ราคารวมสุทธิ</span>
                <span class="summary-value price" id="grandTotal">0</span>
            </div>
        </div>
        <div class="footer-actions">
            <button type="button" class="btn btn-secondary" id="summaryMaterialBtn">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M3 8H15V10H3V8ZM3 13H15V15H3V13ZM3 18H15V20H3V18ZM21.4142 6.58579L16 12L21.4142 17.4142L20 18.8284L13.1716 12L20 5.17157L21.4142 6.58579Z"></path></svg>
                สรุปวัสดุ
            </button>
            <button type="button" class="btn btn-primary" id="copyTextBtn">
                 <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M16 1H4C2.9 1 2 1.9 2 3V17H4V3H16V1ZM19 5H8C6.9 5 6 5.9 6 7V21C6 22.1 6.9 23 8 23H19C20.1 23 21 22.1 21 21V7C21 5.9 20.1 5 19 5ZM19 21H8V7H19V21Z"></path></svg>
                คัดลอก
            </button>
            <button type="submit" class="btn btn-submit" id="submitBtn">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M3 13H11V11H3M3 18H11V16H3M3 8H11V6H3M13 22.5L22.5 13L13 3.5V8.6C8.2 9.1 5.4 12.3 4.4 16.8C5.9 14.2 8.7 12.6 13 12.5V22.5Z"></path></svg>
                ส่งข้อมูล
            </button>
        </div>
    </div>

    <div id="toast-container"></div>
    <iframe name="hiddenFrame" class="hidden"></iframe>

    <div id="confirmationModal" class="modal-overlay">
        <div class="modal">
            <h3 class="modal-title" id="modalTitle">ยืนยัน</h3><p class="modal-body" id="modalBody">คุณแน่ใจหรือไม่?</p>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" id="modalCancel">ยกเลิก</button>
                <button type="button" class="btn btn-danger" id="modalConfirm">ยืนยัน</button>
            </div>
        </div>
    </div>
    
    <div id="importModal" class="modal-overlay">
        <div class="modal">
            <h3 class="modal-title">นำเข้าข้อมูล (JSON)</h3>
            <p class="modal-body">วางข้อมูล JSON ที่คัดลอกมาในช่องด้านล่าง</p>
            <textarea id="importJsonArea" class="field" rows="10"></textarea>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" id="importCancel">ยกเลิก</button>
                <button type="button" class="btn btn-primary" id="importConfirm">นำเข้า</button>
            </div>
        </div>
    </div>

    <div id="copyOptionsModal" class="modal-overlay">
        <div class="modal">
            <h3 class="modal-title">เลือกข้อมูลที่ต้องการคัดลอก</h3>
            <div class="modal-body">
                <label class="form-check"><input type="checkbox" id="copyCustomerInfo" checked><span>ข้อมูลลูกค้า</span></label>
                <label class="form-check"><input type="checkbox" id="copyRoomDetails" checked><span>รายละเอียดห้องและจุด</span></label>
                <label class="form-check"><input type="checkbox" id="copySummary" checked><span>สรุปยอดรวม</span></label>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" id="copyOptionsCancel">ยกเลิก</button>
                <button type="button" class="btn btn-primary" id="copyOptionsConfirm">คัดลอก</button>
            </div>
        </div>
    </div>
    
    <div id="summaryModal" class="modal-overlay">
        <div class="modal">
            <h3 class="modal-title">สรุปวัสดุทั้งหมด</h3>
            <div class="modal-body">
                <div class="summary-line-item"><span>ผ้าทึบที่ใช้</span><span class="price" id="grandFabric">0 หลา</span></div>
                <div class="summary-line-item"><span>รางทึบที่ใช้</span><span class="price" id="grandOpaqueTrack">0 ม.</span></div>
                <hr>
                <div class="summary-line-item"><span>ผ้าโปร่งที่ใช้</span><span class="price" id="grandSheerFabric">0 หลา</span></div>
                <div class="summary-line-item"><span>รางโปร่งที่ใช้</span><span class="price" id="grandSheerTrack">0 ม.</span></div>
            </div>
             <div class="modal-actions">
                <button type="button" class="btn btn-primary" id="summaryModalClose">ปิด</button>
            </div>
        </div>
    </div>

    <template id="roomTpl">
        <div class="card room" data-room>
            <div class="card-header room-head">
                <input class="field-trans" type="text" name="room_name" placeholder="ห้อง 01" required />
                <div class="room-brief" data-room-brief></div>
                <button type="button" class="btn btn-icon btn-toggle" data-act="toggle-room" title="ย่อ/ขยาย">
                    <svg class="icon-expand" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12.0007 10.5865L16.9504 5.63672L18.3646 7.05093L13.4149 12.0007L18.3646 16.9504L16.9504 18.3646L12.0007 13.4149L7.05093 18.3646L5.63672 16.9504L10.5865 12.0007L5.63672 7.05093L7.05093 5.63672L12.0007 10.5865Z"></path></svg>
                </button>
                 <button type="button" class="btn btn-icon btn-danger" data-act="del-room" title="ลบห้อง">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M7 6V3C7 2.44772 7.44772 2 8 2H16C16.5523 2 17 2.44772 17 3V6H22V8H2V6H7ZM6 8V21C6 21.5523 6.44772 22 7 22H17C17.5523 22 18 21.5523 18 21V8H6Z"></path></svg>
                </button>
            </div>
            <div class="card-body">
                <div class="row two-col">
                    <div><label class="required">ราคาผ้า (ทึบ) (ต่อเมตร)</label><select class="field" name="room_price_per_m" required><option value="" hidden>เลือก</option></select></div>
                    <div><label class="required">สไตล์</label><select class="field" name="room_style" required><option value="" hidden>เลือก</option><option>ลอน</option><option>ตาไก่</option><option>จีบ</option></select></div>
                </div>
                <div data-sets></div>
                <div data-decorations></div>
                <div data-wallpapers></div>
                <div class="room-actions">
                    <button type="button" class="btn btn-primary" data-act="add-set">+ ผ้าม่าน</button>
                    <button type="button" class="btn btn-secondary" data-act="add-deco">+ ตกแต่ง</button>
                    <button type="button" class="btn btn-info" data-act="add-wallpaper">+ วอลเปเปอร์</button>
                </div>
            </div>
        </div>
    </template>

    <template id="setTpl">
        <div class="item set" data-set>
            <div class="item-head">
                <div class="item-badge" data-item-title></div>
                <div class="item-price" data-set-price-total>0.-</div>
                <div class="item-actions">
                    <button type="button" class="btn btn-icon btn-warning" data-act="toggle-suspend" title="ระงับ/ใช้งาน"><span data-suspend-text>ระงับ</span></button>
                    <button type="button" class="btn btn-icon" data-act="clear-set" title="ล้างข้อมูล">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M16 2L19.2929 5.29289L16.7071 7.87868L13.4142 4.58579L16 2ZM4 14V20H10V14H4ZM12 1.41421L19.2929 8.70711C19.6834 9.09763 19.6834 9.7308 19.2929 10.1213L10.1213 19.2929C9.7308 19.6834 9.09763 19.6834 8.70711 19.2929L1.41421 12L12 1.41421Z"></path></svg>
                    </button>
                    <button type="button" class="btn btn-icon btn-danger" data-act="del-set" title="ลบชุด">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M17 6H22V8H20V21C20 21.5523 19.5523 22 19 22H5C4.44772 22 4 21.5523 4 21V8H2V6H7V3C7 2.44772 7.44772 2 8 2H16C16.5523 2 17 2.44772 17 3V6Z"></path></svg>
                    </button>
                </div>
            </div>
            <div class="item-body">
                <div class="row two-col">
                    <div><label class="required">กว้าง (ม.)</label><input class="field" name="width_m" type="number" step="0.01" min="0" required /></div>
                    <div><label class="required">สูง (ม.)</label><input class="field" name="height_m" type="number" step="0.01" min="0" required /></div>
                </div>
                <div class="row" data-set-options-row>
                    <div><label>ชนิดผ้า</label><select class="field" name="fabric_variant"><option>ทึบ</option><option>โปร่ง</option><option>ทึบ&โปร่ง</option></select></div>
                    <div data-sheer-wrap class="hidden"><label>ราคาผ้าโปร่ง</label><select class="field" name="sheer_price_per_m"><option value="" hidden>เลือก</option></select></div>
                </div>
                <div class="item-summary">
                    <span data-opaque-yardage-label>ทึบ: <b data-set-yardage-opaque>0</b> หลา, ราง <b data-set-opaque-track>0</b> ม.</span>
                    <span data-sheer-yardage-label class="hidden">โปร่ง: <b data-set-yardage-sheer>0</b> หลา, ราง <b data-set-sheer-track>0</b> ม.</span>
                </div>
            </div>
        </div>
    </template>
    
    <template id="decoTpl">
        <div class="item deco-item" data-deco-item>
            <div class="item-head">
                <div class="item-badge" data-item-title></div>
                <div class="item-price" data-deco-price>0.-</div>
                 <div class="item-actions">
                    <button type="button" class="btn btn-icon btn-warning" data-act="toggle-suspend" title="ระงับ/ใช้งาน"><span data-suspend-text>ระงับ</span></button>
                    <button type="button" class="btn btn-icon" data-act="clear-deco" title="ล้างข้อมูล">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M16 2L19.2929 5.29289L16.7071 7.87868L13.4142 4.58579L16 2ZM4 14V20H10V14H4ZM12 1.41421L19.2929 8.70711C19.6834 9.09763 19.6834 9.7308 19.2929 10.1213L10.1213 19.2929C9.7308 19.6834 9.09763 19.6834 8.70711 19.2929L1.41421 12L12 1.41421Z"></path></svg>
                    </button>
                    <button type="button" class="btn btn-icon btn-danger" data-act="del-deco" title="ลบรายการ">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M17 6H22V8H20V21C20 21.5523 19.5523 22 19 22H5C4.44772 22 4 21.5523 4 21V8H2V6H7V3C7 2.44772 7.44772 2 8 2H16C16.5523 2 17 2.44772 17 3V6Z"></path></svg>
                    </button>
                </div>
            </div>
            <div class="item-body">
                <div class="row two-col">
                    <div><label>ประเภท</label><select class="field" name="deco_type" required><option value="" hidden>เลือก</option><option>มู่ลี่ไม้</option><option>ม่านม้วน</option><option>ปรับแสง</option><option>ฉากPVC</option></select></div>
                    <div><label>ราคา/ตร.หลา</label><input class="field" name="deco_price_sqyd" type="text" inputmode="numeric" required /></div>
                </div>
                 <div class="row two-col">
                    <div><label>กว้าง(ม.)</label><input class="field" name="deco_width_m" type="number" step="0.01" min="0" required /></div>
                    <div><label>สูง(ม.)</label><input class="field" name="deco_height_m" type="number" step="0.01" min="0" required /></div>
                </div>
                <div class="item-summary">พื้นที่: <b data-deco-area>0.00</b> ตร.หลา</div>
            </div>
        </div>
    </template>

    <template id="wallpaperTpl">
        <div class="item wallpaper-item" data-wallpaper-item>
            <div class="item-head">
                <div class="item-badge" data-item-title></div>
                <div class="item-price" data-wallpaper-price>0.-</div>
                 <div class="item-actions">
                    <button type="button" class="btn btn-icon btn-warning" data-act="toggle-suspend" title="ระงับ/ใช้งาน"><span data-suspend-text>ระงับ</span></button>
                    <button type="button" class="btn btn-icon" data-act="clear-wallpaper" title="ล้างข้อมูล">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M16 2L19.2929 5.29289L16.7071 7.87868L13.4142 4.58579L16 2ZM4 14V20H10V14H4ZM12 1.41421L19.2929 8.70711C19.6834 9.09763 19.6834 9.7308 19.2929 10.1213L10.1213 19.2929C9.7308 19.6834 9.09763 19.6834 8.70711 19.2929L1.41421 12L12 1.41421Z"></path></svg>
                    </button>
                    <button type="button" class="btn btn-icon btn-danger" data-act="del-wallpaper" title="ลบรายการ">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M17 6H22V8H20V21C20 21.5523 19.5523 22 19 22H5C4.44772 22 4 21.5523 4 21V8H2V6H7V3C7 2.44772 7.44772 2 8 2H16C16.5523 2 17 2.44772 17 3V6Z"></path></svg>
                    </button>
                </div>
            </div>
            <div class="item-body">
                <div class="row two-col">
                    <div><label>ความสูงห้อง (ม.)</label><input class="field" name="wallpaper_height_m" type="number" step="0.01" min="0" required /></div>
                    <div><label>ราคาต่อม้วน</label><input class="field" name="wallpaper_price_roll" type="text" inputmode="numeric" required /></div>
                </div>
                <div class="walls-section">
                    <label>ความกว้างผนัง (ใส่ทีละด้าน)</label>
                    <div data-walls-container></div>
                    <button type="button" class="btn btn-sm" data-act="add-wall">+ เพิ่มผนัง</button>
                </div>
                <div class="item-summary">
                    พื้นที่รวม: <b data-wallpaper-area>0.00</b> ตร.ม. • ใช้ <b data-wallpaper-rolls>0</b> ม้วน
                </div>
            </div>
        </div>
    </template>

    <template id="wallTpl">
        <div class="wall-input-row">
            <input class="field" name="wall_width_m" type="number" step="0.01" min="0" placeholder="ความกว้าง (ม.)" required />
            <button type="button" class="btn btn-icon btn-danger" data-act="del-wall" title="ลบผนัง">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M17 11V13H7V11H17Z"></path></svg>
            </button>
        </div>
    </template>

    <script src="script.js"></script>
</body>
</html>