/* style.css */
/* --- GLOBAL SETUP & THEME V4 (2025 Color Trends) --- */
@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@400;500;700&display=swap');

:root {
    --font-family: 'Noto Sans Thai', sans-serif;
    --border-radius-sm: 8px;
    --border-radius-md: 12px;
    --border-radius-lg: 16px;
    --border-radius-xl: 28px;
    --transition-speed: 0.3s;

    /* 2025 COLOR PALETTE: Soothing Nature & Earth Tones */
    /* Inspired by https://www.thenordroom.com/color-trends-2025/ */
    --primary: #5A7D8B; /* Calming Blue / Muted Teal */
    --on-primary: #FFFFFF;
    --primary-container: #DDEBF0;
    --on-primary-container: #1A3F4C;

    --secondary: #B48A6E; /* Earthy Terracotta */
    --on-secondary: #FFFFFF;
    --secondary-container: #F3E5DC;
    --on-secondary-container: #5E3E2A;
    
    --danger: #C85C5C; /* Softer, Muted Red */
    --on-danger: #FFFFFF;
    --danger-container: #F9E3E3;
    --on-danger-container: #7A2828;

    --background: #F8F7F4; /* Warm Off-White */
    --surface: #FFFFFF;
    --surface-container: #F2F1ED;
    --surface-container-high: #EBEAE5;
    --on-surface: #1E1E1E;
    --on-surface-variant: #646464;
    
    --outline: #DCDCDC;
    --outline-variant: #BFBFBF;

    /* Shadows & Glow */
    --shadow-color: rgba(90, 125, 139, 0.1);
    --glow-color: rgba(90, 125, 139, 0.15);
    --shadow-sm: 0 2px 4px var(--shadow-color);
    --shadow-md: 0 4px 15px var(--shadow-color), 0 2px 20px var(--glow-color);
    --shadow-lg: 0 10px 25px var(--shadow-color), 0 5px 30px var(--glow-color);

    /* Liquid Glass Effect */
    --glass-bg: rgba(248, 247, 244, 0.7);
    --glass-border: rgba(255, 255, 255, 0.6);

    /* ITEM TYPE COLORS for clear distinction */
    --curtain-color: var(--primary);
    --curtain-container-color: var(--primary-container);
    --deco-color: #889D77; /* Sage Green */
    --deco-container-color: #E6EDDF;
    --wallpaper-color: var(--secondary); /* Earthy Terracotta */
    --wallpaper-container-color: var(--secondary-container);
}

* { box-sizing: border-box; margin: 0; padding: 0; }
html { scroll-behavior: smooth; }
body {
    font-family: var(--font-family);
    background-color: var(--background);
    color: var(--on-surface);
    margin: 0;
    padding-bottom: 100px;
}
h1, h2, h3, h4 { color: var(--on-surface); font-weight: 700; }
i.ph { font-size: 1.25em; vertical-align: middle; }

/* --- LAYOUT & CONTAINERS --- */
#app-container { max-width: 800px; margin: 0 auto; padding: 1rem; }
.main-header {
    background: var(--glass-bg);
    backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
    border-bottom: 1px solid var(--glass-border);
    padding: 0.75rem 1rem;
    display: flex; justify-content: space-between; align-items: center;
    position: sticky; top: 0; z-index: 100;
    border-radius: 0 0 var(--border-radius-lg) var(--border-radius-lg);
    margin: 0 auto 1rem;
    max-width: 824px; width: calc(100% - 8px);
    box-shadow: var(--shadow-md);
}
.main-header h1 { font-size: 1.25rem; color: var(--primary); }
.header-actions { display: flex; align-items: center; gap: 0.5rem; }

/* --- CARD STYLING --- */
.card {
    background-color: var(--surface);
    border-radius: var(--border-radius-lg);
    border: 1px solid var(--outline);
    margin-bottom: 1.5rem;
    box-shadow: var(--shadow-sm);
    overflow: hidden;
    transition: all var(--transition-speed) ease-in-out;
}
.card.is-active-room {
    border-color: var(--primary);
    box-shadow: 0 0 0 3px var(--primary-container), var(--shadow-lg);
}
.room-card.is-suspended { opacity: 0.6; }
.card summary {
    list-style: none; display: flex; justify-content: space-between; align-items: center;
    padding: 0.5rem 0.5rem 0.5rem 1.25rem; cursor: pointer; gap: 0.5rem;
}
.card summary::-webkit-details-marker { display: none; }
.card .expand-icon { transition: transform var(--transition-speed) ease; font-size: 1.5rem; color: var(--on-surface-variant); }
.card[open] > summary .expand-icon { transform: rotate(180deg); }
.card summary h2 { font-size: 1.1rem; display: flex; align-items: center; gap: 0.75rem; flex-grow: 1; }
.card-content { padding: 0.25rem 1.25rem 1.25rem 1.25rem; display: flex; flex-direction: column; gap: 1rem; }
.room-card summary { padding: 0.5rem; }
.room-card summary .form-group { flex-grow: 1; margin: 0; }
.room-summary-controls { display: flex; align-items: center; gap: 0.25rem; flex-shrink: 0; }
.room-name-input {
    font-size: 1.2rem; font-weight: 700; border: none; background: none; outline: none;
    color: var(--on-surface); padding: 0.25rem; width: 100%; border-radius: var(--border-radius-sm);
    transition: all var(--transition-speed);
}
.room-name-input:focus { background-color: var(--primary-container); }
.room-brief { font-size: 0.875rem; color: var(--on-surface-variant); text-align: right; white-space: nowrap; padding: 0 0.5rem; }

/* --- ROOM OPTIONS MENU --- */
.room-options-container { position: relative; }
.room-options-menu {
    position: absolute; top: calc(100% + 4px); right: 0;
    background: var(--glass-bg);
    backdrop-filter: blur(24px); -webkit-backdrop-filter: blur(24px);
    border-radius: var(--border-radius-md); box-shadow: var(--shadow-lg);
    border: 1px solid var(--glass-border);
    overflow: hidden; display: flex; flex-direction: column;
    width: max-content; opacity: 0; visibility: hidden;
    transform: translateY(-10px); transition: all var(--transition-speed) ease; z-index: 20;
}
.room-options-menu.show { opacity: 1; visibility: visible; transform: translateY(0); }
.room-options-menu a {
    padding: 0.75rem 1.25rem; text-decoration: none; color: var(--on-surface);
    display: flex; align-items: center; gap: 0.75rem; font-size: 0.9rem;
}
.room-options-menu a:hover { background-color: var(--surface-container); }
.room-options-menu a.danger { color: var(--danger); }
.room-options-menu a.danger:hover { background-color: var(--danger-container); }

/* --- ITEM CARD STYLING --- */
.items-container { display: flex; flex-direction: column; gap: 1rem; }
.item-card {
    border: 1px solid var(--outline);
    background-color: var(--surface);
    border-radius: var(--border-radius-md);
    border-left: 5px solid var(--outline-variant);
    transition: all var(--transition-speed);
    overflow: hidden;
    box-shadow: none;
}
.item-card.is-suspended {
    opacity: 0.5;
    background-image: repeating-linear-gradient(-45deg, transparent, transparent 5px, rgba(120, 120, 120, 0.1) 5px, rgba(120, 120, 120, 0.1) 10px);
}
.item-header { display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; }
.item-title {
    display: flex; align-items: center; gap: 0.5rem;
    font-size: 1rem; font-weight: 500;
}
.item-title > span { font-weight: 700; }
.deco-type-display { font-weight: normal; }
.item-actions { display: flex; align-items: center; gap: 0.25rem; }

/* Color Coding Rules for clear distinction */
.set-item { border-left-color: var(--curtain-color); }
.set-item .item-header { background-color: var(--curtain-container-color); }
.set-item .item-title { color: var(--on-primary-container); }

.deco-item { border-left-color: var(--deco-color); }
.deco-item .item-header { background-color: var(--deco-container-color); }
.deco-item .item-title { color: #3A4B30; } /* Darker Sage */

.wallpaper-item { border-left-color: var(--wallpaper-color); }
.wallpaper-item .item-header { background-color: var(--wallpaper-container-color); }
.wallpaper-item .item-title { color: var(--on-secondary-container); }

.item-grid { padding: 0.75rem; display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 0.75rem; }
.item-summary {
    background-color: var(--surface-container); padding: 0.75rem;
    font-size: 0.9rem; color: var(--on-surface-variant);
    border-top: 1px solid var(--outline); margin: 0.5rem 0 0 0; text-align: center;
}
.item-summary b { color: var(--on-surface); font-weight: 700; }
.walls-section { margin-top: 0; padding: 0.75rem; border-top: 1px solid var(--outline-variant); }
.walls-section > label { display: block; margin-bottom: 0.5rem; font-weight: 500; }
.walls-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 0.5rem; margin-bottom: 0.75rem; }
.wall-input-row { display: flex; align-items: center; gap: 0.25rem; }

/* --- FORM ELEMENTS --- */
.form-grid-2 { display: grid; grid-template-columns: 1fr; gap: 1rem; }
@media (min-width: 420px) { .form-grid-2 { grid-template-columns: 1fr 1fr; gap: 0.75rem; } }
.form-group { display: flex; flex-direction: column; }
.form-group.full-width-item { grid-column: 1 / -1; }
.form-group label {
    font-size: 0.875rem; color: var(--on-surface-variant);
    margin-bottom: 0.35rem; padding-left: 0.5rem; font-weight: 500;
}
input, textarea, select {
    width: 100%; padding: 0.75rem; border-radius: var(--border-radius-md);
    border: 1px solid var(--outline); background-color: var(--surface-container);
    color: var(--on-surface); font-family: var(--font-family); font-size: 1rem;
    transition: border-color var(--transition-speed), box-shadow var(--transition-speed), background-color var(--transition-speed);
}
input:focus, select:focus, textarea:focus {
    outline: none; border-color: var(--primary);
    box-shadow: 0 0 0 3px var(--primary-container);
    background-color: var(--surface);
}
input:disabled, select:disabled, textarea:disabled {
    background-color: var(--surface-container-high); color: var(--on-surface-variant);
    border-color: var(--outline); cursor: not-allowed; opacity: 0.7;
    -webkit-text-fill-color: var(--on-surface-variant); box-shadow: none;
}

/* --- BUTTONS --- */
.btn {
    display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem; padding: 0.75rem 1.5rem;
    border-radius: var(--border-radius-xl); border: none; font-family: var(--font-family);
    font-size: 1rem; font-weight: 700; cursor: pointer; transition: all var(--transition-speed);
    -webkit-tap-highlight-color: transparent;
}
.btn:active { transform: scale(0.97); }
.btn.btn-primary { background-color: var(--primary); color: var(--on-primary); }
.btn.btn-primary:hover { filter: brightness(1.1); box-shadow: var(--shadow-sm); }
.btn.btn-secondary { background-color: var(--secondary-container); color: var(--on-secondary-container); }
.btn.btn-secondary:hover { filter: brightness(0.97); }
.btn.btn-danger { background-color: var(--danger); color: var(--on-danger); }
.btn.btn-danger:hover { filter: brightness(1.1); box-shadow: var(--shadow-sm); }
.btn-icon {
    background: none; border: none; border-radius: 50%; width: 38px; height: 38px;
    display: inline-flex; align-items: center; justify-content: center; cursor: pointer;
    color: var(--on-surface-variant); transition: background-color var(--transition-speed), color var(--transition-speed);
}
.btn-icon:hover { background-color: var(--surface-container-high); color: var(--primary); }
.btn-icon.danger:hover { background-color: var(--danger-container); color: var(--danger); }
.header-btn:hover, #lockBtn:not(.is-locked):hover { background-color: var(--surface-container-high); }

/* --- HEADER & FOOTER --- */
.summary-footer {
    position: fixed; bottom: 0; left: 0; right: 0;
    background: var(--glass-bg);
    backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
    border-top: 1px solid var(--glass-border); padding: 0.75rem; z-index: 50;
    box-shadow: 0 -5px 30px var(--shadow-color);
}
.summary-grid {
    display: grid; grid-template-columns: 1fr auto; gap: 0.25rem 1rem;
    max-width: 800px; margin: 0 auto; align-items: center;
}
.summary-grid .total-items { color: var(--on-surface-variant); font-size: 0.875rem; }
.summary-grid .grand-total { font-size: 1.3rem; font-weight: 700; color: var(--primary); }
.grand-total span span::after { content: ' บาท'; font-size: 0.9rem; font-weight: normal; color: var(--on-surface-variant); }

/* --- MODALS & TOASTS --- */
.modal-wrapper {
    position: fixed; inset: 0; background-color: rgba(0, 0, 0, 0.5);
    display: flex; align-items: center; justify-content: center; z-index: 200;
    opacity: 0; visibility: hidden; transition: opacity var(--transition-speed), visibility var(--transition-speed);
}
.modal-wrapper.visible { opacity: 1; visibility: visible; }
.modal-content {
    background: var(--surface); border-radius: var(--border-radius-lg); padding: 1.5rem;
    width: 90%; max-width: 400px; box-shadow: var(--shadow-lg);
}
.modal-actions { display: flex; justify-content: flex-end; gap: 0.5rem; margin-top: 1.5rem;}
#toast-container { position: fixed; top: 1rem; left: 50%; transform: translateX(-50%); z-index: 300; display: flex; flex-direction: column; gap: 0.5rem; align-items: center; }
.toast {
    display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem 1.25rem;
    border-radius: var(--border-radius-xl); box-shadow: var(--shadow-lg);
    opacity: 0; transform: translateY(-150%); transition: transform 0.4s ease, opacity 0.4s ease;
}
.toast.show { transform: translateY(0); opacity: 1; }
/* Toast colors are now consistent with the new theme */
.toast-success { background-color: #E6EDDF; color: #3A4B30; } /* Sage */
.toast-warning { background-color: #F3E5DC; color: #5E3E2A; } /* Terracotta */
.toast-error { background-color: var(--danger-container); color: var(--on-danger-container); }
.toast-default { background-color: var(--primary-container); color: var(--on-primary-container); }


/* --- FLOATING ACTION BUTTON (FAB) [FINAL FIX] --- */
.fab-container {
    position: fixed;
    bottom: calc(env(safe-area-inset-bottom, 0rem) + 85px); right: 1.5rem;
    z-index: 150; display: flex; flex-direction: column-reverse; align-items: flex-end;
    /* BUG FIX: This property hints to the browser to optimize the element for transform changes, preventing rendering glitches after scroll. */
    will-change: transform;
}
.fab-main {
    width: 56px; height: 56px; border-radius: var(--border-radius-lg); padding: 0;
    background-color: var(--primary); color: var(--on-primary);
    box-shadow: var(--shadow-lg); font-size: 1.5rem;
}
.fab-main .ph { transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
.fab-container.active .fab-main .ph { transform: rotate(135deg); }
.fab-actions { display: flex; flex-direction: column-reverse; align-items: flex-end; gap: 1rem; }
.fab-action-item {
    opacity: 0; transform: translateY(10px) scale(0.95);
    transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
    padding: 0.75rem 1.2rem 0.75rem 1rem; border-radius: var(--border-radius-md);
    box-shadow: var(--shadow-md); width: max-content; font-size: 0.9rem; font-weight: 700;
}
.fab-container.active .fab-action-item { opacity: 1; transform: translateY(0) scale(1); }
.fab-container.active .fab-action-item:nth-of-type(1) { transition-delay: 0.1s; }
.fab-container.active .fab-action-item:nth-of-type(2) { transition-delay: 0.07s; }
.fab-container.active .fab-action-item:nth-of-type(3) { transition-delay: 0.04s; }
.fab-container.active .fab-action-item:nth-of-type(4) { transition-delay: 0s; }

/* Color coding for FAB action buttons */
.fab-action-item.btn-curtain { background-color: var(--curtain-container-color); color: var(--on-primary-container); }
.fab-action-item.btn-deco { background-color: var(--deco-container-color); color: #3A4B30; }
.fab-action-item.btn-wallpaper { background-color: var(--wallpaper-container-color); color: var(--on-secondary-container); }
.fab-action-item.btn-add-room { background-color: var(--surface-container-high); color: var(--on-surface-variant); }

/* --- ANIMATIONS & UTILITIES --- */
.hidden { display: none !important; }
@keyframes highlight-and-fade-in {
    0% { opacity: 0; transform: translateY(15px); }
    50% { opacity: 1; background-color: var(--primary-container); }
    100% { opacity: 1; transform: translateY(0); background-color: transparent; }
}
.item-created { animation: highlight-and-fade-in 1.2s ease-out forwards; }
@keyframes fade-out-and-shrink {
    from { opacity: 1; transform: scale(1); max-height: 500px; margin: 0.5rem 0; padding: 0.5rem; }
    to { opacity: 0; transform: scale(0.95); max-height: 0; margin: 0; padding: 0; border-width: 0; }
}
.item-removing { overflow: hidden; animation: fade-out-and-shrink 0.4s ease-in forwards; }